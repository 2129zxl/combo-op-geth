<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>op-geth - go-ethereum fork diff overview</title>

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-5443e82c2360e1f2ca8ed1b9">
        
            <div class="col-12 col-sm-9 text-start"><h1>op-geth</h1></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+5052</span></div>
                <div class="text-start"><span class="text-danger">-1896</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-5443e82c2360e1f2ca8ed1b9">
        <div><p>This is an overview of the changes in <a href="https://github.com/ethereum-optimism/op-geth"><code>op-geth</code></a>,
a fork of <a href="https://github.com/ethereum/go-ethereum"><code>go-ethereum</code></a>, part of the OP-stack.</p>

<p>The OP-stack architecture is modular, following the Consensus/Execution split of post-Merge Ethereum L1:</p>

<ul>
<li><a href="https://github.com/ethereum-optimism/optimism/tree/develop/op-node"><code>op-node</code></a> implements most rollup-specific functionality as Consensus-Layer, similar to a L1 beacon-node.</li>
<li><a href="https://github.com/ethereum-optimism/op-geth"><code>op-geth</code></a> implements the Execution-Layer, with <strong>minimal changes</strong> for a secure Ethereum-equivalent application environment.</li>
</ul>

<p>Related <a href="https://github.com/ethereum-optimism/optimism/tree/develop/specs">op-stack specifications</a>:</p>

<ul>
<li><a href="https://github.com/ethereum-optimism/optimism/blob/develop/specs/exec-engine.md">L2 Execution Engine spec</a></li>
<li><a href="https://github.com/ethereum-optimism/optimism/blob/develop/specs/deposits.md">Deposit Transaction spec</a></li>
</ul>
</div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-72636a20f6e0bd7ee92d4a76"role="button" aria-expanded="false" aria-controls="id-72636a20f6e0bd7ee92d4a76">
        
            <div class="col-12 col-sm-9 text-start"><h2>Core modifications</h2></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+986</span></div>
                <div class="text-start"><span class="text-danger">-256</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-72636a20f6e0bd7ee92d4a76">
        <div></div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-b1d5b8c614788460085620f4"role="button" aria-expanded="false" aria-controls="id-b1d5b8c614788460085620f4">
        
            <div class="col-12 col-sm-9 text-start"><h3>State-transition modifications</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+510</span></div>
                <div class="text-start"><span class="text-danger">-34</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-b1d5b8c614788460085620f4">
        <div></div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-dbacc0d2e8f53a009e50b2db"role="button" aria-expanded="false" aria-controls="id-dbacc0d2e8f53a009e50b2db">
        
            <div class="col-12 col-sm-9 text-start"><h4>Deposit Transaction type</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+181</span></div>
                <div class="text-start"><span class="text-danger">-0</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-dbacc0d2e8f53a009e50b2db">
        <div><p>The Bedrock upgrade introduces a <code>Deposit</code> transaction-type (<code>0x7E</code>) to enable both users and the
rollup system itself to change the L2 state based on L1 events and system rules as
<a href="https://github.com/ethereum-optimism/optimism/blob/develop/specs/deposits.md">specified</a>.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82e2652be89e791c7f8b34a0" role="button"
                   aria-expanded="false" aria-controls="id-82e2652be89e791c7f8b34a0">
                    <code>core/types/deposit_tx.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/deposit_tx.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+93</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82e2652be89e791c7f8b34a0"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;deposit_tx.go op-geth&#47;core&#47;types&#47;deposit_tx.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..dc0708a0c208defb6e2c94c3428c26637094f1c3</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;deposit_tx.go</span>
<span class="term-fg36">@@ -0,0 +1,93 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2021 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const DepositTxType = 0x7E</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type DepositTx struct {</span>
<span class="term-fg32">+	&#47;&#47; SourceHash uniquely identifies the source of the deposit</span>
<span class="term-fg32">+	SourceHash common.Hash</span>
<span class="term-fg32">+	&#47;&#47; From is exposed through the types.Signer, not through TxData</span>
<span class="term-fg32">+	From common.Address</span>
<span class="term-fg32">+	&#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	To *common.Address `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	&#47;&#47; Mint is minted on L2, locked on L1, nil if no minting.</span>
<span class="term-fg32">+	Mint *big.Int `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	&#47;&#47; Value is transferred from L2 balance, executed after Mint (if any)</span>
<span class="term-fg32">+	Value *big.Int</span>
<span class="term-fg32">+	&#47;&#47; gas limit</span>
<span class="term-fg32">+	Gas uint64</span>
<span class="term-fg32">+	&#47;&#47; Field indicating if this transaction is exempt from the L2 gas limit.</span>
<span class="term-fg32">+	IsSystemTransaction bool</span>
<span class="term-fg32">+	&#47;&#47; Normal Tx data</span>
<span class="term-fg32">+	Data []byte</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; copy creates a deep copy of the transaction data and initializes all fields.</span>
<span class="term-fg32">+func (tx *DepositTx) copy() TxData {</span>
<span class="term-fg32">+	cpy := &amp;DepositTx{</span>
<span class="term-fg32">+		SourceHash:          tx.SourceHash,</span>
<span class="term-fg32">+		From:                tx.From,</span>
<span class="term-fg32">+		To:                  copyAddressPtr(tx.To),</span>
<span class="term-fg32">+		Mint:                nil,</span>
<span class="term-fg32">+		Value:               new(big.Int),</span>
<span class="term-fg32">+		Gas:                 tx.Gas,</span>
<span class="term-fg32">+		IsSystemTransaction: tx.IsSystemTransaction,</span>
<span class="term-fg32">+		Data:                common.CopyBytes(tx.Data),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.Mint != nil {</span>
<span class="term-fg32">+		cpy.Mint = new(big.Int).Set(tx.Mint)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.Value != nil {</span>
<span class="term-fg32">+		cpy.Value.Set(tx.Value)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; accessors for innerTx.</span>
<span class="term-fg32">+func (tx *DepositTx) txType() byte           { return DepositTxType }</span>
<span class="term-fg32">+func (tx *DepositTx) chainID() *big.Int      { return common.Big0 }</span>
<span class="term-fg32">+func (tx *DepositTx) accessList() AccessList { return nil }</span>
<span class="term-fg32">+func (tx *DepositTx) data() []byte           { return tx.Data }</span>
<span class="term-fg32">+func (tx *DepositTx) gas() uint64            { return tx.Gas }</span>
<span class="term-fg32">+func (tx *DepositTx) gasFeeCap() *big.Int    { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) gasTipCap() *big.Int    { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) gasPrice() *big.Int     { return new(big.Int) }</span>
<span class="term-fg32">+func (tx *DepositTx) value() *big.Int        { return tx.Value }</span>
<span class="term-fg32">+func (tx *DepositTx) nonce() uint64          { return 0 }</span>
<span class="term-fg32">+func (tx *DepositTx) to() *common.Address    { return tx.To }</span>
<span class="term-fg32">+func (tx *DepositTx) isSystemTx() bool       { return tx.IsSystemTransaction }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {</span>
<span class="term-fg32">+	return dst.Set(new(big.Int))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) effectiveNonce() *uint64 { return nil }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) rawSignatureValues() (v, r, s *big.Int) {</span>
<span class="term-fg32">+	return common.Big0, common.Big0, common.Big0</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *DepositTx) setSignatureValues(chainID, v, r, s *big.Int) {</span>
<span class="term-fg32">+	&#47;&#47; this is a noop for deposit transactions</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-35c161fcf036ab519fde606a" role="button"
                   aria-expanded="false" aria-controls="id-35c161fcf036ab519fde606a">
                    <code>core/types/transaction_marshalling.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/transaction_marshalling.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/transaction_marshalling.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+79</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-35c161fcf036ab519fde606a"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction_marshalling.go op-geth&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">index 2566d0b8d6566aa2953cb0456ede19af069e7d4c..dccb54ffcad6e5565a463bc911fc16824ca5e4f6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg36">@@ -19,10 +19,12 @@</span>
 import (
 	&quot;encoding&#47;json&quot;
 	&quot;errors&quot;
<span class="term-fg32">+	&quot;io&quot;</span>
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
 )
&nbsp;
 &#47;&#47; txJSON is the JSON representation of transactions.
<span class="term-fg36">@@ -41,6 +43,12 @@</span> 	V                    *hexutil.Big    `json:&quot;v&quot;`
 	R                    *hexutil.Big    `json:&quot;r&quot;`
 	S                    *hexutil.Big    `json:&quot;s&quot;`
 	To                   *common.Address `json:&quot;to&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Deposit transaction fields</span>
<span class="term-fg32">+	SourceHash *common.Hash    `json:&quot;sourceHash,omitempty&quot;`</span>
<span class="term-fg32">+	From       *common.Address `json:&quot;from,omitempty&quot;`</span>
<span class="term-fg32">+	Mint       *hexutil.Big    `json:&quot;mint,omitempty&quot;`</span>
<span class="term-fg32">+	IsSystemTx *bool           `json:&quot;isSystemTx,omitempty&quot;`</span>
&nbsp;
 	&#47;&#47; Access list transaction fields:
 	ChainID    *hexutil.Big `json:&quot;chainId,omitempty&quot;`
<span class="term-fg36">@@ -94,6 +102,18 @@</span> 		enc.To = tx.To()
 		enc.V = (*hexutil.Big)(itx.V)
 		enc.R = (*hexutil.Big)(itx.R)
 		enc.S = (*hexutil.Big)(itx.S)
<span class="term-fg32">+	case *DepositTx:</span>
<span class="term-fg32">+		enc.Gas = (*hexutil.Uint64)(&amp;itx.Gas)</span>
<span class="term-fg32">+		enc.Value = (*hexutil.Big)(itx.Value)</span>
<span class="term-fg32">+		enc.Data = (*hexutil.Bytes)(&amp;itx.Data)</span>
<span class="term-fg32">+		enc.To = tx.To()</span>
<span class="term-fg32">+		enc.SourceHash = &amp;itx.SourceHash</span>
<span class="term-fg32">+		enc.From = &amp;itx.From</span>
<span class="term-fg32">+		if itx.Mint != nil {</span>
<span class="term-fg32">+			enc.Mint = (*hexutil.Big)(itx.Mint)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		enc.IsSystemTx = &amp;itx.IsSystemTransaction</span>
<span class="term-fg32">+		&#47;&#47; other fields will show up as null.</span>
 	}
 	return json.Marshal(&amp;enc)
 }
<span class="term-fg36">@@ -262,7 +282,54 @@</span> 			if err := sanityCheckSignature(itx.V, itx.R, itx.S, false); err != nil {
 				return err
 			}
 		}
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		if dec.AccessList != nil || dec.MaxFeePerGas != nil ||</span>
<span class="term-fg32">+			dec.MaxPriorityFeePerGas != nil {</span>
<span class="term-fg32">+			return errors.New(&quot;unexpected field(s) in deposit transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if dec.GasPrice != nil &amp;&amp; dec.GasPrice.ToInt().Cmp(common.Big0) != 0 {</span>
<span class="term-fg32">+			return errors.New(&quot;deposit transaction GasPrice must be 0&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if (dec.V != nil &amp;&amp; dec.V.ToInt().Cmp(common.Big0) != 0) ||</span>
<span class="term-fg32">+			(dec.R != nil &amp;&amp; dec.R.ToInt().Cmp(common.Big0) != 0) ||</span>
<span class="term-fg32">+			(dec.S != nil &amp;&amp; dec.S.ToInt().Cmp(common.Big0) != 0) {</span>
<span class="term-fg32">+			return errors.New(&quot;deposit transaction signature must be 0 or unset&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		var itx DepositTx</span>
<span class="term-fg32">+		inner = &amp;itx</span>
<span class="term-fg32">+		if dec.To != nil {</span>
<span class="term-fg32">+			itx.To = dec.To</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if dec.Gas == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;gas&#39; for txdata&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Gas = uint64(*dec.Gas)</span>
<span class="term-fg32">+		if dec.Value == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;value&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Value = (*big.Int)(dec.Value)</span>
<span class="term-fg32">+		&#47;&#47; mint may be omitted or nil if there is nothing to mint.</span>
<span class="term-fg32">+		itx.Mint = (*big.Int)(dec.Mint)</span>
<span class="term-fg32">+		if dec.Data == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;input&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Data = *dec.Data</span>
<span class="term-fg32">+		if dec.From == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;from&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.From = *dec.From</span>
<span class="term-fg32">+		if dec.SourceHash == nil {</span>
<span class="term-fg32">+			return errors.New(&quot;missing required field &#39;sourceHash&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.SourceHash = *dec.SourceHash</span>
<span class="term-fg32">+		&#47;&#47; IsSystemTx may be omitted. Defaults to false.</span>
<span class="term-fg32">+		if dec.IsSystemTx != nil {</span>
<span class="term-fg32">+			itx.IsSystemTransaction = *dec.IsSystemTx</span>
<span class="term-fg32">+		}</span>
&nbsp;
<span class="term-fg32">+		if dec.Nonce != nil {</span>
<span class="term-fg32">+			inner = &amp;depositTxWithNonce{DepositTx: itx, EffectiveNonce: uint64(*dec.Nonce)}</span>
<span class="term-fg32">+		}</span>
 	default:
 		return ErrTxTypeNotSupported
 	}
<span class="term-fg36">@@ -273,3 +340,15 @@</span>
 	&#47;&#47; TODO: check hash here?
 	return nil
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+type depositTxWithNonce struct {</span>
<span class="term-fg32">+	DepositTx</span>
<span class="term-fg32">+	EffectiveNonce uint64</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; EncodeRLP ensures that RLP encoding this transaction excludes the nonce. Otherwise, the tx Hash would change</span>
<span class="term-fg32">+func (tx *depositTxWithNonce) EncodeRLP(w io.Writer) error {</span>
<span class="term-fg32">+	return rlp.Encode(w, tx.DepositTx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *depositTxWithNonce) effectiveNonce() *uint64 { return &amp;tx.EffectiveNonce }</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1c48de59659bf1e38e0433b5" role="button"
                   aria-expanded="false" aria-controls="id-1c48de59659bf1e38e0433b5">
                    <code>core/types/transaction_signing.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/transaction_signing.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/transaction_signing.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+9</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1c48de59659bf1e38e0433b5"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction_signing.go op-geth&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">index 87f0390a6f9ce448873688ef214fc02753856342..70a10eb1c1ed086a4421914f940555e406040c55 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg36">@@ -182,6 +182,9 @@</span> 	return londonSigner{eip2930Signer{NewEIP155Signer(chainId)}}
 }
&nbsp;
 func (s londonSigner) Sender(tx *Transaction) (common.Address, error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return tx.inner.(*DepositTx).From, nil</span>
<span class="term-fg32">+	}</span>
 	if tx.Type() != DynamicFeeTxType {
 		return s.eip2930Signer.Sender(tx)
 	}
<span class="term-fg36">@@ -201,6 +204,9 @@</span> 	return ok &amp;&amp; x.chainId.Cmp(s.chainId) == 0
 }
&nbsp;
 func (s londonSigner) SignatureValues(tx *Transaction, sig []byte) (R, S, V *big.Int, err error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return nil, nil, nil, fmt.Errorf(&quot;deposits do not have a signature&quot;)</span>
<span class="term-fg32">+	}</span>
 	txdata, ok := tx.inner.(*DynamicFeeTx)
 	if !ok {
 		return s.eip2930Signer.SignatureValues(tx, sig)
<span class="term-fg36">@@ -218,6 +224,9 @@</span>
 &#47;&#47; Hash returns the hash to be signed by the sender.
 &#47;&#47; It does not uniquely identify the transaction.
 func (s londonSigner) Hash(tx *Transaction) common.Hash {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		panic(&quot;deposits cannot be signed and do not have a signing hash&quot;)</span>
<span class="term-fg32">+	}</span>
 	if tx.Type() != DynamicFeeTxType {
 		return s.eip2930Signer.Hash(tx)
 	}</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-c657a51d8491b781cf03d92d"role="button" aria-expanded="false" aria-controls="id-c657a51d8491b781cf03d92d">
        
            <div class="col-12 col-sm-9 text-start"><h4>Transaction properties</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+83</span></div>
                <div class="text-start"><span class="text-danger">-0</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-c657a51d8491b781cf03d92d">
        <div><p>The <code>Transaction</code> type now exposes the deposit-transaction and L1-cost properties required for the rollup.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5985cf07010a7902ebe8ac2a" role="button"
                   aria-expanded="false" aria-controls="id-5985cf07010a7902ebe8ac2a">
                    <code>core/types/transaction.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/transaction.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/transaction.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+80</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5985cf07010a7902ebe8ac2a"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction.go op-geth&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">index 89192f049bd5c49dcbb7d06959a570426e4ecf07..6485d0516914a4291a5e7ea95d4f7d0edd4a8642 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg36">@@ -28,6 +28,7 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 )
&nbsp;
<span class="term-fg36">@@ -56,6 +57,9 @@</span> 	&#47;&#47; caches
 	hash atomic.Value
 	size atomic.Value
 	from atomic.Value
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; cache of RollupGasData details to compute the gas the tx takes on L1 for its share of rollup data</span>
<span class="term-fg32">+	rollupGas atomic.Value</span>
 }
&nbsp;
 &#47;&#47; NewTx creates a new transaction.
<span class="term-fg36">@@ -82,6 +86,7 @@</span> 	gasFeeCap() *big.Int
 	value() *big.Int
 	nonce() uint64
 	to() *common.Address
<span class="term-fg32">+	isSystemTx() bool</span>
&nbsp;
 	rawSignatureValues() (v, r, s *big.Int)
 	setSignatureValues(chainID, v, r, s *big.Int)
<span class="term-fg36">@@ -192,6 +197,10 @@</span> 	case DynamicFeeTxType:
 		var inner DynamicFeeTx
 		err := rlp.DecodeBytes(b[1:], &amp;inner)
 		return &amp;inner, err
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		var inner DepositTx</span>
<span class="term-fg32">+		err := rlp.DecodeBytes(b[1:], &amp;inner)</span>
<span class="term-fg32">+		return &amp;inner, err</span>
 	default:
 		return nil, ErrTxTypeNotSupported
 	}
<span class="term-fg36">@@ -287,12 +296,56 @@</span>
 &#47;&#47; Nonce returns the sender account nonce of the transaction.
 func (tx *Transaction) Nonce() uint64 { return tx.inner.nonce() }
&nbsp;
<span class="term-fg32">+&#47;&#47; EffectiveNonce returns the nonce that was actually used as part of transaction execution</span>
<span class="term-fg32">+&#47;&#47; Returns nil if the effective nonce is not known</span>
<span class="term-fg32">+func (tx *Transaction) EffectiveNonce() *uint64 {</span>
<span class="term-fg32">+	type txWithEffectiveNonce interface {</span>
<span class="term-fg32">+		effectiveNonce() *uint64</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if itx, ok := tx.inner.(txWithEffectiveNonce); ok {</span>
<span class="term-fg32">+		return itx.effectiveNonce()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	nonce := tx.inner.nonce()</span>
<span class="term-fg32">+	return &amp;nonce</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; To returns the recipient address of the transaction.
 &#47;&#47; For contract-creation transactions, To returns nil.
 func (tx *Transaction) To() *common.Address {
 	return copyAddressPtr(tx.inner.to())
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; SourceHash returns the hash that uniquely identifies the source of the deposit tx,</span>
<span class="term-fg32">+&#47;&#47; e.g. a user deposit event, or a L1 info deposit included in a specific L2 block height.</span>
<span class="term-fg32">+&#47;&#47; Non-deposit transactions return a zeroed hash.</span>
<span class="term-fg32">+func (tx *Transaction) SourceHash() common.Hash {</span>
<span class="term-fg32">+	if dep, ok := tx.inner.(*DepositTx); ok {</span>
<span class="term-fg32">+		return dep.SourceHash</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return common.Hash{}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Mint returns the ETH to mint in the deposit tx.</span>
<span class="term-fg32">+&#47;&#47; This returns nil if there is nothing to mint, or if this is not a deposit tx.</span>
<span class="term-fg32">+func (tx *Transaction) Mint() *big.Int {</span>
<span class="term-fg32">+	if dep, ok := tx.inner.(*DepositTx); ok {</span>
<span class="term-fg32">+		return dep.Mint</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsDepositTx returns true if the transaction is a deposit tx type.</span>
<span class="term-fg32">+func (tx *Transaction) IsDepositTx() bool {</span>
<span class="term-fg32">+	return tx.Type() == DepositTxType</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsSystemTx returns true for deposits that are system transactions. These transactions</span>
<span class="term-fg32">+&#47;&#47; are executed in an unmetered environment &amp; do not contribute to the block gas limit.</span>
<span class="term-fg32">+func (tx *Transaction) IsSystemTx() bool {</span>
<span class="term-fg32">+	return tx.inner.isSystemTx()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; Cost returns gas * gasPrice + value.
 func (tx *Transaction) Cost() *big.Int {
 	total := new(big.Int).Mul(tx.GasPrice(), new(big.Int).SetUint64(tx.Gas()))
<span class="term-fg36">@@ -300,6 +353,30 @@</span> 	total.Add(total, tx.Value())
 	return total
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; RollupDataGas is the amount of gas it takes to confirm the tx on L1 as a rollup</span>
<span class="term-fg32">+func (tx *Transaction) RollupDataGas() RollupGasData {</span>
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return RollupGasData{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if v := tx.rollupGas.Load(); v != nil {</span>
<span class="term-fg32">+		return v.(RollupGasData)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	data, err := tx.MarshalBinary()</span>
<span class="term-fg32">+	if err != nil { &#47;&#47; Silent error, invalid txs will not be marshalled&#47;unmarshalled for batch submission anyway.</span>
<span class="term-fg32">+		log.Error(&quot;failed to encode tx for L1 cost computation&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var out RollupGasData</span>
<span class="term-fg32">+	for _, byt := range data {</span>
<span class="term-fg32">+		if byt == 0 {</span>
<span class="term-fg32">+			out.Zeroes++</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			out.Ones++</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tx.rollupGas.Store(out)</span>
<span class="term-fg32">+	return out</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; RawSignatureValues returns the V, R, S signature values of the transaction.
 &#47;&#47; The return values should not be modified by the caller.
 func (tx *Transaction) RawSignatureValues() (v, r, s *big.Int) {
<span class="term-fg36">@@ -330,6 +407,9 @@</span> &#47;&#47; EffectiveGasTip returns the effective miner gasTipCap for the given base fee.
 &#47;&#47; Note: if the effective gasTipCap is negative, this method returns both error
 &#47;&#47; the actual negative value, _and_ ErrGasFeeCapTooLow
 func (tx *Transaction) EffectiveGasTip(baseFee *big.Int) (*big.Int, error) {
<span class="term-fg32">+	if tx.Type() == DepositTxType {</span>
<span class="term-fg32">+		return new(big.Int), nil</span>
<span class="term-fg32">+	}</span>
 	if baseFee == nil {
 		return tx.GasTipCap(), nil
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b9084a3fd2c985637f6452b" role="button"
                   aria-expanded="false" aria-controls="id-7b9084a3fd2c985637f6452b">
                    <code>core/types/tx_access_list.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/tx_access_list.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/tx_access_list.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b9084a3fd2c985637f6452b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_access_list.go op-geth&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg1">index 692bba4ff2d9bf4affda01bb23f9f28f1ef41fd1..518fb603754dcd3497d8b8829598736cd640e136 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_access_list.go</span>
<span class="term-fg36">@@ -105,6 +105,7 @@</span> func (tx *AccessListTx) gasFeeCap() *big.Int    { return tx.GasPrice }
 func (tx *AccessListTx) value() *big.Int        { return tx.Value }
 func (tx *AccessListTx) nonce() uint64          { return tx.Nonce }
 func (tx *AccessListTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *AccessListTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *AccessListTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {
 	return dst.Set(tx.GasPrice)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-106f07c2de39f1fd9790956b" role="button"
                   aria-expanded="false" aria-controls="id-106f07c2de39f1fd9790956b">
                    <code>core/types/tx_dynamic_fee.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/tx_dynamic_fee.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/tx_dynamic_fee.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-106f07c2de39f1fd9790956b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_dynamic_fee.go op-geth&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg1">index 5708106658173b2dda9dcce75f53df8899aaa190..ee84b7741f21c8bfbe5dd9f7cce0304d89b6a9bc 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_dynamic_fee.go</span>
<span class="term-fg36">@@ -93,6 +93,7 @@</span> func (tx *DynamicFeeTx) gasPrice() *big.Int     { return tx.GasFeeCap }
 func (tx *DynamicFeeTx) value() *big.Int        { return tx.Value }
 func (tx *DynamicFeeTx) nonce() uint64          { return tx.Nonce }
 func (tx *DynamicFeeTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *DynamicFeeTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *DynamicFeeTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {
 	if baseFee == nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7e815ce678db8ed5a563a774" role="button"
                   aria-expanded="false" aria-controls="id-7e815ce678db8ed5a563a774">
                    <code>core/types/tx_legacy.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/tx_legacy.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/tx_legacy.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7e815ce678db8ed5a563a774"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;tx_legacy.go op-geth&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">index 988de7db09aa6fb14bf02e53c66d766f7e887b20..3fdbaf1eec4d5f22ffa47c8723c095ff825fde97 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg36">@@ -102,6 +102,7 @@</span> func (tx *LegacyTx) gasFeeCap() *big.Int    { return tx.GasPrice }
 func (tx *LegacyTx) value() *big.Int        { return tx.Value }
 func (tx *LegacyTx) nonce() uint64          { return tx.Nonce }
 func (tx *LegacyTx) to() *common.Address    { return tx.To }
<span class="term-fg32">+func (tx *LegacyTx) isSystemTx() bool       { return false }</span>
&nbsp;
 func (tx *LegacyTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {
 	return dst.Set(tx.GasPrice)</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-067208817376fd348218cbfb"role="button" aria-expanded="false" aria-controls="id-067208817376fd348218cbfb">
        
            <div class="col-12 col-sm-9 text-start"><h4>L1 cost computation</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+116</span></div>
                <div class="text-start"><span class="text-danger">-18</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-067208817376fd348218cbfb">
        <div><p>Transactions must pay an additional L1 cost based on the amount of rollup-data-gas they consume,
estimated based on gas-price-oracle information and encoded tx size.&rdquo;</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-70d107983f00e3b987277314" role="button"
                   aria-expanded="false" aria-controls="id-70d107983f00e3b987277314">
                    <code>core/vm/evm.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/evm.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/evm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+16</span></div>
                        <div class="text-start"><span class="text-danger">-12</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-70d107983f00e3b987277314"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;evm.go op-geth&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">index d78ea07926641a08a6ccda5b552fa4f851eadd4e..d070a8230ed168b0412ba43fd04065a40e66e4d0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg36">@@ -20,10 +20,12 @@</span> import (
 	&quot;math&#47;big&quot;
 	&quot;sync&#47;atomic&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg31">-	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 &#47;&#47; emptyCodeHash is used by create to ensure deployment is disallowed to already
<span class="term-fg36">@@ -66,6 +68,8 @@</span> 	&#47;&#47; Transfer transfers ether from one account to the other
 	Transfer TransferFunc
 	&#47;&#47; GetHash returns the hash corresponding to n
 	GetHash GetHashFunc
<span class="term-fg32">+	&#47;&#47; L1CostFunc returns the L1 cost of the rollup message, the function may be nil, or return nil</span>
<span class="term-fg32">+	L1CostFunc types.L1CostFunc</span>
&nbsp;
 	&#47;&#47; Block information
 	Coinbase    common.Address &#47;&#47; Provides information for COINBASE
<span class="term-fg36">@@ -114,8 +118,7 @@</span> 	&#47;&#47; global (to this context) ethereum virtual machine
 	&#47;&#47; used throughout the execution of the tx.
 	interpreter *EVMInterpreter
 	&#47;&#47; abort is used to abort the EVM calling operations
<span class="term-fg31">-	&#47;&#47; NOTE: must be set atomically</span>
<span class="term-fg31">-	abort int32</span>
<span class="term-fg32">+	abort atomic.Bool</span>
 	&#47;&#47; callGasTemp holds the gas available for the current call. This is needed because the
 	&#47;&#47; available gas is calculated in gasCall* according to the 63&#47;64 rule and later
 	&#47;&#47; applied in opCall*.
<span class="term-fg36">@@ -147,12 +150,12 @@</span>
 &#47;&#47; Cancel cancels any running EVM operation. This may be called concurrently and
 &#47;&#47; it&#39;s safe to be called multiple times.
 func (evm *EVM) Cancel() {
<span class="term-fg31">-	atomic.StoreInt32(&amp;evm.abort, 1)</span>
<span class="term-fg32">+	evm.abort.Store(true)</span>
 }
&nbsp;
 &#47;&#47; Cancelled returns true if Cancel has been called
 func (evm *EVM) Cancelled() bool {
<span class="term-fg31">-	return atomic.LoadInt32(&amp;evm.abort) == 1</span>
<span class="term-fg32">+	return evm.abort.Load()</span>
 }
&nbsp;
 &#47;&#47; Interpreter returns the current interpreter
<span class="term-fg36">@@ -183,11 +186,12 @@</span> 		return nil, gas, ErrInsufficientBalance
 	}
 	snapshot := evm.StateDB.Snapshot()
 	p, isPrecompile := evm.precompile(addr)
<span class="term-fg32">+	debug := evm.Config.Tracer != nil</span>
&nbsp;
 	if !evm.StateDB.Exist(addr) {
 		if !isPrecompile &amp;&amp; evm.chainRules.IsEIP158 &amp;&amp; value.Sign() == 0 {
 			&#47;&#47; Calling a non existing account, don&#39;t do anything, but ping the tracer
<span class="term-fg31">-			if evm.Config.Debug {</span>
<span class="term-fg32">+			if debug {</span>
 				if evm.depth == 0 {
 					evm.Config.Tracer.CaptureStart(evm, caller.Address(), addr, false, input, gas, value)
 					evm.Config.Tracer.CaptureEnd(ret, 0, nil)
<span class="term-fg36">@@ -203,7 +207,7 @@</span> 	}
 	evm.Context.Transfer(evm.StateDB, caller.Address(), addr, value)
&nbsp;
 	&#47;&#47; Capture the tracer start&#47;end events in debug mode
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if debug {</span>
 		if evm.depth == 0 {
 			evm.Config.Tracer.CaptureStart(evm, caller.Address(), addr, false, input, gas, value)
 			defer func(startGas uint64) { &#47;&#47; Lazy evaluation of the parameters
<span class="term-fg36">@@ -273,7 +277,7 @@</span> 	}
 	var snapshot = evm.StateDB.Snapshot()
&nbsp;
 	&#47;&#47; Invoke tracer hooks that signal entering&#47;exiting a call frame
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if evm.Config.Tracer != nil {</span>
 		evm.Config.Tracer.CaptureEnter(CALLCODE, caller.Address(), addr, input, gas, value)
 		defer func(startGas uint64) {
 			evm.Config.Tracer.CaptureExit(ret, startGas-gas, err)
<span class="term-fg36">@@ -314,7 +318,7 @@</span> 	}
 	var snapshot = evm.StateDB.Snapshot()
&nbsp;
 	&#47;&#47; Invoke tracer hooks that signal entering&#47;exiting a call frame
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if evm.Config.Tracer != nil {</span>
 		&#47;&#47; NOTE: caller must, at all times be a contract. It should never happen
 		&#47;&#47; that caller is something other than a Contract.
 		parent := caller.(*Contract)
<span class="term-fg36">@@ -368,7 +372,7 @@</span> 	&#47;&#47; future scenarios
 	evm.StateDB.AddBalance(addr, big0)
&nbsp;
 	&#47;&#47; Invoke tracer hooks that signal entering&#47;exiting a call frame
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if evm.Config.Tracer != nil {</span>
 		evm.Config.Tracer.CaptureEnter(STATICCALL, caller.Address(), addr, input, gas, nil)
 		defer func(startGas uint64) {
 			evm.Config.Tracer.CaptureExit(ret, startGas-gas, err)
<span class="term-fg36">@@ -451,7 +455,7 @@</span> 	&#47;&#47; The contract is a scoped environment for this execution context only.
 	contract := NewContract(caller, AccountRef(address), value, gas)
 	contract.SetCodeOptionalHash(&amp;address, codeAndHash)
&nbsp;
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if evm.Config.Tracer != nil {</span>
 		if evm.depth == 0 {
 			evm.Config.Tracer.CaptureStart(evm, caller.Address(), address, true, codeAndHash.code, gas, value)
 		} else {
<span class="term-fg36">@@ -494,7 +498,7 @@</span> 			contract.UseGas(contract.Gas)
 		}
 	}
&nbsp;
<span class="term-fg31">-	if evm.Config.Debug {</span>
<span class="term-fg32">+	if evm.Config.Tracer != nil {</span>
 		if evm.depth == 0 {
 			evm.Config.Tracer.CaptureEnd(ret, gas-contract.Gas, err)
 		} else {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7884fb2706baed45acbdf88e" role="button"
                   aria-expanded="false" aria-controls="id-7884fb2706baed45acbdf88e">
                    <code>core/types/rollup_l1_cost.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/rollup_l1_cost.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+83</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7884fb2706baed45acbdf88e"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;rollup_l1_cost.go op-geth&#47;core&#47;types&#47;rollup_l1_cost.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..521dfc10d7a7f086456cea4d16b2a756a0dbc777</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;rollup_l1_cost.go</span>
<span class="term-fg36">@@ -0,0 +1,83 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2022 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type RollupGasData struct {</span>
<span class="term-fg32">+	Zeroes, Ones uint64</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (r RollupGasData) DataGas(time uint64, cfg *params.ChainConfig) (gas uint64) {</span>
<span class="term-fg32">+	gas = r.Zeroes * params.TxDataZeroGas</span>
<span class="term-fg32">+	if cfg.IsRegolith(time) {</span>
<span class="term-fg32">+		gas += r.Ones * params.TxDataNonZeroGasEIP2028</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		gas += (r.Ones + 68) * params.TxDataNonZeroGasEIP2028</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return gas</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type StateGetter interface {</span>
<span class="term-fg32">+	GetState(common.Address, common.Hash) common.Hash</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; L1CostFunc is used in the state transition to determine the cost of a rollup message.</span>
<span class="term-fg32">+&#47;&#47; Returns nil if there is no cost.</span>
<span class="term-fg32">+type L1CostFunc func(blockNum uint64, blockTime uint64, dataGas RollupGasData, isDepositTx bool) *big.Int</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	L1BaseFeeSlot = common.BigToHash(big.NewInt(1))</span>
<span class="term-fg32">+	OverheadSlot  = common.BigToHash(big.NewInt(5))</span>
<span class="term-fg32">+	ScalarSlot    = common.BigToHash(big.NewInt(6))</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var L1BlockAddr = common.HexToAddress(&quot;0x4200000000000000000000000000000000000015&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewL1CostFunc returns a function used for calculating L1 fee cost.</span>
<span class="term-fg32">+&#47;&#47; This depends on the oracles because gas costs can change over time.</span>
<span class="term-fg32">+&#47;&#47; It returns nil if there is no applicable cost function.</span>
<span class="term-fg32">+func NewL1CostFunc(config *params.ChainConfig, statedb StateGetter) L1CostFunc {</span>
<span class="term-fg32">+	cacheBlockNum := ^uint64(0)</span>
<span class="term-fg32">+	var l1BaseFee, overhead, scalar *big.Int</span>
<span class="term-fg32">+	return func(blockNum uint64, blockTime uint64, dataGas RollupGasData, isDepositTx bool) *big.Int {</span>
<span class="term-fg32">+		rollupDataGas := dataGas.DataGas(blockTime, config) &#47;&#47; Only fake txs for RPC view-calls are 0.</span>
<span class="term-fg32">+		if config.Optimism == nil || isDepositTx || rollupDataGas == 0 {</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if blockNum != cacheBlockNum {</span>
<span class="term-fg32">+			l1BaseFee = statedb.GetState(L1BlockAddr, L1BaseFeeSlot).Big()</span>
<span class="term-fg32">+			overhead = statedb.GetState(L1BlockAddr, OverheadSlot).Big()</span>
<span class="term-fg32">+			scalar = statedb.GetState(L1BlockAddr, ScalarSlot).Big()</span>
<span class="term-fg32">+			cacheBlockNum = blockNum</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return L1Cost(rollupDataGas, l1BaseFee, overhead, scalar)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func L1Cost(rollupDataGas uint64, l1BaseFee, overhead, scalar *big.Int) *big.Int {</span>
<span class="term-fg32">+	l1GasUsed := new(big.Int).SetUint64(rollupDataGas)</span>
<span class="term-fg32">+	l1GasUsed = l1GasUsed.Add(l1GasUsed, overhead)</span>
<span class="term-fg32">+	l1Cost := l1GasUsed.Mul(l1GasUsed, l1BaseFee)</span>
<span class="term-fg32">+	l1Cost = l1Cost.Mul(l1Cost, scalar)</span>
<span class="term-fg32">+	return l1Cost.Div(l1Cost, big.NewInt(1_000_000))</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c3e10d9c22f13a29b2171745" role="button"
                   aria-expanded="false" aria-controls="id-c3e10d9c22f13a29b2171745">
                    <code>core/state_processor.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state_processor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state_processor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+14</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c3e10d9c22f13a29b2171745"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_processor.go op-geth&#47;core&#47;state_processor.go</span>
<span class="term-fg1">index 2fa9c41bcc018b50f2509959206eb1bbce60efdb..7a638190aafc4c37bd2fe3855a755b2e75d00089 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_processor.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_processor.go</span>
<span class="term-fg36">@@ -70,7 +70,7 @@</span> 	&#47;&#47; Mutate the block and state according to any hard-fork specs
 	if p.config.DAOForkSupport &amp;&amp; p.config.DAOForkBlock != nil &amp;&amp; p.config.DAOForkBlock.Cmp(block.Number()) == 0 {
 		misc.ApplyDAOHardFork(statedb)
 	}
<span class="term-fg31">-	blockContext := NewEVMBlockContext(header, p.bc, nil)</span>
<span class="term-fg32">+	blockContext := NewEVMBlockContext(header, p.bc, nil, p.config, statedb)</span>
 	vmenv := vm.NewEVM(blockContext, vm.TxContext{}, statedb, p.config, cfg)
 	&#47;&#47; Iterate over and process the individual transactions
 	for i, tx := range block.Transactions() {
<span class="term-fg36">@@ -102,6 +102,11 @@</span> 	&#47;&#47; Create a new context to be used in the EVM environment.
 	txContext := NewEVMTxContext(msg)
 	evm.Reset(txContext, statedb)
&nbsp;
<span class="term-fg32">+	nonce := tx.Nonce()</span>
<span class="term-fg32">+	if msg.IsDepositTx &amp;&amp; config.IsOptimismRegolith(evm.Context.Time) {</span>
<span class="term-fg32">+		nonce = statedb.GetNonce(msg.From)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Apply the transaction to the current state (included in the env).
 	result, err := ApplyMessage(evm, msg, gp)
 	if err != nil {
<span class="term-fg36">@@ -128,9 +133,15 @@</span> 	}
 	receipt.TxHash = tx.Hash()
 	receipt.GasUsed = result.UsedGas
&nbsp;
<span class="term-fg32">+	if msg.IsDepositTx &amp;&amp; config.IsOptimismRegolith(evm.Context.Time) {</span>
<span class="term-fg32">+		&#47;&#47; The actual nonce for deposit transactions is only recorded from Regolith onwards.</span>
<span class="term-fg32">+		&#47;&#47; Before the Regolith fork the DepositNonce must remain nil</span>
<span class="term-fg32">+		receipt.DepositNonce = &amp;nonce</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; If the transaction created a contract, store the creation address in the receipt.
 	if msg.To == nil {
<span class="term-fg31">-		receipt.ContractAddress = crypto.CreateAddress(evm.TxContext.Origin, tx.Nonce())</span>
<span class="term-fg32">+		receipt.ContractAddress = crypto.CreateAddress(evm.TxContext.Origin, nonce)</span>
 	}
&nbsp;
 	&#47;&#47; Set the receipt logs and create the bloom filter.
<span class="term-fg36">@@ -152,7 +163,7 @@</span> 	if err != nil {
 		return nil, err
 	}
 	&#47;&#47; Create a new context to be used in the EVM environment
<span class="term-fg31">-	blockContext := NewEVMBlockContext(header, bc, author)</span>
<span class="term-fg32">+	blockContext := NewEVMBlockContext(header, bc, author, config, statedb)</span>
 	vmenv := vm.NewEVM(blockContext, vm.TxContext{}, statedb, config, cfg)
 	return applyTransaction(msg, config, gp, statedb, header.Number, header.Hash(), tx, usedGas, vmenv)
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-10642725094c057ed03dd856" role="button"
                   aria-expanded="false" aria-controls="id-10642725094c057ed03dd856">
                    <code>core/state_prefetcher.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state_prefetcher.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state_prefetcher.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-10642725094c057ed03dd856"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_prefetcher.go op-geth&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">index c258eee4f4cc0ba508fa209ec233121428017763..9b2f6f5b5ebecaa3dc89c31e3ffbe31615fbe7f1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg36">@@ -47,11 +47,11 @@</span>
 &#47;&#47; Prefetch processes the state changes according to the Ethereum rules by running
 &#47;&#47; the transaction messages using the statedb, but any changes are discarded. The
 &#47;&#47; only goal is to pre-cache transaction signatures and state trie nodes.
<span class="term-fg31">-func (p *statePrefetcher) Prefetch(block *types.Block, statedb *state.StateDB, cfg vm.Config, interrupt *uint32) {</span>
<span class="term-fg32">+func (p *statePrefetcher) Prefetch(block *types.Block, statedb *state.StateDB, cfg vm.Config, interrupt *atomic.Bool) {</span>
 	var (
 		header       = block.Header()
 		gaspool      = new(GasPool).AddGas(block.GasLimit())
<span class="term-fg31">-		blockContext = NewEVMBlockContext(header, p.bc, nil)</span>
<span class="term-fg32">+		blockContext = NewEVMBlockContext(header, p.bc, nil, p.config, statedb)</span>
 		evm          = vm.NewEVM(blockContext, vm.TxContext{}, statedb, p.config, cfg)
 		signer       = types.MakeSigner(p.config, header.Number)
 	)
<span class="term-fg36">@@ -59,7 +59,7 @@</span> 	&#47;&#47; Iterate over and process the individual transactions
 	byzantium := p.config.IsByzantium(block.Number())
 	for i, tx := range block.Transactions() {
 		&#47;&#47; If block precaching was interrupted, abort
<span class="term-fg31">-		if interrupt != nil &amp;&amp; atomic.LoadUint32(interrupt) == 1 {</span>
<span class="term-fg32">+		if interrupt != nil &amp;&amp; interrupt.Load() {</span>
 			return
 		}
 		&#47;&#47; Convert the transaction into an executable message and pre-cache its sender</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-756d127f27246420371f7d4b"role="button" aria-expanded="false" aria-controls="id-756d127f27246420371f7d4b">
        
            <div class="col-12 col-sm-9 text-start"><h4>Transaction processing</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+114</span></div>
                <div class="text-start"><span class="text-danger">-13</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-756d127f27246420371f7d4b">
        <div><p>Deposit transactions have special processing rules: gas is pre-paid on L1,
and deposits with EVM-failure are included with rolled back changes (except mint).
For regular transactions, at the end of the transition, the 1559 burn and L1 cost are routed to vaults.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d56bec8ea7898b4f995a3cb" role="button"
                   aria-expanded="false" aria-controls="id-9d56bec8ea7898b4f995a3cb">
                    <code>core/state_transition.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state_transition.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state_transition.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+114</span></div>
                        <div class="text-start"><span class="text-danger">-13</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d56bec8ea7898b4f995a3cb"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state_transition.go op-geth&#47;core&#47;state_transition.go</span>
<span class="term-fg1">index 1802f1daf70ae988a08010bf2089da55690159cd..e242f63aea84464b5d457ddc0ab5534344b67225 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state_transition.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state_transition.go</span>
<span class="term-fg36">@@ -136,24 +136,34 @@</span> 	GasTipCap  *big.Int
 	Data       []byte
 	AccessList types.AccessList
&nbsp;
<span class="term-fg31">-	&#47;&#47; When SkipAccountCheckss is true, the message nonce is not checked against the</span>
<span class="term-fg32">+	&#47;&#47; When SkipAccountChecks is true, the message nonce is not checked against the</span>
 	&#47;&#47; account nonce in state. It also disables checking that the sender is an EOA.
 	&#47;&#47; This field will be set to true for operations like RPC eth_call.
 	SkipAccountChecks bool
<span class="term-fg32">+</span>
<span class="term-fg32">+	IsSystemTx    bool                &#47;&#47; IsSystemTx indicates the message, if also a deposit, does not emit gas usage.</span>
<span class="term-fg32">+	IsDepositTx   bool                &#47;&#47; IsDepositTx indicates the message is force-included and can persist a mint.</span>
<span class="term-fg32">+	Mint          *big.Int            &#47;&#47; Mint is the amount to mint before EVM processing, or nil if there is no minting.</span>
<span class="term-fg32">+	RollupDataGas types.RollupGasData &#47;&#47; RollupDataGas indicates the rollup cost of the message, 0 if not a rollup or no cost.</span>
 }
&nbsp;
 &#47;&#47; TransactionToMessage converts a transaction into a Message.
 func TransactionToMessage(tx *types.Transaction, s types.Signer, baseFee *big.Int) (*Message, error) {
 	msg := &amp;Message{
<span class="term-fg31">-		Nonce:             tx.Nonce(),</span>
<span class="term-fg31">-		GasLimit:          tx.Gas(),</span>
<span class="term-fg31">-		GasPrice:          new(big.Int).Set(tx.GasPrice()),</span>
<span class="term-fg31">-		GasFeeCap:         new(big.Int).Set(tx.GasFeeCap()),</span>
<span class="term-fg31">-		GasTipCap:         new(big.Int).Set(tx.GasTipCap()),</span>
<span class="term-fg31">-		To:                tx.To(),</span>
<span class="term-fg31">-		Value:             tx.Value(),</span>
<span class="term-fg31">-		Data:              tx.Data(),</span>
<span class="term-fg31">-		AccessList:        tx.AccessList(),</span>
<span class="term-fg32">+		Nonce:         tx.Nonce(),</span>
<span class="term-fg32">+		GasLimit:      tx.Gas(),</span>
<span class="term-fg32">+		GasPrice:      new(big.Int).Set(tx.GasPrice()),</span>
<span class="term-fg32">+		GasFeeCap:     new(big.Int).Set(tx.GasFeeCap()),</span>
<span class="term-fg32">+		GasTipCap:     new(big.Int).Set(tx.GasTipCap()),</span>
<span class="term-fg32">+		To:            tx.To(),</span>
<span class="term-fg32">+		Value:         tx.Value(),</span>
<span class="term-fg32">+		Data:          tx.Data(),</span>
<span class="term-fg32">+		AccessList:    tx.AccessList(),</span>
<span class="term-fg32">+		IsSystemTx:    tx.IsSystemTx(),</span>
<span class="term-fg32">+		IsDepositTx:   tx.IsDepositTx(),</span>
<span class="term-fg32">+		Mint:          tx.Mint(),</span>
<span class="term-fg32">+		RollupDataGas: tx.RollupDataGas(),</span>
<span class="term-fg32">+</span>
 		SkipAccountChecks: false,
 	}
 	&#47;&#47; If baseFee provided, set gasPrice to effectiveGasPrice.
<span class="term-fg36">@@ -228,11 +238,21 @@</span>
 func (st *StateTransition) buyGas() error {
 	mgval := new(big.Int).SetUint64(st.msg.GasLimit)
 	mgval = mgval.Mul(mgval, st.msg.GasPrice)
<span class="term-fg32">+	var l1Cost *big.Int</span>
<span class="term-fg32">+	if st.evm.Context.L1CostFunc != nil &amp;&amp; !st.msg.SkipAccountChecks {</span>
<span class="term-fg32">+		l1Cost = st.evm.Context.L1CostFunc(st.evm.Context.BlockNumber.Uint64(), st.evm.Context.Time, st.msg.RollupDataGas, st.msg.IsDepositTx)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if l1Cost != nil {</span>
<span class="term-fg32">+		mgval = mgval.Add(mgval, l1Cost)</span>
<span class="term-fg32">+	}</span>
 	balanceCheck := mgval
 	if st.msg.GasFeeCap != nil {
 		balanceCheck = new(big.Int).SetUint64(st.msg.GasLimit)
 		balanceCheck = balanceCheck.Mul(balanceCheck, st.msg.GasFeeCap)
 		balanceCheck.Add(balanceCheck, st.msg.Value)
<span class="term-fg32">+		if l1Cost != nil {</span>
<span class="term-fg32">+			balanceCheck.Add(balanceCheck, l1Cost)</span>
<span class="term-fg32">+		}</span>
 	}
 	if have, want := st.state.GetBalance(st.msg.From), balanceCheck; have.Cmp(want) &lt; 0 {
 		return fmt.Errorf(&quot;%w: address %v have %v want %v&quot;, ErrInsufficientFunds, st.msg.From.Hex(), have, want)
<span class="term-fg36">@@ -248,6 +268,21 @@</span> 	return nil
 }
&nbsp;
 func (st *StateTransition) preCheck() error {
<span class="term-fg32">+	if st.msg.IsDepositTx {</span>
<span class="term-fg32">+		&#47;&#47; No fee fields to check, no nonce to check, and no need to check if EOA (L1 already verified it for us)</span>
<span class="term-fg32">+		&#47;&#47; Gas is free, but no refunds!</span>
<span class="term-fg32">+		st.initialGas = st.msg.GasLimit</span>
<span class="term-fg32">+		st.gasRemaining += st.msg.GasLimit &#47;&#47; Add gas here in order to be able to execute calls.</span>
<span class="term-fg32">+		&#47;&#47; Don&#39;t touch the gas pool for system transactions</span>
<span class="term-fg32">+		if st.msg.IsSystemTx {</span>
<span class="term-fg32">+			if st.evm.ChainConfig().IsOptimismRegolith(st.evm.Context.Time) {</span>
<span class="term-fg32">+				return fmt.Errorf(&quot;%w: address %v&quot;, ErrSystemTxNotSupported,</span>
<span class="term-fg32">+					st.msg.From.Hex())</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return st.gp.SubGas(st.msg.GasLimit) &#47;&#47; gas used by deposits may not be used by other txs</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Only check transactions that are not fake
 	msg := st.msg
 	if !msg.SkipAccountChecks {
<span class="term-fg36">@@ -309,6 +344,37 @@</span> &#47;&#47;
 &#47;&#47; However if any consensus issue encountered, return the error directly with
 &#47;&#47; nil evm execution result.
 func (st *StateTransition) TransitionDb() (*ExecutionResult, error) {
<span class="term-fg32">+	if mint := st.msg.Mint; mint != nil {</span>
<span class="term-fg32">+		st.state.AddBalance(st.msg.From, mint)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	snap := st.state.Snapshot()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	result, err := st.innerTransitionDb()</span>
<span class="term-fg32">+	&#47;&#47; Failed deposits must still be included. Unless we cannot produce the block at all due to the gas limit.</span>
<span class="term-fg32">+	&#47;&#47; On deposit failure, we rewind any state changes from after the minting, and increment the nonce.</span>
<span class="term-fg32">+	if err != nil &amp;&amp; err != ErrGasLimitReached &amp;&amp; st.msg.IsDepositTx {</span>
<span class="term-fg32">+		st.state.RevertToSnapshot(snap)</span>
<span class="term-fg32">+		&#47;&#47; Even though we revert the state changes, always increment the nonce for the next deposit transaction</span>
<span class="term-fg32">+		st.state.SetNonce(st.msg.From, st.state.GetNonce(st.msg.From)+1)</span>
<span class="term-fg32">+		&#47;&#47; Record deposits as using all their gas (matches the gas pool)</span>
<span class="term-fg32">+		&#47;&#47; System Transactions are special &amp; are not recorded as using any gas (anywhere)</span>
<span class="term-fg32">+		&#47;&#47; Regolith changes this behaviour so the actual gas used is reported.</span>
<span class="term-fg32">+		&#47;&#47; In this case the tx is invalid so is recorded as using all gas.</span>
<span class="term-fg32">+		gasUsed := st.msg.GasLimit</span>
<span class="term-fg32">+		if st.msg.IsSystemTx &amp;&amp; !st.evm.ChainConfig().IsRegolith(st.evm.Context.Time) {</span>
<span class="term-fg32">+			gasUsed = 0</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		result = &amp;ExecutionResult{</span>
<span class="term-fg32">+			UsedGas:    gasUsed,</span>
<span class="term-fg32">+			Err:        fmt.Errorf(&quot;failed deposit: %w&quot;, err),</span>
<span class="term-fg32">+			ReturnData: nil,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		err = nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return result, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (st *StateTransition) innerTransitionDb() (*ExecutionResult, error) {</span>
 	&#47;&#47; First check this message satisfies all consensus rules before
 	&#47;&#47; applying the message. The rules include these clauses
 	&#47;&#47;
<span class="term-fg36">@@ -324,10 +390,10 @@</span> 	if err := st.preCheck(); err != nil {
 		return nil, err
 	}
&nbsp;
<span class="term-fg31">-	if st.evm.Config.Debug {</span>
<span class="term-fg31">-		st.evm.Config.Tracer.CaptureTxStart(st.initialGas)</span>
<span class="term-fg32">+	if tracer := st.evm.Config.Tracer; tracer != nil {</span>
<span class="term-fg32">+		tracer.CaptureTxStart(st.initialGas)</span>
 		defer func() {
<span class="term-fg31">-			st.evm.Config.Tracer.CaptureTxEnd(st.gasRemaining)</span>
<span class="term-fg32">+			tracer.CaptureTxEnd(st.gasRemaining)</span>
 		}()
 	}
&nbsp;
<span class="term-fg36">@@ -375,6 +441,24 @@</span> 		st.state.SetNonce(msg.From, st.state.GetNonce(sender.Address())+1)
 		ret, st.gasRemaining, vmerr = st.evm.Call(sender, st.to(), msg.Data, st.gasRemaining, msg.Value)
 	}
&nbsp;
<span class="term-fg32">+	&#47;&#47; if deposit: skip refunds, skip tipping coinbase</span>
<span class="term-fg32">+	&#47;&#47; Regolith changes this behaviour to report the actual gasUsed instead of always reporting all gas used.</span>
<span class="term-fg32">+	if st.msg.IsDepositTx &amp;&amp; !rules.IsOptimismRegolith {</span>
<span class="term-fg32">+		&#47;&#47; Record deposits as using all their gas (matches the gas pool)</span>
<span class="term-fg32">+		&#47;&#47; System Transactions are special &amp; are not recorded as using any gas (anywhere)</span>
<span class="term-fg32">+		gasUsed := st.msg.GasLimit</span>
<span class="term-fg32">+		if st.msg.IsSystemTx {</span>
<span class="term-fg32">+			gasUsed = 0</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return &amp;ExecutionResult{</span>
<span class="term-fg32">+			UsedGas:    gasUsed,</span>
<span class="term-fg32">+			Err:        vmerr,</span>
<span class="term-fg32">+			ReturnData: ret,</span>
<span class="term-fg32">+		}, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Note for deposit tx there is no ETH refunded for unused gas, but that&#39;s taken care of by the fact that gasPrice</span>
<span class="term-fg32">+	&#47;&#47; is always 0 for deposit tx. So calling refundGas will ensure the gasUsed accounting is correct without actually</span>
<span class="term-fg32">+	&#47;&#47; changing the sender&#39;s balance</span>
 	if !rules.IsLondon {
 		&#47;&#47; Before EIP-3529: refunds were capped to gasUsed &#47; 2
 		st.refundGas(params.RefundQuotient)
<span class="term-fg36">@@ -382,6 +466,14 @@</span> 	} else {
 		&#47;&#47; After EIP-3529: refunds are capped to gasUsed &#47; 5
 		st.refundGas(params.RefundQuotientEIP3529)
 	}
<span class="term-fg32">+	if st.msg.IsDepositTx &amp;&amp; rules.IsOptimismRegolith {</span>
<span class="term-fg32">+		&#47;&#47; Skip coinbase payments for deposit tx in Regolith</span>
<span class="term-fg32">+		return &amp;ExecutionResult{</span>
<span class="term-fg32">+			UsedGas:    st.gasUsed(),</span>
<span class="term-fg32">+			Err:        vmerr,</span>
<span class="term-fg32">+			ReturnData: ret,</span>
<span class="term-fg32">+		}, nil</span>
<span class="term-fg32">+	}</span>
 	effectiveTip := msg.GasPrice
 	if rules.IsLondon {
 		effectiveTip = cmath.BigMin(msg.GasTipCap, new(big.Int).Sub(msg.GasFeeCap, st.evm.Context.BaseFee))
<span class="term-fg36">@@ -395,6 +487,15 @@</span> 	} else {
 		fee := new(big.Int).SetUint64(st.gasUsed())
 		fee.Mul(fee, effectiveTip)
 		st.state.AddBalance(st.evm.Context.Coinbase, fee)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Check that we are post bedrock to enable op-geth to be able to create pseudo pre-bedrock blocks (these are pre-bedrock, but don&#39;t follow l2 geth rules)</span>
<span class="term-fg32">+	&#47;&#47; Note optimismConfig will not be nil if rules.IsOptimismBedrock is true</span>
<span class="term-fg32">+	if optimismConfig := st.evm.ChainConfig().Optimism; optimismConfig != nil &amp;&amp; rules.IsOptimismBedrock {</span>
<span class="term-fg32">+		st.state.AddBalance(params.OptimismBaseFeeRecipient, new(big.Int).Mul(new(big.Int).SetUint64(st.gasUsed()), st.evm.Context.BaseFee))</span>
<span class="term-fg32">+		if cost := st.evm.Context.L1CostFunc(st.evm.Context.BlockNumber.Uint64(), st.evm.Context.Time, st.msg.RollupDataGas, st.msg.IsDepositTx); cost != nil {</span>
<span class="term-fg32">+			st.state.AddBalance(params.OptimismL1FeeRecipient, cost)</span>
<span class="term-fg32">+		}</span>
 	}
&nbsp;
 	return &amp;ExecutionResult{</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8f35d5cc8710494633625757"role="button" aria-expanded="false" aria-controls="id-8f35d5cc8710494633625757">
        
            <div class="col-12 col-sm-9 text-start"><h4>Gaslimit</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+4</span></div>
                <div class="text-start"><span class="text-danger">-2</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8f35d5cc8710494633625757">
        <div><p>The gaslimit is free to be set by the Engine API caller, instead of enforcing adjustments of the
gaslimit in increments of <sup>1</sup>&frasl;<sub>1024</sub> of the previous gaslimit.
The gaslimit is changed (and limited) through the <code>SystemConfig</code> contract.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-84b9f7cc65a13f973d642f89" role="button"
                   aria-expanded="false" aria-controls="id-84b9f7cc65a13f973d642f89">
                    <code>consensus/misc/eip1559.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/misc/eip1559.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/misc/eip1559.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-84b9f7cc65a13f973d642f89"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;eip1559.go op-geth&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg1">index 4521b47b36e6b4d6fe0aa1c9895383f1be2f3ec1..0b6c8532ac01995cc73a161889a29612b63615e1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;misc&#47;eip1559.go</span>
<span class="term-fg36">@@ -35,8 +35,10 @@</span> 	parentGasLimit := parent.GasLimit
 	if !config.IsLondon(parent.Number) {
 		parentGasLimit = parent.GasLimit * config.ElasticityMultiplier()
 	}
<span class="term-fg31">-	if err := VerifyGaslimit(parentGasLimit, header.GasLimit); err != nil {</span>
<span class="term-fg31">-		return err</span>
<span class="term-fg32">+	if config.Optimism == nil { &#47;&#47; gasLimit can adjust instantly in optimism</span>
<span class="term-fg32">+		if err := VerifyGaslimit(parentGasLimit, header.GasLimit); err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
 	}
 	&#47;&#47; Verify the header is not malformed
 	if header.BaseFee == nil {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a03a8f177e6c354ac807f676"role="button" aria-expanded="false" aria-controls="id-a03a8f177e6c354ac807f676">
        
            <div class="col-12 col-sm-9 text-start"><h4>Consensus tweaks</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+12</span></div>
                <div class="text-start"><span class="text-danger">-1</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a03a8f177e6c354ac807f676">
        <div><p>The Engine API is activated at the Merge transition, with a Total Terminal Difficulty (TTD).
The rollup starts post-merge, and thus sets the TTD to 0.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-76b000313a9904d749a53f5c" role="button"
                   aria-expanded="false" aria-controls="id-76b000313a9904d749a53f5c">
                    <code>consensus/beacon/consensus.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/beacon/consensus.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/beacon/consensus.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-76b000313a9904d749a53f5c"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;beacon&#47;consensus.go op-geth&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg1">index b4da9b553a7b3bb1baf01cc135c8c0d9d76e4fc2..bb420516362698bb72e69203bdb7d019d7007c62 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;beacon&#47;consensus.go</span>
<span class="term-fg36">@@ -263,10 +263,18 @@</span> 	}
 	&#47;&#47; Verify existence &#47; non-existence of withdrawalsHash.
 	shanghai := chain.Config().IsShanghai(header.Time)
 	if shanghai &amp;&amp; header.WithdrawalsHash == nil {
<span class="term-fg31">-		return fmt.Errorf(&quot;missing withdrawalsHash&quot;)</span>
<span class="term-fg32">+		return errors.New(&quot;missing withdrawalsHash&quot;)</span>
 	}
 	if !shanghai &amp;&amp; header.WithdrawalsHash != nil {
 		return fmt.Errorf(&quot;invalid withdrawalsHash: have %x, expected nil&quot;, header.WithdrawalsHash)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Verify the existence &#47; non-existence of excessDataGas</span>
<span class="term-fg32">+	cancun := chain.Config().IsCancun(header.Time)</span>
<span class="term-fg32">+	if cancun &amp;&amp; header.ExcessDataGas == nil {</span>
<span class="term-fg32">+		return errors.New(&quot;missing excessDataGas&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if !cancun &amp;&amp; header.ExcessDataGas != nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;invalid excessDataGas: have %d, expected nil&quot;, header.ExcessDataGas)</span>
 	}
 	return nil
 }
<span class="term-fg36">@@ -443,6 +451,9 @@</span> &#47;&#47; If the parentHash is not stored in the database a UnknownAncestor error is returned.
 func IsTTDReached(chain consensus.ChainHeaderReader, parentHash common.Hash, parentNumber uint64) (bool, error) {
 	if chain.Config().TerminalTotalDifficulty == nil {
 		return false, nil
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if common.Big0.Cmp(chain.Config().TerminalTotalDifficulty) == 0 { &#47;&#47; in case TTD is reached at genesis.</span>
<span class="term-fg32">+		return true, nil</span>
 	}
 	td := chain.GetTd(parentHash, parentNumber)
 	if td == nil {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-1a2fa9be0936e0c89e104bec"role="button" aria-expanded="false" aria-controls="id-1a2fa9be0936e0c89e104bec">
        
            <div class="col-12 col-sm-9 text-start"><h3>Chain config</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+126</span></div>
                <div class="text-start"><span class="text-danger">-14</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-1a2fa9be0936e0c89e104bec">
        <div><p>The rollup functionality is enabled with the <code>optimism</code> field in the chain config.
The EIP-1559 parameters are configurable to adjust for faster more frequent and smaller blocks.
The parameters can be overriden for testing.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ee50858903a57a1ee571f295" role="button"
                   aria-expanded="false" aria-controls="id-ee50858903a57a1ee571f295">
                    <code>params/config.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/params/config.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/params/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+85</span></div>
                        <div class="text-start"><span class="text-danger">-13</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee50858903a57a1ee571f295"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;config.go op-geth&#47;params&#47;config.go</span>
<span class="term-fg1">index e04b16673c6b8a360ad9d20e97ff5ddf8e0e07ec..52ac687055799f8e2a48a09e37e14f76b0e1e2ab 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;config.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;config.go</span>
<span class="term-fg36">@@ -21,8 +21,9 @@</span> 	&quot;encoding&#47;binary&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
&nbsp;
<span class="term-fg32">+	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg31">-	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
 )
&nbsp;
 &#47;&#47; Genesis hashes to enforce below configs on.
<span class="term-fg36">@@ -31,6 +32,16 @@</span> 	MainnetGenesisHash = common.HexToHash(&quot;0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3&quot;)
 	SepoliaGenesisHash = common.HexToHash(&quot;0x25a5cc106eea7138acab33231d7160d69cb777ee0c2c553fcddf5138993e6dd9&quot;)
 	RinkebyGenesisHash = common.HexToHash(&quot;0x6341fd3daf94b748c72ced5a5b26028f2474f5f00d824504e4fa37a75767e177&quot;)
 	GoerliGenesisHash  = common.HexToHash(&quot;0xbf7e331f7f7c1dd2e05159666b3bf8bc7a8a3a9eb1d518969eab529dd9b88c1a&quot;)
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OP Stack chain config</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	OptimismGoerliChainId = big.NewInt(420)</span>
<span class="term-fg32">+	&#47;&#47; March 17, 2023 @ 7:00:00 pm UTC</span>
<span class="term-fg32">+	OptimismGoerliRegolithTime = uint64(1679079600)</span>
<span class="term-fg32">+	BaseGoerliChainId          = big.NewInt(84531)</span>
<span class="term-fg32">+	&#47;&#47; May 4, 2023 @ 5:00:00 pm UTC</span>
<span class="term-fg32">+	BaseGoerliRegolithTime = uint64(1683219600)</span>
 )
&nbsp;
 &#47;&#47; TrustedCheckpoints associates each known checkpoint with the genesis hash of
<span class="term-fg36">@@ -62,7 +73,6 @@</span> 		HomesteadBlock:                big.NewInt(1_150_000),
 		DAOForkBlock:                  big.NewInt(1_920_000),
 		DAOForkSupport:                true,
 		EIP150Block:                   big.NewInt(2_463_000),
<span class="term-fg31">-		EIP150Hash:                    common.HexToHash(&quot;0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0&quot;),</span>
 		EIP155Block:                   big.NewInt(2_675_000),
 		EIP158Block:                   big.NewInt(2_675_000),
 		ByzantiumBlock:                big.NewInt(4_370_000),
<span class="term-fg36">@@ -139,7 +149,6 @@</span> 		HomesteadBlock:      big.NewInt(1),
 		DAOForkBlock:        nil,
 		DAOForkSupport:      true,
 		EIP150Block:         big.NewInt(2),
<span class="term-fg31">-		EIP150Hash:          common.HexToHash(&quot;0x9b095b36c15eaf13044373aef8ee0bd3a382a5abb92e402afa44b8249c3a90e9&quot;),</span>
 		EIP155Block:         big.NewInt(3),
 		EIP158Block:         big.NewInt(3),
 		ByzantiumBlock:      big.NewInt(1_035_301),
<span class="term-fg36">@@ -231,7 +240,6 @@</span> 		HomesteadBlock:                big.NewInt(0),
 		DAOForkBlock:                  nil,
 		DAOForkSupport:                false,
 		EIP150Block:                   big.NewInt(0),
<span class="term-fg31">-		EIP150Hash:                    common.Hash{},</span>
 		EIP155Block:                   big.NewInt(0),
 		EIP158Block:                   big.NewInt(0),
 		ByzantiumBlock:                big.NewInt(0),
<span class="term-fg36">@@ -261,7 +269,6 @@</span> 		HomesteadBlock:                big.NewInt(0),
 		DAOForkBlock:                  nil,
 		DAOForkSupport:                false,
 		EIP150Block:                   big.NewInt(0),
<span class="term-fg31">-		EIP150Hash:                    common.Hash{},</span>
 		EIP155Block:                   big.NewInt(0),
 		EIP158Block:                   big.NewInt(0),
 		ByzantiumBlock:                big.NewInt(0),
<span class="term-fg36">@@ -291,7 +298,6 @@</span> 		HomesteadBlock:                big.NewInt(0),
 		DAOForkBlock:                  nil,
 		DAOForkSupport:                false,
 		EIP150Block:                   big.NewInt(0),
<span class="term-fg31">-		EIP150Hash:                    common.Hash{},</span>
 		EIP155Block:                   big.NewInt(0),
 		EIP158Block:                   big.NewInt(0),
 		ByzantiumBlock:                big.NewInt(0),
<span class="term-fg36">@@ -321,7 +327,6 @@</span> 		HomesteadBlock:                nil,
 		DAOForkBlock:                  nil,
 		DAOForkSupport:                false,
 		EIP150Block:                   nil,
<span class="term-fg31">-		EIP150Hash:                    common.Hash{},</span>
 		EIP155Block:                   nil,
 		EIP158Block:                   nil,
 		ByzantiumBlock:                nil,
<span class="term-fg36">@@ -343,6 +348,15 @@</span> 		Ethash:                        new(EthashConfig),
 		Clique:                        nil,
 	}
 	TestRules = TestChainConfig.Rules(new(big.Int), false, 0)
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; This is an Optimism chain config with bedrock starting a block 5, introduced for historical endpoint testing, largely based on the clique config</span>
<span class="term-fg32">+	OptimismTestConfig = func() *ChainConfig {</span>
<span class="term-fg32">+		conf := *AllCliqueProtocolChanges &#47;&#47; copy the config</span>
<span class="term-fg32">+		conf.Clique = nil</span>
<span class="term-fg32">+		conf.BedrockBlock = big.NewInt(5)</span>
<span class="term-fg32">+		conf.Optimism = &amp;OptimismConfig{EIP1559Elasticity: 50, EIP1559Denominator: 10}</span>
<span class="term-fg32">+		return &amp;conf</span>
<span class="term-fg32">+	}()</span>
 )
&nbsp;
 &#47;&#47; NetworkNames are user friendly names to use in the chain spec banner.
<span class="term-fg36">@@ -415,9 +429,7 @@</span> 	DAOForkBlock   *big.Int `json:&quot;daoForkBlock,omitempty&quot;`   &#47;&#47; TheDAO hard-fork switch block (nil = no fork)
 	DAOForkSupport bool     `json:&quot;daoForkSupport,omitempty&quot;` &#47;&#47; Whether the nodes supports or opposes the DAO hard-fork
&nbsp;
 	&#47;&#47; EIP150 implements the Gas price changes (https:&#47;&#47;github.com&#47;ethereum&#47;EIPs&#47;issues&#47;150)
<span class="term-fg31">-	EIP150Block *big.Int    `json:&quot;eip150Block,omitempty&quot;` &#47;&#47; EIP150 HF block (nil = no fork)</span>
<span class="term-fg31">-	EIP150Hash  common.Hash `json:&quot;eip150Hash,omitempty&quot;`  &#47;&#47; EIP150 HF hash (needed for header only clients as only gas pricing changed)</span>
<span class="term-fg31">-</span>
<span class="term-fg32">+	EIP150Block *big.Int `json:&quot;eip150Block,omitempty&quot;` &#47;&#47; EIP150 HF block (nil = no fork)</span>
 	EIP155Block *big.Int `json:&quot;eip155Block,omitempty&quot;` &#47;&#47; EIP155 HF block
 	EIP158Block *big.Int `json:&quot;eip158Block,omitempty&quot;` &#47;&#47; EIP158 HF block
&nbsp;
<span class="term-fg36">@@ -438,6 +450,9 @@</span> 	ShanghaiTime *uint64 `json:&quot;shanghaiTime,omitempty&quot;` &#47;&#47; Shanghai switch time (nil = no fork, 0 = already on shanghai)
 	CancunTime   *uint64 `json:&quot;cancunTime,omitempty&quot;`   &#47;&#47; Cancun switch time (nil = no fork, 0 = already on cancun)
 	PragueTime   *uint64 `json:&quot;pragueTime,omitempty&quot;`   &#47;&#47; Prague switch time (nil = no fork, 0 = already on prague)
&nbsp;
<span class="term-fg32">+	BedrockBlock *big.Int `json:&quot;bedrockBlock,omitempty&quot;` &#47;&#47; Bedrock switch block (nil = no fork, 0 = already on optimism bedrock)</span>
<span class="term-fg32">+	RegolithTime *uint64  `json:&quot;regolithTime,omitempty&quot;` &#47;&#47; Regolith switch time (nil = no fork, 0 = already on optimism regolith)</span>
<span class="term-fg32">+</span>
 	&#47;&#47; TerminalTotalDifficulty is the amount of total difficulty reached by
 	&#47;&#47; the network that triggers the consensus upgrade.
 	TerminalTotalDifficulty *big.Int `json:&quot;terminalTotalDifficulty,omitempty&quot;`
<span class="term-fg36">@@ -450,6 +465,9 @@</span>
 	&#47;&#47; Various consensus engines
 	Ethash *EthashConfig `json:&quot;ethash,omitempty&quot;`
 	Clique *CliqueConfig `json:&quot;clique,omitempty&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Optimism config, nil if not active</span>
<span class="term-fg32">+	Optimism *OptimismConfig `json:&quot;optimism,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; EthashConfig is the consensus engine configs for proof-of-work based sealing.
<span class="term-fg36">@@ -469,6 +487,17 @@</span>
 &#47;&#47; String implements the stringer interface, returning the consensus engine details.
 func (c *CliqueConfig) String() string {
 	return &quot;clique&quot;
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OptimismConfig is the optimism config.</span>
<span class="term-fg32">+type OptimismConfig struct {</span>
<span class="term-fg32">+	EIP1559Elasticity  uint64 `json:&quot;eip1559Elasticity&quot;`</span>
<span class="term-fg32">+	EIP1559Denominator uint64 `json:&quot;eip1559Denominator&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; String implements the stringer interface, returning the optimism fee config details.</span>
<span class="term-fg32">+func (o *OptimismConfig) String() string {</span>
<span class="term-fg32">+	return &quot;optimism&quot;</span>
 }
&nbsp;
 &#47;&#47; Description returns a human-readable description of ChainConfig.
<span class="term-fg36">@@ -482,6 +511,8 @@</span> 		network = &quot;unknown&quot;
 	}
 	banner += fmt.Sprintf(&quot;Chain ID:  %v (%s)\n&quot;, c.ChainID, network)
 	switch {
<span class="term-fg32">+	case c.Optimism != nil:</span>
<span class="term-fg32">+		banner += &quot;Consensus: Optimism\n&quot;</span>
 	case c.Ethash != nil:
 		if c.TerminalTotalDifficulty == nil {
 			banner += &quot;Consensus: Ethash (proof-of-work)\n&quot;
<span class="term-fg36">@@ -556,6 +587,9 @@</span> 		banner += fmt.Sprintf(&quot; - Cancun:                      @%-10v\n&quot;, *c.CancunTime)
 	}
 	if c.PragueTime != nil {
 		banner += fmt.Sprintf(&quot; - Prague:                      @%-10v\n&quot;, *c.PragueTime)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if c.RegolithTime != nil {</span>
<span class="term-fg32">+		banner += fmt.Sprintf(&quot; - Regolith:                    @%-10v\n&quot;, *c.RegolithTime)</span>
 	}
 	return banner
 }
<span class="term-fg36">@@ -655,6 +689,34 @@</span> func (c *ChainConfig) IsPrague(time uint64) bool {
 	return isTimestampForked(c.PragueTime, time)
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; IsBedrock returns whether num is either equal to the Bedrock fork block or greater.</span>
<span class="term-fg32">+func (c *ChainConfig) IsBedrock(num *big.Int) bool {</span>
<span class="term-fg32">+	return isBlockForked(c.BedrockBlock, num)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *ChainConfig) IsRegolith(time uint64) bool {</span>
<span class="term-fg32">+	return isTimestampForked(c.RegolithTime, time)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsOptimism returns whether the node is an optimism node or not.</span>
<span class="term-fg32">+func (c *ChainConfig) IsOptimism() bool {</span>
<span class="term-fg32">+	return c.Optimism != nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsOptimismBedrock returns true iff this is an optimism node &amp; bedrock is active</span>
<span class="term-fg32">+func (c *ChainConfig) IsOptimismBedrock(num *big.Int) bool {</span>
<span class="term-fg32">+	return c.IsOptimism() &amp;&amp; c.IsBedrock(num)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *ChainConfig) IsOptimismRegolith(time uint64) bool {</span>
<span class="term-fg32">+	return c.IsOptimism() &amp;&amp; c.IsRegolith(time)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsOptimismPreBedrock returns true iff this is an optimism node &amp; bedrock is not yet active</span>
<span class="term-fg32">+func (c *ChainConfig) IsOptimismPreBedrock(num *big.Int) bool {</span>
<span class="term-fg32">+	return c.IsOptimism() &amp;&amp; !c.IsBedrock(num)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; CheckCompatible checks whether scheduled fork transitions have been imported
 &#47;&#47; with a mismatching chain configuration.
 func (c *ChainConfig) CheckCompatible(newcfg *ChainConfig, height uint64, time uint64) *ConfigCompatError {
<span class="term-fg36">@@ -817,11 +879,17 @@</span> }
&nbsp;
 &#47;&#47; BaseFeeChangeDenominator bounds the amount the base fee can change between blocks.
 func (c *ChainConfig) BaseFeeChangeDenominator() uint64 {
<span class="term-fg32">+	if c.Optimism != nil {</span>
<span class="term-fg32">+		return c.Optimism.EIP1559Denominator</span>
<span class="term-fg32">+	}</span>
 	return DefaultBaseFeeChangeDenominator
 }
&nbsp;
 &#47;&#47; ElasticityMultiplier bounds the maximum gas limit an EIP-1559 block may have.
 func (c *ChainConfig) ElasticityMultiplier() uint64 {
<span class="term-fg32">+	if c.Optimism != nil {</span>
<span class="term-fg32">+		return c.Optimism.EIP1559Elasticity</span>
<span class="term-fg32">+	}</span>
 	return DefaultElasticityMultiplier
 }
&nbsp;
<span class="term-fg36">@@ -956,7 +1024,8 @@</span> 	ChainID                                                 *big.Int
 	IsHomestead, IsEIP150, IsEIP155, IsEIP158               bool
 	IsByzantium, IsConstantinople, IsPetersburg, IsIstanbul bool
 	IsBerlin, IsLondon                                      bool
<span class="term-fg31">-	IsMerge, IsShanghai, isCancun, isPrague                 bool</span>
<span class="term-fg32">+	IsMerge, IsShanghai, IsCancun, IsPrague                 bool</span>
<span class="term-fg32">+	IsOptimismBedrock, IsOptimismRegolith                   bool</span>
 }
&nbsp;
 &#47;&#47; Rules ensures c&#39;s ChainID is not nil.
<span class="term-fg36">@@ -979,7 +1048,10 @@</span> 		IsBerlin:         c.IsBerlin(num),
 		IsLondon:         c.IsLondon(num),
 		IsMerge:          isMerge,
 		IsShanghai:       c.IsShanghai(timestamp),
<span class="term-fg31">-		isCancun:         c.IsCancun(timestamp),</span>
<span class="term-fg31">-		isPrague:         c.IsPrague(timestamp),</span>
<span class="term-fg32">+		IsCancun:         c.IsCancun(timestamp),</span>
<span class="term-fg32">+		IsPrague:         c.IsPrague(timestamp),</span>
<span class="term-fg32">+		&#47;&#47; Optimism</span>
<span class="term-fg32">+		IsOptimismBedrock:  c.IsOptimismBedrock(num),</span>
<span class="term-fg32">+		IsOptimismRegolith: c.IsOptimismRegolith(timestamp),</span>
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3b5c5ce90cbbcf6fa91c33c1" role="button"
                   aria-expanded="false" aria-controls="id-3b5c5ce90cbbcf6fa91c33c1">
                    <code>params/protocol_params.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/params/protocol_params.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/params/protocol_params.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3b5c5ce90cbbcf6fa91c33c1"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;protocol_params.go op-geth&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">index bb703d0b74dce80d4f90c83f428eb54a0aedd780..fed24accb67452c8ee7d5e1b0a723a0db1f67b57 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;protocol_params.go</span>
<span class="term-fg36">@@ -16,7 +16,18 @@</span> &#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.
&nbsp;
 package params
&nbsp;
<span class="term-fg31">-import &quot;math&#47;big&quot;</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	&#47;&#47; The base fee portion of the transaction fee accumulates at this predeploy</span>
<span class="term-fg32">+	OptimismBaseFeeRecipient = common.HexToAddress(&quot;0x4200000000000000000000000000000000000019&quot;)</span>
<span class="term-fg32">+	&#47;&#47; The L1 portion of the transaction fee accumulates at this predeploy</span>
<span class="term-fg32">+	OptimismL1FeeRecipient = common.HexToAddress(&quot;0x420000000000000000000000000000000000001A&quot;)</span>
<span class="term-fg32">+)</span>
&nbsp;
 const (
 	GasLimitBoundDivisor uint64 = 1024               &#47;&#47; The bound divisor of the gas limit, used in update calculations.
<span class="term-fg36">@@ -159,6 +170,9 @@</span> 	&#47;&#47; The Refund Quotient is the cap on how much of the used gas can be refunded. Before EIP-3529,
 	&#47;&#47; up to half the consumed gas could be refunded. Redefined as 1&#47;5th in EIP-3529
 	RefundQuotient        uint64 = 2
 	RefundQuotientEIP3529 uint64 = 5
<span class="term-fg32">+</span>
<span class="term-fg32">+	BlobTxMinDataGasprice            = 1       &#47;&#47; Minimum gas price for data blobs</span>
<span class="term-fg32">+	BlobTxDataGaspriceUpdateFraction = 2225652 &#47;&#47; Controls the maximum rate of change for data gas price</span>
 )
&nbsp;
 &#47;&#47; Gas discount table for BLS12-381 G1 and G2 multi exponentiation operations</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02663799609e943c49d8b426" role="button"
                   aria-expanded="false" aria-controls="id-02663799609e943c49d8b426">
                    <code>core/genesis.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/genesis.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/genesis.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+26</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02663799609e943c49d8b426"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;genesis.go op-geth&#47;core&#47;genesis.go</span>
<span class="term-fg1">index 269c1486d31d824f238bfb9180b960aad137ef91..76874dd11d38749ed28abbb5b8508865c8989fef 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;genesis.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;genesis.go</span>
<span class="term-fg36">@@ -268,6 +268,10 @@</span>
 &#47;&#47; ChainOverrides contains the changes to chain config.
 type ChainOverrides struct {
 	OverrideShanghai *uint64
<span class="term-fg32">+	&#47;&#47; optimism</span>
<span class="term-fg32">+	OverrideOptimismBedrock  *big.Int</span>
<span class="term-fg32">+	OverrideOptimismRegolith *uint64</span>
<span class="term-fg32">+	OverrideOptimism         *bool</span>
 }
&nbsp;
 &#47;&#47; SetupGenesisBlock writes or updates the genesis block in db.
<span class="term-fg36">@@ -293,8 +297,30 @@</span> 		return params.AllEthashProtocolChanges, common.Hash{}, errGenesisNoConfig
 	}
 	applyOverrides := func(config *params.ChainConfig) {
 		if config != nil {
<span class="term-fg32">+			if config.IsOptimism() &amp;&amp; config.ChainID != nil &amp;&amp; config.ChainID.Cmp(params.OptimismGoerliChainId) == 0 {</span>
<span class="term-fg32">+				&#47;&#47; Apply Optimism Goerli regolith time</span>
<span class="term-fg32">+				config.RegolithTime = &amp;params.OptimismGoerliRegolithTime</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if config.IsOptimism() &amp;&amp; config.ChainID != nil &amp;&amp; config.ChainID.Cmp(params.BaseGoerliChainId) == 0 {</span>
<span class="term-fg32">+				&#47;&#47; Apply Base Goerli regolith time</span>
<span class="term-fg32">+				config.RegolithTime = &amp;params.BaseGoerliRegolithTime</span>
<span class="term-fg32">+			}</span>
 			if overrides != nil &amp;&amp; overrides.OverrideShanghai != nil {
 				config.ShanghaiTime = overrides.OverrideShanghai
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if overrides != nil &amp;&amp; overrides.OverrideOptimismBedrock != nil {</span>
<span class="term-fg32">+				config.BedrockBlock = overrides.OverrideOptimismBedrock</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if overrides != nil &amp;&amp; overrides.OverrideOptimismRegolith != nil {</span>
<span class="term-fg32">+				config.RegolithTime = overrides.OverrideOptimismRegolith</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if overrides != nil &amp;&amp; overrides.OverrideOptimism != nil {</span>
<span class="term-fg32">+				if *overrides.OverrideOptimism {</span>
<span class="term-fg32">+					config.Optimism = &amp;params.OptimismConfig{</span>
<span class="term-fg32">+						EIP1559Elasticity:  10,</span>
<span class="term-fg32">+						EIP1559Denominator: 50,</span>
<span class="term-fg32">+					}</span>
<span class="term-fg32">+				}</span>
 			}
 		}
 	}</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-778d9395dd20d1941bdb8166"role="button" aria-expanded="false" aria-controls="id-778d9395dd20d1941bdb8166">
        
            <div class="col-12 col-sm-9 text-start"><h3>Chain config cleanup</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+3</span></div>
                <div class="text-start"><span class="text-danger">-0</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-778d9395dd20d1941bdb8166">
        <div><p>The optimism Goerli testnet used clique-config data to make geth internals accept blocks.
Post-bedrock the beacon-consensus (i.e. follow Engine API) is now used, and the clique config is removed.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fbb391072f9833b670248d5d" role="button"
                   aria-expanded="false" aria-controls="id-fbb391072f9833b670248d5d">
                    <code>core/rawdb/accessors_metadata.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/accessors_metadata.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/accessors_metadata.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fbb391072f9833b670248d5d"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;accessors_metadata.go op-geth&#47;core&#47;rawdb&#47;accessors_metadata.go</span>
<span class="term-fg1">index 2ff29d1add93938a5f76f621ce6b47af179d9aca..45ced36a4fd400cc84f60a9a9dffedd19cb7e1cf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;accessors_metadata.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;accessors_metadata.go</span>
<span class="term-fg36">@@ -64,6 +64,9 @@</span> 	if err := json.Unmarshal(data, &amp;config); err != nil {
 		log.Error(&quot;Invalid chain config JSON&quot;, &quot;hash&quot;, hash, &quot;err&quot;, err)
 		return nil
 	}
<span class="term-fg32">+	if config.Optimism != nil {</span>
<span class="term-fg32">+		config.Clique = nil &#47;&#47; get rid of legacy clique data in chain config (optimism goerli issue)</span>
<span class="term-fg32">+	}</span>
 	return &amp;config
 }
</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-177f4dee269df566a5599415"role="button" aria-expanded="false" aria-controls="id-177f4dee269df566a5599415">
        
            <div class="col-12 col-sm-9 text-start"><h3>Engine API modifications</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+66</span></div>
                <div class="text-start"><span class="text-danger">-81</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-177f4dee269df566a5599415">
        <div><p>The Engine API is extended to insert transactions into the block and optionally exclude the tx-pool,
to reproduce the exact block of the sequencer from just the inputs, as derived from L1 by the rollup-node.
See <a href="https://github.com/ethereum-optimism/optimism/blob/develop/specs/exec-engine.md">L2 execution engine specs</a>.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-89ea823c183ad6eeef98a39d" role="button"
                   aria-expanded="false" aria-controls="id-89ea823c183ad6eeef98a39d">
                    <code>beacon/engine/types.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/beacon/engine/types.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/beacon/engine/types.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-89ea823c183ad6eeef98a39d"><span class="term-fg1">diff --git go-ethereum&#47;beacon&#47;engine&#47;types.go op-geth&#47;beacon&#47;engine&#47;types.go</span>
<span class="term-fg1">index 07ebe544b438f4c0d356efc4362928c37de8062b..00128cf777744fba0aec75a29d5566ca968d20ce 100644</span>
<span class="term-fg1">--- go-ethereum&#47;beacon&#47;engine&#47;types.go</span>
<span class="term-fg1">+++ op-geth&#47;beacon&#47;engine&#47;types.go</span>
<span class="term-fg36">@@ -34,12 +34,23 @@</span> type PayloadAttributes struct {
 	Timestamp             uint64              `json:&quot;timestamp&quot;             gencodec:&quot;required&quot;`
 	Random                common.Hash         `json:&quot;prevRandao&quot;            gencodec:&quot;required&quot;`
 	SuggestedFeeRecipient common.Address      `json:&quot;suggestedFeeRecipient&quot; gencodec:&quot;required&quot;`
<span class="term-fg31">-	Withdrawals           []*types.Withdrawal `json:&quot;withdrawals&quot;`</span>
<span class="term-fg32">+	Withdrawals           []*types.Withdrawal `json:&quot;withdrawals,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Transactions is a field for rollups: the transactions list is forced into the block</span>
<span class="term-fg32">+	Transactions [][]byte `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+	&#47;&#47; NoTxPool is a field for rollups: if true, the no transactions are taken out of the tx-pool,</span>
<span class="term-fg32">+	&#47;&#47; only transactions from the above Transactions list will be included.</span>
<span class="term-fg32">+	NoTxPool bool `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+	&#47;&#47; GasLimit is a field for rollups: if set, this sets the exact gas limit the block produced with.</span>
<span class="term-fg32">+	GasLimit *uint64 `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 }
&nbsp;
 &#47;&#47; JSON type overrides for PayloadAttributes.
 type payloadAttributesMarshaling struct {
 	Timestamp hexutil.Uint64
<span class="term-fg32">+</span>
<span class="term-fg32">+	Transactions []hexutil.Bytes</span>
<span class="term-fg32">+	GasLimit     *hexutil.Uint64</span>
 }
&nbsp;
 &#47;&#47;go:generate go run github.com&#47;fjl&#47;gencodec -type ExecutableData -field-override executableDataMarshaling -out gen_ed.go</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-59e34360b2a82a0ef8082748" role="button"
                   aria-expanded="false" aria-controls="id-59e34360b2a82a0ef8082748">
                    <code>beacon/engine/gen_blockparams.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/beacon/engine/gen_blockparams.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/beacon/engine/gen_blockparams.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+28</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-59e34360b2a82a0ef8082748"><span class="term-fg1">diff --git go-ethereum&#47;beacon&#47;engine&#47;gen_blockparams.go op-geth&#47;beacon&#47;engine&#47;gen_blockparams.go</span>
<span class="term-fg1">index 0dd2b52597ad5ddc7fc46d97c6c8878edf29d471..0a76475841a12886ef2f9eaadba0172f2708d2b4 100644</span>
<span class="term-fg1">--- go-ethereum&#47;beacon&#47;engine&#47;gen_blockparams.go</span>
<span class="term-fg1">+++ op-geth&#47;beacon&#47;engine&#47;gen_blockparams.go</span>
<span class="term-fg36">@@ -19,13 +19,24 @@</span> 	type PayloadAttributes struct {
 		Timestamp             hexutil.Uint64      `json:&quot;timestamp&quot;             gencodec:&quot;required&quot;`
 		Random                common.Hash         `json:&quot;prevRandao&quot;            gencodec:&quot;required&quot;`
 		SuggestedFeeRecipient common.Address      `json:&quot;suggestedFeeRecipient&quot; gencodec:&quot;required&quot;`
<span class="term-fg31">-		Withdrawals           []*types.Withdrawal `json:&quot;withdrawals&quot;`</span>
<span class="term-fg32">+		Withdrawals           []*types.Withdrawal `json:&quot;withdrawals,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		Transactions          []hexutil.Bytes     `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		NoTxPool              bool                `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		GasLimit              *hexutil.Uint64     `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 	}
 	var enc PayloadAttributes
 	enc.Timestamp = hexutil.Uint64(p.Timestamp)
 	enc.Random = p.Random
 	enc.SuggestedFeeRecipient = p.SuggestedFeeRecipient
 	enc.Withdrawals = p.Withdrawals
<span class="term-fg32">+	if p.Transactions != nil {</span>
<span class="term-fg32">+		enc.Transactions = make([]hexutil.Bytes, len(p.Transactions))</span>
<span class="term-fg32">+		for k, v := range p.Transactions {</span>
<span class="term-fg32">+			enc.Transactions[k] = v</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	enc.NoTxPool = p.NoTxPool</span>
<span class="term-fg32">+	enc.GasLimit = (*hexutil.Uint64)(p.GasLimit)</span>
 	return json.Marshal(&amp;enc)
 }
&nbsp;
<span class="term-fg36">@@ -35,7 +46,10 @@</span> 	type PayloadAttributes struct {
 		Timestamp             *hexutil.Uint64     `json:&quot;timestamp&quot;             gencodec:&quot;required&quot;`
 		Random                *common.Hash        `json:&quot;prevRandao&quot;            gencodec:&quot;required&quot;`
 		SuggestedFeeRecipient *common.Address     `json:&quot;suggestedFeeRecipient&quot; gencodec:&quot;required&quot;`
<span class="term-fg31">-		Withdrawals           []*types.Withdrawal `json:&quot;withdrawals&quot;`</span>
<span class="term-fg32">+		Withdrawals           []*types.Withdrawal `json:&quot;withdrawals,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		Transactions          []hexutil.Bytes     `json:&quot;transactions,omitempty&quot;  gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		NoTxPool              *bool               `json:&quot;noTxPool,omitempty&quot; gencodec:&quot;optional&quot;`</span>
<span class="term-fg32">+		GasLimit              *hexutil.Uint64     `json:&quot;gasLimit,omitempty&quot; gencodec:&quot;optional&quot;`</span>
 	}
 	var dec PayloadAttributes
 	if err := json.Unmarshal(input, &amp;dec); err != nil {
<span class="term-fg36">@@ -55,6 +69,18 @@</span> 	}
 	p.SuggestedFeeRecipient = *dec.SuggestedFeeRecipient
 	if dec.Withdrawals != nil {
 		p.Withdrawals = dec.Withdrawals
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.Transactions != nil {</span>
<span class="term-fg32">+		p.Transactions = make([][]byte, len(dec.Transactions))</span>
<span class="term-fg32">+		for k, v := range dec.Transactions {</span>
<span class="term-fg32">+			p.Transactions[k] = v</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.NoTxPool != nil {</span>
<span class="term-fg32">+		p.NoTxPool = *dec.NoTxPool</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.GasLimit != nil {</span>
<span class="term-fg32">+		p.GasLimit = (*uint64)(dec.GasLimit)</span>
 	}
 	return nil
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c18b645910fbcb08ff748188" role="button"
                   aria-expanded="false" aria-controls="id-c18b645910fbcb08ff748188">
                    <code>eth/catalyst/api.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/catalyst/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/catalyst/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+26</span></div>
                        <div class="text-start"><span class="text-danger">-78</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c18b645910fbcb08ff748188"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;catalyst&#47;api.go op-geth&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">index 9077f20bffccb108ca46e6b334b1fb5464c74c21..2ddc0467371e2f0729d0b56a6a08fb2f400a9284 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg36">@@ -20,7 +20,6 @@</span>
 import (
 	&quot;errors&quot;
 	&quot;fmt&quot;
<span class="term-fg31">-	&quot;math&#47;big&quot;</span>
 	&quot;sync&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg36">@@ -63,11 +62,6 @@</span>
 	&#47;&#47; beaconUpdateStartupTimeout is the time to wait for a beacon client to get
 	&#47;&#47; attached before starting to issue warnings.
 	beaconUpdateStartupTimeout = 30 * time.Second
<span class="term-fg31">-</span>
<span class="term-fg31">-	&#47;&#47; beaconUpdateExchangeTimeout is the max time allowed for a beacon client to</span>
<span class="term-fg31">-	&#47;&#47; do a transition config exchange before it&#39;s considered offline and the user</span>
<span class="term-fg31">-	&#47;&#47; is warned.</span>
<span class="term-fg31">-	beaconUpdateExchangeTimeout = 2 * time.Minute</span>
&nbsp;
 	&#47;&#47; beaconUpdateConsensusTimeout is the max time allowed for a beacon client
 	&#47;&#47; to send a consensus update before it&#39;s considered offline and the user is
<span class="term-fg36">@@ -149,6 +143,9 @@</span> 		invalidBlocksHits: make(map[common.Hash]int),
 		invalidTipsets:    make(map[common.Hash]*types.Header),
 	}
 	eth.Downloader().SetBadBlockCallback(api.setInvalidAncestor)
<span class="term-fg32">+	if api.eth.BlockChain().Config().Optimism != nil { &#47;&#47; don&#39;t start the api heartbeat, there is no transition</span>
<span class="term-fg32">+		return api</span>
<span class="term-fg32">+	}</span>
 	go api.heartbeat()
&nbsp;
 	return api
<span class="term-fg36">@@ -298,7 +295,7 @@</span> 	} else if api.eth.BlockChain().CurrentBlock().Hash() == update.HeadBlockHash {
 		&#47;&#47; If the specified head matches with our local head, do nothing and keep
 		&#47;&#47; generating the payload. It&#39;s a special corner case that a few slots are
 		&#47;&#47; missing and we are requested to generate the payload in slot.
<span class="term-fg31">-	} else {</span>
<span class="term-fg32">+	} else if api.eth.BlockChain().Config().Optimism == nil { &#47;&#47; minor Engine API divergence: allow proposers to reorg their own chain</span>
 		&#47;&#47; If the head block is already in our canonical chain, the beacon client is
 		&#47;&#47; probably resyncing. Ignore the update.
 		log.Info(&quot;Ignoring beacon update to old head&quot;, &quot;number&quot;, block.NumberU64(), &quot;hash&quot;, update.HeadBlockHash, &quot;age&quot;, common.PrettyAge(time.Unix(int64(block.Time()), 0)), &quot;have&quot;, api.eth.BlockChain().CurrentBlock().Number)
<span class="term-fg36">@@ -342,12 +339,26 @@</span> 	&#47;&#47; If payload generation was requested, create a new block to be potentially
 	&#47;&#47; sealed by the beacon client. The payload will be requested later, and we
 	&#47;&#47; will replace it arbitrarily many times in between.
 	if payloadAttributes != nil {
<span class="term-fg32">+		if api.eth.BlockChain().Config().Optimism != nil &amp;&amp; payloadAttributes.GasLimit == nil {</span>
<span class="term-fg32">+			return engine.STATUS_INVALID, engine.InvalidPayloadAttributes.With(errors.New(&quot;gasLimit parameter is required&quot;))</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		transactions := make(types.Transactions, 0, len(payloadAttributes.Transactions))</span>
<span class="term-fg32">+		for i, otx := range payloadAttributes.Transactions {</span>
<span class="term-fg32">+			var tx types.Transaction</span>
<span class="term-fg32">+			if err := tx.UnmarshalBinary(otx); err != nil {</span>
<span class="term-fg32">+				return engine.STATUS_INVALID, fmt.Errorf(&quot;transaction %d is not valid: %v&quot;, i, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			transactions = append(transactions, &amp;tx)</span>
<span class="term-fg32">+		}</span>
 		args := &amp;miner.BuildPayloadArgs{
 			Parent:       update.HeadBlockHash,
 			Timestamp:    payloadAttributes.Timestamp,
 			FeeRecipient: payloadAttributes.SuggestedFeeRecipient,
 			Random:       payloadAttributes.Random,
 			Withdrawals:  payloadAttributes.Withdrawals,
<span class="term-fg32">+			NoTxPool:     payloadAttributes.NoTxPool,</span>
<span class="term-fg32">+			Transactions: transactions,</span>
<span class="term-fg32">+			GasLimit:     payloadAttributes.GasLimit,</span>
 		}
 		id := args.Id()
 		&#47;&#47; If we already are busy generating this work, then we do not need
<span class="term-fg36">@@ -667,14 +678,13 @@</span> 	&#47;&#47; Sleep a bit on startup since there&#39;s obviously no beacon client yet
 	&#47;&#47; attached, so no need to print scary warnings to the user.
 	time.Sleep(beaconUpdateStartupTimeout)
&nbsp;
<span class="term-fg31">-	var (</span>
<span class="term-fg31">-		offlineLogged time.Time</span>
<span class="term-fg31">-		ttd           = api.eth.BlockChain().Config().TerminalTotalDifficulty</span>
<span class="term-fg31">-	)</span>
 	&#47;&#47; If the network is not yet merged&#47;merging, don&#39;t bother continuing.
<span class="term-fg31">-	if ttd == nil {</span>
<span class="term-fg32">+	if api.eth.BlockChain().Config().TerminalTotalDifficulty == nil {</span>
 		return
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	var offlineLogged time.Time</span>
<span class="term-fg32">+</span>
 	for {
 		&#47;&#47; Sleep a bit and retrieve the last known consensus updates
 		time.Sleep(5 * time.Second)
<span class="term-fg36">@@ -698,82 +708,20 @@</span> 			if time.Since(lastForkchoiceUpdate) &lt;= beaconUpdateConsensusTimeout || time.Since(lastNewPayloadUpdate) &lt;= beaconUpdateConsensusTimeout {
 				offlineLogged = time.Time{}
 				continue
 			}
<span class="term-fg31">-			if time.Since(lastTransitionUpdate) &gt; beaconUpdateExchangeTimeout {</span>
<span class="term-fg31">-				if time.Since(offlineLogged) &gt; beaconUpdateWarnFrequency {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			if time.Since(offlineLogged) &gt; beaconUpdateWarnFrequency {</span>
<span class="term-fg32">+				if lastForkchoiceUpdate.IsZero() &amp;&amp; lastNewPayloadUpdate.IsZero() {</span>
 					if lastTransitionUpdate.IsZero() {
 						log.Warn(&quot;Post-merge network, but no beacon client seen. Please launch one to follow the chain!&quot;)
 					} else {
<span class="term-fg31">-						log.Warn(&quot;Previously seen beacon client is offline. Please ensure it is operational to follow the chain!&quot;)</span>
<span class="term-fg32">+						log.Warn(&quot;Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!&quot;)</span>
 					}
<span class="term-fg31">-					offlineLogged = time.Now()</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-				continue</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			if time.Since(offlineLogged) &gt; beaconUpdateWarnFrequency {</span>
<span class="term-fg31">-				if lastForkchoiceUpdate.IsZero() &amp;&amp; lastNewPayloadUpdate.IsZero() {</span>
<span class="term-fg31">-					log.Warn(&quot;Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!&quot;)</span>
 				} else {
 					log.Warn(&quot;Beacon client online, but no consensus updates received in a while. Please fix your beacon client to follow the chain!&quot;)
 				}
 				offlineLogged = time.Now()
 			}
 			continue
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		if time.Since(lastTransitionUpdate) &lt;= beaconUpdateExchangeTimeout {</span>
<span class="term-fg31">-			offlineLogged = time.Time{}</span>
<span class="term-fg31">-			continue</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		if time.Since(offlineLogged) &gt; beaconUpdateWarnFrequency {</span>
<span class="term-fg31">-			&#47;&#47; Retrieve the last few blocks and make a rough estimate as</span>
<span class="term-fg31">-			&#47;&#47; to when the merge transition should happen</span>
<span class="term-fg31">-			var (</span>
<span class="term-fg31">-				chain = api.eth.BlockChain()</span>
<span class="term-fg31">-				head  = chain.CurrentHeader()</span>
<span class="term-fg31">-				htd   = chain.GetTd(head.Hash(), head.Number.Uint64())</span>
<span class="term-fg31">-			)</span>
<span class="term-fg31">-			if htd.Cmp(ttd) &gt;= 0 {</span>
<span class="term-fg31">-				if lastTransitionUpdate.IsZero() {</span>
<span class="term-fg31">-					log.Warn(&quot;Merge already reached, but no beacon client seen. Please launch one to follow the chain!&quot;)</span>
<span class="term-fg31">-				} else {</span>
<span class="term-fg31">-					log.Warn(&quot;Merge already reached, but previously seen beacon client is offline. Please ensure it is operational to follow the chain!&quot;)</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-				offlineLogged = time.Now()</span>
<span class="term-fg31">-				continue</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			var eta time.Duration</span>
<span class="term-fg31">-			if head.Number.Uint64() &gt; 0 {</span>
<span class="term-fg31">-				&#47;&#47; Accumulate the last 64 difficulties to estimate the growth</span>
<span class="term-fg31">-				var (</span>
<span class="term-fg31">-					deltaDiff uint64</span>
<span class="term-fg31">-					deltaTime uint64</span>
<span class="term-fg31">-					current   = head</span>
<span class="term-fg31">-				)</span>
<span class="term-fg31">-				for i := 0; i &lt; 64; i++ {</span>
<span class="term-fg31">-					parent := chain.GetHeader(current.ParentHash, current.Number.Uint64()-1)</span>
<span class="term-fg31">-					if parent == nil {</span>
<span class="term-fg31">-						break</span>
<span class="term-fg31">-					}</span>
<span class="term-fg31">-					deltaDiff += current.Difficulty.Uint64()</span>
<span class="term-fg31">-					deltaTime += current.Time - parent.Time</span>
<span class="term-fg31">-					current = parent</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-				&#47;&#47; Estimate an ETA based on the block times and the difficulty growth</span>
<span class="term-fg31">-				if deltaTime &gt; 0 {</span>
<span class="term-fg31">-					growth := deltaDiff &#47; deltaTime</span>
<span class="term-fg31">-					left := new(big.Int).Sub(ttd, htd)</span>
<span class="term-fg31">-					eta = time.Duration(new(big.Int).Div(left, new(big.Int).SetUint64(growth+1)).Uint64()) * time.Second</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			message := &quot;Merge is configured, but previously seen beacon client is offline. Please ensure it is operational before the transition arrives!&quot;</span>
<span class="term-fg31">-			if lastTransitionUpdate.IsZero() {</span>
<span class="term-fg31">-				message = &quot;Merge is configured, but no beacon client seen. Please ensure you have one available before the transition arrives!&quot;</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			if eta &lt; time.Second {</span>
<span class="term-fg31">-				log.Warn(message)</span>
<span class="term-fg31">-			} else {</span>
<span class="term-fg31">-				log.Warn(message, &quot;eta&quot;, common.PrettyAge(time.Now().Add(-eta))) &#47;&#47; weird hack, but duration formatted doesn&#39;t handle days</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			offlineLogged = time.Now()</span>
 		}
 	}
 }</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-87889f409eb0ad8018083b78"role="button" aria-expanded="false" aria-controls="id-87889f409eb0ad8018083b78">
        
            <div class="col-12 col-sm-9 text-start"><h3>Block-building modifications</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+101</span></div>
                <div class="text-start"><span class="text-danger">-54</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-87889f409eb0ad8018083b78">
        <div><p>The block-building code (in the &ldquo;miner&rdquo; package because of Proof-Of-Work legacy of ethereum) implements the
changes to support the transaction-inclusion, tx-pool toggle and gaslimit parameters of the Engine API.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cccbed08e575fb78a373b492" role="button"
                   aria-expanded="false" aria-controls="id-cccbed08e575fb78a373b492">
                    <code>miner/payload_building.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/payload_building.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/payload_building.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+22</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cccbed08e575fb78a373b492"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;payload_building.go op-geth&#47;miner&#47;payload_building.go</span>
<span class="term-fg1">index f84d908e86d68dbb132e2cd75ba5e21887fc018c..26e89eef31cab52754e0a41bb540639b4f58067f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;payload_building.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;payload_building.go</span>
<span class="term-fg36">@@ -40,6 +40,10 @@</span> 	Timestamp    uint64            &#47;&#47; The provided timestamp of generated payload
 	FeeRecipient common.Address    &#47;&#47; The provided recipient address for collecting transaction fee
 	Random       common.Hash       &#47;&#47; The provided randomness value
 	Withdrawals  types.Withdrawals &#47;&#47; The provided withdrawals
<span class="term-fg32">+</span>
<span class="term-fg32">+	NoTxPool     bool                 &#47;&#47; Optimism addition: option to disable tx pool contents from being included</span>
<span class="term-fg32">+	Transactions []*types.Transaction &#47;&#47; Optimism addition: txs forced into the block via engine API</span>
<span class="term-fg32">+	GasLimit     *uint64              &#47;&#47; Optimism addition: override gas limit of the block to build</span>
 }
&nbsp;
 &#47;&#47; Id computes an 8-byte identifier by hashing the components of the payload arguments.
<span class="term-fg36">@@ -51,6 +55,19 @@</span> 	binary.Write(hasher, binary.BigEndian, args.Timestamp)
 	hasher.Write(args.Random[:])
 	hasher.Write(args.FeeRecipient[:])
 	rlp.Encode(hasher, args.Withdrawals)
<span class="term-fg32">+</span>
<span class="term-fg32">+	if args.NoTxPool || len(args.Transactions) &gt; 0 { &#47;&#47; extend if extra payload attributes are used</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, args.NoTxPool)</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, uint64(len(args.Transactions)))</span>
<span class="term-fg32">+		for _, tx := range args.Transactions {</span>
<span class="term-fg32">+			h := tx.Hash()</span>
<span class="term-fg32">+			hasher.Write(h[:])</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if args.GasLimit != nil {</span>
<span class="term-fg32">+		binary.Write(hasher, binary.BigEndian, *args.GasLimit)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	var out engine.PayloadID
 	copy(out[:], hasher.Sum(nil)[:8])
 	return out
<span class="term-fg36">@@ -156,12 +173,15 @@</span> func (w *worker) buildPayload(args *BuildPayloadArgs) (*Payload, error) {
 	&#47;&#47; Build the initial version with no transaction included. It should be fast
 	&#47;&#47; enough to run. The empty payload can at least make sure there is something
 	&#47;&#47; to deliver for not missing slot.
<span class="term-fg31">-	empty, _, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, args.Withdrawals, true)</span>
<span class="term-fg32">+	empty, _, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, args.Withdrawals, true, args.Transactions, args.GasLimit)</span>
 	if err != nil {
 		return nil, err
 	}
 	&#47;&#47; Construct a payload object for return.
 	payload := newPayload(empty, args.Id())
<span class="term-fg32">+	if args.NoTxPool { &#47;&#47; don&#39;t start the background payload updating job if there is no tx pool to pull from</span>
<span class="term-fg32">+		return payload, nil</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	&#47;&#47; Spin up a routine for updating the payload in background. This strategy
 	&#47;&#47; can maximum the revenue for including transactions with highest fee.
<span class="term-fg36">@@ -180,7 +200,7 @@</span> 		for {
 			select {
 			case &lt;-timer.C:
 				start := time.Now()
<span class="term-fg31">-				block, fees, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, args.Withdrawals, false)</span>
<span class="term-fg32">+				block, fees, err := w.getSealingBlock(args.Parent, args.Timestamp, args.FeeRecipient, args.Random, args.Withdrawals, false, args.Transactions, args.GasLimit)</span>
 				if err == nil {
 					payload.update(block, fees, time.Since(start))
 				}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5fcd6c9446a74f8cc29f8d9e" role="button"
                   aria-expanded="false" aria-controls="id-5fcd6c9446a74f8cc29f8d9e">
                    <code>miner/worker_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/worker_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/worker_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5fcd6c9446a74f8cc29f8d9e"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;worker_test.go op-geth&#47;miner&#47;worker_test.go</span>
<span class="term-fg1">index e60de679326cf18a3cc9bf0dbfb8ea9107864e68..8e3b1c8c0809c0fc7327096ccff6c11b37dc3a63 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;worker_test.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;worker_test.go</span>
<span class="term-fg36">@@ -454,11 +454,11 @@</span> 	var (
 		progress = make(chan struct{}, 10)
 		result   = make([]float64, 0, 10)
 		index    = 0
<span class="term-fg31">-		start    uint32</span>
<span class="term-fg32">+		start    atomic.Bool</span>
 	)
 	w.resubmitHook = func(minInterval time.Duration, recommitInterval time.Duration) {
 		&#47;&#47; Short circuit if interval checking hasn&#39;t started.
<span class="term-fg31">-		if atomic.LoadUint32(&amp;start) == 0 {</span>
<span class="term-fg32">+		if !start.Load() {</span>
 			return
 		}
 		var wantMinInterval, wantRecommitInterval time.Duration
<span class="term-fg36">@@ -493,7 +493,7 @@</span> 	}
 	w.start()
&nbsp;
 	time.Sleep(time.Second) &#47;&#47; Ensure two tasks have been submitted due to start opt
<span class="term-fg31">-	atomic.StoreUint32(&amp;start, 1)</span>
<span class="term-fg32">+	start.Store(true)</span>
&nbsp;
 	w.setRecommitInterval(3 * time.Second)
 	select {
<span class="term-fg36">@@ -635,7 +635,7 @@</span> 	}
&nbsp;
 	&#47;&#47; This API should work even when the automatic sealing is not enabled
 	for _, c := range cases {
<span class="term-fg31">-		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, nil, false)</span>
<span class="term-fg32">+		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, nil, false, nil, nil)</span>
 		if c.expectErr {
 			if err == nil {
 				t.Error(&quot;Expect error but get nil&quot;)
<span class="term-fg36">@@ -651,7 +651,7 @@</span>
 	&#47;&#47; This API should work even when the automatic sealing is enabled
 	w.start()
 	for _, c := range cases {
<span class="term-fg31">-		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, nil, false)</span>
<span class="term-fg32">+		block, _, err := w.getSealingBlock(c.parent, timestamp, c.coinbase, c.random, nil, false, nil, nil)</span>
 		if c.expectErr {
 			if err == nil {
 				t.Error(&quot;Expect error but get nil&quot;)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a8f183836d0c6376e4b2d687" role="button"
                   aria-expanded="false" aria-controls="id-a8f183836d0c6376e4b2d687">
                    <code>miner/miner.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/miner.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/miner.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a8f183836d0c6376e4b2d687"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;miner.go op-geth&#47;miner&#47;miner.go</span>
<span class="term-fg1">index c969aec735469405966e7676eb0d44d169155541..aa17a57967a0bfcc11ee454460598be37a5e9c38 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;miner.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;miner.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span> &#47;&#47; Package miner implements Ethereum block creation and mining.
 package miner
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
 	&quot;sync&quot;
<span class="term-fg36">@@ -31,6 +32,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;txpool&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;downloader&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg36">@@ -41,6 +43,10 @@</span> &#47;&#47; to offer all the functions here.
 type Backend interface {
 	BlockChain() *core.BlockChain
 	TxPool() *txpool.TxPool
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type BackendWithHistoricalState interface {</span>
<span class="term-fg32">+	StateAtBlock(ctx context.Context, block *types.Block, reexec uint64, base *state.StateDB, readOnly bool, preferDisk bool) (*state.StateDB, tracers.StateReleaseFunc, error)</span>
 }
&nbsp;
 &#47;&#47; Config is the configuration parameters of mining.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0615c9f11223e317cca8c34b" role="button"
                   aria-expanded="false" aria-controls="id-0615c9f11223e317cca8c34b">
                    <code>miner/worker.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/worker.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/worker.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+68</span></div>
                        <div class="text-start"><span class="text-danger">-47</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0615c9f11223e317cca8c34b"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;worker.go op-geth&#47;miner&#47;worker.go</span>
<span class="term-fg1">index 67a5842d23e0ddecfd019821081032a01ae69ea9..4342bb2fc5d933dbc3c799b92a7b742ba5893e35 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;worker.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;worker.go</span>
<span class="term-fg36">@@ -17,6 +17,7 @@</span>
 package miner
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
<span class="term-fg36">@@ -31,6 +32,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg36">@@ -164,7 +166,7 @@</span> )
&nbsp;
 &#47;&#47; newWorkReq represents a request for new sealing work submitting with relative interrupt notifier.
 type newWorkReq struct {
<span class="term-fg31">-	interrupt *int32</span>
<span class="term-fg32">+	interrupt *atomic.Int32</span>
 	noempty   bool
 	timestamp int64
 }
<span class="term-fg36">@@ -239,15 +241,15 @@</span> 	snapshotReceipts types.Receipts
 	snapshotState    *state.StateDB
&nbsp;
 	&#47;&#47; atomic status counters
<span class="term-fg31">-	running int32 &#47;&#47; The indicator whether the consensus engine is running or not.</span>
<span class="term-fg31">-	newTxs  int32 &#47;&#47; New arrival transaction count since last sealing work submitting.</span>
<span class="term-fg32">+	running atomic.Bool  &#47;&#47; The indicator whether the consensus engine is running or not.</span>
<span class="term-fg32">+	newTxs  atomic.Int32 &#47;&#47; New arrival transaction count since last sealing work submitting.</span>
&nbsp;
 	&#47;&#47; noempty is the flag used to control whether the feature of pre-seal empty
 	&#47;&#47; block is enabled. The default value is false(pre-seal is enabled by default).
 	&#47;&#47; But in some special scenario the consensus engine will seal blocks instantaneously,
 	&#47;&#47; in this case this feature will add all empty blocks into canonical chain
 	&#47;&#47; non-stop and no real transaction will be included.
<span class="term-fg31">-	noempty uint32</span>
<span class="term-fg32">+	noempty atomic.Bool</span>
&nbsp;
 	&#47;&#47; newpayloadTimeout is the maximum timeout allowance for creating payload.
 	&#47;&#47; The default value is 2 seconds but node operator can set it to arbitrary
<span class="term-fg36">@@ -372,12 +374,12 @@</span> }
&nbsp;
 &#47;&#47; disablePreseal disables pre-sealing feature
 func (w *worker) disablePreseal() {
<span class="term-fg31">-	atomic.StoreUint32(&amp;w.noempty, 1)</span>
<span class="term-fg32">+	w.noempty.Store(true)</span>
 }
&nbsp;
 &#47;&#47; enablePreseal enables pre-sealing feature
 func (w *worker) enablePreseal() {
<span class="term-fg31">-	atomic.StoreUint32(&amp;w.noempty, 0)</span>
<span class="term-fg32">+	w.noempty.Store(false)</span>
 }
&nbsp;
 &#47;&#47; pending returns the pending state and corresponding block.
<span class="term-fg36">@@ -409,24 +411,24 @@</span> }
&nbsp;
 &#47;&#47; start sets the running status as 1 and triggers new work submitting.
 func (w *worker) start() {
<span class="term-fg31">-	atomic.StoreInt32(&amp;w.running, 1)</span>
<span class="term-fg32">+	w.running.Store(true)</span>
 	w.startCh &lt;- struct{}{}
 }
&nbsp;
 &#47;&#47; stop sets the running status as 0.
 func (w *worker) stop() {
<span class="term-fg31">-	atomic.StoreInt32(&amp;w.running, 0)</span>
<span class="term-fg32">+	w.running.Store(false)</span>
 }
&nbsp;
 &#47;&#47; isRunning returns an indicator whether worker is running or not.
 func (w *worker) isRunning() bool {
<span class="term-fg31">-	return atomic.LoadInt32(&amp;w.running) == 1</span>
<span class="term-fg32">+	return w.running.Load()</span>
 }
&nbsp;
 &#47;&#47; close terminates all background threads maintained by the worker.
 &#47;&#47; Note the worker does not support being closed multiple times.
 func (w *worker) close() {
<span class="term-fg31">-	atomic.StoreInt32(&amp;w.running, 0)</span>
<span class="term-fg32">+	w.running.Store(false)</span>
 	close(w.exitCh)
 	w.wg.Wait()
 }
<span class="term-fg36">@@ -457,7 +459,7 @@</span> &#47;&#47; newWorkLoop is a standalone goroutine to submit new sealing work upon received events.
 func (w *worker) newWorkLoop(recommit time.Duration) {
 	defer w.wg.Done()
 	var (
<span class="term-fg31">-		interrupt   *int32</span>
<span class="term-fg32">+		interrupt   *atomic.Int32</span>
 		minRecommit = recommit &#47;&#47; minimal resubmit interval specified by user.
 		timestamp   int64      &#47;&#47; timestamp for each round of sealing.
 	)
<span class="term-fg36">@@ -469,16 +471,16 @@</span>
 	&#47;&#47; commit aborts in-flight transaction execution with given signal and resubmits a new one.
 	commit := func(noempty bool, s int32) {
 		if interrupt != nil {
<span class="term-fg31">-			atomic.StoreInt32(interrupt, s)</span>
<span class="term-fg32">+			interrupt.Store(s)</span>
 		}
<span class="term-fg31">-		interrupt = new(int32)</span>
<span class="term-fg32">+		interrupt = new(atomic.Int32)</span>
 		select {
 		case w.newWorkCh &lt;- &amp;newWorkReq{interrupt: interrupt, noempty: noempty, timestamp: timestamp}:
 		case &lt;-w.exitCh:
 			return
 		}
 		timer.Reset(recommit)
<span class="term-fg31">-		atomic.StoreInt32(&amp;w.newTxs, 0)</span>
<span class="term-fg32">+		w.newTxs.Store(0)</span>
 	}
 	&#47;&#47; clearPending cleans the stale pending tasks.
 	clearPending := func(number uint64) {
<span class="term-fg36">@@ -508,7 +510,7 @@</span> 			&#47;&#47; If sealing is running resubmit a new work cycle periodically to pull in
 			&#47;&#47; higher priced transactions. Disable this overhead for pending blocks.
 			if w.isRunning() &amp;&amp; (w.chainConfig.Clique == nil || w.chainConfig.Clique.Period &gt; 0) {
 				&#47;&#47; Short circuit if no new transaction arrives.
<span class="term-fg31">-				if atomic.LoadInt32(&amp;w.newTxs) == 0 {</span>
<span class="term-fg32">+				if w.newTxs.Load() == 0 {</span>
 					timer.Reset(recommit)
 					continue
 				}
<span class="term-fg36">@@ -650,7 +652,7 @@</span> 				if w.chainConfig.Clique != nil &amp;&amp; w.chainConfig.Clique.Period == 0 {
 					w.commitWork(nil, true, time.Now().Unix())
 				}
 			}
<span class="term-fg31">-			atomic.AddInt32(&amp;w.newTxs, int32(len(ev.Txs)))</span>
<span class="term-fg32">+			w.newTxs.Add(int32(len(ev.Txs)))</span>
&nbsp;
 		&#47;&#47; System stopped
 		case &lt;-w.exitCh:
<span class="term-fg36">@@ -794,6 +796,15 @@</span> func (w *worker) makeEnv(parent *types.Header, header *types.Header, coinbase common.Address) (*environment, error) {
 	&#47;&#47; Retrieve the parent state to execute on top and start a prefetcher for
 	&#47;&#47; the miner to speed block sealing up a bit.
 	state, err := w.chain.StateAt(parent.Root)
<span class="term-fg32">+	if err != nil &amp;&amp; w.chainConfig.Optimism != nil { &#47;&#47; Allow the miner to reorg its own chain arbitrarily deep</span>
<span class="term-fg32">+		if historicalBackend, ok := w.eth.(BackendWithHistoricalState); ok {</span>
<span class="term-fg32">+			var release tracers.StateReleaseFunc</span>
<span class="term-fg32">+			parentBlock := w.eth.BlockChain().GetBlockByHash(parent.Hash())</span>
<span class="term-fg32">+			state, release, err = historicalBackend.StateAtBlock(context.Background(), parentBlock, ^uint64(0), nil, false, false)</span>
<span class="term-fg32">+			state = state.Copy()</span>
<span class="term-fg32">+			release()</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -877,7 +888,7 @@</span>
 	return receipt.Logs, nil
 }
&nbsp;
<span class="term-fg31">-func (w *worker) commitTransactions(env *environment, txs *types.TransactionsByPriceAndNonce, interrupt *int32) error {</span>
<span class="term-fg32">+func (w *worker) commitTransactions(env *environment, txs *types.TransactionsByPriceAndNonce, interrupt *atomic.Int32) error {</span>
 	gasLimit := env.header.GasLimit
 	if env.gasPool == nil {
 		env.gasPool = new(core.GasPool).AddGas(gasLimit)
<span class="term-fg36">@@ -887,7 +898,7 @@</span>
 	for {
 		&#47;&#47; Check interruption signal and abort building if it&#39;s fired.
 		if interrupt != nil {
<span class="term-fg31">-			if signal := atomic.LoadInt32(interrupt); signal != commitInterruptNone {</span>
<span class="term-fg32">+			if signal := interrupt.Load(); signal != commitInterruptNone {</span>
 				return signalToErr(signal)
 			}
 		}
<span class="term-fg36">@@ -918,37 +929,22 @@</span> 		env.state.SetTxContext(tx.Hash(), env.tcount)
&nbsp;
 		logs, err := w.commitTransaction(env, tx)
 		switch {
<span class="term-fg31">-		case errors.Is(err, core.ErrGasLimitReached):</span>
<span class="term-fg31">-			&#47;&#47; Pop the current out-of-gas transaction without shifting in the next from the account</span>
<span class="term-fg31">-			log.Trace(&quot;Gas limit exceeded for current block&quot;, &quot;sender&quot;, from)</span>
<span class="term-fg31">-			txs.Pop()</span>
<span class="term-fg31">-</span>
 		case errors.Is(err, core.ErrNonceTooLow):
 			&#47;&#47; New head notification data race between the transaction pool and miner, shift
 			log.Trace(&quot;Skipping transaction with low nonce&quot;, &quot;sender&quot;, from, &quot;nonce&quot;, tx.Nonce())
 			txs.Shift()
&nbsp;
<span class="term-fg31">-		case errors.Is(err, core.ErrNonceTooHigh):</span>
<span class="term-fg31">-			&#47;&#47; Reorg notification data race between the transaction pool and miner, skip account =</span>
<span class="term-fg31">-			log.Trace(&quot;Skipping account with hight nonce&quot;, &quot;sender&quot;, from, &quot;nonce&quot;, tx.Nonce())</span>
<span class="term-fg31">-			txs.Pop()</span>
<span class="term-fg31">-</span>
 		case errors.Is(err, nil):
 			&#47;&#47; Everything ok, collect the logs and shift in the next transaction from the same account
 			coalescedLogs = append(coalescedLogs, logs...)
 			env.tcount++
 			txs.Shift()
&nbsp;
<span class="term-fg31">-		case errors.Is(err, types.ErrTxTypeNotSupported):</span>
<span class="term-fg31">-			&#47;&#47; Pop the unsupported transaction without shifting in the next from the account</span>
<span class="term-fg31">-			log.Trace(&quot;Skipping unsupported transaction type&quot;, &quot;sender&quot;, from, &quot;type&quot;, tx.Type())</span>
<span class="term-fg31">-			txs.Pop()</span>
<span class="term-fg31">-</span>
 		default:
<span class="term-fg31">-			&#47;&#47; Strange error, discard the transaction and get the next in line (note, the</span>
<span class="term-fg31">-			&#47;&#47; nonce-too-high clause will prevent us from executing in vain).</span>
<span class="term-fg32">+			&#47;&#47; Transaction is regarded as invalid, drop all consecutive transactions from</span>
<span class="term-fg32">+			&#47;&#47; the same sender because of `nonce-too-high` clause.</span>
 			log.Debug(&quot;Transaction failed, account skipped&quot;, &quot;hash&quot;, tx.Hash(), &quot;err&quot;, err)
<span class="term-fg31">-			txs.Shift()</span>
<span class="term-fg32">+			txs.Pop()</span>
 		}
 	}
 	if !w.isRunning() &amp;&amp; len(coalescedLogs) &gt; 0 {
<span class="term-fg36">@@ -979,6 +975,9 @@</span> 	random      common.Hash       &#47;&#47; The randomness generated by beacon chain, empty before the merge
 	withdrawals types.Withdrawals &#47;&#47; List of withdrawals to include in block.
 	noUncle     bool              &#47;&#47; Flag whether the uncle block inclusion is allowed
 	noTxs       bool              &#47;&#47; Flag whether an empty block without any transaction is expected
<span class="term-fg32">+</span>
<span class="term-fg32">+	txs      types.Transactions &#47;&#47; Deposit transactions to include at the start of the block</span>
<span class="term-fg32">+	gasLimit *uint64            &#47;&#47; Optional gas limit override</span>
 }
&nbsp;
 &#47;&#47; prepareWork constructs the sealing task according to the given parameters,
<span class="term-fg36">@@ -1015,7 +1014,7 @@</span> 		Time:       timestamp,
 		Coinbase:   genParams.coinbase,
 	}
 	&#47;&#47; Set the extra field.
<span class="term-fg31">-	if len(w.extra) != 0 {</span>
<span class="term-fg32">+	if len(w.extra) != 0 &amp;&amp; w.chainConfig.Optimism == nil { &#47;&#47; Optimism chains must not set any extra data.</span>
 		header.Extra = w.extra
 	}
 	&#47;&#47; Set the randomness field from the beacon chain if it&#39;s available.
<span class="term-fg36">@@ -1030,6 +1029,12 @@</span> 			parentGasLimit := parent.GasLimit * w.chainConfig.ElasticityMultiplier()
 			header.GasLimit = core.CalcGasLimit(parentGasLimit, w.config.GasCeil)
 		}
 	}
<span class="term-fg32">+	if genParams.gasLimit != nil { &#47;&#47; override gas limit if specified</span>
<span class="term-fg32">+		header.GasLimit = *genParams.gasLimit</span>
<span class="term-fg32">+	} else if w.chain.Config().Optimism != nil &amp;&amp; w.config.GasCeil != 0 {</span>
<span class="term-fg32">+		&#47;&#47; configure the gas limit of pending blocks with the miner gas limit config when using optimism</span>
<span class="term-fg32">+		header.GasLimit = w.config.GasCeil</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Run the consensus preparation with the default or customized consensus engine.
 	if err := w.engine.Prepare(w.chain, header); err != nil {
 		log.Error(&quot;Failed to prepare header for sealing&quot;, &quot;err&quot;, err)
<span class="term-fg36">@@ -1067,7 +1072,7 @@</span>
 &#47;&#47; fillTransactions retrieves the pending transactions from the txpool and fills them
 &#47;&#47; into the given sealing block. The transaction selection and ordering strategy can
 &#47;&#47; be customized with the plugin in the future.
<span class="term-fg31">-func (w *worker) fillTransactions(interrupt *int32, env *environment) error {</span>
<span class="term-fg32">+func (w *worker) fillTransactions(interrupt *atomic.Int32, env *environment) error {</span>
 	&#47;&#47; Split the pending transactions into locals and remotes
 	&#47;&#47; Fill the block with all available pending transactions.
 	pending := w.eth.TxPool().Pending(true)
<span class="term-fg36">@@ -1094,17 +1099,31 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; generateWork generates a sealing block based on the given parameters.
<span class="term-fg31">-func (w *worker) generateWork(params *generateParams) (*types.Block, *big.Int, error) {</span>
<span class="term-fg31">-	work, err := w.prepareWork(params)</span>
<span class="term-fg32">+func (w *worker) generateWork(genParams *generateParams) (*types.Block, *big.Int, error) {</span>
<span class="term-fg32">+	work, err := w.prepareWork(genParams)</span>
 	if err != nil {
 		return nil, nil, err
 	}
 	defer work.discard()
<span class="term-fg32">+	if work.gasPool == nil {</span>
<span class="term-fg32">+		work.gasPool = new(core.GasPool).AddGas(work.header.GasLimit)</span>
<span class="term-fg32">+	}</span>
&nbsp;
<span class="term-fg31">-	if !params.noTxs {</span>
<span class="term-fg31">-		interrupt := new(int32)</span>
<span class="term-fg32">+	for _, tx := range genParams.txs {</span>
<span class="term-fg32">+		from, _ := types.Sender(work.signer, tx)</span>
<span class="term-fg32">+		work.state.SetTxContext(tx.Hash(), work.tcount)</span>
<span class="term-fg32">+		_, err := w.commitTransaction(work, tx)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, nil, fmt.Errorf(&quot;failed to force-include tx: %s type: %d sender: %s nonce: %d, err: %w&quot;, tx.Hash(), tx.Type(), from, tx.Nonce(), err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		work.tcount++</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; forced transactions done, fill rest of block with transactions</span>
<span class="term-fg32">+	if !genParams.noTxs {</span>
<span class="term-fg32">+		interrupt := new(atomic.Int32)</span>
 		timer := time.AfterFunc(w.newpayloadTimeout, func() {
<span class="term-fg31">-			atomic.StoreInt32(interrupt, commitInterruptTimeout)</span>
<span class="term-fg32">+			interrupt.Store(commitInterruptTimeout)</span>
 		})
 		defer timer.Stop()
&nbsp;
<span class="term-fg36">@@ -1113,7 +1132,7 @@</span> 		if errors.Is(err, errBlockInterruptedByTimeout) {
 			log.Warn(&quot;Block building is interrupted&quot;, &quot;allowance&quot;, common.PrettyDuration(w.newpayloadTimeout))
 		}
 	}
<span class="term-fg31">-	block, err := w.engine.FinalizeAndAssemble(w.chain, work.header, work.state, work.txs, work.unclelist(), work.receipts, params.withdrawals)</span>
<span class="term-fg32">+	block, err := w.engine.FinalizeAndAssemble(w.chain, work.header, work.state, work.txs, work.unclelist(), work.receipts, genParams.withdrawals)</span>
 	if err != nil {
 		return nil, nil, err
 	}
<span class="term-fg36">@@ -1122,7 +1141,7 @@</span> }
&nbsp;
 &#47;&#47; commitWork generates several new sealing tasks based on the parent block
 &#47;&#47; and submit them to the sealer.
<span class="term-fg31">-func (w *worker) commitWork(interrupt *int32, noempty bool, timestamp int64) {</span>
<span class="term-fg32">+func (w *worker) commitWork(interrupt *atomic.Int32, noempty bool, timestamp int64) {</span>
 	start := time.Now()
&nbsp;
 	&#47;&#47; Set the coinbase if the worker is running or it&#39;s required
<span class="term-fg36">@@ -1143,7 +1162,7 @@</span> 		return
 	}
 	&#47;&#47; Create an empty block based on temporary copied state for
 	&#47;&#47; sealing in advance without waiting block execution finished.
<span class="term-fg31">-	if !noempty &amp;&amp; atomic.LoadUint32(&amp;w.noempty) == 0 {</span>
<span class="term-fg32">+	if !noempty &amp;&amp; !w.noempty.Load() {</span>
 		w.commit(work.copy(), nil, false, start)
 	}
 	&#47;&#47; Fill pending transactions from the txpool into the block.
<span class="term-fg36">@@ -1230,7 +1249,7 @@</span>
 &#47;&#47; getSealingBlock generates the sealing block based on the given parameters.
 &#47;&#47; The generation result will be passed back via the given channel no matter
 &#47;&#47; the generation itself succeeds or not.
<span class="term-fg31">-func (w *worker) getSealingBlock(parent common.Hash, timestamp uint64, coinbase common.Address, random common.Hash, withdrawals types.Withdrawals, noTxs bool) (*types.Block, *big.Int, error) {</span>
<span class="term-fg32">+func (w *worker) getSealingBlock(parent common.Hash, timestamp uint64, coinbase common.Address, random common.Hash, withdrawals types.Withdrawals, noTxs bool, transactions types.Transactions, gasLimit *uint64) (*types.Block, *big.Int, error) {</span>
 	req := &amp;getWorkReq{
 		params: &amp;generateParams{
 			timestamp:   timestamp,
<span class="term-fg36">@@ -1241,6 +1260,8 @@</span> 			random:      random,
 			withdrawals: withdrawals,
 			noUncle:     true,
 			noTxs:       noTxs,
<span class="term-fg32">+			txs:         transactions,</span>
<span class="term-fg32">+			gasLimit:    gasLimit,</span>
 		},
 		result: make(chan *newPayloadResult, 1),
 	}</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-622692db41577947eef81693"role="button" aria-expanded="false" aria-controls="id-622692db41577947eef81693">
        
            <div class="col-12 col-sm-9 text-start"><h3>Tx-pool tx cost updates</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+180</span></div>
                <div class="text-start"><span class="text-danger">-73</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-622692db41577947eef81693">
        <div><p>Transaction queueing and inclusion needs to account for the L1 cost component.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e06567096b80e2b22408435e" role="button"
                   aria-expanded="false" aria-controls="id-e06567096b80e2b22408435e">
                    <code>core/txpool/txpool2_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/txpool/txpool2_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/txpool/txpool2_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+26</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e06567096b80e2b22408435e"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;txpool2_test.go op-geth&#47;core&#47;txpool&#47;txpool2_test.go</span>
<span class="term-fg1">index 6d84975d83f9544abdf1607bbf2da28c89209ec8..7e2a9eb908d39ea9248484471f1ac0d82f79a19e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;txpool2_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;txpool2_test.go</span>
<span class="term-fg36">@@ -42,7 +42,7 @@</span> 	}
 	return pending, queued
 }
&nbsp;
<span class="term-fg31">-func fillPool(t *testing.T, pool *TxPool) {</span>
<span class="term-fg32">+func fillPool(t testing.TB, pool *TxPool) {</span>
 	t.Helper()
 	&#47;&#47; Create a number of test accounts, fund them and make transactions
 	executableTxs := types.Transactions{}
<span class="term-fg36">@@ -189,7 +189,7 @@</span> 	{
 		key, _ := crypto.GenerateKey()
 		pool.currentState.AddBalance(crypto.PubkeyToAddress(key.PublicKey), big.NewInt(100000000000))
 		for j := 0; j &lt; int(pool.config.GlobalSlots); j++ {
<span class="term-fg31">-			overDraftTxs = append(overDraftTxs, pricedValuedTransaction(uint64(j), 60000000000, 21000, big.NewInt(500), key))</span>
<span class="term-fg32">+			overDraftTxs = append(overDraftTxs, pricedValuedTransaction(uint64(j), 600000000000, 21000, big.NewInt(500), key))</span>
 		}
 	}
 	pool.AddRemotesSync(overDraftTxs)
<span class="term-fg36">@@ -210,3 +210,27 @@</span> 		t.Errorf(&quot;Wrong invalid pending-count, have %d, want %d (GlobalSlots: %d, queued: %d)&quot;,
 			newIvPending, ivPending, pool.config.GlobalSlots, newQueued)
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func BenchmarkFutureAttack(b *testing.B) {</span>
<span class="term-fg32">+	&#47;&#47; Create the pool to test the limit enforcement with</span>
<span class="term-fg32">+	statedb, _ := state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase()), nil)</span>
<span class="term-fg32">+	blockchain := newTestBlockChain(1000000, statedb, new(event.Feed))</span>
<span class="term-fg32">+	config := testTxPoolConfig</span>
<span class="term-fg32">+	config.GlobalQueue = 100</span>
<span class="term-fg32">+	config.GlobalSlots = 100</span>
<span class="term-fg32">+	pool := NewTxPool(config, eip1559Config, blockchain)</span>
<span class="term-fg32">+	defer pool.Stop()</span>
<span class="term-fg32">+	fillPool(b, pool)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	key, _ := crypto.GenerateKey()</span>
<span class="term-fg32">+	pool.currentState.AddBalance(crypto.PubkeyToAddress(key.PublicKey), big.NewInt(100000000000))</span>
<span class="term-fg32">+	futureTxs := types.Transactions{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for n := 0; n &lt; b.N; n++ {</span>
<span class="term-fg32">+		futureTxs = append(futureTxs, pricedTransaction(1000+uint64(n), 100000, big.NewInt(500), key))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	b.ResetTimer()</span>
<span class="term-fg32">+	for i := 0; i &lt; 5; i++ {</span>
<span class="term-fg32">+		pool.AddRemotesSync(futureTxs)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-708b1b0881d38f1be7a36754" role="button"
                   aria-expanded="false" aria-controls="id-708b1b0881d38f1be7a36754">
                    <code>core/txpool/txpool.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/txpool/txpool.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/txpool/txpool.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+125</span></div>
                        <div class="text-start"><span class="text-danger">-52</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-708b1b0881d38f1be7a36754"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;txpool.go op-geth&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg1">index ac4486c6cba8c011da4dfa474294c64567c1ac4c..3793ecc31c69b6d1dfbdedccff849b270dffcc43 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;txpool.go</span>
<span class="term-fg36">@@ -23,6 +23,7 @@</span> 	&quot;math&quot;
 	&quot;math&#47;big&quot;
 	&quot;sort&quot;
 	&quot;sync&quot;
<span class="term-fg32">+	&quot;sync&#47;atomic&quot;</span>
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -99,6 +100,11 @@</span>
 var (
 	evictionInterval    = time.Minute     &#47;&#47; Time interval to check for evictable transactions
 	statsReportInterval = 8 * time.Second &#47;&#47; Time interval to report transaction pool stats
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; L1 Info Gas Overhead is the amount of gas the the L1 info deposit consumes.</span>
<span class="term-fg32">+	&#47;&#47; It is removed from the tx pool max gas to better indicate that L2 transactions</span>
<span class="term-fg32">+	&#47;&#47; are not able to consume all of the gas in a L2 block as the L1 info deposit is always present.</span>
<span class="term-fg32">+	l1InfoGasOverhead = uint64(70_000)</span>
 )
&nbsp;
 var (
<span class="term-fg36">@@ -250,14 +256,16 @@</span> 	scope       event.SubscriptionScope
 	signer      types.Signer
 	mu          sync.RWMutex
&nbsp;
<span class="term-fg31">-	istanbul bool &#47;&#47; Fork indicator whether we are in the istanbul stage.</span>
<span class="term-fg31">-	eip2718  bool &#47;&#47; Fork indicator whether we are using EIP-2718 type transactions.</span>
<span class="term-fg31">-	eip1559  bool &#47;&#47; Fork indicator whether we are using EIP-1559 type transactions.</span>
<span class="term-fg31">-	shanghai bool &#47;&#47; Fork indicator whether we are in the Shanghai stage.</span>
<span class="term-fg32">+	istanbul atomic.Bool &#47;&#47; Fork indicator whether we are in the istanbul stage.</span>
<span class="term-fg32">+	eip2718  atomic.Bool &#47;&#47; Fork indicator whether we are using EIP-2718 type transactions.</span>
<span class="term-fg32">+	eip1559  atomic.Bool &#47;&#47; Fork indicator whether we are using EIP-1559 type transactions.</span>
<span class="term-fg32">+	shanghai atomic.Bool &#47;&#47; Fork indicator whether we are in the Shanghai stage.</span>
&nbsp;
 	currentState  *state.StateDB &#47;&#47; Current state in the blockchain head
 	pendingNonces *noncer        &#47;&#47; Pending state tracking virtual nonces
<span class="term-fg31">-	currentMaxGas uint64         &#47;&#47; Current gas limit for transaction caps</span>
<span class="term-fg32">+	currentMaxGas atomic.Uint64  &#47;&#47; Current gas limit for transaction caps</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	l1CostFn func(dataGas types.RollupGasData, isDepositTx bool) *big.Int &#47;&#47; Current L1 fee cost function</span>
&nbsp;
 	locals  *accountSet &#47;&#47; Set of local transaction to exempt from eviction rules
 	journal *journal    &#47;&#47; Journal of local transaction to back up to disk
<span class="term-fg36">@@ -592,15 +600,23 @@</span> 	}
 	return txs
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; validateTx checks whether a transaction is valid according to the consensus</span>
<span class="term-fg31">-&#47;&#47; rules and adheres to some heuristic limits of the local node (price and size).</span>
<span class="term-fg31">-func (pool *TxPool) validateTx(tx *types.Transaction, local bool) error {</span>
<span class="term-fg32">+&#47;&#47; validateTxBasics checks whether a transaction is valid according to the consensus</span>
<span class="term-fg32">+&#47;&#47; rules, but does not check state-dependent validation such as sufficient balance.</span>
<span class="term-fg32">+&#47;&#47; This check is meant as an early check which only needs to be performed once,</span>
<span class="term-fg32">+&#47;&#47; and does not require the pool mutex to be held.</span>
<span class="term-fg32">+func (pool *TxPool) validateTxBasics(tx *types.Transaction, local bool) error {</span>
<span class="term-fg32">+	&#47;&#47; No unauthenticated deposits allowed in the transaction pool.</span>
<span class="term-fg32">+	&#47;&#47; This is for spam protection, not consensus,</span>
<span class="term-fg32">+	&#47;&#47; as the external engine-API user authenticates deposits.</span>
<span class="term-fg32">+	if tx.Type() == types.DepositTxType {</span>
<span class="term-fg32">+		return core.ErrTxTypeNotSupported</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Accept only legacy transactions until EIP-2718&#47;2930 activates.
<span class="term-fg31">-	if !pool.eip2718 &amp;&amp; tx.Type() != types.LegacyTxType {</span>
<span class="term-fg32">+	if !pool.eip2718.Load() &amp;&amp; tx.Type() != types.LegacyTxType {</span>
 		return core.ErrTxTypeNotSupported
 	}
 	&#47;&#47; Reject dynamic fee transactions until EIP-1559 activates.
<span class="term-fg31">-	if !pool.eip1559 &amp;&amp; tx.Type() == types.DynamicFeeTxType {</span>
<span class="term-fg32">+	if !pool.eip1559.Load() &amp;&amp; tx.Type() == types.DynamicFeeTxType {</span>
 		return core.ErrTxTypeNotSupported
 	}
 	&#47;&#47; Reject transactions over defined size to prevent DOS attacks
<span class="term-fg36">@@ -608,7 +624,7 @@</span> 	if tx.Size() &gt; txMaxSize {
 		return ErrOversizedData
 	}
 	&#47;&#47; Check whether the init code size has been exceeded.
<span class="term-fg31">-	if pool.shanghai &amp;&amp; tx.To() == nil &amp;&amp; len(tx.Data()) &gt; params.MaxInitCodeSize {</span>
<span class="term-fg32">+	if pool.shanghai.Load() &amp;&amp; tx.To() == nil &amp;&amp; len(tx.Data()) &gt; params.MaxInitCodeSize {</span>
 		return fmt.Errorf(&quot;%w: code size %v limit %v&quot;, core.ErrMaxInitCodeSizeExceeded, len(tx.Data()), params.MaxInitCodeSize)
 	}
 	&#47;&#47; Transactions can&#39;t be negative. This may never happen using RLP decoded
<span class="term-fg36">@@ -617,7 +633,7 @@</span> 	if tx.Value().Sign() &lt; 0 {
 		return ErrNegativeValue
 	}
 	&#47;&#47; Ensure the transaction doesn&#39;t exceed the current block limit gas.
<span class="term-fg31">-	if pool.currentMaxGas &lt; tx.Gas() {</span>
<span class="term-fg32">+	if pool.currentMaxGas.Load() &lt; tx.Gas() {</span>
 		return ErrGasLimit
 	}
 	&#47;&#47; Sanity check for extremely large numbers
<span class="term-fg36">@@ -632,47 +648,61 @@</span> 	if tx.GasFeeCapIntCmp(tx.GasTipCap()) &lt; 0 {
 		return core.ErrTipAboveFeeCap
 	}
 	&#47;&#47; Make sure the transaction is signed properly.
<span class="term-fg31">-	from, err := types.Sender(pool.signer, tx)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg32">+	if _, err := types.Sender(pool.signer, tx); err != nil {</span>
 		return ErrInvalidSender
 	}
 	&#47;&#47; Drop non-local transactions under our own minimal accepted gas price or tip
 	if !local &amp;&amp; tx.GasTipCapIntCmp(pool.gasPrice) &lt; 0 {
 		return ErrUnderpriced
 	}
<span class="term-fg32">+	&#47;&#47; Ensure the transaction has more gas than the basic tx fee.</span>
<span class="term-fg32">+	intrGas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil, true, pool.istanbul.Load(), pool.shanghai.Load())</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.Gas() &lt; intrGas {</span>
<span class="term-fg32">+		return core.ErrIntrinsicGas</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; validateTx checks whether a transaction is valid according to the consensus</span>
<span class="term-fg32">+&#47;&#47; rules and adheres to some heuristic limits of the local node (price and size).</span>
<span class="term-fg32">+func (pool *TxPool) validateTx(tx *types.Transaction, local bool) error {</span>
<span class="term-fg32">+	&#47;&#47; Signature has been checked already, this cannot error.</span>
<span class="term-fg32">+	from, _ := types.Sender(pool.signer, tx)</span>
 	&#47;&#47; Ensure the transaction adheres to nonce ordering
 	if pool.currentState.GetNonce(from) &gt; tx.Nonce() {
 		return core.ErrNonceTooLow
 	}
 	&#47;&#47; Transactor should have enough funds to cover the costs
 	&#47;&#47; cost == V + GP * GL
<span class="term-fg32">+	cost := tx.Cost()</span>
<span class="term-fg32">+	if l1Cost := pool.l1CostFn(tx.RollupDataGas(), tx.IsDepositTx()); l1Cost != nil { &#47;&#47; add rollup cost</span>
<span class="term-fg32">+		cost = cost.Add(cost, l1Cost)</span>
<span class="term-fg32">+	}</span>
 	balance := pool.currentState.GetBalance(from)
<span class="term-fg31">-	if balance.Cmp(tx.Cost()) &lt; 0 {</span>
<span class="term-fg32">+	if balance.Cmp(cost) &lt; 0 {</span>
 		return core.ErrInsufficientFunds
 	}
&nbsp;
 	&#47;&#47; Verify that replacing transactions will not result in overdraft
 	list := pool.pending[from]
 	if list != nil { &#47;&#47; Sender already has pending txs
<span class="term-fg31">-		sum := new(big.Int).Add(tx.Cost(), list.totalcost)</span>
<span class="term-fg32">+		sum := new(big.Int).Add(cost, list.totalcost)</span>
 		if repl := list.txs.Get(tx.Nonce()); repl != nil {
 			&#47;&#47; Deduct the cost of a transaction replaced by this
<span class="term-fg31">-			sum.Sub(sum, repl.Cost())</span>
<span class="term-fg32">+			replL1Cost := repl.Cost()</span>
<span class="term-fg32">+			if l1Cost := pool.l1CostFn(tx.RollupDataGas(), tx.IsDepositTx()); l1Cost != nil { &#47;&#47; add rollup cost</span>
<span class="term-fg32">+				replL1Cost = replL1Cost.Add(cost, l1Cost)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			sum.Sub(sum, replL1Cost)</span>
 		}
 		if balance.Cmp(sum) &lt; 0 {
 			log.Trace(&quot;Replacing transactions would overdraft&quot;, &quot;sender&quot;, from, &quot;balance&quot;, pool.currentState.GetBalance(from), &quot;required&quot;, sum)
 			return ErrOverdraft
 		}
 	}
<span class="term-fg31">-</span>
<span class="term-fg31">-	&#47;&#47; Ensure the transaction has more gas than the basic tx fee.</span>
<span class="term-fg31">-	intrGas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil, true, pool.istanbul, pool.shanghai)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		return err</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if tx.Gas() &lt; intrGas {</span>
<span class="term-fg31">-		return core.ErrIntrinsicGas</span>
<span class="term-fg31">-	}</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -736,11 +766,11 @@</span> 			return false, ErrTxPoolOverflow
 		}
&nbsp;
 		&#47;&#47; If the new transaction is a future transaction it should never churn pending transactions
<span class="term-fg31">-		if !isLocal &amp;&amp; pool.isFuture(from, tx) {</span>
<span class="term-fg32">+		if !isLocal &amp;&amp; pool.isGapped(from, tx) {</span>
 			var replacesPending bool
 			for _, dropTx := range drop {
 				dropSender, _ := types.Sender(pool.signer, dropTx)
<span class="term-fg31">-				if list := pool.pending[dropSender]; list != nil &amp;&amp; list.Overlaps(dropTx) {</span>
<span class="term-fg32">+				if list := pool.pending[dropSender]; list != nil &amp;&amp; list.Contains(dropTx.Nonce()) {</span>
 					replacesPending = true
 					break
 				}
<span class="term-fg36">@@ -765,7 +795,7 @@</span> 		}
 	}
&nbsp;
 	&#47;&#47; Try to replace an existing transaction in the pending pool
<span class="term-fg31">-	if list := pool.pending[from]; list != nil &amp;&amp; list.Overlaps(tx) {</span>
<span class="term-fg32">+	if list := pool.pending[from]; list != nil &amp;&amp; list.Contains(tx.Nonce()) {</span>
 		&#47;&#47; Nonce already pending, check if required price bump is met
 		inserted, old := list.Add(tx, pool.config.PriceBump)
 		if !inserted {
<span class="term-fg36">@@ -808,18 +838,26 @@</span> 	log.Trace(&quot;Pooled new future transaction&quot;, &quot;hash&quot;, hash, &quot;from&quot;, from, &quot;to&quot;, tx.To())
 	return replaced, nil
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; isFuture reports whether the given transaction is immediately executable.</span>
<span class="term-fg31">-func (pool *TxPool) isFuture(from common.Address, tx *types.Transaction) bool {</span>
<span class="term-fg31">-	list := pool.pending[from]</span>
<span class="term-fg31">-	if list == nil {</span>
<span class="term-fg31">-		return pool.pendingNonces.get(from) != tx.Nonce()</span>
<span class="term-fg32">+&#47;&#47; isGapped reports whether the given transaction is immediately executable.</span>
<span class="term-fg32">+func (pool *TxPool) isGapped(from common.Address, tx *types.Transaction) bool {</span>
<span class="term-fg32">+	&#47;&#47; Short circuit if transaction matches pending nonce and can be promoted</span>
<span class="term-fg32">+	&#47;&#47; to pending list as an executable transaction.</span>
<span class="term-fg32">+	next := pool.pendingNonces.get(from)</span>
<span class="term-fg32">+	if tx.Nonce() == next {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; The transaction has a nonce gap with pending list, it&#39;s only considered</span>
<span class="term-fg32">+	&#47;&#47; as executable if transactions in queue can fill up the nonce gap.</span>
<span class="term-fg32">+	queue, ok := pool.queue[from]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return true</span>
 	}
<span class="term-fg31">-	&#47;&#47; Sender has pending transactions.</span>
<span class="term-fg31">-	if old := list.txs.Get(tx.Nonce()); old != nil {</span>
<span class="term-fg31">-		return false &#47;&#47; It replaces a pending transaction.</span>
<span class="term-fg32">+	for nonce := next; nonce &lt; tx.Nonce(); nonce++ {</span>
<span class="term-fg32">+		if !queue.Contains(nonce) {</span>
<span class="term-fg32">+			return true &#47;&#47; txs in queue can&#39;t fill up the nonce gap</span>
<span class="term-fg32">+		}</span>
 	}
<span class="term-fg31">-	&#47;&#47; Not replacing, check if parent nonce exists in pending.</span>
<span class="term-fg31">-	return list.txs.Get(tx.Nonce()-1) == nil</span>
<span class="term-fg32">+	return false</span>
 }
&nbsp;
 &#47;&#47; enqueueTx inserts a new transaction into the non-executable transaction queue.
<span class="term-fg36">@@ -969,12 +1007,12 @@</span> 			errs[i] = ErrAlreadyKnown
 			knownTxMeter.Mark(1)
 			continue
 		}
<span class="term-fg31">-		&#47;&#47; Exclude transactions with invalid signatures as soon as</span>
<span class="term-fg31">-		&#47;&#47; possible and cache senders in transactions before</span>
<span class="term-fg31">-		&#47;&#47; obtaining lock</span>
<span class="term-fg31">-		_, err := types.Sender(pool.signer, tx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			errs[i] = ErrInvalidSender</span>
<span class="term-fg32">+		&#47;&#47; Exclude transactions with basic errors, e.g invalid signatures and</span>
<span class="term-fg32">+		&#47;&#47; insufficient intrinsic gas as soon as possible and cache senders</span>
<span class="term-fg32">+		&#47;&#47; in transactions before obtaining lock</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		if err := pool.validateTxBasics(tx, local); err != nil {</span>
<span class="term-fg32">+			errs[i] = err</span>
 			invalidTxMeter.Mark(1)
 			continue
 		}
<span class="term-fg36">@@ -1349,6 +1387,16 @@</span> 						log.Error(&quot;Unrooted new chain seen by tx pool&quot;, &quot;block&quot;, newHead.Number, &quot;hash&quot;, newHead.Hash())
 						return
 					}
 				}
<span class="term-fg32">+				&#47;&#47; Do not insert deposit txs back into the pool</span>
<span class="term-fg32">+				&#47;&#47; (validateTx would still catch it if not filtered, but no need to re-inject in the first place).</span>
<span class="term-fg32">+				j := 0</span>
<span class="term-fg32">+				for _, tx := range discarded {</span>
<span class="term-fg32">+					if tx.Type() != types.DepositTxType {</span>
<span class="term-fg32">+						discarded[j] = tx</span>
<span class="term-fg32">+						j++</span>
<span class="term-fg32">+					}</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				discarded = discarded[:j]</span>
 				reinject = types.TxDifference(discarded, included)
 			}
 		}
<span class="term-fg36">@@ -1364,7 +1412,16 @@</span> 		return
 	}
 	pool.currentState = statedb
 	pool.pendingNonces = newNoncer(statedb)
<span class="term-fg31">-	pool.currentMaxGas = newHead.GasLimit</span>
<span class="term-fg32">+	if !pool.chainconfig.IsOptimism() {</span>
<span class="term-fg32">+		pool.currentMaxGas.Store(newHead.GasLimit)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		pool.currentMaxGas.Store(newHead.GasLimit - l1InfoGasOverhead)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	costFn := types.NewL1CostFunc(pool.chainconfig, statedb)</span>
<span class="term-fg32">+	pool.l1CostFn = func(dataGas types.RollupGasData, isDepositTx bool) *big.Int {</span>
<span class="term-fg32">+		return costFn(newHead.Number.Uint64(), newHead.Time, dataGas, isDepositTx)</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	&#47;&#47; Inject any transactions discarded due to reorgs
 	log.Debug(&quot;Reinjecting stale transactions&quot;, &quot;count&quot;, len(reinject))
<span class="term-fg36">@@ -1373,10 +1430,10 @@</span> 	pool.addTxsLocked(reinject, false)
&nbsp;
 	&#47;&#47; Update all fork indicator by next pending block number.
 	next := new(big.Int).Add(newHead.Number, big.NewInt(1))
<span class="term-fg31">-	pool.istanbul = pool.chainconfig.IsIstanbul(next)</span>
<span class="term-fg31">-	pool.eip2718 = pool.chainconfig.IsBerlin(next)</span>
<span class="term-fg31">-	pool.eip1559 = pool.chainconfig.IsLondon(next)</span>
<span class="term-fg31">-	pool.shanghai = pool.chainconfig.IsShanghai(uint64(time.Now().Unix()))</span>
<span class="term-fg32">+	pool.istanbul.Store(pool.chainconfig.IsIstanbul(next))</span>
<span class="term-fg32">+	pool.eip2718.Store(pool.chainconfig.IsBerlin(next))</span>
<span class="term-fg32">+	pool.eip1559.Store(pool.chainconfig.IsLondon(next))</span>
<span class="term-fg32">+	pool.shanghai.Store(pool.chainconfig.IsShanghai(uint64(time.Now().Unix())))</span>
 }
&nbsp;
 &#47;&#47; promoteExecutables moves transactions that have become processable from the
<span class="term-fg36">@@ -1399,8 +1456,16 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 		}
 		log.Trace(&quot;Removed old queued transactions&quot;, &quot;count&quot;, len(forwards))
<span class="term-fg32">+		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg32">+		if !list.Empty() {</span>
<span class="term-fg32">+			&#47;&#47; Reduce the cost-cap by L1 rollup cost of the first tx if necessary. Other txs will get filtered out afterwards.</span>
<span class="term-fg32">+			el := list.txs.FirstElement()</span>
<span class="term-fg32">+			if l1Cost := pool.l1CostFn(el.RollupDataGas(), el.IsDepositTx()); l1Cost != nil {</span>
<span class="term-fg32">+				balance = new(big.Int).Sub(balance, l1Cost) &#47;&#47; negative big int is fine</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas)
<span class="term-fg31">-		drops, _ := list.Filter(pool.currentState.GetBalance(addr), pool.currentMaxGas)</span>
<span class="term-fg32">+		drops, _ := list.Filter(balance, pool.currentMaxGas.Load())</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			pool.all.Remove(hash)
<span class="term-fg36">@@ -1596,8 +1661,16 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 			log.Trace(&quot;Removed old pending transaction&quot;, &quot;hash&quot;, hash)
 		}
<span class="term-fg32">+		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg32">+		if !list.Empty() {</span>
<span class="term-fg32">+			&#47;&#47; Reduce the cost-cap by L1 rollup cost of the first tx if necessary. Other txs will get filtered out afterwards.</span>
<span class="term-fg32">+			el := list.txs.FirstElement()</span>
<span class="term-fg32">+			if l1Cost := pool.l1CostFn(el.RollupDataGas(), el.IsDepositTx()); l1Cost != nil {</span>
<span class="term-fg32">+				balance = new(big.Int).Sub(balance, l1Cost) &#47;&#47; negative big int is fine</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas), and queue any invalids back for later
<span class="term-fg31">-		drops, invalids := list.Filter(pool.currentState.GetBalance(addr), pool.currentMaxGas)</span>
<span class="term-fg32">+		drops, invalids := list.Filter(balance, pool.currentMaxGas.Load())</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			log.Trace(&quot;Removed unpayable pending transaction&quot;, &quot;hash&quot;, hash)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5e26f8881497b1129bc961bd" role="button"
                   aria-expanded="false" aria-controls="id-5e26f8881497b1129bc961bd">
                    <code>core/txpool/txpool_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/txpool/txpool_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/txpool/txpool_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+16</span></div>
                        <div class="text-start"><span class="text-danger">-15</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5e26f8881497b1129bc961bd"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;txpool_test.go op-geth&#47;core&#47;txpool&#47;txpool_test.go</span>
<span class="term-fg1">index 7771c5f7cda1464489943454f72869924285ed6a..a4889fa62f59ca5cd10ac97abc8b37094ef96c93 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;txpool_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;txpool_test.go</span>
<span class="term-fg36">@@ -293,28 +293,29 @@</span>
 	tx := transaction(0, 100, key)
 	from, _ := deriveSender(tx)
&nbsp;
<span class="term-fg32">+	&#47;&#47; Intrinsic gas too low</span>
 	testAddBalance(pool, from, big.NewInt(1))
<span class="term-fg31">-	if err := pool.AddRemote(tx); !errors.Is(err, core.ErrInsufficientFunds) {</span>
<span class="term-fg31">-		t.Error(&quot;expected&quot;, core.ErrInsufficientFunds)</span>
<span class="term-fg32">+	if err, want := pool.AddRemote(tx), core.ErrIntrinsicGas; !errors.Is(err, want) {</span>
<span class="term-fg32">+		t.Errorf(&quot;want %v have %v&quot;, want, err)</span>
 	}
&nbsp;
<span class="term-fg31">-	balance := new(big.Int).Add(tx.Value(), new(big.Int).Mul(new(big.Int).SetUint64(tx.Gas()), tx.GasPrice()))</span>
<span class="term-fg31">-	testAddBalance(pool, from, balance)</span>
<span class="term-fg31">-	if err := pool.AddRemote(tx); !errors.Is(err, core.ErrIntrinsicGas) {</span>
<span class="term-fg31">-		t.Error(&quot;expected&quot;, core.ErrIntrinsicGas, &quot;got&quot;, err)</span>
<span class="term-fg32">+	&#47;&#47; Insufficient funds</span>
<span class="term-fg32">+	tx = transaction(0, 100000, key)</span>
<span class="term-fg32">+	if err, want := pool.AddRemote(tx), core.ErrInsufficientFunds; !errors.Is(err, want) {</span>
<span class="term-fg32">+		t.Errorf(&quot;want %v have %v&quot;, want, err)</span>
 	}
&nbsp;
 	testSetNonce(pool, from, 1)
 	testAddBalance(pool, from, big.NewInt(0xffffffffffffff))
 	tx = transaction(0, 100000, key)
<span class="term-fg31">-	if err := pool.AddRemote(tx); !errors.Is(err, core.ErrNonceTooLow) {</span>
<span class="term-fg31">-		t.Error(&quot;expected&quot;, core.ErrNonceTooLow)</span>
<span class="term-fg32">+	if err, want := pool.AddRemote(tx), core.ErrNonceTooLow; !errors.Is(err, want) {</span>
<span class="term-fg32">+		t.Errorf(&quot;want %v have %v&quot;, want, err)</span>
 	}
&nbsp;
 	tx = transaction(1, 100000, key)
 	pool.gasPrice = big.NewInt(1000)
<span class="term-fg31">-	if err := pool.AddRemote(tx); err != ErrUnderpriced {</span>
<span class="term-fg31">-		t.Error(&quot;expected&quot;, ErrUnderpriced, &quot;got&quot;, err)</span>
<span class="term-fg32">+	if err, want := pool.AddRemote(tx), ErrUnderpriced; !errors.Is(err, want) {</span>
<span class="term-fg32">+		t.Errorf(&quot;want %v have %v&quot;, want, err)</span>
 	}
 	if err := pool.AddLocal(tx); err != nil {
 		t.Error(&quot;expected&quot;, nil, &quot;got&quot;, err)
<span class="term-fg36">@@ -1217,22 +1218,22 @@</span> 	&#47;&#47;   - signature == 65 bytes
 	&#47;&#47; All those fields are summed up to at most 213 bytes.
 	baseSize := uint64(213)
 	dataSize := txMaxSize - baseSize
<span class="term-fg31">-</span>
<span class="term-fg32">+	maxGas := pool.currentMaxGas.Load()</span>
 	&#47;&#47; Try adding a transaction with maximal allowed size
<span class="term-fg31">-	tx := pricedDataTransaction(0, pool.currentMaxGas, big.NewInt(1), key, dataSize)</span>
<span class="term-fg32">+	tx := pricedDataTransaction(0, maxGas, big.NewInt(1), key, dataSize)</span>
 	if err := pool.addRemoteSync(tx); err != nil {
 		t.Fatalf(&quot;failed to add transaction of size %d, close to maximal: %v&quot;, int(tx.Size()), err)
 	}
 	&#47;&#47; Try adding a transaction with random allowed size
<span class="term-fg31">-	if err := pool.addRemoteSync(pricedDataTransaction(1, pool.currentMaxGas, big.NewInt(1), key, uint64(rand.Intn(int(dataSize))))); err != nil {</span>
<span class="term-fg32">+	if err := pool.addRemoteSync(pricedDataTransaction(1, maxGas, big.NewInt(1), key, uint64(rand.Intn(int(dataSize))))); err != nil {</span>
 		t.Fatalf(&quot;failed to add transaction of random allowed size: %v&quot;, err)
 	}
 	&#47;&#47; Try adding a transaction of minimal not allowed size
<span class="term-fg31">-	if err := pool.addRemoteSync(pricedDataTransaction(2, pool.currentMaxGas, big.NewInt(1), key, txMaxSize)); err == nil {</span>
<span class="term-fg32">+	if err := pool.addRemoteSync(pricedDataTransaction(2, maxGas, big.NewInt(1), key, txMaxSize)); err == nil {</span>
 		t.Fatalf(&quot;expected rejection on slightly oversize transaction&quot;)
 	}
 	&#47;&#47; Try adding a transaction of random not allowed size
<span class="term-fg31">-	if err := pool.addRemoteSync(pricedDataTransaction(2, pool.currentMaxGas, big.NewInt(1), key, dataSize+1+uint64(rand.Intn(10*txMaxSize)))); err == nil {</span>
<span class="term-fg32">+	if err := pool.addRemoteSync(pricedDataTransaction(2, maxGas, big.NewInt(1), key, dataSize+1+uint64(rand.Intn(10*txMaxSize)))); err == nil {</span>
 		t.Fatalf(&quot;expected rejection on oversize transaction&quot;)
 	}
 	&#47;&#47; Run some sanity checks on the pool internals</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-60f7c1e3ec13a0cbf980f8c4" role="button"
                   aria-expanded="false" aria-controls="id-60f7c1e3ec13a0cbf980f8c4">
                    <code>core/txpool/list.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/txpool/list.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/txpool/list.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-60f7c1e3ec13a0cbf980f8c4"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;txpool&#47;list.go op-geth&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg1">index 639d69bcbed42c882de9dac45f8256a70bc934be..c8d9835335451132cfd723b894ab9ca8b8f1c050 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;txpool&#47;list.go</span>
<span class="term-fg36">@@ -246,6 +246,15 @@</span> 	cache := m.flatten()
 	return cache[len(cache)-1]
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; FirstElement returns the first element from the heap (guaranteed to be lowest), thus, the</span>
<span class="term-fg32">+&#47;&#47; transaction with the lowest nonce. Returns nil if there are no elements.</span>
<span class="term-fg32">+func (m *sortedMap) FirstElement() *types.Transaction {</span>
<span class="term-fg32">+	if m.Len() == 0 {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return m.Get((*m.index)[0])</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; list is a &quot;list&quot; of transactions belonging to an account, sorted by account
 &#47;&#47; nonce. The same type can be used both for storing contiguous transactions for
 &#47;&#47; the executable&#47;pending queue; and for storing gapped transactions for the non-
<span class="term-fg36">@@ -270,10 +279,10 @@</span> 		totalcost: new(big.Int),
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Overlaps returns whether the transaction specified has the same nonce as one</span>
<span class="term-fg31">-&#47;&#47; already contained within the list.</span>
<span class="term-fg31">-func (l *list) Overlaps(tx *types.Transaction) bool {</span>
<span class="term-fg31">-	return l.txs.Get(tx.Nonce()) != nil</span>
<span class="term-fg32">+&#47;&#47; Contains returns whether the  list contains a transaction</span>
<span class="term-fg32">+&#47;&#47; with the provided nonce.</span>
<span class="term-fg32">+func (l *list) Contains(nonce uint64) bool {</span>
<span class="term-fg32">+	return l.txs.Get(nonce) != nil</span>
 }
&nbsp;
 &#47;&#47; Add tries to insert a new transaction into the list, returning whether the</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-fc64e45e03589dc8f85904fa"role="button" aria-expanded="false" aria-controls="id-fc64e45e03589dc8f85904fa">
        
            <div class="col-12 col-sm-9 text-start"><h2>Node modifications</h2></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+145</span></div>
                <div class="text-start"><span class="text-danger">-17</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-fc64e45e03589dc8f85904fa">
        <div><p>Changes to the node configuration and services.</p>
</div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-c987b8fa02ac84bdee943d49"role="button" aria-expanded="false" aria-controls="id-c987b8fa02ac84bdee943d49">
        
            <div class="col-12 col-sm-9 text-start"><h3>CLI</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+114</span></div>
                <div class="text-start"><span class="text-danger">-16</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-c987b8fa02ac84bdee943d49">
        <div></div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-63164039b48bb9bb1e26b181"role="button" aria-expanded="false" aria-controls="id-63164039b48bb9bb1e26b181">
        
            <div class="col-12 col-sm-9 text-start"><h4>Flags</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+83</span></div>
                <div class="text-start"><span class="text-danger">-5</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-63164039b48bb9bb1e26b181">
        <div><p>Flag changes:
  - Transactions can be forwarded to an RPC for sequencing.
  - Historical calls can be forwarded to a legacy node.
  - The tx pool propagation can be enabled/disabled.
  - The Optimism bedrock fork activation can be changed for testing.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f1a7ca5918a12042a6dd4c55" role="button"
                   aria-expanded="false" aria-controls="id-f1a7ca5918a12042a6dd4c55">
                    <code>cmd/utils/flags.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/utils/flags.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/utils/flags.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+56</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f1a7ca5918a12042a6dd4c55"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;utils&#47;flags.go op-geth&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">index 08de71ee831bfb9e29441c76226842e748108702..7b17390d97dff41d3cfe9b57bd0bc8e24b75bcf1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg36">@@ -34,6 +34,10 @@</span> 	&quot;strconv&quot;
 	&quot;strings&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	pcsclite &quot;github.com&#47;gballet&#47;go-libpcsclite&quot;</span>
<span class="term-fg32">+	gopsutil &quot;github.com&#47;shirou&#47;gopsutil&#47;mem&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;keystore&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -74,9 +78,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;p2p&#47;netutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg31">-	pcsclite &quot;github.com&#47;gballet&#47;go-libpcsclite&quot;</span>
<span class="term-fg31">-	gopsutil &quot;github.com&#47;shirou&#47;gopsutil&#47;mem&quot;</span>
<span class="term-fg31">-	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
 )
&nbsp;
 &#47;&#47; These are all the command line flags we support.
<span class="term-fg36">@@ -271,6 +272,21 @@</span> 	}
 	OverrideShanghai = &amp;cli.Uint64Flag{
 		Name:     &quot;override.shanghai&quot;,
 		Usage:    &quot;Manually specify the Shanghai fork timestamp, overriding the bundled setting&quot;,
<span class="term-fg32">+		Category: flags.EthCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	OverrideOptimismBedrock = &amp;flags.BigFlag{</span>
<span class="term-fg32">+		Name:     &quot;override.bedrock&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Manually specify OptimsimBedrock, overriding the bundled setting&quot;,</span>
<span class="term-fg32">+		Category: flags.EthCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	OverrideOptimismRegolith = &amp;flags.BigFlag{</span>
<span class="term-fg32">+		Name:     &quot;override.regolith&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Manually specify the OptimsimRegolith fork timestamp, overriding the bundled setting&quot;,</span>
<span class="term-fg32">+		Category: flags.EthCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	OverrideOptimism = &amp;cli.BoolFlag{</span>
<span class="term-fg32">+		Name:     &quot;override.optimism&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Manually specify optimism&quot;,</span>
 		Category: flags.EthCategory,
 	}
 	&#47;&#47; Light server and client settings
<span class="term-fg36">@@ -898,6 +914,32 @@</span> 		Name:     &quot;gpo.ignoreprice&quot;,
 		Usage:    &quot;Gas price below which gpo will ignore transactions&quot;,
 		Value:    ethconfig.Defaults.GPO.IgnorePrice.Int64(),
 		Category: flags.GasPriceCategory,
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Rollup Flags</span>
<span class="term-fg32">+	RollupSequencerHTTPFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.sequencerhttp&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;HTTP endpoint for the sequencer mempool&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupHistoricalRPCFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.historicalrpc&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;RPC endpoint for historical data.&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupHistoricalRPCTimeoutFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.historicalrpctimeout&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Timeout for historical RPC requests.&quot;,</span>
<span class="term-fg32">+		Value:    &quot;5s&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupDisableTxPoolGossipFlag = &amp;cli.BoolFlag{</span>
<span class="term-fg32">+		Name:     &quot;rollup.disabletxpoolgossip&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Disable transaction pool gossip.&quot;,</span>
<span class="term-fg32">+		Category: flags.RollupCategory,</span>
 	}
&nbsp;
 	&#47;&#47; Metrics flags
<span class="term-fg36">@@ -1857,7 +1899,17 @@</span> 		} else {
 			cfg.EthDiscoveryURLs = SplitAndTrim(urls)
 		}
 	}
<span class="term-fg31">-</span>
<span class="term-fg32">+	&#47;&#47; Only configure sequencer http flag if we&#39;re running in verifier mode i.e. --mine is disabled.</span>
<span class="term-fg32">+	if ctx.IsSet(RollupSequencerHTTPFlag.Name) &amp;&amp; !ctx.IsSet(MiningEnabledFlag.Name) {</span>
<span class="term-fg32">+		cfg.RollupSequencerHTTP = ctx.String(RollupSequencerHTTPFlag.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ctx.IsSet(RollupHistoricalRPCFlag.Name) {</span>
<span class="term-fg32">+		cfg.RollupHistoricalRPC = ctx.String(RollupHistoricalRPCFlag.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ctx.IsSet(RollupHistoricalRPCTimeoutFlag.Name) {</span>
<span class="term-fg32">+		cfg.RollupHistoricalRPCTimeout = ctx.Duration(RollupHistoricalRPCTimeoutFlag.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	cfg.RollupDisableTxPoolGossip = ctx.Bool(RollupDisableTxPoolGossipFlag.Name)</span>
 	&#47;&#47; Override any default configs for hard coded networks.
 	switch {
 	case ctx.Bool(MainnetFlag.Name):</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7052a81b559b0a0307c75c1d" role="button"
                   aria-expanded="false" aria-controls="id-7052a81b559b0a0307c75c1d">
                    <code>cmd/geth/main.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/geth/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/geth/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7052a81b559b0a0307c75c1d"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;main.go op-geth&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">index a970e76523426210919e122b5881a18d9a688412..6365ed28ab6371119c49355ad4bdefe7bf64ec06 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg36">@@ -66,6 +66,9 @@</span> 		utils.USBFlag,
 		utils.SmartCardDaemonPathFlag,
 		utils.OverrideShanghai,
 		utils.EnablePersonal,
<span class="term-fg32">+		utils.OverrideOptimismBedrock,</span>
<span class="term-fg32">+		utils.OverrideOptimismRegolith,</span>
<span class="term-fg32">+		utils.OverrideOptimism,</span>
 		utils.EthashCacheDirFlag,
 		utils.EthashCachesInMemoryFlag,
 		utils.EthashCachesOnDiskFlag,
<span class="term-fg36">@@ -149,6 +152,10 @@</span> 		utils.GpoPercentileFlag,
 		utils.GpoMaxGasPriceFlag,
 		utils.GpoIgnoreGasPriceFlag,
 		utils.MinerNotifyFullFlag,
<span class="term-fg32">+		utils.RollupSequencerHTTPFlag,</span>
<span class="term-fg32">+		utils.RollupHistoricalRPCFlag,</span>
<span class="term-fg32">+		utils.RollupHistoricalRPCTimeoutFlag,</span>
<span class="term-fg32">+		utils.RollupDisableTxPoolGossipFlag,</span>
 		configFileFlag,
 	}, utils.NetworkFlags, utils.DatabasePathFlags)
&nbsp;
<span class="term-fg36">@@ -464,7 +471,12 @@</span> 	&#47;&#47; Print warning log to user and skip unlocking.
 	if !stack.Config().InsecureUnlockAllowed &amp;&amp; stack.Config().ExtRPCEnabled() {
 		utils.Fatalf(&quot;Account unlock with HTTP access is forbidden!&quot;)
 	}
<span class="term-fg31">-	ks := stack.AccountManager().Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	backends := stack.AccountManager().Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(backends) == 0 {</span>
<span class="term-fg32">+		log.Warn(&quot;Failed to unlock accounts, keystore is not available&quot;)</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	ks := backends[0].(*keystore.KeyStore)</span>
 	passwords := utils.MakePasswordList(ctx)
 	for i, account := range unlocks {
 		unlockAccount(ks, account, i, passwords)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-64003b11a8b79340ac804212" role="button"
                   aria-expanded="false" aria-controls="id-64003b11a8b79340ac804212">
                    <code>internal/flags/categories.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/flags/categories.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/flags/categories.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-64003b11a8b79340ac804212"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;flags&#47;categories.go op-geth&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg1">index c2db6c6c1d25c115c77c8a829d481133a932faa7..f2b368775867174abef2e16d6c64d10b890ca9ff 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;flags&#47;categories.go</span>
<span class="term-fg36">@@ -31,6 +31,7 @@</span> 	NetworkingCategory = &quot;NETWORKING&quot;
 	MinerCategory      = &quot;MINER&quot;
 	GasPriceCategory   = &quot;GAS PRICE ORACLE&quot;
 	VMCategory         = &quot;VIRTUAL MACHINE&quot;
<span class="term-fg32">+	RollupCategory     = &quot;ROLLUP NODE&quot;</span>
 	LoggingCategory    = &quot;LOGGING AND DEBUGGING&quot;
 	MetricsCategory    = &quot;METRICS AND STATS&quot;
 	MiscCategory       = &quot;MISC&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-92fb07b643ae6401ad305661" role="button"
                   aria-expanded="false" aria-controls="id-92fb07b643ae6401ad305661">
                    <code>cmd/geth/config.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/geth/config.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/geth/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-92fb07b643ae6401ad305661"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;config.go op-geth&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg1">index 0b856d1c1b7a9c25a29c0b467a3f88487ef09ebb..10a519c2cbcd859a59abde028660a5b8e7df37a2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg36">@@ -162,6 +162,19 @@</span> 	if ctx.IsSet(utils.OverrideShanghai.Name) {
 		v := ctx.Uint64(utils.OverrideShanghai.Name)
 		cfg.Eth.OverrideShanghai = &amp;v
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	if ctx.IsSet(utils.OverrideOptimismBedrock.Name) {</span>
<span class="term-fg32">+		cfg.Eth.OverrideOptimismBedrock = flags.GlobalBig(ctx, utils.OverrideOptimismBedrock.Name)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ctx.IsSet(utils.OverrideOptimismRegolith.Name) {</span>
<span class="term-fg32">+		v := ctx.Uint64(utils.OverrideOptimismRegolith.Name)</span>
<span class="term-fg32">+		cfg.Eth.OverrideOptimismRegolith = &amp;v</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if ctx.IsSet(utils.OverrideOptimism.Name) {</span>
<span class="term-fg32">+		override := ctx.Bool(utils.OverrideOptimism.Name)</span>
<span class="term-fg32">+		cfg.Eth.OverrideOptimism = &amp;override</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	backend, eth := utils.RegisterEthService(stack, &amp;cfg.Eth)
&nbsp;
 	&#47;&#47; Configure log filter RPC API.</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-53ebf5bfad98f33a046851c4"role="button" aria-expanded="false" aria-controls="id-53ebf5bfad98f33a046851c4">
        
            <div class="col-12 col-sm-9 text-start"><h4>Versioning</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+31</span></div>
                <div class="text-start"><span class="text-danger">-11</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-53ebf5bfad98f33a046851c4">
        <div><p>List the op-geth and upstream go-ethereum versions.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-deafc9c7967a33fcf9364f4f" role="button"
                   aria-expanded="false" aria-controls="id-deafc9c7967a33fcf9364f4f">
                    <code>cmd/geth/misccmd.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/geth/misccmd.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/geth/misccmd.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-deafc9c7967a33fcf9364f4f"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;misccmd.go op-geth&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg1">index d8a523c6322168c5c532e81a05b8fb5a4933d642..5ca1732e07ade07abae15ce53e042f97e1be8634 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;misccmd.go</span>
<span class="term-fg36">@@ -137,6 +137,7 @@</span> 	}
 	if git.Date != &quot;&quot; {
 		fmt.Println(&quot;Git Commit Date:&quot;, git.Date)
 	}
<span class="term-fg32">+	fmt.Println(&quot;Upstream Version:&quot;, params.GethVersionWithMeta)</span>
 	fmt.Println(&quot;Architecture:&quot;, runtime.GOARCH)
 	fmt.Println(&quot;Go Version:&quot;, runtime.Version())
 	fmt.Println(&quot;Operating System:&quot;, runtime.GOOS)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4786b7c98d854589b12949ac" role="button"
                   aria-expanded="false" aria-controls="id-4786b7c98d854589b12949ac">
                    <code>params/version.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/params/version.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/params/version.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+28</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4786b7c98d854589b12949ac"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;version.go op-geth&#47;params&#47;version.go</span>
<span class="term-fg1">index 2ac4a554b1d5093af00f4739ff65cd8bb549a784..9916f885545c71110219a5d7d9356932dc7c70ac 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;version.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;version.go</span>
<span class="term-fg36">@@ -20,21 +20,44 @@</span> import (
 	&quot;fmt&quot;
 )
&nbsp;
<span class="term-fg32">+&#47;&#47; Version is the version of upstream geth</span>
 const (
 	VersionMajor = 1        &#47;&#47; Major version component of the current release
 	VersionMinor = 11       &#47;&#47; Minor version component of the current release
<span class="term-fg31">-	VersionPatch = 5        &#47;&#47; Patch version component of the current release</span>
<span class="term-fg32">+	VersionPatch = 6        &#47;&#47; Patch version component of the current release</span>
 	VersionMeta  = &quot;stable&quot; &#47;&#47; Version metadata to append to the version string
 )
&nbsp;
<span class="term-fg32">+&#47;&#47; OPVersion is the version of op-geth</span>
<span class="term-fg32">+const (</span>
<span class="term-fg32">+	OPVersionMajor = 0          &#47;&#47; Major version component of the current release</span>
<span class="term-fg32">+	OPVersionMinor = 1          &#47;&#47; Minor version component of the current release</span>
<span class="term-fg32">+	OPVersionPatch = 0          &#47;&#47; Patch version component of the current release</span>
<span class="term-fg32">+	OPVersionMeta  = &quot;unstable&quot; &#47;&#47; Version metadata to append to the version string</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
 &#47;&#47; Version holds the textual version string.
 var Version = func() string {
<span class="term-fg31">-	return fmt.Sprintf(&quot;%d.%d.%d&quot;, VersionMajor, VersionMinor, VersionPatch)</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;%d.%d.%d&quot;, OPVersionMajor, OPVersionMinor, OPVersionPatch)</span>
 }()
&nbsp;
 &#47;&#47; VersionWithMeta holds the textual version string including the metadata.
 var VersionWithMeta = func() string {
 	v := Version
<span class="term-fg32">+	if OPVersionMeta != &quot;&quot; {</span>
<span class="term-fg32">+		v += &quot;-&quot; + OPVersionMeta</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return v</span>
<span class="term-fg32">+}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GethVersion holds the textual geth version string.</span>
<span class="term-fg32">+var GethVersion = func() string {</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;%d.%d.%d&quot;, VersionMajor, VersionMinor, VersionPatch)</span>
<span class="term-fg32">+}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GethVersionWithMeta holds the textual geth version string including the metadata.</span>
<span class="term-fg32">+var GethVersionWithMeta = func() string {</span>
<span class="term-fg32">+	v := GethVersion</span>
 	if VersionMeta != &quot;&quot; {
 		v += &quot;-&quot; + VersionMeta
 	}
<span class="term-fg36">@@ -46,8 +69,8 @@</span> &#47;&#47; &quot;1.8.11-dea1ce05&quot; for stable releases, or &quot;1.8.13-unstable-21c059b6&quot; for unstable
 &#47;&#47; releases.
 func ArchiveVersion(gitCommit string) string {
 	vsn := Version
<span class="term-fg31">-	if VersionMeta != &quot;stable&quot; {</span>
<span class="term-fg31">-		vsn += &quot;-&quot; + VersionMeta</span>
<span class="term-fg32">+	if OPVersionMeta != &quot;stable&quot; {</span>
<span class="term-fg32">+		vsn += &quot;-&quot; + OPVersionMeta</span>
 	}
 	if len(gitCommit) &gt;= 8 {
 		vsn += &quot;-&quot; + gitCommit[:8]
<span class="term-fg36">@@ -60,7 +83,7 @@</span> 	vsn := VersionWithMeta
 	if len(gitCommit) &gt;= 8 {
 		vsn += &quot;-&quot; + gitCommit[:8]
 	}
<span class="term-fg31">-	if (VersionMeta != &quot;stable&quot;) &amp;&amp; (gitDate != &quot;&quot;) {</span>
<span class="term-fg32">+	if (OPVersionMeta != &quot;stable&quot;) &amp;&amp; (gitDate != &quot;&quot;) {</span>
 		vsn += &quot;-&quot; + gitDate
 	}
 	return vsn</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c51d29c886773995d26f654e" role="button"
                   aria-expanded="false" aria-controls="id-c51d29c886773995d26f654e">
                    <code>build/ci.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/build/ci.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/build/ci.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c51d29c886773995d26f654e"><span class="term-fg1">diff --git go-ethereum&#47;build&#47;ci.go op-geth&#47;build&#47;ci.go</span>
<span class="term-fg1">index 49926621bda6c56ee630f643ebaa22107ac1faf2..89895048c0b8f6985564910ea5aa2ca8fd3da308 100644</span>
<span class="term-fg1">--- go-ethereum&#47;build&#47;ci.go</span>
<span class="term-fg1">+++ op-geth&#47;build&#47;ci.go</span>
<span class="term-fg36">@@ -139,7 +139,7 @@</span>
 	&#47;&#47; This is the version of Go that will be downloaded by
 	&#47;&#47;
 	&#47;&#47;     go run ci.go install -dlgo
<span class="term-fg31">-	dlgoVersion = &quot;1.20.2&quot;</span>
<span class="term-fg32">+	dlgoVersion = &quot;1.20.3&quot;</span>
&nbsp;
 	&#47;&#47; This is the version of Go that will be used to bootstrap the PPA builder.
 	&#47;&#47;
<span class="term-fg36">@@ -465,10 +465,6 @@</span> 	if env.IsPullRequest {
 		log.Printf(&quot;skipping archive creation because this is a PR build&quot;)
 		os.Exit(0)
 	}
<span class="term-fg31">-	if env.IsCronJob {</span>
<span class="term-fg31">-		log.Printf(&quot;skipping archive creation because this is a cron job&quot;)</span>
<span class="term-fg31">-		os.Exit(0)</span>
<span class="term-fg31">-	}</span>
 	if env.Branch != &quot;master&quot; &amp;&amp; !strings.HasPrefix(env.Tag, &quot;v1.&quot;) {
 		log.Printf(&quot;skipping archive creation because branch %q, tag %q is not on the inclusion list&quot;, env.Branch, env.Tag)
 		os.Exit(0)
<span class="term-fg36">@@ -512,7 +508,7 @@</span> 	switch {
 	case env.Branch == &quot;master&quot;:
 		tags = []string{&quot;latest&quot;}
 	case strings.HasPrefix(env.Tag, &quot;v1.&quot;):
<span class="term-fg31">-		tags = []string{&quot;stable&quot;, fmt.Sprintf(&quot;release-1.%d&quot;, params.VersionMinor), &quot;v&quot; + params.Version}</span>
<span class="term-fg32">+		tags = []string{&quot;stable&quot;, fmt.Sprintf(&quot;release-1.%d&quot;, params.OPVersionMinor), &quot;v&quot; + params.Version}</span>
 	}
 	&#47;&#47; If architecture specific image builds are requested, build and push them
 	if *image {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-5b77ac44373f2abb2fe8542e"role="button" aria-expanded="false" aria-controls="id-5b77ac44373f2abb2fe8542e">
        
            <div class="col-12 col-sm-9 text-start"><h3>Node config</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+10</span></div>
                <div class="text-start"><span class="text-danger">-0</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-5b77ac44373f2abb2fe8542e">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-365ee550aadf50cd5bf7ba1f" role="button"
                   aria-expanded="false" aria-controls="id-365ee550aadf50cd5bf7ba1f">
                    <code>eth/ethconfig/config.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/ethconfig/config.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/ethconfig/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-365ee550aadf50cd5bf7ba1f"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;ethconfig&#47;config.go op-geth&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">index db686c5d0875f43f099e401865558f7ccf2b9224..272433cd278c2e58b7064ec141bba9611cc2c6cd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span> &#47;&#47; Package ethconfig contains the configuration of the ETH and LES protocols.
 package ethconfig
&nbsp;
 import (
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
 	&quot;os&quot;
 	&quot;os&#47;user&quot;
 	&quot;path&#47;filepath&quot;
<span class="term-fg36">@@ -207,6 +208,15 @@</span> 	CheckpointOracle *params.CheckpointOracleConfig `toml:&quot;,omitempty&quot;`
&nbsp;
 	&#47;&#47; OverrideShanghai (TODO: remove after the fork)
 	OverrideShanghai *uint64 `toml:&quot;,omitempty&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	OverrideOptimismBedrock  *big.Int</span>
<span class="term-fg32">+	OverrideOptimismRegolith *uint64 `toml:&quot;,omitempty&quot;`</span>
<span class="term-fg32">+	OverrideOptimism         *bool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	RollupSequencerHTTP        string</span>
<span class="term-fg32">+	RollupHistoricalRPC        string</span>
<span class="term-fg32">+	RollupHistoricalRPCTimeout time.Duration</span>
<span class="term-fg32">+	RollupDisableTxPoolGossip  bool</span>
 }
&nbsp;
 &#47;&#47; CreateConsensusEngine creates a consensus engine for the given chain configuration.</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-42948605b234258f8f5eeaf3"role="button" aria-expanded="false" aria-controls="id-42948605b234258f8f5eeaf3">
        
            <div class="col-12 col-sm-9 text-start"><h3>Tx gossip disable option</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+21</span></div>
                <div class="text-start"><span class="text-danger">-1</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-42948605b234258f8f5eeaf3">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-649aace855acefbef2fc9eba" role="button"
                   aria-expanded="false" aria-controls="id-649aace855acefbef2fc9eba">
                    <code>eth/handler.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/handler.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/handler.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-649aace855acefbef2fc9eba"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;handler.go op-geth&#47;eth&#47;handler.go</span>
<span class="term-fg1">index 83df6ff2eb60238fae8221d89b287fa352c5ecbb..b39f5d0fd82756695f71b2f1db4e9d5dd1433b24 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;handler.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;handler.go</span>
<span class="term-fg36">@@ -87,6 +87,7 @@</span> 	BloomCache     uint64                    &#47;&#47; Megabytes to alloc for snap sync bloom
 	EventMux       *event.TypeMux            &#47;&#47; Legacy event mux, deprecate for `feed`
 	Checkpoint     *params.TrustedCheckpoint &#47;&#47; Hard coded checkpoint for sync challenges
 	RequiredBlocks map[uint64]common.Hash    &#47;&#47; Hard coded map of required block hashes for sync challenges
<span class="term-fg32">+	NoTxGossip     bool                      &#47;&#47; Disable P2P transaction gossip</span>
 }
&nbsp;
 type handler struct {
<span class="term-fg36">@@ -103,6 +104,8 @@</span> 	database ethdb.Database
 	txpool   txPool
 	chain    *core.BlockChain
 	maxPeers int
<span class="term-fg32">+</span>
<span class="term-fg32">+	noTxGossip bool</span>
&nbsp;
 	downloader   *downloader.Downloader
 	blockFetcher *fetcher.BlockFetcher
<span class="term-fg36">@@ -137,6 +140,7 @@</span> 		forkFilter:     forkid.NewFilter(config.Chain),
 		eventMux:       config.EventMux,
 		database:       config.Database,
 		txpool:         config.TxPool,
<span class="term-fg32">+		noTxGossip:     config.NoTxGossip,</span>
 		chain:          config.Chain,
 		peers:          newPeerSet(),
 		merger:         config.Merger,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-50e64f8a46378c05f41f08c6" role="button"
                   aria-expanded="false" aria-controls="id-50e64f8a46378c05f41f08c6">
                    <code>eth/handler_eth.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/handler_eth.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/handler_eth.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+17</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-50e64f8a46378c05f41f08c6"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;handler_eth.go op-geth&#47;eth&#47;handler_eth.go</span>
<span class="term-fg1">index 4ed6335769cf9c32017c19c3037df91e7fabed48..6f573cc3e9a98861531f976b59a8ab67d5d33e51 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;handler_eth.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;handler_eth.go</span>
<span class="term-fg36">@@ -34,7 +34,20 @@</span> &#47;&#47; packets that are sent as replies or broadcasts.
 type ethHandler handler
&nbsp;
 func (h *ethHandler) Chain() *core.BlockChain { return h.chain }
<span class="term-fg31">-func (h *ethHandler) TxPool() eth.TxPool      { return h.txpool }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NilPool satisfies the TxPool interface but does not return any tx in the</span>
<span class="term-fg32">+&#47;&#47; pool. It is used to disable transaction gossip.</span>
<span class="term-fg32">+type NilPool struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NilPool Get always returns nil</span>
<span class="term-fg32">+func (n NilPool) Get(hash common.Hash) *types.Transaction { return nil }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (h *ethHandler) TxPool() eth.TxPool {</span>
<span class="term-fg32">+	if h.noTxGossip {</span>
<span class="term-fg32">+		return &amp;NilPool{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return h.txpool</span>
<span class="term-fg32">+}</span>
&nbsp;
 &#47;&#47; RunPeer is invoked when a peer joins on the `eth` protocol.
 func (h *ethHandler) RunPeer(peer *eth.Peer, hand eth.Handler) error {
<span class="term-fg36">@@ -52,6 +65,9 @@</span>
 &#47;&#47; AcceptTxs retrieves whether transaction processing is enabled on the node
 &#47;&#47; or if inbound transactions should simply be dropped.
 func (h *ethHandler) AcceptTxs() bool {
<span class="term-fg32">+	if h.noTxGossip {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
 	return atomic.LoadUint32(&amp;h.acceptTxs) == 1
 }
</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-cce1153d028096fa4c9097fe"role="button" aria-expanded="false" aria-controls="id-cce1153d028096fa4c9097fe">
        
            <div class="col-12 col-sm-9 text-start"><h2>User API enhancements</h2></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+1002</span></div>
                <div class="text-start"><span class="text-danger">-77</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-cce1153d028096fa4c9097fe">
        <div><p>Encode the Deposit Tx properties, the L1 costs, and daisy-chain RPC-calls for pre-Bedrock historical data</p>
</div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a835b679614e59c643a9b53f"role="button" aria-expanded="false" aria-controls="id-a835b679614e59c643a9b53f">
        
            <div class="col-12 col-sm-9 text-start"><h3>Receipts metadata</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+222</span></div>
                <div class="text-start"><span class="text-danger">-6</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a835b679614e59c643a9b53f">
        <div><p>Pre-Bedrock L1-cost receipt data is loaded from the database if available, and post-Bedrock the L1-cost
metadata is hydrated on-the-fly based on the L1 fee information in the corresponding block.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-861b1bc4d6f56001e69f38ea" role="button"
                   aria-expanded="false" aria-controls="id-861b1bc4d6f56001e69f38ea">
                    <code>core/types/receipt.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/receipt.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/receipt.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+194</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-861b1bc4d6f56001e69f38ea"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;receipt.go op-geth&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">index 61b3b351780694beb99f6442f837f7e07d1184f2..874e10efb01a7a5307ea566094647e980208d871 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg36">@@ -58,17 +58,28 @@</span> 	CumulativeGasUsed uint64 `json:&quot;cumulativeGasUsed&quot; gencodec:&quot;required&quot;`
 	Bloom             Bloom  `json:&quot;logsBloom&quot;         gencodec:&quot;required&quot;`
 	Logs              []*Log `json:&quot;logs&quot;              gencodec:&quot;required&quot;`
&nbsp;
<span class="term-fg31">-	&#47;&#47; Implementation fields: These fields are added by geth when processing a transaction.</span>
<span class="term-fg32">+	&#47;&#47; Implementation fields: These fields are added by geth when processing a transaction or retrieving a receipt.</span>
<span class="term-fg32">+	&#47;&#47; gencodec annotated fields: these are stored in the chain database.</span>
 	TxHash            common.Hash    `json:&quot;transactionHash&quot; gencodec:&quot;required&quot;`
 	ContractAddress   common.Address `json:&quot;contractAddress&quot;`
 	GasUsed           uint64         `json:&quot;gasUsed&quot; gencodec:&quot;required&quot;`
 	EffectiveGasPrice *big.Int       `json:&quot;effectiveGasPrice&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; DepositNonce was introduced in Regolith to store the actual nonce used by deposit transactions</span>
<span class="term-fg32">+	&#47;&#47; The state transition process ensures this is only set for Regolith deposit transactions.</span>
<span class="term-fg32">+	DepositNonce *uint64 `json:&quot;depositNonce,omitempty&quot;`</span>
&nbsp;
 	&#47;&#47; Inclusion information: These fields provide information about the inclusion of the
 	&#47;&#47; transaction corresponding to this receipt.
 	BlockHash        common.Hash `json:&quot;blockHash,omitempty&quot;`
 	BlockNumber      *big.Int    `json:&quot;blockNumber,omitempty&quot;`
 	TransactionIndex uint        `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; OVM legacy: extend receipts with their L1 price (if a rollup tx)</span>
<span class="term-fg32">+	L1GasPrice *big.Int   `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+	L1GasUsed  *big.Int   `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+	L1Fee      *big.Int   `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+	FeeScalar  *big.Float `json:&quot;l1FeeScalar,omitempty&quot;`</span>
 }
&nbsp;
 type receiptMarshaling struct {
<span class="term-fg36">@@ -79,6 +90,12 @@</span> 	CumulativeGasUsed hexutil.Uint64
 	GasUsed           hexutil.Uint64
 	BlockNumber       *hexutil.Big
 	TransactionIndex  hexutil.Uint
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Optimism: extend receipts with their L1 price (if a rollup tx)</span>
<span class="term-fg32">+	L1GasPrice *hexutil.Big</span>
<span class="term-fg32">+	L1GasUsed  *hexutil.Big</span>
<span class="term-fg32">+	L1Fee      *hexutil.Big</span>
<span class="term-fg32">+	FeeScalar  *big.Float</span>
 }
&nbsp;
 &#47;&#47; receiptRLP is the consensus encoding of a receipt.
<span class="term-fg36">@@ -89,11 +106,90 @@</span> 	Bloom             Bloom
 	Logs              []*Log
 }
&nbsp;
<span class="term-fg32">+type depositReceiptRlp struct {</span>
<span class="term-fg32">+	PostStateOrStatus []byte</span>
<span class="term-fg32">+	CumulativeGasUsed uint64</span>
<span class="term-fg32">+	Bloom             Bloom</span>
<span class="term-fg32">+	Logs              []*Log</span>
<span class="term-fg32">+	&#47;&#47; DepositNonce was introduced in Regolith to store the actual nonce used by deposit transactions.</span>
<span class="term-fg32">+	&#47;&#47; Must be nil for any transactions prior to Regolith or that aren&#39;t deposit transactions.</span>
<span class="term-fg32">+	DepositNonce *uint64 `rlp:&quot;optional&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; storedReceiptRLP is the storage encoding of a receipt.
 type storedReceiptRLP struct {
 	PostStateOrStatus []byte
 	CumulativeGasUsed uint64
 	Logs              []*Log
<span class="term-fg32">+	&#47;&#47; DepositNonce was introduced in Regolith to store the actual nonce used by deposit transactions.</span>
<span class="term-fg32">+	&#47;&#47; Must be nil for any transactions prior to Regolith or that aren&#39;t deposit transactions.</span>
<span class="term-fg32">+	DepositNonce *uint64 `rlp:&quot;optional&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; LegacyOptimismStoredReceiptRLP is the pre bedrock storage encoding of a</span>
<span class="term-fg32">+&#47;&#47; receipt. It will only exist in the database if it was migrated using the</span>
<span class="term-fg32">+&#47;&#47; migration tool. Nodes that sync using snap-sync will not have any of these</span>
<span class="term-fg32">+&#47;&#47; entries.</span>
<span class="term-fg32">+type LegacyOptimismStoredReceiptRLP struct {</span>
<span class="term-fg32">+	PostStateOrStatus []byte</span>
<span class="term-fg32">+	CumulativeGasUsed uint64</span>
<span class="term-fg32">+	Logs              []*LogForStorage</span>
<span class="term-fg32">+	L1GasUsed         *big.Int</span>
<span class="term-fg32">+	L1GasPrice        *big.Int</span>
<span class="term-fg32">+	L1Fee             *big.Int</span>
<span class="term-fg32">+	FeeScalar         string</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; LogForStorage is a wrapper around a Log that handles</span>
<span class="term-fg32">+&#47;&#47; backward compatibility with prior storage formats.</span>
<span class="term-fg32">+type LogForStorage Log</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; EncodeRLP implements rlp.Encoder.</span>
<span class="term-fg32">+func (l *LogForStorage) EncodeRLP(w io.Writer) error {</span>
<span class="term-fg32">+	rl := rlpLog{Address: l.Address, Topics: l.Topics, Data: l.Data}</span>
<span class="term-fg32">+	return rlp.Encode(w, &amp;rl)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type legacyRlpStorageLog struct {</span>
<span class="term-fg32">+	Address     common.Address</span>
<span class="term-fg32">+	Topics      []common.Hash</span>
<span class="term-fg32">+	Data        []byte</span>
<span class="term-fg32">+	BlockNumber uint64</span>
<span class="term-fg32">+	TxHash      common.Hash</span>
<span class="term-fg32">+	TxIndex     uint</span>
<span class="term-fg32">+	BlockHash   common.Hash</span>
<span class="term-fg32">+	Index       uint</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DecodeRLP implements rlp.Decoder.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Note some redundant fields(e.g. block number, tx hash etc) will be assembled later.</span>
<span class="term-fg32">+func (l *LogForStorage) DecodeRLP(s *rlp.Stream) error {</span>
<span class="term-fg32">+	blob, err := s.Raw()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var dec rlpLog</span>
<span class="term-fg32">+	err = rlp.DecodeBytes(blob, &amp;dec)</span>
<span class="term-fg32">+	if err == nil {</span>
<span class="term-fg32">+		*l = LogForStorage{</span>
<span class="term-fg32">+			Address: dec.Address,</span>
<span class="term-fg32">+			Topics:  dec.Topics,</span>
<span class="term-fg32">+			Data:    dec.Data,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		&#47;&#47; Try to decode log with previous definition.</span>
<span class="term-fg32">+		var dec legacyRlpStorageLog</span>
<span class="term-fg32">+		err = rlp.DecodeBytes(blob, &amp;dec)</span>
<span class="term-fg32">+		if err == nil {</span>
<span class="term-fg32">+			*l = LogForStorage{</span>
<span class="term-fg32">+				Address: dec.Address,</span>
<span class="term-fg32">+				Topics:  dec.Topics,</span>
<span class="term-fg32">+				Data:    dec.Data,</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return err</span>
 }
&nbsp;
 &#47;&#47; NewReceipt creates a barebone transaction receipt, copying the init fields.
<span class="term-fg36">@@ -131,7 +227,13 @@</span>
 &#47;&#47; encodeTyped writes the canonical encoding of a typed receipt to w.
 func (r *Receipt) encodeTyped(data *receiptRLP, w *bytes.Buffer) error {
 	w.WriteByte(r.Type)
<span class="term-fg31">-	return rlp.Encode(w, data)</span>
<span class="term-fg32">+	switch r.Type {</span>
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		withNonce := depositReceiptRlp{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs, r.DepositNonce}</span>
<span class="term-fg32">+		return rlp.Encode(w, withNonce)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		return rlp.Encode(w, data)</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 &#47;&#47; MarshalBinary returns the consensus encoding of the receipt.
<span class="term-fg36">@@ -201,6 +303,15 @@</span> 			return err
 		}
 		r.Type = b[0]
 		return r.setFromRLP(data)
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		var data depositReceiptRlp</span>
<span class="term-fg32">+		err := rlp.DecodeBytes(b[1:], &amp;data)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		r.Type = b[0]</span>
<span class="term-fg32">+		r.DepositNonce = data.DepositNonce</span>
<span class="term-fg32">+		return r.setFromRLP(receiptRLP{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs})</span>
 	default:
 		return ErrTxTypeNotSupported
 	}
<span class="term-fg36">@@ -264,6 +375,9 @@</span> 			return err
 		}
 	}
 	w.ListEnd(logList)
<span class="term-fg32">+	if r.DepositNonce != nil {</span>
<span class="term-fg32">+		w.WriteUint64(*r.DepositNonce)</span>
<span class="term-fg32">+	}</span>
 	w.ListEnd(outerList)
 	return w.Flush()
 }
<span class="term-fg36">@@ -271,8 +385,51 @@</span>
 &#47;&#47; DecodeRLP implements rlp.Decoder, and loads both consensus and implementation
 &#47;&#47; fields of a receipt from an RLP stream.
 func (r *ReceiptForStorage) DecodeRLP(s *rlp.Stream) error {
<span class="term-fg32">+	&#47;&#47; Retrieve the entire receipt blob as we need to try multiple decoders</span>
<span class="term-fg32">+	blob, err := s.Raw()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; First try to decode the latest receipt database format, try the pre-bedrock Optimism legacy format otherwise.</span>
<span class="term-fg32">+	if err := decodeStoredReceiptRLP(r, blob); err == nil {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return decodeLegacyOptimismReceiptRLP(r, blob)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func decodeLegacyOptimismReceiptRLP(r *ReceiptForStorage, blob []byte) error {</span>
<span class="term-fg32">+	var stored LegacyOptimismStoredReceiptRLP</span>
<span class="term-fg32">+	if err := rlp.DecodeBytes(blob, &amp;stored); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err := (*Receipt)(r).setStatus(stored.PostStateOrStatus); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.CumulativeGasUsed = stored.CumulativeGasUsed</span>
<span class="term-fg32">+	r.Logs = make([]*Log, len(stored.Logs))</span>
<span class="term-fg32">+	for i, log := range stored.Logs {</span>
<span class="term-fg32">+		r.Logs[i] = (*Log)(log)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.Bloom = CreateBloom(Receipts{(*Receipt)(r)})</span>
<span class="term-fg32">+	&#47;&#47; UsingOVM</span>
<span class="term-fg32">+	scalar := new(big.Float)</span>
<span class="term-fg32">+	if stored.FeeScalar != &quot;&quot; {</span>
<span class="term-fg32">+		var ok bool</span>
<span class="term-fg32">+		scalar, ok = scalar.SetString(stored.FeeScalar)</span>
<span class="term-fg32">+		if !ok {</span>
<span class="term-fg32">+			return errors.New(&quot;cannot parse fee scalar&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.L1GasUsed = stored.L1GasUsed</span>
<span class="term-fg32">+	r.L1GasPrice = stored.L1GasPrice</span>
<span class="term-fg32">+	r.L1Fee = stored.L1Fee</span>
<span class="term-fg32">+	r.FeeScalar = scalar</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func decodeStoredReceiptRLP(r *ReceiptForStorage, blob []byte) error {</span>
 	var stored storedReceiptRLP
<span class="term-fg31">-	if err := s.Decode(&amp;stored); err != nil {</span>
<span class="term-fg32">+	if err := rlp.DecodeBytes(blob, &amp;stored); err != nil {</span>
 		return err
 	}
 	if err := (*Receipt)(r).setStatus(stored.PostStateOrStatus); err != nil {
<span class="term-fg36">@@ -281,7 +438,9 @@</span> 	}
 	r.CumulativeGasUsed = stored.CumulativeGasUsed
 	r.Logs = stored.Logs
 	r.Bloom = CreateBloom(Receipts{(*Receipt)(r)})
<span class="term-fg31">-</span>
<span class="term-fg32">+	if stored.DepositNonce != nil {</span>
<span class="term-fg32">+		r.DepositNonce = stored.DepositNonce</span>
<span class="term-fg32">+	}</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -304,6 +463,9 @@</span> 		rlp.Encode(w, data)
 	case DynamicFeeTxType:
 		w.WriteByte(DynamicFeeTxType)
 		rlp.Encode(w, data)
<span class="term-fg32">+	case DepositTxType:</span>
<span class="term-fg32">+		w.WriteByte(DepositTxType)</span>
<span class="term-fg32">+		rlp.Encode(w, data)</span>
 	default:
 		&#47;&#47; For unsupported types, write nothing. Since this is for
 		&#47;&#47; DeriveSha, the error will be caught matching the derived hash
<span class="term-fg36">@@ -313,7 +475,7 @@</span> }
&nbsp;
 &#47;&#47; DeriveFields fills the receipts with their computed fields based on consensus
 &#47;&#47; data and contextual infos like containing block and transactions.
<span class="term-fg31">-func (rs Receipts) DeriveFields(config *params.ChainConfig, hash common.Hash, number uint64, baseFee *big.Int, txs []*Transaction) error {</span>
<span class="term-fg32">+func (rs Receipts) DeriveFields(config *params.ChainConfig, hash common.Hash, number uint64, time uint64, baseFee *big.Int, txs Transactions) error {</span>
 	signer := MakeSigner(config, new(big.Int).SetUint64(number))
&nbsp;
 	logIndex := uint(0)
<span class="term-fg36">@@ -336,7 +498,11 @@</span> 		&#47;&#47; The contract address can be derived from the transaction itself
 		if txs[i].To() == nil {
 			&#47;&#47; Deriving the signer is expensive, only do if it&#39;s actually needed
 			from, _ := Sender(signer, txs[i])
<span class="term-fg31">-			rs[i].ContractAddress = crypto.CreateAddress(from, txs[i].Nonce())</span>
<span class="term-fg32">+			nonce := txs[i].Nonce()</span>
<span class="term-fg32">+			if rs[i].DepositNonce != nil {</span>
<span class="term-fg32">+				nonce = *rs[i].DepositNonce</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			rs[i].ContractAddress = crypto.CreateAddress(from, nonce)</span>
 		} else {
 			rs[i].ContractAddress = common.Address{}
 		}
<span class="term-fg36">@@ -358,5 +524,27 @@</span> 			rs[i].Logs[j].Index = logIndex
 			logIndex++
 		}
 	}
<span class="term-fg32">+	if config.Optimism != nil &amp;&amp; len(txs) &gt;= 2 { &#47;&#47; need at least an info tx and a non-info tx</span>
<span class="term-fg32">+		if data := txs[0].Data(); len(data) &gt;= 4+32*8 { &#47;&#47; function selector + 8 arguments to setL1BlockValues</span>
<span class="term-fg32">+			l1Basefee := new(big.Int).SetBytes(data[4+32*2 : 4+32*3]) &#47;&#47; arg index 2</span>
<span class="term-fg32">+			overhead := new(big.Int).SetBytes(data[4+32*6 : 4+32*7])  &#47;&#47; arg index 6</span>
<span class="term-fg32">+			scalar := new(big.Int).SetBytes(data[4+32*7 : 4+32*8])    &#47;&#47; arg index 7</span>
<span class="term-fg32">+			fscalar := new(big.Float).SetInt(scalar)                  &#47;&#47; legacy: format fee scalar as big Float</span>
<span class="term-fg32">+			fdivisor := new(big.Float).SetUint64(1_000_000)           &#47;&#47; 10**6, i.e. 6 decimals</span>
<span class="term-fg32">+			feeScalar := new(big.Float).Quo(fscalar, fdivisor)</span>
<span class="term-fg32">+			for i := 0; i &lt; len(rs); i++ {</span>
<span class="term-fg32">+				if !txs[i].IsDepositTx() {</span>
<span class="term-fg32">+					gas := txs[i].RollupDataGas().DataGas(time, config)</span>
<span class="term-fg32">+					rs[i].L1GasPrice = l1Basefee</span>
<span class="term-fg32">+					rs[i].L1GasUsed = new(big.Int).SetUint64(gas)</span>
<span class="term-fg32">+					rs[i].L1Fee = L1Cost(gas, l1Basefee, overhead, scalar)</span>
<span class="term-fg32">+					rs[i].FeeScalar = feeScalar</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;L1 info tx only has %d bytes, cannot read gas price parameters&quot;, len(data))</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return nil
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ceefbd4ccf7e9b014e5bb51" role="button"
                   aria-expanded="false" aria-controls="id-8ceefbd4ccf7e9b014e5bb51">
                    <code>core/types/gen_receipt_json.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/gen_receipt_json.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/gen_receipt_json.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+28</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ceefbd4ccf7e9b014e5bb51"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;gen_receipt_json.go op-geth&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg1">index 8d85dd5b9c1aa295cda6d232427fda9d7dc9ded2..9fd74009becf231aa3596aeb22f657abfb6a964a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;gen_receipt_json.go</span>
<span class="term-fg36">@@ -29,6 +29,10 @@</span> 		EffectiveGasPrice *hexutil.Big   `json:&quot;effectiveGasPrice,omitempty&quot;`
 		BlockHash         common.Hash    `json:&quot;blockHash,omitempty&quot;`
 		BlockNumber       *hexutil.Big   `json:&quot;blockNumber,omitempty&quot;`
 		TransactionIndex  hexutil.Uint   `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+		L1GasPrice        *hexutil.Big   `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+		L1GasUsed         *hexutil.Big   `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+		L1Fee             *hexutil.Big   `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+		FeeScalar         *big.Float     `json:&quot;l1FeeScalar,omitempty&quot;`</span>
 	}
 	var enc Receipt
 	enc.Type = hexutil.Uint64(r.Type)
<span class="term-fg36">@@ -44,6 +48,10 @@</span> 	enc.EffectiveGasPrice = (*hexutil.Big)(r.EffectiveGasPrice)
 	enc.BlockHash = r.BlockHash
 	enc.BlockNumber = (*hexutil.Big)(r.BlockNumber)
 	enc.TransactionIndex = hexutil.Uint(r.TransactionIndex)
<span class="term-fg32">+	enc.L1GasPrice = (*hexutil.Big)(r.L1GasPrice)</span>
<span class="term-fg32">+	enc.L1GasUsed = (*hexutil.Big)(r.L1GasUsed)</span>
<span class="term-fg32">+	enc.L1Fee = (*hexutil.Big)(r.L1Fee)</span>
<span class="term-fg32">+	enc.FeeScalar = r.FeeScalar</span>
 	return json.Marshal(&amp;enc)
 }
&nbsp;
<span class="term-fg36">@@ -63,6 +71,11 @@</span> 		EffectiveGasPrice *hexutil.Big    `json:&quot;effectiveGasPrice,omitempty&quot;`
 		BlockHash         *common.Hash    `json:&quot;blockHash,omitempty&quot;`
 		BlockNumber       *hexutil.Big    `json:&quot;blockNumber,omitempty&quot;`
 		TransactionIndex  *hexutil.Uint   `json:&quot;transactionIndex&quot;`
<span class="term-fg32">+		L1GasPrice        *hexutil.Big    `json:&quot;l1GasPrice,omitempty&quot;`</span>
<span class="term-fg32">+		L1GasUsed         *hexutil.Big    `json:&quot;l1GasUsed,omitempty&quot;`</span>
<span class="term-fg32">+		L1Fee             *hexutil.Big    `json:&quot;l1Fee,omitempty&quot;`</span>
<span class="term-fg32">+		FeeScalar         *big.Float      `json:&quot;l1FeeScalar,omitempty&quot;`</span>
<span class="term-fg32">+		DepositNonce      *hexutil.Uint64 `json:&quot;depositNonce,omitempty&quot;`</span>
 	}
 	var dec Receipt
 	if err := json.Unmarshal(input, &amp;dec); err != nil {
<span class="term-fg36">@@ -111,6 +124,21 @@</span> 		r.BlockNumber = (*big.Int)(dec.BlockNumber)
 	}
 	if dec.TransactionIndex != nil {
 		r.TransactionIndex = uint(*dec.TransactionIndex)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1GasPrice != nil {</span>
<span class="term-fg32">+		r.L1GasPrice = (*big.Int)(dec.L1GasPrice)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1GasUsed != nil {</span>
<span class="term-fg32">+		r.L1GasUsed = (*big.Int)(dec.L1GasUsed)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.L1Fee != nil {</span>
<span class="term-fg32">+		r.L1Fee = (*big.Int)(dec.L1Fee)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.FeeScalar != nil {</span>
<span class="term-fg32">+		r.FeeScalar = dec.FeeScalar</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if dec.DepositNonce != nil {</span>
<span class="term-fg32">+		r.DepositNonce = (*uint64)(dec.DepositNonce)</span>
 	}
 	return nil
 }</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-2fc1c7256b33e5e555531a4e"role="button" aria-expanded="false" aria-controls="id-2fc1c7256b33e5e555531a4e">
        
            <div class="col-12 col-sm-9 text-start"><h3>API Backend</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+92</span></div>
                <div class="text-start"><span class="text-danger">-9</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-2fc1c7256b33e5e555531a4e">
        <div><p>Forward transactions to the sequencer if configured.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-39844ed805b56b830c0be11b" role="button"
                   aria-expanded="false" aria-controls="id-39844ed805b56b830c0be11b">
                    <code>eth/api_backend.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/api_backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/api_backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+37</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-39844ed805b56b830c0be11b"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;api_backend.go op-geth&#47;eth&#47;api_backend.go</span>
<span class="term-fg1">index 643f6369df0e6ac51e9ce312dde4378934b288f2..4c6afa6e756157ecf618a70b70acf4ff302535cf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;api_backend.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;api_backend.go</span>
<span class="term-fg36">@@ -19,12 +19,14 @@</span>
 import (
 	&quot;context&quot;
 	&quot;errors&quot;
<span class="term-fg32">+	&quot;fmt&quot;</span>
 	&quot;math&#47;big&quot;
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;bloombits&quot;
<span class="term-fg36">@@ -37,6 +39,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;gasprice&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;miner&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg36">@@ -134,6 +137,9 @@</span> 		if !b.eth.Merger().TDDReached() {
 			return nil, errors.New(&quot;&#39;finalized&#39; tag not supported on pre-merge network&quot;)
 		}
 		header := b.eth.blockchain.CurrentFinalBlock()
<span class="term-fg32">+		if header == nil {</span>
<span class="term-fg32">+			return nil, nil</span>
<span class="term-fg32">+		}</span>
 		return b.eth.blockchain.GetBlock(header.Hash(), header.Number.Uint64()), nil
 	}
 	if number == rpc.SafeBlockNumber {
<span class="term-fg36">@@ -141,6 +147,9 @@</span> 		if !b.eth.Merger().TDDReached() {
 			return nil, errors.New(&quot;&#39;safe&#39; tag not supported on pre-merge network&quot;)
 		}
 		header := b.eth.blockchain.CurrentSafeBlock()
<span class="term-fg32">+		if header == nil {</span>
<span class="term-fg32">+			return nil, nil</span>
<span class="term-fg32">+		}</span>
 		return b.eth.blockchain.GetBlock(header.Hash(), header.Number.Uint64()), nil
 	}
 	return b.eth.blockchain.GetBlockByNumber(uint64(number)), nil
<span class="term-fg36">@@ -198,7 +207,7 @@</span> 	if err != nil {
 		return nil, nil, err
 	}
 	if header == nil {
<span class="term-fg31">-		return nil, nil, errors.New(&quot;header not found&quot;)</span>
<span class="term-fg32">+		return nil, nil, fmt.Errorf(&quot;header %w&quot;, ethereum.NotFound)</span>
 	}
 	stateDb, err := b.eth.BlockChain().StateAt(header.Root)
 	return stateDb, header, err
<span class="term-fg36">@@ -214,7 +223,7 @@</span> 		if err != nil {
 			return nil, nil, err
 		}
 		if header == nil {
<span class="term-fg31">-			return nil, nil, errors.New(&quot;header for hash not found&quot;)</span>
<span class="term-fg32">+			return nil, nil, fmt.Errorf(&quot;header for hash %w&quot;, ethereum.NotFound)</span>
 		}
 		if blockNrOrHash.RequireCanonical &amp;&amp; b.eth.blockchain.GetCanonicalHash(header.Number.Uint64()) != hash {
 			return nil, nil, errors.New(&quot;hash is not currently canonical&quot;)
<span class="term-fg36">@@ -245,7 +254,7 @@</span> 	if vmConfig == nil {
 		vmConfig = b.eth.blockchain.GetVMConfig()
 	}
 	txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-	context := core.NewEVMBlockContext(header, b.eth.BlockChain(), nil)</span>
<span class="term-fg32">+	context := core.NewEVMBlockContext(header, b.eth.BlockChain(), nil, b.eth.blockchain.Config(), state)</span>
 	return vm.NewEVM(context, txContext, state, b.eth.blockchain.Config(), *vmConfig), state.Error, nil
 }
&nbsp;
<span class="term-fg36">@@ -273,8 +282,22 @@</span> func (b *EthAPIBackend) SubscribeLogsEvent(ch chan&lt;- []*types.Log) event.Subscription {
 	return b.eth.BlockChain().SubscribeLogsEvent(ch)
 }
&nbsp;
<span class="term-fg31">-func (b *EthAPIBackend) SendTx(ctx context.Context, signedTx *types.Transaction) error {</span>
<span class="term-fg31">-	return b.eth.txPool.AddLocal(signedTx)</span>
<span class="term-fg32">+func (b *EthAPIBackend) SendTx(ctx context.Context, tx *types.Transaction) error {</span>
<span class="term-fg32">+	if b.eth.seqRPCService != nil {</span>
<span class="term-fg32">+		data, err := tx.MarshalBinary()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if err := b.eth.seqRPCService.CallContext(ctx, nil, &quot;eth_sendRawTransaction&quot;, hexutil.Encode(data)); err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		&#47;&#47; Retain tx in local tx pool after forwarding, for local RPC usage.</span>
<span class="term-fg32">+		if err := b.eth.txPool.AddLocal(tx); err != nil {</span>
<span class="term-fg32">+			log.Warn(&quot;successfully sent tx to sequencer, but failed to persist in local tx pool&quot;, &quot;err&quot;, err, &quot;tx&quot;, tx.Hash())</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return b.eth.txPool.AddLocal(tx)</span>
 }
&nbsp;
 func (b *EthAPIBackend) GetPoolTransactions() (types.Transactions, error) {
<span class="term-fg36">@@ -327,7 +350,7 @@</span> func (b *EthAPIBackend) SuggestGasTipCap(ctx context.Context) (*big.Int, error) {
 	return b.gpo.SuggestTipCap(ctx)
 }
&nbsp;
<span class="term-fg31">-func (b *EthAPIBackend) FeeHistory(ctx context.Context, blockCount int, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (firstBlock *big.Int, reward [][]*big.Int, baseFee []*big.Int, gasUsedRatio []float64, err error) {</span>
<span class="term-fg32">+func (b *EthAPIBackend) FeeHistory(ctx context.Context, blockCount uint64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (firstBlock *big.Int, reward [][]*big.Int, baseFee []*big.Int, gasUsedRatio []float64, err error) {</span>
 	return b.gpo.FeeHistory(ctx, blockCount, lastBlock, rewardPercentiles)
 }
&nbsp;
<span class="term-fg36">@@ -397,3 +420,11 @@</span>
 func (b *EthAPIBackend) StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (*core.Message, vm.BlockContext, *state.StateDB, tracers.StateReleaseFunc, error) {
 	return b.eth.stateAtTransaction(ctx, block, txIndex, reexec)
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *EthAPIBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.eth.historicalRPCService</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *EthAPIBackend) Genesis() *types.Block {</span>
<span class="term-fg32">+	return b.eth.blockchain.Genesis()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5a23eedb99a97d031c62bdf1" role="button"
                   aria-expanded="false" aria-controls="id-5a23eedb99a97d031c62bdf1">
                    <code>eth/backend.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+52</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5a23eedb99a97d031c62bdf1"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;backend.go op-geth&#47;eth&#47;backend.go</span>
<span class="term-fg1">index 6368c0e03c564cdc5e457883b7f81e0d8d9c7431..0e3351ab8baa35d22c68872dcc072e5995eb3263 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;backend.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;backend.go</span>
<span class="term-fg36">@@ -18,12 +18,14 @@</span> &#47;&#47; Package eth implements the Ethereum protocol.
 package eth
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
 	&quot;runtime&quot;
 	&quot;sync&quot;
 	&quot;sync&#47;atomic&quot;
<span class="term-fg32">+	&quot;time&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -74,6 +76,9 @@</span> 	ethDialCandidates  enode.Iterator
 	snapDialCandidates enode.Iterator
 	merger             *consensus.Merger
&nbsp;
<span class="term-fg32">+	seqRPCService        *rpc.Client</span>
<span class="term-fg32">+	historicalRPCService *rpc.Client</span>
<span class="term-fg32">+</span>
 	&#47;&#47; DB interfaces
 	chainDb ethdb.Database &#47;&#47; Block chain database
&nbsp;
<span class="term-fg36">@@ -165,7 +170,6 @@</span> 	var dbVer = &quot;&lt;nil&gt;&quot;
 	if bcVersion != nil {
 		dbVer = fmt.Sprintf(&quot;%d&quot;, *bcVersion)
 	}
<span class="term-fg31">-	log.Info(&quot;Initialising Ethereum protocol&quot;, &quot;network&quot;, config.NetworkId, &quot;dbversion&quot;, dbVer)</span>
&nbsp;
 	if !config.SkipBcVersionCheck {
 		if bcVersion != nil &amp;&amp; *bcVersion &gt; core.BlockChainVersion {
<span class="term-fg36">@@ -198,10 +202,29 @@</span> 	var overrides core.ChainOverrides
 	if config.OverrideShanghai != nil {
 		overrides.OverrideShanghai = config.OverrideShanghai
 	}
<span class="term-fg32">+	if config.OverrideOptimismBedrock != nil {</span>
<span class="term-fg32">+		overrides.OverrideOptimismBedrock = config.OverrideOptimismBedrock</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if config.OverrideOptimismRegolith != nil {</span>
<span class="term-fg32">+		overrides.OverrideOptimismRegolith = config.OverrideOptimismRegolith</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if config.OverrideOptimism != nil {</span>
<span class="term-fg32">+		overrides.OverrideOptimism = config.OverrideOptimism</span>
<span class="term-fg32">+	}</span>
 	eth.blockchain, err = core.NewBlockChain(chainDb, cacheConfig, config.Genesis, &amp;overrides, eth.engine, vmConfig, eth.shouldPreserve, &amp;config.TxLookupLimit)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg32">+	if chainConfig := eth.blockchain.Config(); chainConfig.Optimism != nil { &#47;&#47; config.Genesis.Config.ChainID cannot be used because it&#39;s based on CLI flags only, thus default to mainnet L1</span>
<span class="term-fg32">+		config.NetworkId = chainConfig.ChainID.Uint64() &#47;&#47; optimism defaults eth network ID to chain ID</span>
<span class="term-fg32">+		eth.networkID = config.NetworkId</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	log.Info(&quot;Initialising Ethereum protocol&quot;, &quot;network&quot;, config.NetworkId, &quot;dbversion&quot;, dbVer)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if eth.blockchain.Config().Optimism != nil { &#47;&#47; Optimism Bedrock depends on Merge functionality</span>
<span class="term-fg32">+		eth.merger.FinalizePoS()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	eth.bloomIndexer.Start(eth.blockchain)
&nbsp;
 	if config.TxPool.Journal != &quot;&quot; {
<span class="term-fg36">@@ -226,6 +249,7 @@</span> 		BloomCache:     uint64(cacheLimit),
 		EventMux:       eth.eventMux,
 		Checkpoint:     checkpoint,
 		RequiredBlocks: config.RequiredBlocks,
<span class="term-fg32">+		NoTxGossip:     config.RollupDisableTxPoolGossip,</span>
 	}); err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -254,6 +278,26 @@</span> 	if err != nil {
 		return nil, err
 	}
&nbsp;
<span class="term-fg32">+	if config.RollupSequencerHTTP != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupSequencerHTTP)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		eth.seqRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupHistoricalRPC != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), config.RollupHistoricalRPCTimeout)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupHistoricalRPC)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		eth.historicalRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Start the RPC service
 	eth.netRPCService = ethapi.NewNetAPI(eth.p2pServer, config.NetworkId)
&nbsp;
<span class="term-fg36">@@ -272,7 +316,7 @@</span> func makeExtraData(extra []byte) []byte {
 	if len(extra) == 0 {
 		&#47;&#47; create default extradata
 		extra, _ = rlp.EncodeToBytes([]interface{}{
<span class="term-fg31">-			uint(params.VersionMajor&lt;&lt;16 | params.VersionMinor&lt;&lt;8 | params.VersionPatch),</span>
<span class="term-fg32">+			uint(params.OPVersionMajor&lt;&lt;16 | params.OPVersionMinor&lt;&lt;8 | params.OPVersionPatch),</span>
 			&quot;geth&quot;,
 			runtime.Version(),
 			runtime.GOOS,
<span class="term-fg36">@@ -533,6 +577,12 @@</span> 	s.txPool.Stop()
 	s.miner.Close()
 	s.blockchain.Stop()
 	s.engine.Close()
<span class="term-fg32">+	if s.seqRPCService != nil {</span>
<span class="term-fg32">+		s.seqRPCService.Close()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if s.historicalRPCService != nil {</span>
<span class="term-fg32">+		s.historicalRPCService.Close()</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	&#47;&#47; Clean shutdown marker as the last thing before closing db
 	s.shutdownTracker.Stop()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b1ebd9a7451f84c9e5f3513" role="button"
                   aria-expanded="false" aria-controls="id-9b1ebd9a7451f84c9e5f3513">
                    <code>internal/ethapi/backend.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/ethapi/backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/ethapi/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b1ebd9a7451f84c9e5f3513"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;backend.go op-geth&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">index 98887afc803fab93f18e569b71aaa44d53efde27..ba2c75cae2ec70cd8732039adb93e6f9120d86e1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg36">@@ -44,7 +44,7 @@</span> 	&#47;&#47; General Ethereum API
 	SyncProgress() ethereum.SyncProgress
&nbsp;
 	SuggestGasTipCap(ctx context.Context) (*big.Int, error)
<span class="term-fg31">-	FeeHistory(ctx context.Context, blockCount int, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error)</span>
<span class="term-fg32">+	FeeHistory(ctx context.Context, blockCount uint64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error)</span>
 	ChainDb() ethdb.Database
 	AccountManager() *accounts.Manager
 	ExtRPCEnabled() bool
<span class="term-fg36">@@ -86,6 +86,8 @@</span> 	SubscribeNewTxsEvent(chan&lt;- core.NewTxsEvent) event.Subscription
&nbsp;
 	ChainConfig() *params.ChainConfig
 	Engine() consensus.Engine
<span class="term-fg32">+	HistoricalRPCService() *rpc.Client</span>
<span class="term-fg32">+	Genesis() *types.Block</span>
&nbsp;
 	&#47;&#47; This is copied from filters.Backend
 	&#47;&#47; eth&#47;filters needs to be initialized from this backend type, so methods needed by</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-21895ba892e9be37b89fde51"role="button" aria-expanded="false" aria-controls="id-21895ba892e9be37b89fde51">
        
            <div class="col-12 col-sm-9 text-start"><h3>Apply L1 cost in API responses</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+1</span></div>
                <div class="text-start"><span class="text-danger">-1</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-21895ba892e9be37b89fde51">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-27c97900bff2280c654ec7be" role="button"
                   aria-expanded="false" aria-controls="id-27c97900bff2280c654ec7be">
                    <code>eth/state_accessor.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/state_accessor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/state_accessor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-27c97900bff2280c654ec7be"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;state_accessor.go op-geth&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">index 59b471425542fb4b1cb6241a537a7bd231b54512..c5f34822e15410bb772ad9f6771e8809b894cdd7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;state_accessor.go</span>
<span class="term-fg36">@@ -214,7 +214,7 @@</span> 	for idx, tx := range block.Transactions() {
 		&#47;&#47; Assemble the transaction call message and return if the requested offset
 		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())
 		txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-		context := core.NewEVMBlockContext(block.Header(), eth.blockchain, nil)</span>
<span class="term-fg32">+		context := core.NewEVMBlockContext(block.Header(), eth.blockchain, nil, eth.blockchain.Config(), statedb)</span>
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-1984a7998e46ef8cc179c33b"role="button" aria-expanded="false" aria-controls="id-1984a7998e46ef8cc179c33b">
        
            <div class="col-12 col-sm-9 text-start"><h3>API frontend</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+229</span></div>
                <div class="text-start"><span class="text-danger">-15</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-1984a7998e46ef8cc179c33b">
        <div><p>Format deposit and L1-cost data in transaction responses.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f96b4a1fcaf709c6710b6608" role="button"
                   aria-expanded="false" aria-controls="id-f96b4a1fcaf709c6710b6608">
                    <code>internal/ethapi/api.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/ethapi/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/ethapi/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+219</span></div>
                        <div class="text-start"><span class="text-danger">-15</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f96b4a1fcaf709c6710b6608"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;api.go op-geth&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">index 0cf29e5fe64220ba14cb7a6a4e9a6662c3620ac9..8714ff869485e0b441f552225ab6e83b697c005f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg36">@@ -25,7 +25,11 @@</span> 	&quot;math&#47;big&quot;
 	&quot;strings&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;davecgh&#47;go-spew&#47;spew&quot;
<span class="term-fg32">+	&quot;github.com&#47;tyler-smith&#47;go-bip39&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;keystore&quot;
<span class="term-fg36">@@ -46,7 +50,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;p2p&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg31">-	&quot;github.com&#47;tyler-smith&#47;go-bip39&quot;</span>
 )
&nbsp;
 &#47;&#47; EthereumAPI provides an API to access Ethereum related information.
<span class="term-fg36">@@ -89,7 +92,7 @@</span> }
&nbsp;
 &#47;&#47; FeeHistory returns the fee market history.
 func (s *EthereumAPI) FeeHistory(ctx context.Context, blockCount math.HexOrDecimal64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*feeHistoryResult, error) {
<span class="term-fg31">-	oldest, reward, baseFee, gasUsed, err := s.b.FeeHistory(ctx, int(blockCount), lastBlock, rewardPercentiles)</span>
<span class="term-fg32">+	oldest, reward, baseFee, gasUsed, err := s.b.FeeHistory(ctx, uint64(blockCount), lastBlock, rewardPercentiles)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -630,10 +633,29 @@</span> &#47;&#47; GetBalance returns the amount of wei for the given address in the state of the
 &#47;&#47; given block number. The rpc.LatestBlockNumber and rpc.PendingBlockNumber meta
 &#47;&#47; block numbers are also allowed.
 func (s *BlockChainAPI) GetBalance(ctx context.Context, address common.Address, blockNrOrHash rpc.BlockNumberOrHash) (*hexutil.Big, error) {
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Big</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_getBalance&quot;, address, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return &amp;res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	state, _, err := s.b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
 	return (*hexutil.Big)(state.GetBalance(address)), state.Error()
 }
&nbsp;
<span class="term-fg36">@@ -656,6 +678,22 @@</span> }
&nbsp;
 &#47;&#47; GetProof returns the Merkle-proof for a given account and optionally some storage keys.
 func (s *BlockChainAPI) GetProof(ctx context.Context, address common.Address, storageKeys []string, blockNrOrHash rpc.BlockNumberOrHash) (*AccountResult, error) {
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res AccountResult</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_getProof&quot;, address, storageKeys, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return &amp;res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	state, _, err := s.b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
 		return nil, err
<span class="term-fg36">@@ -836,10 +874,29 @@</span> }
&nbsp;
 &#47;&#47; GetCode returns the code stored at the given address in the state for the given block number.
 func (s *BlockChainAPI) GetCode(ctx context.Context, address common.Address, blockNrOrHash rpc.BlockNumberOrHash) (hexutil.Bytes, error) {
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Bytes</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_getCode&quot;, address, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	state, _, err := s.b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
 	code := state.GetCode(address)
 	return code, state.Error()
 }
<span class="term-fg36">@@ -848,10 +905,29 @@</span> &#47;&#47; GetStorageAt returns the storage from the state at the given address, key and
 &#47;&#47; block number. The rpc.LatestBlockNumber and rpc.PendingBlockNumber meta block
 &#47;&#47; numbers are also allowed.
 func (s *BlockChainAPI) GetStorageAt(ctx context.Context, address common.Address, hexKey string, blockNrOrHash rpc.BlockNumberOrHash) (hexutil.Bytes, error) {
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Bytes</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_getStorageAt&quot;, address, hexKey, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	state, _, err := s.b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
 	key, err := decodeHash(hexKey)
 	if err != nil {
 		return nil, fmt.Errorf(&quot;unable to decode storage key: %s&quot;, err)
<span class="term-fg36">@@ -860,6 +936,18 @@</span> 	res := state.GetState(address, key)
 	return res[:], state.Error()
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; The HeaderByNumberOrHash method returns a nil error and nil header</span>
<span class="term-fg32">+&#47;&#47; if the header is not found, but only for nonexistent block numbers. This is</span>
<span class="term-fg32">+&#47;&#47; different from StateAndHeaderByNumberOrHash. To account for this discrepancy,</span>
<span class="term-fg32">+&#47;&#47; headerOrNumberByHash will properly convert the error into an ethereum.NotFound.</span>
<span class="term-fg32">+func headerByNumberOrHash(ctx context.Context, b Backend, blockNrOrHash rpc.BlockNumberOrHash) (*types.Header, error) {</span>
<span class="term-fg32">+	header, err := b.HeaderByNumberOrHash(ctx, blockNrOrHash)</span>
<span class="term-fg32">+	if header == nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;header %w&quot;, ethereum.NotFound)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return header, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; OverrideAccount indicates the overriding fields of account during the execution
 &#47;&#47; of a message call.
 &#47;&#47; Note, state and stateDiff can&#39;t be specified at the same time. If state is
<span class="term-fg36">@@ -1047,6 +1135,24 @@</span> &#47;&#47;
 &#47;&#47; Note, this function doesn&#39;t make and changes in the state&#47;blockchain and is
 &#47;&#47; useful to execute and retrieve values.
 func (s *BlockChainAPI) Call(ctx context.Context, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride) (hexutil.Bytes, error) {
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Bytes</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_call&quot;, args, blockNrOrHash, overrides)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	result, err := DoCall(ctx, s.b, args, blockNrOrHash, overrides, s.b.RPCEVMTimeout(), s.b.RPCGasCap())
 	if err != nil {
 		return nil, err
<span class="term-fg36">@@ -1185,6 +1291,25 @@</span> 	bNrOrHash := rpc.BlockNumberOrHashWithNumber(rpc.PendingBlockNumber)
 	if blockNrOrHash != nil {
 		bNrOrHash = *blockNrOrHash
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, bNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Uint64</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_estimateGas&quot;, args, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return 0, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return 0, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return DoEstimateGas(ctx, s.b, args, bNrOrHash, s.b.RPCGasCap())
 }
&nbsp;
<span class="term-fg36">@@ -1224,7 +1349,7 @@</span>
 &#47;&#47; RPCMarshalBlock converts the given block to the RPC output which depends on fullTx. If inclTx is true transactions are
 &#47;&#47; returned. When fullTx is true the returned block contains full transaction details, otherwise it will only contain
 &#47;&#47; transaction hashes.
<span class="term-fg31">-func RPCMarshalBlock(block *types.Block, inclTx bool, fullTx bool, config *params.ChainConfig) (map[string]interface{}, error) {</span>
<span class="term-fg32">+func RPCMarshalBlock(ctx context.Context, block *types.Block, inclTx bool, fullTx bool, backend Backend) (map[string]interface{}, error) {</span>
 	fields := RPCMarshalHeader(block.Header())
 	fields[&quot;size&quot;] = hexutil.Uint64(block.Size())
&nbsp;
<span class="term-fg36">@@ -1234,7 +1359,7 @@</span> 			return tx.Hash(), nil
 		}
 		if fullTx {
 			formatTx = func(tx *types.Transaction) (interface{}, error) {
<span class="term-fg31">-				return newRPCTransactionFromBlockHash(block, tx.Hash(), config), nil</span>
<span class="term-fg32">+				return newRPCTransactionFromBlockHash(ctx, block, tx.Hash(), backend), nil</span>
 			}
 		}
 		txs := block.Transactions()
<span class="term-fg36">@@ -1270,7 +1395,7 @@</span>
 &#47;&#47; rpcMarshalBlock uses the generalized output filler, then adds the total difficulty field, which requires
 &#47;&#47; a `BlockchainAPI`.
 func (s *BlockChainAPI) rpcMarshalBlock(ctx context.Context, b *types.Block, inclTx bool, fullTx bool) (map[string]interface{}, error) {
<span class="term-fg31">-	fields, err := RPCMarshalBlock(b, inclTx, fullTx, s.b.ChainConfig())</span>
<span class="term-fg32">+	fields, err := RPCMarshalBlock(ctx, b, inclTx, fullTx, s.b)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -1301,11 +1426,16 @@</span> 	ChainID          *hexutil.Big      `json:&quot;chainId,omitempty&quot;`
 	V                *hexutil.Big      `json:&quot;v&quot;`
 	R                *hexutil.Big      `json:&quot;r&quot;`
 	S                *hexutil.Big      `json:&quot;s&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; deposit-tx only</span>
<span class="term-fg32">+	SourceHash *common.Hash `json:&quot;sourceHash,omitempty&quot;`</span>
<span class="term-fg32">+	Mint       *hexutil.Big `json:&quot;mint,omitempty&quot;`</span>
<span class="term-fg32">+	IsSystemTx *bool        `json:&quot;isSystemTx,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; newRPCTransaction returns a transaction that will serialize to the RPC
 &#47;&#47; representation, with the given location metadata set (if available).
<span class="term-fg31">-func newRPCTransaction(tx *types.Transaction, blockHash common.Hash, blockNumber uint64, index uint64, baseFee *big.Int, config *params.ChainConfig) *RPCTransaction {</span>
<span class="term-fg32">+func newRPCTransaction(tx *types.Transaction, blockHash common.Hash, blockNumber uint64, index uint64, baseFee *big.Int, config *params.ChainConfig, receipt *types.Receipt) *RPCTransaction {</span>
 	signer := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber))
 	from, _ := types.Sender(signer, tx)
 	v, r, s := tx.RawSignatureValues()
<span class="term-fg36">@@ -1328,7 +1458,20 @@</span> 		result.BlockHash = &amp;blockHash
 		result.BlockNumber = (*hexutil.Big)(new(big.Int).SetUint64(blockNumber))
 		result.TransactionIndex = (*hexutil.Uint64)(&amp;index)
 	}
<span class="term-fg32">+</span>
 	switch tx.Type() {
<span class="term-fg32">+	case types.DepositTxType:</span>
<span class="term-fg32">+		srcHash := tx.SourceHash()</span>
<span class="term-fg32">+		isSystemTx := tx.IsSystemTx()</span>
<span class="term-fg32">+		result.SourceHash = &amp;srcHash</span>
<span class="term-fg32">+		if isSystemTx {</span>
<span class="term-fg32">+			&#47;&#47; Only include IsSystemTx when true</span>
<span class="term-fg32">+			result.IsSystemTx = &amp;isSystemTx</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		result.Mint = (*hexutil.Big)(tx.Mint())</span>
<span class="term-fg32">+		if receipt != nil &amp;&amp; receipt.DepositNonce != nil {</span>
<span class="term-fg32">+			result.Nonce = hexutil.Uint64(*receipt.DepositNonce)</span>
<span class="term-fg32">+		}</span>
 	case types.LegacyTxType:
 		&#47;&#47; if a legacy transaction has an EIP-155 chain id, include it explicitly
 		if id := tx.ChainId(); id.Sign() != 0 {
<span class="term-fg36">@@ -1364,16 +1507,32 @@</span> 	if current != nil {
 		baseFee = misc.CalcBaseFee(config, current)
 		blockNumber = current.Number.Uint64()
 	}
<span class="term-fg31">-	return newRPCTransaction(tx, common.Hash{}, blockNumber, 0, baseFee, config)</span>
<span class="term-fg32">+	return newRPCTransaction(tx, common.Hash{}, blockNumber, 0, baseFee, config, nil)</span>
 }
&nbsp;
 &#47;&#47; newRPCTransactionFromBlockIndex returns a transaction that will serialize to the RPC representation.
<span class="term-fg31">-func newRPCTransactionFromBlockIndex(b *types.Block, index uint64, config *params.ChainConfig) *RPCTransaction {</span>
<span class="term-fg32">+func newRPCTransactionFromBlockIndex(ctx context.Context, b *types.Block, index uint64, backend Backend) *RPCTransaction {</span>
 	txs := b.Transactions()
 	if index &gt;= uint64(len(txs)) {
 		return nil
 	}
<span class="term-fg31">-	return newRPCTransaction(txs[index], b.Hash(), b.NumberU64(), index, b.BaseFee(), config)</span>
<span class="term-fg32">+	tx := txs[index]</span>
<span class="term-fg32">+	rcpt := depositTxReceipt(ctx, b.Hash(), index, backend, tx)</span>
<span class="term-fg32">+	return newRPCTransaction(tx, b.Hash(), b.NumberU64(), index, b.BaseFee(), backend.ChainConfig(), rcpt)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func depositTxReceipt(ctx context.Context, blockHash common.Hash, index uint64, backend Backend, tx *types.Transaction) *types.Receipt {</span>
<span class="term-fg32">+	if tx.Type() != types.DepositTxType {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	receipts, err := backend.GetReceipts(ctx, blockHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if index &gt;= uint64(len(receipts)) {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return receipts[index]</span>
 }
&nbsp;
 &#47;&#47; newRPCRawTransactionFromBlockIndex returns the bytes of a transaction given a block and a transaction index.
<span class="term-fg36">@@ -1387,10 +1546,10 @@</span> 	return blob
 }
&nbsp;
 &#47;&#47; newRPCTransactionFromBlockHash returns a transaction that will serialize to the RPC representation.
<span class="term-fg31">-func newRPCTransactionFromBlockHash(b *types.Block, hash common.Hash, config *params.ChainConfig) *RPCTransaction {</span>
<span class="term-fg32">+func newRPCTransactionFromBlockHash(ctx context.Context, b *types.Block, hash common.Hash, backend Backend) *RPCTransaction {</span>
 	for idx, tx := range b.Transactions() {
 		if tx.Hash() == hash {
<span class="term-fg31">-			return newRPCTransactionFromBlockIndex(b, uint64(idx), config)</span>
<span class="term-fg32">+			return newRPCTransactionFromBlockIndex(ctx, b, uint64(idx), backend)</span>
 		}
 	}
 	return nil
<span class="term-fg36">@@ -1412,6 +1571,21 @@</span> 	bNrOrHash := rpc.BlockNumberOrHashWithNumber(rpc.PendingBlockNumber)
 	if blockNrOrHash != nil {
 		bNrOrHash = *blockNrOrHash
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, bNrOrHash)</span>
<span class="term-fg32">+	if err == nil &amp;&amp; header != nil &amp;&amp; s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res accessListResult</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_createAccessList&quot;, args, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return &amp;res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	acl, gasUsed, vmerr, err := AccessList(ctx, s.b, bNrOrHash, args)
 	if err != nil {
 		return nil, err
<span class="term-fg36">@@ -1473,7 +1647,7 @@</span> 		}
&nbsp;
 		&#47;&#47; Apply the transaction with the access list tracer
 		tracer := logger.NewAccessListTracer(accessList, args.from(), to, precompiles)
<span class="term-fg31">-		config := vm.Config{Tracer: tracer, Debug: true, NoBaseFee: true}</span>
<span class="term-fg32">+		config := vm.Config{Tracer: tracer, NoBaseFee: true}</span>
 		vmenv, _, err := b.GetEVM(ctx, msg, statedb, header, &amp;config)
 		if err != nil {
 			return nil, 0, nil, err
<span class="term-fg36">@@ -1525,7 +1699,7 @@</span>
 &#47;&#47; GetTransactionByBlockNumberAndIndex returns the transaction for the given block number and index.
 func (s *TransactionAPI) GetTransactionByBlockNumberAndIndex(ctx context.Context, blockNr rpc.BlockNumber, index hexutil.Uint) *RPCTransaction {
 	if block, _ := s.b.BlockByNumber(ctx, blockNr); block != nil {
<span class="term-fg31">-		return newRPCTransactionFromBlockIndex(block, uint64(index), s.b.ChainConfig())</span>
<span class="term-fg32">+		return newRPCTransactionFromBlockIndex(ctx, block, uint64(index), s.b)</span>
 	}
 	return nil
 }
<span class="term-fg36">@@ -1533,7 +1707,7 @@</span>
 &#47;&#47; GetTransactionByBlockHashAndIndex returns the transaction for the given block hash and index.
 func (s *TransactionAPI) GetTransactionByBlockHashAndIndex(ctx context.Context, blockHash common.Hash, index hexutil.Uint) *RPCTransaction {
 	if block, _ := s.b.BlockByHash(ctx, blockHash); block != nil {
<span class="term-fg31">-		return newRPCTransactionFromBlockIndex(block, uint64(index), s.b.ChainConfig())</span>
<span class="term-fg32">+		return newRPCTransactionFromBlockIndex(ctx, block, uint64(index), s.b)</span>
 	}
 	return nil
 }
<span class="term-fg36">@@ -1565,10 +1739,29 @@</span> 		}
 		return (*hexutil.Uint64)(&amp;nonce), nil
 	}
 	&#47;&#47; Resolve block number and use its state to ask for the nonce
<span class="term-fg32">+	header, err := headerByNumberOrHash(ctx, s.b, blockNrOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().IsOptimismPreBedrock(header.Number) {</span>
<span class="term-fg32">+		if s.b.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var res hexutil.Uint64</span>
<span class="term-fg32">+			err := s.b.HistoricalRPCService().CallContext(ctx, &amp;res, &quot;eth_getTransactionCount&quot;, address, blockNrOrHash)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return &amp;res, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	state, _, err := s.b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
 	nonce := state.GetNonce(address)
 	return (*hexutil.Uint64)(&amp;nonce), state.Error()
 }
<span class="term-fg36">@@ -1585,7 +1778,8 @@</span> 		header, err := s.b.HeaderByHash(ctx, blockHash)
 		if err != nil {
 			return nil, err
 		}
<span class="term-fg31">-		return newRPCTransaction(tx, blockHash, blockNumber, index, header.BaseFee, s.b.ChainConfig()), nil</span>
<span class="term-fg32">+		rcpt := depositTxReceipt(ctx, blockHash, index, s.b, tx)</span>
<span class="term-fg32">+		return newRPCTransaction(tx, blockHash, blockNumber, index, header.BaseFee, s.b.ChainConfig(), rcpt), nil</span>
 	}
 	&#47;&#47; No finalized transaction, try to retrieve it from the pool
 	if tx := s.b.GetPoolTransaction(hash); tx != nil {
<span class="term-fg36">@@ -1650,6 +1844,16 @@</span> 		&quot;logs&quot;:              receipt.Logs,
 		&quot;logsBloom&quot;:         receipt.Bloom,
 		&quot;type&quot;:              hexutil.Uint(tx.Type()),
 		&quot;effectiveGasPrice&quot;: (*hexutil.Big)(receipt.EffectiveGasPrice),
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if s.b.ChainConfig().Optimism != nil &amp;&amp; !tx.IsDepositTx() {</span>
<span class="term-fg32">+		fields[&quot;l1GasPrice&quot;] = (*hexutil.Big)(receipt.L1GasPrice)</span>
<span class="term-fg32">+		fields[&quot;l1GasUsed&quot;] = (*hexutil.Big)(receipt.L1GasUsed)</span>
<span class="term-fg32">+		fields[&quot;l1Fee&quot;] = (*hexutil.Big)(receipt.L1Fee)</span>
<span class="term-fg32">+		fields[&quot;l1FeeScalar&quot;] = receipt.FeeScalar.String()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if s.b.ChainConfig().Optimism != nil &amp;&amp; tx.IsDepositTx() &amp;&amp; receipt.DepositNonce != nil {</span>
<span class="term-fg32">+		fields[&quot;depositNonce&quot;] = hexutil.Uint64(*receipt.DepositNonce)</span>
 	}
&nbsp;
 	&#47;&#47; Assign receipt status or post state.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9fbe788938c041acabcdca9d" role="button"
                   aria-expanded="false" aria-controls="id-9fbe788938c041acabcdca9d">
                    <code>rpc/errors.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/rpc/errors.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/rpc/errors.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9fbe788938c041acabcdca9d"><span class="term-fg1">diff --git go-ethereum&#47;rpc&#47;errors.go op-geth&#47;rpc&#47;errors.go</span>
<span class="term-fg1">index 7188332d551ebdcd541438d7a58daad996b5c70f..4a2dab3d9836494a8618d56bfa204e2339a12491 100644</span>
<span class="term-fg1">--- go-ethereum&#47;rpc&#47;errors.go</span>
<span class="term-fg1">+++ op-geth&#47;rpc&#47;errors.go</span>
<span class="term-fg36">@@ -69,6 +69,16 @@</span> const (
 	errMsgTimeout = &quot;request timed out&quot;
 )
&nbsp;
<span class="term-fg32">+var ErrNoHistoricalFallback = NoHistoricalFallbackError{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type NoHistoricalFallbackError struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (e NoHistoricalFallbackError) ErrorCode() int { return -32801 }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (e NoHistoricalFallbackError) Error() string {</span>
<span class="term-fg32">+	return &quot;no historical RPC is available for this historical (pre-bedrock) execution request&quot;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 type methodNotFoundError struct{ method string }
&nbsp;
 func (e *methodNotFoundError) ErrorCode() int { return -32601 }</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-39a924130c03f52b50bd5cd3"role="button" aria-expanded="false" aria-controls="id-39a924130c03f52b50bd5cd3">
        
            <div class="col-12 col-sm-9 text-start"><h3>Tracer RPC daisy-chain</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+60</span></div>
                <div class="text-start"><span class="text-danger">-14</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-39a924130c03f52b50bd5cd3">
        <div><p>Forward pre-bedrock tracing calls to legacy node.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2523ebcd52b84e21d44f4a4e" role="button"
                   aria-expanded="false" aria-controls="id-2523ebcd52b84e21d44f4a4e">
                    <code>eth/tracers/api.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+60</span></div>
                        <div class="text-start"><span class="text-danger">-14</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2523ebcd52b84e21d44f4a4e"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;api.go op-geth&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">index 58ad0c3c9ad768f883047d7d75181253b81fe2f1..ddba32aebeb4c42747bb907ae013d9ecf237b366 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg36">@@ -23,6 +23,7 @@</span> 	&quot;context&quot;
 	&quot;encoding&#47;json&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
 	&quot;os&quot;
 	&quot;runtime&quot;
 	&quot;sync&quot;
<span class="term-fg36">@@ -68,8 +69,6 @@</span> 	&#47;&#47; trace states exceed this limit.
 	maximumPendingTraceStates = 128
 )
&nbsp;
<span class="term-fg31">-var errTxNotFound = errors.New(&quot;transaction not found&quot;)</span>
<span class="term-fg31">-</span>
 &#47;&#47; StateReleaseFunc is used to deallocate resources held by constructing a
 &#47;&#47; historical state for tracing purposes.
 type StateReleaseFunc func()
<span class="term-fg36">@@ -88,6 +87,7 @@</span> 	Engine() consensus.Engine
 	ChainDb() ethdb.Database
 	StateAtBlock(ctx context.Context, block *types.Block, reexec uint64, base *state.StateDB, readOnly bool, preferDisk bool) (*state.StateDB, StateReleaseFunc, error)
 	StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (*core.Message, vm.BlockContext, *state.StateDB, StateReleaseFunc, error)
<span class="term-fg32">+	HistoricalRPCService() *rpc.Client</span>
 }
&nbsp;
 &#47;&#47; API is the collection of tracing APIs exposed over the private debugging endpoint.
<span class="term-fg36">@@ -231,6 +231,7 @@</span>
 &#47;&#47; TraceChain returns the structured logs created during the execution of EVM
 &#47;&#47; between two blocks (excluding start) and returns them as a JSON object.
 func (api *API) TraceChain(ctx context.Context, start, end rpc.BlockNumber, config *TraceConfig) (*rpc.Subscription, error) { &#47;&#47; Fetch the block interval that we want to trace
<span class="term-fg32">+	&#47;&#47; TODO: Need to implement a fallback for this</span>
 	from, err := api.blockByNumber(ctx, start)
 	if err != nil {
 		return nil, err
<span class="term-fg36">@@ -289,7 +290,7 @@</span> 			&#47;&#47; Fetch and execute the block trace taskCh
 			for task := range taskCh {
 				var (
 					signer   = types.MakeSigner(api.backend.ChainConfig(), task.block.Number())
<span class="term-fg31">-					blockCtx = core.NewEVMBlockContext(task.block.Header(), api.chainContext(ctx), nil)</span>
<span class="term-fg32">+					blockCtx = core.NewEVMBlockContext(task.block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), task.statedb)</span>
 				)
 				&#47;&#47; Trace all the transactions contained within
 				for i, tx := range task.block.Transactions() {
<span class="term-fg36">@@ -459,6 +460,20 @@</span> 	block, err := api.blockByNumber(ctx, number)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	if api.backend.ChainConfig().IsOptimismPreBedrock(block.Number()) {</span>
<span class="term-fg32">+		if api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var histResult []*txTraceResult</span>
<span class="term-fg32">+			err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceBlockByNumber&quot;, number, config)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return histResult, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return api.traceBlock(ctx, block, config)
 }
&nbsp;
<span class="term-fg36">@@ -469,6 +484,20 @@</span> 	block, err := api.blockByHash(ctx, hash)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	if api.backend.ChainConfig().IsOptimismPreBedrock(block.Number()) {</span>
<span class="term-fg32">+		if api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var histResult []*txTraceResult</span>
<span class="term-fg32">+			err = api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceBlockByHash&quot;, hash, config)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return histResult, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return api.traceBlock(ctx, block, config)
 }
&nbsp;
<span class="term-fg36">@@ -518,6 +547,7 @@</span> &#47;&#47; IntermediateRoots executes a block (bad- or canon- or side-), and returns a list
 &#47;&#47; of intermediate roots: the stateroot after each transaction.
 func (api *API) IntermediateRoots(ctx context.Context, hash common.Hash, config *TraceConfig) ([]common.Hash, error) {
 	block, _ := api.blockByHash(ctx, hash)
<span class="term-fg32">+	&#47;&#47; TODO: Cannot get intermediate roots for pre-bedrock block without daisy chain</span>
 	if block == nil {
 		&#47;&#47; Check in the bad blocks
 		block = rawdb.ReadBadBlock(api.backend.ChainDb(), hash)
<span class="term-fg36">@@ -546,7 +576,7 @@</span> 	var (
 		roots              []common.Hash
 		signer             = types.MakeSigner(api.backend.ChainConfig(), block.Number())
 		chainConfig        = api.backend.ChainConfig()
<span class="term-fg31">-		vmctx              = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)</span>
<span class="term-fg32">+		vmctx              = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, chainConfig, statedb)</span>
 		deleteEmptyObjects = chainConfig.IsEIP158(block.Number())
 	)
 	for i, tx := range block.Transactions() {
<span class="term-fg36">@@ -622,7 +652,7 @@</span> 	var (
 		txs       = block.Transactions()
 		blockHash = block.Hash()
 		is158     = api.backend.ChainConfig().IsEIP158(block.Number())
<span class="term-fg31">-		blockCtx  = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)</span>
<span class="term-fg32">+		blockCtx  = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), statedb)</span>
 		signer    = types.MakeSigner(api.backend.ChainConfig(), block.Number())
 		results   = make([]*txTraceResult, len(txs))
 	)
<span class="term-fg36">@@ -655,7 +685,6 @@</span> 	&#47;&#47; Execute all the transaction contained within the block concurrently
 	var (
 		txs       = block.Transactions()
 		blockHash = block.Hash()
<span class="term-fg31">-		blockCtx  = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)</span>
 		signer    = types.MakeSigner(api.backend.ChainConfig(), block.Number())
 		results   = make([]*txTraceResult, len(txs))
 		pend      sync.WaitGroup
<span class="term-fg36">@@ -671,6 +700,7 @@</span> 		go func() {
 			defer pend.Done()
 			&#47;&#47; Fetch and execute the next transaction trace tasks
 			for task := range jobs {
<span class="term-fg32">+				blockCtx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), task.statedb)</span>
 				msg, _ := core.TransactionToMessage(txs[task.index], signer, block.BaseFee())
 				txctx := &amp;Context{
 					BlockHash:   blockHash,
<span class="term-fg36">@@ -690,6 +720,7 @@</span> 	}
&nbsp;
 	&#47;&#47; Feed the transactions into the tracers and return
 	var failed error
<span class="term-fg32">+	blockCtx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), statedb)</span>
 txloop:
 	for i, tx := range txs {
 		&#47;&#47; Send the trace task over for execution
<span class="term-fg36">@@ -767,7 +798,7 @@</span> 	var (
 		dumps       []string
 		signer      = types.MakeSigner(api.backend.ChainConfig(), block.Number())
 		chainConfig = api.backend.ChainConfig()
<span class="term-fg31">-		vmctx       = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)</span>
<span class="term-fg32">+		vmctx       = core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, chainConfig, statedb)</span>
 		canon       = true
 	)
 	&#47;&#47; Check if there are any overrides: the caller may wish to enable a future
<span class="term-fg36">@@ -805,7 +836,6 @@</span>
 			&#47;&#47; Swap out the noop logger to the standard tracer
 			writer = bufio.NewWriter(dump)
 			vmConf = vm.Config{
<span class="term-fg31">-				Debug:                   true,</span>
 				Tracer:                  logger.NewJSONLogger(&amp;logConfig, writer),
 				EnablePreimageRecording: true,
 			}
<span class="term-fg36">@@ -850,14 +880,25 @@</span>
 &#47;&#47; TraceTransaction returns the structured logs created during the execution of EVM
 &#47;&#47; and returns them as a JSON object.
 func (api *API) TraceTransaction(ctx context.Context, hash common.Hash, config *TraceConfig) (interface{}, error) {
<span class="term-fg31">-	tx, blockHash, blockNumber, index, err := api.backend.GetTransaction(ctx, hash)</span>
<span class="term-fg32">+	&#47;&#47; GetTransaction returns 0 for the blocknumber if the transaction is not found</span>
<span class="term-fg32">+	_, blockHash, blockNumber, index, err := api.backend.GetTransaction(ctx, hash)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg31">-	&#47;&#47; Only mined txes are supported</span>
<span class="term-fg31">-	if tx == nil {</span>
<span class="term-fg31">-		return nil, errTxNotFound</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if api.backend.ChainConfig().IsOptimismPreBedrock(new(big.Int).SetUint64(blockNumber)) {</span>
<span class="term-fg32">+		if api.backend.HistoricalRPCService() != nil {</span>
<span class="term-fg32">+			var histResult json.RawMessage</span>
<span class="term-fg32">+			err := api.backend.HistoricalRPCService().CallContext(ctx, &amp;histResult, &quot;debug_traceTransaction&quot;, hash, config)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, fmt.Errorf(&quot;historical backend error: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return histResult, nil</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return nil, rpc.ErrNoHistoricalFallback</span>
<span class="term-fg32">+		}</span>
 	}
<span class="term-fg32">+</span>
 	&#47;&#47; It shouldn&#39;t happen in practice.
 	if blockNumber == 0 {
 		return nil, errors.New(&quot;genesis is not traceable&quot;)
<span class="term-fg36">@@ -912,6 +953,11 @@</span> 	}
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	if api.backend.ChainConfig().IsOptimismPreBedrock(block.Number()) {</span>
<span class="term-fg32">+		return nil, errors.New(&quot;l2geth does not have a debug_traceCall method&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; try to recompute the state
 	reexec := defaultTraceReexec
 	if config != nil &amp;&amp; config.Reexec != nil {
<span class="term-fg36">@@ -923,7 +969,7 @@</span> 		return nil, err
 	}
 	defer release()
&nbsp;
<span class="term-fg31">-	vmctx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil)</span>
<span class="term-fg32">+	vmctx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), statedb)</span>
 	&#47;&#47; Apply the customization rules if required.
 	if config != nil {
 		if err := config.StateOverrides.Apply(statedb); err != nil {
<span class="term-fg36">@@ -965,7 +1011,7 @@</span> 		if err != nil {
 			return nil, err
 		}
 	}
<span class="term-fg31">-	vmenv := vm.NewEVM(vmctx, txContext, statedb, api.backend.ChainConfig(), vm.Config{Debug: true, Tracer: tracer, NoBaseFee: true})</span>
<span class="term-fg32">+	vmenv := vm.NewEVM(vmctx, txContext, statedb, api.backend.ChainConfig(), vm.Config{Tracer: tracer, NoBaseFee: true})</span>
&nbsp;
 	&#47;&#47; Define a meaningful timeout of a single transaction trace
 	if config.Timeout != nil {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-49004a4d90187323544da8fc"role="button" aria-expanded="false" aria-controls="id-49004a4d90187323544da8fc">
        
            <div class="col-12 col-sm-9 text-start"><h3>Light Ethereum Subprotocol (LES) RPC</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+38</span></div>
                <div class="text-start"><span class="text-danger">-6</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-49004a4d90187323544da8fc">
        <div><p>Match the RPC changes in the LES RPC</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ede4b9f65c34c693e1e4278" role="button"
                   aria-expanded="false" aria-controls="id-8ede4b9f65c34c693e1e4278">
                    <code>les/odr_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/les/odr_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/les/odr_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ede4b9f65c34c693e1e4278"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;odr_test.go op-geth&#47;les&#47;odr_test.go</span>
<span class="term-fg1">index 90b7cd08d7f5c42c2a923b30e49321914462550b..8654bb4bdad8c4a6a853f919dbe7431918311abd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;odr_test.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;odr_test.go</span>
<span class="term-fg36">@@ -142,7 +142,7 @@</span> 					Data:              data,
 					SkipAccountChecks: true,
 				}
&nbsp;
<span class="term-fg31">-				context := core.NewEVMBlockContext(header, bc, nil)</span>
<span class="term-fg32">+				context := core.NewEVMBlockContext(header, bc, nil, config, statedb)</span>
 				txContext := core.NewEVMTxContext(msg)
 				vmenv := vm.NewEVM(context, txContext, statedb, config, vm.Config{NoBaseFee: true})
&nbsp;
<span class="term-fg36">@@ -166,7 +166,7 @@</span> 				GasTipCap:         new(big.Int),
 				Data:              data,
 				SkipAccountChecks: true,
 			}
<span class="term-fg31">-			context := core.NewEVMBlockContext(header, lc, nil)</span>
<span class="term-fg32">+			context := core.NewEVMBlockContext(header, lc, nil, config, state)</span>
 			txContext := core.NewEVMTxContext(msg)
 			vmenv := vm.NewEVM(context, txContext, state, config, vm.Config{NoBaseFee: true})
 			gp := new(core.GasPool).AddGas(math.MaxUint64)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-06f23af65ebb887b8b73bf95" role="button"
                   aria-expanded="false" aria-controls="id-06f23af65ebb887b8b73bf95">
                    <code>les/client.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/les/client.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/les/client.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+24</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-06f23af65ebb887b8b73bf95"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;client.go op-geth&#47;les&#47;client.go</span>
<span class="term-fg1">index 9ac85ecdac6fb5d2f41c88f13ad9e5fd37ae09c2..b40f1372bc1594fffb1ae84ed5fd804052b934d1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;client.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;client.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span> &#47;&#47; Package les implements the Light Ethereum Subprotocol.
 package les
&nbsp;
 import (
<span class="term-fg32">+	&quot;context&quot;</span>
 	&quot;fmt&quot;
 	&quot;strings&quot;
 	&quot;time&quot;
<span class="term-fg36">@@ -66,6 +67,9 @@</span> 	serverPool         *vfc.ServerPool
 	serverPoolIterator enode.Iterator
 	pruner             *pruner
 	merger             *consensus.Merger
<span class="term-fg32">+</span>
<span class="term-fg32">+	seqRPCService        *rpc.Client</span>
<span class="term-fg32">+	historicalRPCService *rpc.Client</span>
&nbsp;
 	bloomRequests chan chan *bloombits.Retrieval &#47;&#47; Channel receiving bloom data retrieval requests
 	bloomIndexer  *core.ChainIndexer             &#47;&#47; Bloom indexer operating during block imports
<span class="term-fg36">@@ -195,6 +199,26 @@</span> 	leth.handler = newClientHandler(config.UltraLightServers, config.UltraLightFraction, checkpoint, leth)
 	if leth.handler.ulc != nil {
 		log.Warn(&quot;Ultra light client is enabled&quot;, &quot;trustedNodes&quot;, len(leth.handler.ulc.keys), &quot;minTrustedFraction&quot;, leth.handler.ulc.fraction)
 		leth.blockchain.DisableCheckFreq()
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupSequencerHTTP != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupSequencerHTTP)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		leth.seqRPCService = client</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if config.RollupHistoricalRPC != &quot;&quot; {</span>
<span class="term-fg32">+		ctx, cancel := context.WithTimeout(context.Background(), config.RollupHistoricalRPCTimeout)</span>
<span class="term-fg32">+		client, err := rpc.DialContext(ctx, config.RollupHistoricalRPC)</span>
<span class="term-fg32">+		cancel()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		leth.historicalRPCService = client</span>
 	}
&nbsp;
 	leth.netRPCService = ethapi.NewNetAPI(leth.p2pServer, leth.config.NetworkId)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dfdd681cfd5d8582a7c77c81" role="button"
                   aria-expanded="false" aria-controls="id-dfdd681cfd5d8582a7c77c81">
                    <code>les/state_accessor.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/les/state_accessor.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/les/state_accessor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dfdd681cfd5d8582a7c77c81"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;state_accessor.go op-geth&#47;les&#47;state_accessor.go</span>
<span class="term-fg1">index 030d6b5a50044abe36d871f474c14a64c9eef77c..b6ba7f8f04322a9f714666a65b7e5ac1abb1beb1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;state_accessor.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;state_accessor.go</span>
<span class="term-fg36">@@ -62,7 +62,7 @@</span> 	for idx, tx := range block.Transactions() {
 		&#47;&#47; Assemble the transaction call message and return if the requested offset
 		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())
 		txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-		context := core.NewEVMBlockContext(block.Header(), leth.blockchain, nil)</span>
<span class="term-fg32">+		context := core.NewEVMBlockContext(block.Header(), leth.blockchain, nil, leth.blockchain.Config(), statedb)</span>
 		statedb.SetTxContext(tx.Hash(), idx)
 		if idx == txIndex {
 			return msg, context, statedb, release, nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b54ce0855910980cdca0183e" role="button"
                   aria-expanded="false" aria-controls="id-b54ce0855910980cdca0183e">
                    <code>les/api_backend.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/les/api_backend.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/les/api_backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b54ce0855910980cdca0183e"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;api_backend.go op-geth&#47;les&#47;api_backend.go</span>
<span class="term-fg1">index 4b0369845a5a24f8dd4beb74a322a9f41d4043c5..ce123dace711d1770da1b28bdac4146d2a7410fc 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;api_backend.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;api_backend.go</span>
<span class="term-fg36">@@ -189,7 +189,7 @@</span> 	if vmConfig == nil {
 		vmConfig = new(vm.Config)
 	}
 	txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-	context := core.NewEVMBlockContext(header, b.eth.blockchain, nil)</span>
<span class="term-fg32">+	context := core.NewEVMBlockContext(header, b.eth.blockchain, nil, b.eth.chainConfig, state)</span>
 	return vm.NewEVM(context, txContext, state, b.eth.chainConfig, *vmConfig), state.Error, nil
 }
&nbsp;
<span class="term-fg36">@@ -272,7 +272,7 @@</span> func (b *LesApiBackend) SuggestGasTipCap(ctx context.Context) (*big.Int, error) {
 	return b.gpo.SuggestTipCap(ctx)
 }
&nbsp;
<span class="term-fg31">-func (b *LesApiBackend) FeeHistory(ctx context.Context, blockCount int, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (firstBlock *big.Int, reward [][]*big.Int, baseFee []*big.Int, gasUsedRatio []float64, err error) {</span>
<span class="term-fg32">+func (b *LesApiBackend) FeeHistory(ctx context.Context, blockCount uint64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (firstBlock *big.Int, reward [][]*big.Int, baseFee []*big.Int, gasUsedRatio []float64, err error) {</span>
 	return b.gpo.FeeHistory(ctx, blockCount, lastBlock, rewardPercentiles)
 }
&nbsp;
<span class="term-fg36">@@ -333,3 +333,11 @@</span>
 func (b *LesApiBackend) StateAtTransaction(ctx context.Context, block *types.Block, txIndex int, reexec uint64) (*core.Message, vm.BlockContext, *state.StateDB, tracers.StateReleaseFunc, error) {
 	return b.eth.stateAtTransaction(ctx, block, txIndex, reexec)
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *LesApiBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.eth.historicalRPCService</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *LesApiBackend) Genesis() *types.Block {</span>
<span class="term-fg32">+	return b.eth.blockchain.Genesis()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-03e0f6e685ee0305b8aa4c04" role="button"
                   aria-expanded="false" aria-controls="id-03e0f6e685ee0305b8aa4c04">
                    <code>les/server_handler.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/les/server_handler.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/les/server_handler.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-03e0f6e685ee0305b8aa4c04"><span class="term-fg1">diff --git go-ethereum&#47;les&#47;server_handler.go op-geth&#47;les&#47;server_handler.go</span>
<span class="term-fg1">index 2ea496ac2c3a919f51c0d994d8b4809dc236e9d8..39c7ace1c906070ad8665eb8430dfb60f385a36a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;les&#47;server_handler.go</span>
<span class="term-fg1">+++ op-geth&#47;les&#47;server_handler.go</span>
<span class="term-fg36">@@ -364,7 +364,7 @@</span> 	trie, err := trie.New(trie.StateTrieID(root), triedb)
 	if err != nil {
 		return types.StateAccount{}, err
 	}
<span class="term-fg31">-	blob, err := trie.TryGet(hash[:])</span>
<span class="term-fg32">+	blob, err := trie.Get(hash[:])</span>
 	if err != nil {
 		return types.StateAccount{}, err
 	}</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-40f442d012c10b433fae7d7b"role="button" aria-expanded="false" aria-controls="id-40f442d012c10b433fae7d7b">
        
            <div class="col-12 col-sm-9 text-start"><h3>Daisy Chain tests</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+360</span></div>
                <div class="text-start"><span class="text-danger">-26</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-40f442d012c10b433fae7d7b">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-225a8b65159a8f081dced719" role="button"
                   aria-expanded="false" aria-controls="id-225a8b65159a8f081dced719">
                    <code>internal/ethapi/transaction_args_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/ethapi/transaction_args_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/ethapi/transaction_args_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-225a8b65159a8f081dced719"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;transaction_args_test.go op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">index 1b533861d5d6e3c3777ca8f0b9ce8121606ae121..37ccefe0145e02db0bbeabe2e7321ca5c2544ead 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg36">@@ -258,7 +258,7 @@</span> func (b *backendMock) ChainConfig() *params.ChainConfig { return b.config }
&nbsp;
 &#47;&#47; Other methods needed to implement Backend interface.
 func (b *backendMock) SyncProgress() ethereum.SyncProgress { return ethereum.SyncProgress{} }
<span class="term-fg31">-func (b *backendMock) FeeHistory(ctx context.Context, blockCount int, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error) {</span>
<span class="term-fg32">+func (b *backendMock) FeeHistory(ctx context.Context, blockCount uint64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error) {</span>
 	return nil, nil, nil, nil, nil
 }
 func (b *backendMock) ChainDb() ethdb.Database           { return nil }
<span class="term-fg36">@@ -342,4 +342,6 @@</span> func (b *backendMock) SubscribeRemovedLogsEvent(ch chan&lt;- core.RemovedLogsEvent) event.Subscription {
 	return nil
 }
&nbsp;
<span class="term-fg31">-func (b *backendMock) Engine() consensus.Engine { return nil }</span>
<span class="term-fg32">+func (b *backendMock) Engine() consensus.Engine          { return nil }</span>
<span class="term-fg32">+func (b *backendMock) HistoricalRPCService() *rpc.Client { return nil }</span>
<span class="term-fg32">+func (b *backendMock) Genesis() *types.Block             { return nil }</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5ec0abc08da36294123791a7" role="button"
                   aria-expanded="false" aria-controls="id-5ec0abc08da36294123791a7">
                    <code>ethclient/ethclient_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/ethclient/ethclient_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/ethclient/ethclient_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+151</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5ec0abc08da36294123791a7"><span class="term-fg1">diff --git go-ethereum&#47;ethclient&#47;ethclient_test.go op-geth&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg1">index 8bd8b0614c2d6f0fe37b5dd9c0a2da86f57d1892..c22446f6f3bd9a262957877ba2caa54ca1d80cb6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg1">+++ op-geth&#47;ethclient&#47;ethclient_test.go</span>
<span class="term-fg36">@@ -22,9 +22,14 @@</span> 	&quot;context&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
<span class="term-fg32">+	&quot;net&quot;</span>
<span class="term-fg32">+	&quot;net&#47;http&quot;</span>
 	&quot;reflect&quot;
 	&quot;testing&quot;
 	&quot;time&quot;
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -194,6 +199,14 @@</span> 	Timestamp: 9000,
 	BaseFee:   big.NewInt(params.InitialBaseFee),
 }
&nbsp;
<span class="term-fg32">+var genesisForHistorical = &amp;core.Genesis{</span>
<span class="term-fg32">+	Config:    params.OptimismTestConfig,</span>
<span class="term-fg32">+	Alloc:     core.GenesisAlloc{testAddr: {Balance: testBalance}},</span>
<span class="term-fg32">+	ExtraData: []byte(&quot;test genesis&quot;),</span>
<span class="term-fg32">+	Timestamp: 9000,</span>
<span class="term-fg32">+	BaseFee:   big.NewInt(params.InitialBaseFee),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 var testTx1 = types.MustSignNewTx(testKey, types.LatestSigner(genesis.Config), &amp;types.LegacyTx{
 	Nonce:    0,
 	Value:    big.NewInt(12),
<span class="term-fg36">@@ -210,9 +223,64 @@</span> 	Gas:      params.TxGas,
 	To:       &amp;common.Address{2},
 })
&nbsp;
<span class="term-fg31">-func newTestBackend(t *testing.T) (*node.Node, []*types.Block) {</span>
<span class="term-fg32">+type mockHistoricalBackend struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) Call(ctx context.Context, args ethapi.TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *ethapi.StateOverride) (hexutil.Bytes, error) {</span>
<span class="term-fg32">+	num, ok := blockNrOrHash.Number()</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 1 {</span>
<span class="term-fg32">+		return hexutil.Bytes(&quot;test&quot;), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) EstimateGas(ctx context.Context, args ethapi.TransactionArgs, blockNrOrHash *rpc.BlockNumberOrHash) (hexutil.Uint64, error) {</span>
<span class="term-fg32">+	num, ok := blockNrOrHash.Number()</span>
<span class="term-fg32">+	if ok &amp;&amp; num == 1 {</span>
<span class="term-fg32">+		return hexutil.Uint64(12345), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return 0, ethereum.NotFound</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newMockHistoricalBackend(t *testing.T) string {</span>
<span class="term-fg32">+	s := rpc.NewServer()</span>
<span class="term-fg32">+	err := node.RegisterApis([]rpc.API{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			Namespace:     &quot;eth&quot;,</span>
<span class="term-fg32">+			Service:       new(mockHistoricalBackend),</span>
<span class="term-fg32">+			Public:        true,</span>
<span class="term-fg32">+			Authenticated: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}, nil, s)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	hdlr := node.NewHTTPHandlerStack(s, []string{&quot;*&quot;}, []string{&quot;*&quot;}, nil)</span>
<span class="term-fg32">+	mux := http.NewServeMux()</span>
<span class="term-fg32">+	mux.Handle(&quot;&#47;&quot;, hdlr)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	listener, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:0&quot;)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend listener: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	go func() {</span>
<span class="term-fg32">+		httpS := &amp;http.Server{Handler: mux}</span>
<span class="term-fg32">+		httpS.Serve(listener)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Cleanup(func() {</span>
<span class="term-fg32">+			httpS.Shutdown(context.Background())</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;http:&#47;&#47;%s&quot;, listener.Addr().String())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newTestBackend(t *testing.T, enableHistoricalState bool) (*node.Node, []*types.Block) {</span>
<span class="term-fg32">+	histAddr := newMockHistoricalBackend(t)</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Generate test chain.
<span class="term-fg31">-	blocks := generateTestChain()</span>
<span class="term-fg32">+	blocks := generateTestChain(enableHistoricalState)</span>
&nbsp;
 	&#47;&#47; Create node
 	n, err := node.New(&amp;node.Config{})
<span class="term-fg36">@@ -220,8 +288,18 @@</span> 	if err != nil {
 		t.Fatalf(&quot;can&#39;t create new node: %v&quot;, err)
 	}
 	&#47;&#47; Create Ethereum Service
<span class="term-fg31">-	config := &amp;ethconfig.Config{Genesis: genesis}</span>
<span class="term-fg32">+	var actualGenesis *core.Genesis</span>
<span class="term-fg32">+	if enableHistoricalState {</span>
<span class="term-fg32">+		actualGenesis = genesisForHistorical</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		actualGenesis = genesis</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	config := &amp;ethconfig.Config{Genesis: actualGenesis}</span>
 	config.Ethash.PowMode = ethash.ModeFake
<span class="term-fg32">+	if enableHistoricalState {</span>
<span class="term-fg32">+		config.RollupHistoricalRPC = histAddr</span>
<span class="term-fg32">+		config.RollupHistoricalRPCTimeout = time.Second * 5</span>
<span class="term-fg32">+	}</span>
 	ethservice, err := eth.New(n, config)
 	if err != nil {
 		t.Fatalf(&quot;can&#39;t create new ethereum service: %v&quot;, err)
<span class="term-fg36">@@ -236,7 +314,7 @@</span> 	}
 	return n, blocks
 }
&nbsp;
<span class="term-fg31">-func generateTestChain() []*types.Block {</span>
<span class="term-fg32">+func generateTestChain(enableHistoricalState bool) []*types.Block {</span>
 	generate := func(i int, g *core.BlockGen) {
 		g.OffsetTime(5)
 		g.SetExtra([]byte(&quot;test&quot;))
<span class="term-fg36">@@ -246,12 +324,27 @@</span> 			g.AddTx(testTx1)
 			g.AddTx(testTx2)
 		}
 	}
<span class="term-fg31">-	_, blocks, _ := core.GenerateChainWithGenesis(genesis, ethash.NewFaker(), 2, generate)</span>
<span class="term-fg31">-	return append([]*types.Block{genesis.ToBlock()}, blocks...)</span>
<span class="term-fg32">+	var actualGenesis *core.Genesis</span>
<span class="term-fg32">+	if enableHistoricalState {</span>
<span class="term-fg32">+		actualGenesis = genesisForHistorical</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		actualGenesis = genesis</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	_, blocks, _ := core.GenerateChainWithGenesis(actualGenesis, ethash.NewFaker(), 2, generate)</span>
<span class="term-fg32">+	return append([]*types.Block{actualGenesis.ToBlock()}, blocks...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestEthClientHistoricalBackend(t *testing.T) {</span>
<span class="term-fg32">+	backend, _ := newTestBackend(t, true)</span>
<span class="term-fg32">+	client, _ := backend.Attach()</span>
<span class="term-fg32">+	defer backend.Close()</span>
<span class="term-fg32">+	defer client.Close()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	testHistoricalRPC(t, client)</span>
 }
&nbsp;
 func TestEthClient(t *testing.T) {
<span class="term-fg31">-	backend, chain := newTestBackend(t)</span>
<span class="term-fg32">+	backend, chain := newTestBackend(t, false)</span>
 	client, _ := backend.Attach()
 	defer backend.Close()
 	defer client.Close()
<span class="term-fg36">@@ -288,6 +381,9 @@</span> 			func(t *testing.T) { testAtFunctions(t, client) },
 		},
 		&quot;TransactionSender&quot;: {
 			func(t *testing.T) { testTransactionSender(t, client) },
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&quot;EstimateGas&quot;: {</span>
<span class="term-fg32">+			func(t *testing.T) { testEstimateGas(t, client) },</span>
 		},
 	}
&nbsp;
<span class="term-fg36">@@ -684,6 +780,54 @@</span> 		t.Fatal(err)
 	}
 	if sender2 != testAddr {
 		t.Fatal(&quot;wrong sender:&quot;, sender2)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func testEstimateGas(t *testing.T, client *rpc.Client) {</span>
<span class="term-fg32">+	ec := NewClient(client)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; EstimateGas</span>
<span class="term-fg32">+	msg := ethereum.CallMsg{</span>
<span class="term-fg32">+		From:  testAddr,</span>
<span class="term-fg32">+		To:    &amp;common.Address{},</span>
<span class="term-fg32">+		Gas:   21000,</span>
<span class="term-fg32">+		Value: big.NewInt(1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	gas, err := ec.EstimateGas(context.Background(), msg)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if gas != 21000 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected gas price: %v&quot;, gas)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func testHistoricalRPC(t *testing.T, client *rpc.Client) {</span>
<span class="term-fg32">+	ec := NewClient(client)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Estimate Gas RPC</span>
<span class="term-fg32">+	msg := ethereum.CallMsg{</span>
<span class="term-fg32">+		From:  testAddr,</span>
<span class="term-fg32">+		To:    &amp;common.Address{},</span>
<span class="term-fg32">+		Gas:   21000,</span>
<span class="term-fg32">+		Value: big.NewInt(1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var res hexutil.Uint64</span>
<span class="term-fg32">+	err := client.CallContext(context.Background(), &amp;res, &quot;eth_estimateGas&quot;, toCallArg(msg), rpc.BlockNumberOrHashWithNumber(1))</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if res != 12345 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;invalid result: %d&quot;, res)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Call Contract RPC</span>
<span class="term-fg32">+	histVal, err := ec.CallContract(context.Background(), msg, big.NewInt(1))</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;unexpected error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if string(histVal) != &quot;test&quot; {</span>
<span class="term-fg32">+		t.Fatalf(&quot;expected %s to equal test&quot;, string(histVal))</span>
 	}
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a4dcb6b380a3235c881a2ac" role="button"
                   aria-expanded="false" aria-controls="id-9a4dcb6b380a3235c881a2ac">
                    <code>eth/tracers/api_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/api_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+205</span></div>
                        <div class="text-start"><span class="text-danger">-17</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a4dcb6b380a3235c881a2ac"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;api_test.go op-geth&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">index b1eaf60b16c44e158f335248749b5b067fa23c44..02649a10a9b64a80be0b666a0c165e9430b24c8c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg36">@@ -24,12 +24,15 @@</span> 	&quot;encoding&#47;json&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
<span class="term-fg32">+	&quot;net&quot;</span>
<span class="term-fg32">+	&quot;net&#47;http&quot;</span>
 	&quot;reflect&quot;
 	&quot;sort&quot;
 	&quot;sync&#47;atomic&quot;
 	&quot;testing&quot;
 	&quot;time&quot;
&nbsp;
<span class="term-fg32">+	&quot;github.com&#47;davecgh&#47;go-spew&#47;spew&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
<span class="term-fg36">@@ -43,15 +46,78 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&#47;logger&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;node&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;mock&quot;</span>
 )
&nbsp;
 var (
<span class="term-fg31">-	errStateNotFound = errors.New(&quot;state not found&quot;)</span>
<span class="term-fg31">-	errBlockNotFound = errors.New(&quot;block not found&quot;)</span>
<span class="term-fg32">+	errStateNotFound       = errors.New(&quot;state not found&quot;)</span>
<span class="term-fg32">+	errBlockNotFound       = errors.New(&quot;block not found&quot;)</span>
<span class="term-fg32">+	errTransactionNotFound = errors.New(&quot;transaction not found&quot;)</span>
 )
&nbsp;
<span class="term-fg32">+type mockHistoricalBackend struct {</span>
<span class="term-fg32">+	mock.Mock</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; mockHistoricalBackend does not have a TraceCall, because pre-bedrock there is no debug_traceCall available</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceBlockByNumber(ctx context.Context, number rpc.BlockNumber, config *TraceConfig) ([]*txTraceResult, error) {</span>
<span class="term-fg32">+	ret := m.Mock.MethodCalled(&quot;TraceBlockByNumber&quot;, number, config)</span>
<span class="term-fg32">+	return ret[0].([]*txTraceResult), *ret[1].(*error)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) ExpectTraceBlockByNumber(number rpc.BlockNumber, config *TraceConfig, out []*txTraceResult, err error) {</span>
<span class="term-fg32">+	m.Mock.On(&quot;TraceBlockByNumber&quot;, number, config).Once().Return(out, &amp;err)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) TraceTransaction(ctx context.Context, hash common.Hash, config *TraceConfig) (interface{}, error) {</span>
<span class="term-fg32">+	ret := m.Mock.MethodCalled(&quot;TraceTransaction&quot;, hash, config)</span>
<span class="term-fg32">+	return ret[0], *ret[1].(*error)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (m *mockHistoricalBackend) ExpectTraceTransaction(hash common.Hash, config *TraceConfig, out interface{}, err error) {</span>
<span class="term-fg32">+	jsonOut, _ := json.Marshal(out)</span>
<span class="term-fg32">+	m.Mock.On(&quot;TraceTransaction&quot;, hash, config).Once().Return(json.RawMessage(jsonOut), &amp;err)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newMockHistoricalBackend(t *testing.T, backend *mockHistoricalBackend) string {</span>
<span class="term-fg32">+	s := rpc.NewServer()</span>
<span class="term-fg32">+	err := node.RegisterApis([]rpc.API{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			Namespace:     &quot;debug&quot;,</span>
<span class="term-fg32">+			Service:       backend,</span>
<span class="term-fg32">+			Public:        true,</span>
<span class="term-fg32">+			Authenticated: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}, nil, s)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	hdlr := node.NewHTTPHandlerStack(s, []string{&quot;*&quot;}, []string{&quot;*&quot;}, nil)</span>
<span class="term-fg32">+	mux := http.NewServeMux()</span>
<span class="term-fg32">+	mux.Handle(&quot;&#47;&quot;, hdlr)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	listener, err := net.Listen(&quot;tcp&quot;, &quot;127.0.0.1:0&quot;)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error creating mock historical backend listener: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	go func() {</span>
<span class="term-fg32">+		httpS := &amp;http.Server{Handler: mux}</span>
<span class="term-fg32">+		httpS.Serve(listener)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Cleanup(func() {</span>
<span class="term-fg32">+			httpS.Shutdown(context.Background())</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return fmt.Sprintf(&quot;http:&#47;&#47;%s&quot;, listener.Addr().String())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 type testBackend struct {
 	chainConfig *params.ChainConfig
 	engine      consensus.Engine
<span class="term-fg36">@@ -60,15 +126,28 @@</span> 	chain       *core.BlockChain
&nbsp;
 	refHook func() &#47;&#47; Hook is invoked when the requested state is referenced
 	relHook func() &#47;&#47; Hook is invoked when the requested state is released
<span class="term-fg32">+</span>
<span class="term-fg32">+	historical     *rpc.Client</span>
<span class="term-fg32">+	mockHistorical *mockHistoricalBackend</span>
 }
&nbsp;
 &#47;&#47; testBackend creates a new test backend. OBS: After test is done, teardown must be
 &#47;&#47; invoked in order to release associated resources.
 func newTestBackend(t *testing.T, n int, gspec *core.Genesis, generator func(i int, b *core.BlockGen)) *testBackend {
<span class="term-fg32">+	mock := new(mockHistoricalBackend)</span>
<span class="term-fg32">+	historicalAddr := newMockHistoricalBackend(t, mock)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	historicalClient, err := rpc.Dial(historicalAddr)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;error making historical client: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	backend := &amp;testBackend{
<span class="term-fg31">-		chainConfig: gspec.Config,</span>
<span class="term-fg31">-		engine:      ethash.NewFaker(),</span>
<span class="term-fg31">-		chaindb:     rawdb.NewMemoryDatabase(),</span>
<span class="term-fg32">+		chainConfig:    gspec.Config,</span>
<span class="term-fg32">+		engine:         ethash.NewFaker(),</span>
<span class="term-fg32">+		chaindb:        rawdb.NewMemoryDatabase(),</span>
<span class="term-fg32">+		historical:     historicalClient,</span>
<span class="term-fg32">+		mockHistorical: mock,</span>
 	}
 	&#47;&#47; Generate blocks for testing
 	_, blocks, _ := core.GenerateChainWithGenesis(gspec, backend.engine, n, generator)
<span class="term-fg36">@@ -116,6 +195,9 @@</span> }
&nbsp;
 func (b *testBackend) GetTransaction(ctx context.Context, txHash common.Hash) (*types.Transaction, common.Hash, uint64, uint64, error) {
 	tx, hash, blockNumber, index := rawdb.ReadTransaction(b.chaindb, txHash)
<span class="term-fg32">+	if tx == nil {</span>
<span class="term-fg32">+		return nil, common.Hash{}, 0, 0, errTransactionNotFound</span>
<span class="term-fg32">+	}</span>
 	return tx, hash, blockNumber, index, nil
 }
&nbsp;
<span class="term-fg36">@@ -173,7 +255,7 @@</span> 	signer := types.MakeSigner(b.chainConfig, block.Number())
 	for idx, tx := range block.Transactions() {
 		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())
 		txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-		context := core.NewEVMBlockContext(block.Header(), b.chain, nil)</span>
<span class="term-fg32">+		context := core.NewEVMBlockContext(block.Header(), b.chain, nil, b.chainConfig, statedb)</span>
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}
<span class="term-fg36">@@ -184,6 +266,10 @@</span> 		}
 		statedb.Finalise(vmenv.ChainConfig().IsEIP158(block.Number()))
 	}
 	return nil, vm.BlockContext{}, nil, nil, fmt.Errorf(&quot;transaction index %d out of range for block %#x&quot;, txIndex, block.Hash())
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *testBackend) HistoricalRPCService() *rpc.Client {</span>
<span class="term-fg32">+	return b.historical</span>
 }
&nbsp;
 func TestTraceCall(t *testing.T) {
<span class="term-fg36">@@ -361,11 +447,58 @@</span> 		StructLogs:  []logger.StructLogRes{},
 	}) {
 		t.Error(&quot;Transaction tracing result is different&quot;)
 	}
<span class="term-fg32">+}</span>
<span class="term-fg32">+func TestTraceTransactionHistorical(t *testing.T) {</span>
<span class="term-fg32">+	t.Parallel()</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; Test non-existent transaction</span>
<span class="term-fg31">-	_, err = api.TraceTransaction(context.Background(), common.Hash{42}, nil)</span>
<span class="term-fg31">-	if !errors.Is(err, errTxNotFound) {</span>
<span class="term-fg31">-		t.Fatalf(&quot;want %v, have %v&quot;, errTxNotFound, err)</span>
<span class="term-fg32">+	&#47;&#47; Initialize test accounts</span>
<span class="term-fg32">+	accounts := newAccounts(2)</span>
<span class="term-fg32">+	genesis := &amp;core.Genesis{</span>
<span class="term-fg32">+		Config: params.OptimismTestConfig,</span>
<span class="term-fg32">+		Alloc: core.GenesisAlloc{</span>
<span class="term-fg32">+			accounts[0].addr: {Balance: big.NewInt(params.Ether)},</span>
<span class="term-fg32">+			accounts[1].addr: {Balance: big.NewInt(params.Ether)},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	target := common.Hash{}</span>
<span class="term-fg32">+	signer := types.HomesteadSigner{}</span>
<span class="term-fg32">+	backend := newTestBackend(t, 1, genesis, func(i int, b *core.BlockGen) {</span>
<span class="term-fg32">+		&#47;&#47; Transfer from account[0] to account[1]</span>
<span class="term-fg32">+		&#47;&#47;    value: 1000 wei</span>
<span class="term-fg32">+		&#47;&#47;    fee:   0 wei</span>
<span class="term-fg32">+		tx, _ := types.SignTx(types.NewTransaction(uint64(i), accounts[1].addr, big.NewInt(1000), params.TxGas, b.BaseFee(), nil), signer, accounts[0].key)</span>
<span class="term-fg32">+		b.AddTx(tx)</span>
<span class="term-fg32">+		target = tx.Hash()</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	defer backend.mockHistorical.AssertExpectations(t)</span>
<span class="term-fg32">+	defer backend.chain.Stop()</span>
<span class="term-fg32">+	backend.mockHistorical.ExpectTraceTransaction(</span>
<span class="term-fg32">+		target,</span>
<span class="term-fg32">+		nil,</span>
<span class="term-fg32">+		logger.ExecutionResult{</span>
<span class="term-fg32">+			Gas:         params.TxGas,</span>
<span class="term-fg32">+			Failed:      false,</span>
<span class="term-fg32">+			ReturnValue: &quot;&quot;,</span>
<span class="term-fg32">+			StructLogs:  []logger.StructLogRes{},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		nil)</span>
<span class="term-fg32">+	api := NewAPI(backend)</span>
<span class="term-fg32">+	result, err := api.TraceTransaction(context.Background(), target, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Errorf(&quot;Failed to trace transaction %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var have *logger.ExecutionResult</span>
<span class="term-fg32">+	spew.Dump(result)</span>
<span class="term-fg32">+	if err := json.Unmarshal(result.(json.RawMessage), &amp;have); err != nil {</span>
<span class="term-fg32">+		t.Errorf(&quot;failed to unmarshal result %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if !reflect.DeepEqual(have, &amp;logger.ExecutionResult{</span>
<span class="term-fg32">+		Gas:         params.TxGas,</span>
<span class="term-fg32">+		Failed:      false,</span>
<span class="term-fg32">+		ReturnValue: &quot;&quot;,</span>
<span class="term-fg32">+		StructLogs:  []logger.StructLogRes{},</span>
<span class="term-fg32">+	}) {</span>
<span class="term-fg32">+		t.Error(&quot;Transaction tracing result is different&quot;)</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -447,6 +580,59 @@</span> 		want := tc.want
 		if string(have) != want {
 			t.Errorf(&quot;test %d, result mismatch, have\n%v\n, want\n%v\n&quot;, i, string(have), want)
 		}
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestTraceBlockHistorical(t *testing.T) {</span>
<span class="term-fg32">+	t.Parallel()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Initialize test accounts</span>
<span class="term-fg32">+	accounts := newAccounts(3)</span>
<span class="term-fg32">+	genesis := &amp;core.Genesis{</span>
<span class="term-fg32">+		Config: params.OptimismTestConfig,</span>
<span class="term-fg32">+		Alloc: core.GenesisAlloc{</span>
<span class="term-fg32">+			accounts[0].addr: {Balance: big.NewInt(params.Ether)},</span>
<span class="term-fg32">+			accounts[1].addr: {Balance: big.NewInt(params.Ether)},</span>
<span class="term-fg32">+			accounts[2].addr: {Balance: big.NewInt(params.Ether)},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	genBlocks := 10</span>
<span class="term-fg32">+	signer := types.HomesteadSigner{}</span>
<span class="term-fg32">+	backend := newTestBackend(t, genBlocks, genesis, func(i int, b *core.BlockGen) {</span>
<span class="term-fg32">+		&#47;&#47; Transfer from account[0] to account[1]</span>
<span class="term-fg32">+		&#47;&#47;    value: 1000 wei</span>
<span class="term-fg32">+		&#47;&#47;    fee:   0 wei</span>
<span class="term-fg32">+		tx, _ := types.SignTx(types.NewTransaction(uint64(i), accounts[1].addr, big.NewInt(1000), params.TxGas, b.BaseFee(), nil), signer, accounts[0].key)</span>
<span class="term-fg32">+		b.AddTx(tx)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	defer backend.mockHistorical.AssertExpectations(t)</span>
<span class="term-fg32">+	defer backend.chain.Stop()</span>
<span class="term-fg32">+	api := NewAPI(backend)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var expectErr error</span>
<span class="term-fg32">+	var config *TraceConfig</span>
<span class="term-fg32">+	blockNumber := rpc.BlockNumber(3)</span>
<span class="term-fg32">+	want := `[{&quot;result&quot;:{&quot;failed&quot;:false,&quot;gas&quot;:21000,&quot;returnValue&quot;:&quot;&quot;,&quot;structLogs&quot;:[]}}]`</span>
<span class="term-fg32">+	var ret []*txTraceResult</span>
<span class="term-fg32">+	_ = json.Unmarshal([]byte(want), &amp;ret)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	backend.mockHistorical.ExpectTraceBlockByNumber(blockNumber, config, ret, nil)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	result, err := api.TraceBlockByNumber(context.Background(), blockNumber, config)</span>
<span class="term-fg32">+	if expectErr != nil {</span>
<span class="term-fg32">+		if err == nil {</span>
<span class="term-fg32">+			t.Errorf(&quot;want error %v&quot;, expectErr)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if !reflect.DeepEqual(err, expectErr) {</span>
<span class="term-fg32">+			t.Errorf(&quot;error mismatch, want %v, get %v&quot;, expectErr, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Errorf(&quot;want no error, have %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	have, _ := json.Marshal(result)</span>
<span class="term-fg32">+	if string(have) != want {</span>
<span class="term-fg32">+		t.Errorf(&quot;result mismatch, have\n%v\n, want\n%v\n&quot;, string(have), want)</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -835,8 +1021,8 @@</span> 	genBlocks := 50
 	signer := types.HomesteadSigner{}
&nbsp;
 	var (
<span class="term-fg31">-		ref   uint32 &#47;&#47; total refs has made</span>
<span class="term-fg31">-		rel   uint32 &#47;&#47; total rels has made</span>
<span class="term-fg32">+		ref   atomic.Uint32 &#47;&#47; total refs has made</span>
<span class="term-fg32">+		rel   atomic.Uint32 &#47;&#47; total rels has made</span>
 		nonce uint64
 	)
 	backend := newTestBackend(t, genBlocks, genesis, func(i int, b *core.BlockGen) {
<span class="term-fg36">@@ -849,8 +1035,8 @@</span> 			b.AddTx(tx)
 			nonce += 1
 		}
 	})
<span class="term-fg31">-	backend.refHook = func() { atomic.AddUint32(&amp;ref, 1) }</span>
<span class="term-fg31">-	backend.relHook = func() { atomic.AddUint32(&amp;rel, 1) }</span>
<span class="term-fg32">+	backend.refHook = func() { ref.Add(1) }</span>
<span class="term-fg32">+	backend.relHook = func() { rel.Add(1) }</span>
 	api := NewAPI(backend)
&nbsp;
 	single := `{&quot;result&quot;:{&quot;gas&quot;:21000,&quot;failed&quot;:false,&quot;returnValue&quot;:&quot;&quot;,&quot;structLogs&quot;:[]}}`
<span class="term-fg36">@@ -863,7 +1049,8 @@</span> 		{0, 50, nil},  &#47;&#47; the entire chain range, blocks [1, 50]
 		{10, 20, nil}, &#47;&#47; the middle chain range, blocks [11, 20]
 	}
 	for _, c := range cases {
<span class="term-fg31">-		ref, rel = 0, 0 &#47;&#47; clean up the counters</span>
<span class="term-fg32">+		ref.Store(0)</span>
<span class="term-fg32">+		rel.Store(0)</span>
&nbsp;
 		from, _ := api.blockByNumber(context.Background(), rpc.BlockNumber(c.start))
 		to, _ := api.blockByNumber(context.Background(), rpc.BlockNumber(c.end))
<span class="term-fg36">@@ -888,8 +1075,9 @@</span> 		}
 		if next != c.end+1 {
 			t.Error(&quot;Missing tracing block&quot;)
 		}
<span class="term-fg31">-		if ref != rel {</span>
<span class="term-fg31">-			t.Errorf(&quot;Ref and deref actions are not equal, ref %d rel %d&quot;, ref, rel)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		if nref, nrel := ref.Load(), rel.Load(); nref != nrel {</span>
<span class="term-fg32">+			t.Errorf(&quot;Ref and deref actions are not equal, ref %d rel %d&quot;, nref, nrel)</span>
 		}
 	}
 }</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-bd924dc4c4d58831f405e176"role="button" aria-expanded="false" aria-controls="id-bd924dc4c4d58831f405e176">
        
            <div class="col-12 col-sm-9 text-start"><h2>Geth extras</h2></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+288</span></div>
                <div class="text-start"><span class="text-danger">-20</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-bd924dc4c4d58831f405e176">
        <div><p>Extend the tools available in geth to improve external testing and tooling.</p>
</div>
        <div>
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-c4ee47879424cb25ea3bd2f3"role="button" aria-expanded="false" aria-controls="id-c4ee47879424cb25ea3bd2f3">
        
            <div class="col-12 col-sm-9 text-start"><h3>Simulated Backend</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+90</span></div>
                <div class="text-start"><span class="text-danger">-19</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-c4ee47879424cb25ea3bd2f3">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b0e3505963323079765664d" role="button"
                   aria-expanded="false" aria-controls="id-7b0e3505963323079765664d">
                    <code>accounts/abi/bind/backends/simulated.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/accounts/abi/bind/backends/simulated.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/accounts/abi/bind/backends/simulated.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+90</span></div>
                        <div class="text-start"><span class="text-danger">-19</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b0e3505963323079765664d"><span class="term-fg1">diff --git go-ethereum&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go op-geth&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg1">index 3d5259b894dff183006f0afb1f7161b8a9c1f7b6..b2892e3cb1932e234aa0919f7703ada91eaf349c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg1">+++ op-geth&#47;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go</span>
<span class="term-fg36">@@ -30,6 +30,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&#47;bind&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;ethash&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;bloombits&quot;
<span class="term-fg36">@@ -63,6 +64,8 @@</span> type SimulatedBackend struct {
 	database   ethdb.Database   &#47;&#47; In memory database to store our testing data
 	blockchain *core.BlockChain &#47;&#47; Ethereum blockchain to handle the consensus
&nbsp;
<span class="term-fg32">+	consensus consensus.Engine</span>
<span class="term-fg32">+</span>
 	mu              sync.Mutex
 	pendingBlock    *types.Block   &#47;&#47; Currently pending block that will be imported on request
 	pendingState    *state.StateDB &#47;&#47; Currently pending state that will be the active on request
<span class="term-fg36">@@ -78,20 +81,93 @@</span> &#47;&#47; NewSimulatedBackendWithDatabase creates a new binding backend based on the given database
 &#47;&#47; and uses a simulated blockchain for testing purposes.
 &#47;&#47; A simulated backend always uses chainID 1337.
 func NewSimulatedBackendWithDatabase(database ethdb.Database, alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {
<span class="term-fg31">-	genesis := core.Genesis{</span>
<span class="term-fg31">-		Config:   params.AllEthashProtocolChanges,</span>
<span class="term-fg31">-		GasLimit: gasLimit,</span>
<span class="term-fg31">-		Alloc:    alloc,</span>
<span class="term-fg32">+	return NewSimulatedBackendWithOpts(WithDatabase(database), WithAlloc(alloc), WithGasLimit(gasLimit))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewSimulatedBackend creates a new binding backend using a simulated blockchain</span>
<span class="term-fg32">+&#47;&#47; for testing purposes.</span>
<span class="term-fg32">+&#47;&#47; A simulated backend always uses chainID 1337.</span>
<span class="term-fg32">+func NewSimulatedBackend(alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {</span>
<span class="term-fg32">+	return NewSimulatedBackendWithOpts(WithGasLimit(gasLimit), WithAlloc(alloc))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type simulatedBackendConfig struct {</span>
<span class="term-fg32">+	genesis     core.Genesis</span>
<span class="term-fg32">+	cacheConfig *core.CacheConfig</span>
<span class="term-fg32">+	database    ethdb.Database</span>
<span class="term-fg32">+	vmConfig    vm.Config</span>
<span class="term-fg32">+	consensus   consensus.Engine</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type SimulatedBackendOpt func(s *simulatedBackendConfig)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithDatabase(database ethdb.Database) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.database = database</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithGasLimit(gasLimit uint64) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis.GasLimit = gasLimit</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithAlloc(alloc core.GenesisAlloc) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis.Alloc = alloc</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithCacheConfig(cacheConfig *core.CacheConfig) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.cacheConfig = cacheConfig</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithGenesis(genesis core.Genesis) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.genesis = genesis</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithVMConfig(vmConfig vm.Config) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.vmConfig = vmConfig</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func WithConsensus(consensus consensus.Engine) SimulatedBackendOpt {</span>
<span class="term-fg32">+	return func(s *simulatedBackendConfig) {</span>
<span class="term-fg32">+		s.consensus = consensus</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewSimulatedBackendWithOpts creates a new binding backend based on the given database</span>
<span class="term-fg32">+&#47;&#47; and uses a simulated blockchain for testing purposes. It exposes additional configuration</span>
<span class="term-fg32">+&#47;&#47; options that are useful to</span>
<span class="term-fg32">+func NewSimulatedBackendWithOpts(opts ...SimulatedBackendOpt) *SimulatedBackend {</span>
<span class="term-fg32">+	config := &amp;simulatedBackendConfig{</span>
<span class="term-fg32">+		genesis:   core.Genesis{Config: params.AllEthashProtocolChanges, GasLimit: 100000000, Alloc: make(core.GenesisAlloc)},</span>
<span class="term-fg32">+		database:  rawdb.NewMemoryDatabase(),</span>
<span class="term-fg32">+		consensus: ethash.NewFaker(),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for _, opt := range opts {</span>
<span class="term-fg32">+		opt(config)</span>
 	}
<span class="term-fg31">-	blockchain, _ := core.NewBlockChain(database, nil, &amp;genesis, nil, ethash.NewFaker(), vm.Config{}, nil, nil)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	config.genesis.MustCommit(config.database)</span>
<span class="term-fg32">+	blockchain, _ := core.NewBlockChain(config.database, config.cacheConfig, &amp;config.genesis, nil, config.consensus, config.vmConfig, nil, nil)</span>
&nbsp;
 	backend := &amp;SimulatedBackend{
<span class="term-fg31">-		database:   database,</span>
<span class="term-fg32">+		database:   config.database,</span>
 		blockchain: blockchain,
<span class="term-fg31">-		config:     genesis.Config,</span>
<span class="term-fg32">+		config:     config.genesis.Config,</span>
<span class="term-fg32">+		consensus:  config.consensus,</span>
 	}
&nbsp;
<span class="term-fg31">-	filterBackend := &amp;filterBackend{database, blockchain, backend}</span>
<span class="term-fg32">+	filterBackend := &amp;filterBackend{config.database, blockchain, backend}</span>
 	backend.filterSystem = filters.NewFilterSystem(filterBackend, filters.Config{})
 	backend.events = filters.NewEventSystem(backend.filterSystem, false)
&nbsp;
<span class="term-fg36">@@ -102,13 +178,6 @@</span> 	backend.rollback(block)
 	return backend
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; NewSimulatedBackend creates a new binding backend using a simulated blockchain</span>
<span class="term-fg31">-&#47;&#47; for testing purposes.</span>
<span class="term-fg31">-&#47;&#47; A simulated backend always uses chainID 1337.</span>
<span class="term-fg31">-func NewSimulatedBackend(alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {</span>
<span class="term-fg31">-	return NewSimulatedBackendWithDatabase(rawdb.NewMemoryDatabase(), alloc, gasLimit)</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
 &#47;&#47; Close terminates the underlying blockchain&#39;s update loop.
 func (b *SimulatedBackend) Close() error {
 	b.blockchain.Stop()
<span class="term-fg36">@@ -124,6 +193,8 @@</span>
 	if _, err := b.blockchain.InsertChain([]*types.Block{b.pendingBlock}); err != nil {
 		panic(err) &#47;&#47; This cannot happen unless the simulator is wrong, fail in that case
 	}
<span class="term-fg32">+	&#47;&#47; Don&#39;t wait for the async tx indexing</span>
<span class="term-fg32">+	rawdb.WriteTxLookupEntriesByBlock(b.database, b.pendingBlock)</span>
 	blockHash := b.pendingBlock.Hash()
&nbsp;
 	&#47;&#47; Using the last inserted block here makes it possible to build on a side
<span class="term-fg36">@@ -145,7 +216,7 @@</span> 	b.rollback(block)
 }
&nbsp;
 func (b *SimulatedBackend) rollback(parent *types.Block) {
<span class="term-fg31">-	blocks, _ := core.GenerateChain(b.config, parent, ethash.NewFaker(), b.database, 1, func(int, *core.BlockGen) {})</span>
<span class="term-fg32">+	blocks, _ := core.GenerateChain(b.config, parent, b.consensus, b.database, 1, func(int, *core.BlockGen) {})</span>
&nbsp;
 	b.pendingBlock = blocks[0]
 	b.pendingState, _ = state.New(b.pendingBlock.Root(), b.blockchain.StateCache(), nil)
<span class="term-fg36">@@ -666,7 +737,7 @@</span>
 	&#47;&#47; Create a new environment which holds all relevant information
 	&#47;&#47; about the transaction and calling mechanisms.
 	txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-	evmContext := core.NewEVMBlockContext(header, b.blockchain, nil)</span>
<span class="term-fg32">+	evmContext := core.NewEVMBlockContext(header, b.blockchain, nil, b.config, stateDB)</span>
 	vmEnv := vm.NewEVM(evmContext, txContext, stateDB, b.config, vm.Config{NoBaseFee: true})
 	gasPool := new(core.GasPool).AddGas(math.MaxUint64)
&nbsp;
<span class="term-fg36">@@ -694,7 +765,7 @@</span> 	if tx.Nonce() != nonce {
 		return fmt.Errorf(&quot;invalid transaction nonce: got %d, want %d&quot;, tx.Nonce(), nonce)
 	}
 	&#47;&#47; Include tx in chain
<span class="term-fg31">-	blocks, receipts := core.GenerateChain(b.config, block, ethash.NewFaker(), b.database, 1, func(number int, block *core.BlockGen) {</span>
<span class="term-fg32">+	blocks, receipts := core.GenerateChain(b.config, block, b.consensus, b.database, 1, func(number int, block *core.BlockGen) {</span>
 		for _, tx := range b.pendingBlock.Transactions() {
 			block.AddTxWithChain(b.blockchain, tx)
 		}
<span class="term-fg36">@@ -818,7 +889,7 @@</span> 	if block == nil {
 		return fmt.Errorf(&quot;could not find parent&quot;)
 	}
&nbsp;
<span class="term-fg31">-	blocks, _ := core.GenerateChain(b.config, block, ethash.NewFaker(), b.database, 1, func(number int, block *core.BlockGen) {</span>
<span class="term-fg32">+	blocks, _ := core.GenerateChain(b.config, block, b.consensus, b.database, 1, func(number int, block *core.BlockGen) {</span>
 		block.OffsetTime(int64(adjustment.Seconds()))
 	})
 	stateDB, _ := b.blockchain.State()</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a539bc4656930936072c68c3"role="button" aria-expanded="false" aria-controls="id-a539bc4656930936072c68c3">
        
            <div class="col-12 col-sm-9 text-start"><h3>diff-included testing testing</h3></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+198</span></div>
                <div class="text-start"><span class="text-danger">-1</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a539bc4656930936072c68c3">
        <div><p>Most of the op-geth changes are tested in the Optimism Monorepo and not part of the geth diff,
but some testing like the Deposit TX encoding and API interactions are embedded in the op-geth diff instead.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e2cb00802f930fb062ed4e58" role="button"
                   aria-expanded="false" aria-controls="id-e2cb00802f930fb062ed4e58">
                    <code>core/types/transaction_marshalling_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/transaction_marshalling_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+80</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e2cb00802f930fb062ed4e58"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;transaction_marshalling_test.go op-geth&#47;core&#47;types&#47;transaction_marshalling_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..497dd8b0207c35db1c7d1bff22a9404966050222</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;transaction_marshalling_test.go</span>
<span class="term-fg36">@@ -0,0 +1,80 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;encoding&#47;json&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestTransactionUnmarshalJsonDeposit(t *testing.T) {</span>
<span class="term-fg32">+	tx := NewTx(&amp;DepositTx{</span>
<span class="term-fg32">+		SourceHash:          common.HexToHash(&quot;0x1234&quot;),</span>
<span class="term-fg32">+		IsSystemTransaction: true,</span>
<span class="term-fg32">+		Mint:                big.NewInt(34),</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	json, err := tx.MarshalJSON()</span>
<span class="term-fg32">+	require.NoError(t, err, &quot;Failed to marshal tx JSON&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	got := &amp;Transaction{}</span>
<span class="term-fg32">+	err = got.UnmarshalJSON(json)</span>
<span class="term-fg32">+	require.NoError(t, err, &quot;Failed to unmarshal tx JSON&quot;)</span>
<span class="term-fg32">+	require.Equal(t, tx.Hash(), got.Hash())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestTransactionUnmarshalJSON(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name          string</span>
<span class="term-fg32">+		json          string</span>
<span class="term-fg32">+		expectedError string</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:          &quot;No gas&quot;,</span>
<span class="term-fg32">+			json:          `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			expectedError: &quot;missing required field &#39;gas&#39;&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:          &quot;No value&quot;,</span>
<span class="term-fg32">+			json:          `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			expectedError: &quot;missing required field &#39;value&#39;&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:          &quot;No input&quot;,</span>
<span class="term-fg32">+			json:          `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			expectedError: &quot;missing required field &#39;input&#39;&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:          &quot;No from&quot;,</span>
<span class="term-fg32">+			json:          `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			expectedError: &quot;missing required field &#39;from&#39;&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:          &quot;No sourceHash&quot;,</span>
<span class="term-fg32">+			json:          `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			expectedError: &quot;missing required field &#39;sourceHash&#39;&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;No mint&quot;,</span>
<span class="term-fg32">+			json: `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;isSystemTx&quot;:false,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			&#47;&#47; Allowed</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;No IsSystemTx&quot;,</span>
<span class="term-fg32">+			json: `{&quot;type&quot;:&quot;0x7e&quot;,&quot;nonce&quot;:null,&quot;gas&quot;: &quot;0x1234&quot;, &quot;gasPrice&quot;:null,&quot;maxPriorityFeePerGas&quot;:null,&quot;maxFeePerGas&quot;:null,&quot;value&quot;:&quot;0x1&quot;,&quot;input&quot;:&quot;0x616263646566&quot;,&quot;v&quot;:null,&quot;r&quot;:null,&quot;s&quot;:null,&quot;to&quot;:null,&quot;sourceHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;from&quot;:&quot;0x0000000000000000000000000000000000000001&quot;,&quot;hash&quot;:&quot;0xa4341f3db4363b7ca269a8538bd027b2f8784f84454ca917668642d5f6dffdf9&quot;}`,</span>
<span class="term-fg32">+			&#47;&#47; Allowed</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, test := range tests {</span>
<span class="term-fg32">+		t.Run(test.name, func(t *testing.T) {</span>
<span class="term-fg32">+			var parsedTx = &amp;Transaction{}</span>
<span class="term-fg32">+			err := json.Unmarshal([]byte(test.json), &amp;parsedTx)</span>
<span class="term-fg32">+			if test.expectedError == &quot;&quot; {</span>
<span class="term-fg32">+				require.NoError(t, err)</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				require.ErrorContains(t, err, test.expectedError)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d1b043b04215575361cb8874" role="button"
                   aria-expanded="false" aria-controls="id-d1b043b04215575361cb8874">
                    <code>internal/ethapi/api_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/ethapi/api_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/ethapi/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+118</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d1b043b04215575361cb8874"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;ethapi&#47;api_test.go op-geth&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg1">index 762dc8337d30706d2472b9516b1f516392c3998c..f950ce4011d05372c6907c945d775f4236c1cc85 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg36">@@ -22,11 +22,128 @@</span> 	&quot;math&#47;big&quot;
 	&quot;testing&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
 )
&nbsp;
<span class="term-fg32">+func TestNewRPCTransactionDepositTx(t *testing.T) {</span>
<span class="term-fg32">+	tx := types.NewTx(&amp;types.DepositTx{</span>
<span class="term-fg32">+		SourceHash:          common.HexToHash(&quot;0x1234&quot;),</span>
<span class="term-fg32">+		IsSystemTransaction: true,</span>
<span class="term-fg32">+		Mint:                big.NewInt(34),</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	nonce := uint64(7)</span>
<span class="term-fg32">+	receipt := &amp;types.Receipt{</span>
<span class="term-fg32">+		DepositNonce: &amp;nonce,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	got := newRPCTransaction(tx, common.Hash{}, uint64(12), uint64(1), big.NewInt(0), &amp;params.ChainConfig{}, receipt)</span>
<span class="term-fg32">+	&#47;&#47; Should provide zero values for unused fields that are required in other transactions</span>
<span class="term-fg32">+	require.Equal(t, got.GasPrice, (*hexutil.Big)(big.NewInt(0)), &quot;newRPCTransaction().GasPrice = %v, want 0x0&quot;, got.GasPrice)</span>
<span class="term-fg32">+	require.Equal(t, got.V, (*hexutil.Big)(big.NewInt(0)), &quot;newRPCTransaction().V = %v, want 0x0&quot;, got.V)</span>
<span class="term-fg32">+	require.Equal(t, got.R, (*hexutil.Big)(big.NewInt(0)), &quot;newRPCTransaction().R = %v, want 0x0&quot;, got.R)</span>
<span class="term-fg32">+	require.Equal(t, got.S, (*hexutil.Big)(big.NewInt(0)), &quot;newRPCTransaction().S = %v, want 0x0&quot;, got.S)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Should include deposit tx specific fields</span>
<span class="term-fg32">+	require.Equal(t, *got.SourceHash, tx.SourceHash(), &quot;newRPCTransaction().SourceHash = %v, want %v&quot;, got.SourceHash, tx.SourceHash())</span>
<span class="term-fg32">+	require.Equal(t, *got.IsSystemTx, tx.IsSystemTx(), &quot;newRPCTransaction().IsSystemTx = %v, want %v&quot;, got.IsSystemTx, tx.IsSystemTx())</span>
<span class="term-fg32">+	require.Equal(t, got.Mint, (*hexutil.Big)(tx.Mint()), &quot;newRPCTransaction().Mint = %v, want %v&quot;, got.Mint, tx.Mint())</span>
<span class="term-fg32">+	require.Equal(t, got.Nonce, (hexutil.Uint64)(nonce), &quot;newRPCTransaction().Mint = %v, want %v&quot;, got.Nonce, nonce)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestNewRPCTransactionOmitIsSystemTxFalse(t *testing.T) {</span>
<span class="term-fg32">+	tx := types.NewTx(&amp;types.DepositTx{</span>
<span class="term-fg32">+		IsSystemTransaction: false,</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	got := newRPCTransaction(tx, common.Hash{}, uint64(12), uint64(1), big.NewInt(0), &amp;params.ChainConfig{}, nil)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.Nil(t, got.IsSystemTx, &quot;should omit IsSystemTx when false&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestUnmarshalRpcDepositTx(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name     string</span>
<span class="term-fg32">+		modifier func(tx *RPCTransaction)</span>
<span class="term-fg32">+		valid    bool</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:     &quot;Unmodified&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {},</span>
<span class="term-fg32">+			valid:    true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Zero Values&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.V = (*hexutil.Big)(common.Big0)</span>
<span class="term-fg32">+				tx.R = (*hexutil.Big)(common.Big0)</span>
<span class="term-fg32">+				tx.S = (*hexutil.Big)(common.Big0)</span>
<span class="term-fg32">+				tx.GasPrice = (*hexutil.Big)(common.Big0)</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Nil Values&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.V = nil</span>
<span class="term-fg32">+				tx.R = nil</span>
<span class="term-fg32">+				tx.S = nil</span>
<span class="term-fg32">+				tx.GasPrice = nil</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Non-Zero GasPrice&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.GasPrice = (*hexutil.Big)(big.NewInt(43))</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Non-Zero V&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.V = (*hexutil.Big)(big.NewInt(43))</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Non-Zero R&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.R = (*hexutil.Big)(big.NewInt(43))</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Non-Zero S&quot;,</span>
<span class="term-fg32">+			modifier: func(tx *RPCTransaction) {</span>
<span class="term-fg32">+				tx.S = (*hexutil.Big)(big.NewInt(43))</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			valid: false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, test := range tests {</span>
<span class="term-fg32">+		t.Run(test.name, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.DepositTx{</span>
<span class="term-fg32">+				SourceHash:          common.HexToHash(&quot;0x1234&quot;),</span>
<span class="term-fg32">+				IsSystemTransaction: true,</span>
<span class="term-fg32">+				Mint:                big.NewInt(34),</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(tx, common.Hash{}, uint64(12), uint64(1), big.NewInt(0), &amp;params.ChainConfig{}, nil)</span>
<span class="term-fg32">+			test.modifier(rpcTx)</span>
<span class="term-fg32">+			json, err := json.Marshal(rpcTx)</span>
<span class="term-fg32">+			require.NoError(t, err, &quot;marshalling failed: %w&quot;, err)</span>
<span class="term-fg32">+			parsed := &amp;types.Transaction{}</span>
<span class="term-fg32">+			err = parsed.UnmarshalJSON(json)</span>
<span class="term-fg32">+			if test.valid {</span>
<span class="term-fg32">+				require.NoError(t, err, &quot;unmarshal failed: %w&quot;, err)</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				require.Error(t, err, &quot;unmarshal should have failed but did not&quot;)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func TestTransaction_RoundTripRpcJSON(t *testing.T) {
 	var (
 		config = params.AllEthashProtocolChanges
<span class="term-fg36">@@ -51,7 +168,7 @@</span> 			t.Fatalf(&quot;test %d: stx changed, want %x have %x&quot;, i, want, have)
 		}
&nbsp;
 		&#47;&#47;  rpcTransaction
<span class="term-fg31">-		rpcTx := newRPCTransaction(tx, common.Hash{}, 0, 0, nil, config)</span>
<span class="term-fg32">+		rpcTx := newRPCTransaction(tx, common.Hash{}, 0, 0, nil, config, nil)</span>
 		if data, err := json.Marshal(rpcTx); err != nil {
 			t.Fatalf(&quot;test %d: marshalling failed; %v&quot;, i, err)
 		} else if err = tx2.UnmarshalJSON(data); err != nil {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-d569a8930da0df544bbd298f"role="button" aria-expanded="false" aria-controls="id-d569a8930da0df544bbd298f">
        
            <div class="col-12 col-sm-9 text-start"><h2>Other changes</h2></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+2631</span></div>
                <div class="text-start"><span class="text-danger">-1526</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-d569a8930da0df544bbd298f">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-49e8a0f3b27f12a629352f67" role="button"
                   aria-expanded="false" aria-controls="id-49e8a0f3b27f12a629352f67">
                    <code>.github/CODEOWNERS</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/.github/CODEOWNERS" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.github/CODEOWNERS" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49e8a0f3b27f12a629352f67"><span class="term-fg1">diff --git go-ethereum&#47;.github&#47;CODEOWNERS op-geth&#47;.github&#47;CODEOWNERS</span>
<span class="term-fg1">index 780f2a800ec1382eefa0b197785ab43e1faa125c..faf922df01613ecabaee93c1153b91476573e914 100644</span>
<span class="term-fg1">--- go-ethereum&#47;.github&#47;CODEOWNERS</span>
<span class="term-fg1">+++ op-geth&#47;.github&#47;CODEOWNERS</span>
<span class="term-fg36">@@ -10,7 +10,7 @@</span> core&#47;                           @karalabe @holiman @rjl493456442
 eth&#47;                            @karalabe @holiman @rjl493456442
 eth&#47;catalyst&#47;                   @gballet
 eth&#47;tracers&#47;                    @s1na
<span class="term-fg31">-graphql&#47;                        @gballet @s1na</span>
<span class="term-fg32">+graphql&#47;                        @s1na</span>
 les&#47;                            @zsfelfoldi @rjl493456442
 light&#47;                          @zsfelfoldi @rjl493456442
 node&#47;                           @fjl</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c483609c1fe1be9bc1ca8b3" role="button"
                   aria-expanded="false" aria-controls="id-8c483609c1fe1be9bc1ca8b3">
                    <code>.gitignore</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/.gitignore" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.gitignore" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c483609c1fe1be9bc1ca8b3"><span class="term-fg1">diff --git go-ethereum&#47;.gitignore op-geth&#47;.gitignore</span>
<span class="term-fg1">index 1ee8b83022efe585f890e9104913de9cf40bfacf..e24e1d1677098fe7310f7adad5ecc8500236b44f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;.gitignore</span>
<span class="term-fg1">+++ op-geth&#47;.gitignore</span>
<span class="term-fg36">@@ -47,3 +47,4 @@</span> &#47;dashboard&#47;assets&#47;bundle.js.map
 &#47;dashboard&#47;assets&#47;package-lock.json
&nbsp;
 **&#47;yarn-error.log
<span class="term-fg32">+logs&#47;</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-54a0aa0a362f361ee4d8dc9f" role="button"
                   aria-expanded="false" aria-controls="id-54a0aa0a362f361ee4d8dc9f">
                    <code>accounts/abi/bind/base.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/accounts/abi/bind/base.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/accounts/abi/bind/base.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-54a0aa0a362f361ee4d8dc9f"><span class="term-fg1">diff --git go-ethereum&#47;accounts&#47;abi&#47;bind&#47;base.go op-geth&#47;accounts&#47;abi&#47;bind&#47;base.go</span>
<span class="term-fg1">index df3f52a403e74d1aa2c291e72c8513695630c273..b03f431f77176b970fe3c0038856fd7bfc529ad2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;accounts&#47;abi&#47;bind&#47;base.go</span>
<span class="term-fg1">+++ op-geth&#47;accounts&#47;abi&#47;bind&#47;base.go</span>
<span class="term-fg36">@@ -34,6 +34,11 @@</span> )
&nbsp;
 const basefeeWiggleMultiplier = 2
&nbsp;
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	errNoEventSignature       = errors.New(&quot;no event signature&quot;)</span>
<span class="term-fg32">+	errEventSignatureMismatch = errors.New(&quot;event signature mismatch&quot;)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
 &#47;&#47; SignerFn is a signer function callback when a contract requires a method to
 &#47;&#47; sign the transaction before submission.
 type SignerFn func(common.Address, *types.Transaction) (*types.Transaction, error)
<span class="term-fg36">@@ -488,8 +493,12 @@</span> }
&nbsp;
 &#47;&#47; UnpackLog unpacks a retrieved log into the provided output structure.
 func (c *BoundContract) UnpackLog(out interface{}, event string, log types.Log) error {
<span class="term-fg32">+	&#47;&#47; Anonymous events are not supported.</span>
<span class="term-fg32">+	if len(log.Topics) == 0 {</span>
<span class="term-fg32">+		return errNoEventSignature</span>
<span class="term-fg32">+	}</span>
 	if log.Topics[0] != c.abi.Events[event].ID {
<span class="term-fg31">-		return fmt.Errorf(&quot;event signature mismatch&quot;)</span>
<span class="term-fg32">+		return errEventSignatureMismatch</span>
 	}
 	if len(log.Data) &gt; 0 {
 		if err := c.abi.UnpackIntoInterface(out, event, log.Data); err != nil {
<span class="term-fg36">@@ -507,8 +516,12 @@</span> }
&nbsp;
 &#47;&#47; UnpackLogIntoMap unpacks a retrieved log into the provided map.
 func (c *BoundContract) UnpackLogIntoMap(out map[string]interface{}, event string, log types.Log) error {
<span class="term-fg32">+	&#47;&#47; Anonymous events are not supported.</span>
<span class="term-fg32">+	if len(log.Topics) == 0 {</span>
<span class="term-fg32">+		return errNoEventSignature</span>
<span class="term-fg32">+	}</span>
 	if log.Topics[0] != c.abi.Events[event].ID {
<span class="term-fg31">-		return fmt.Errorf(&quot;event signature mismatch&quot;)</span>
<span class="term-fg32">+		return errEventSignatureMismatch</span>
 	}
 	if len(log.Data) &gt; 0 {
 		if err := c.abi.UnpackIntoMap(out, event, log.Data); err != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-36b216cbfdc9d0a1c324c923" role="button"
                   aria-expanded="false" aria-controls="id-36b216cbfdc9d0a1c324c923">
                    <code>accounts/abi/bind/base_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/accounts/abi/bind/base_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/accounts/abi/bind/base_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+17</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-36b216cbfdc9d0a1c324c923"><span class="term-fg1">diff --git go-ethereum&#47;accounts&#47;abi&#47;bind&#47;base_test.go op-geth&#47;accounts&#47;abi&#47;bind&#47;base_test.go</span>
<span class="term-fg1">index 2307b9874b18f0d0e7728c06d8d7b64124d749a2..ca0128148ffa471ecee933f1432ef89613f52dcb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;accounts&#47;abi&#47;bind&#47;base_test.go</span>
<span class="term-fg1">+++ op-geth&#47;accounts&#47;abi&#47;bind&#47;base_test.go</span>
<span class="term-fg36">@@ -186,6 +186,23 @@</span> 	}
 	unpackAndCheck(t, bc, expectedReceivedMap, mockLog)
 }
&nbsp;
<span class="term-fg32">+func TestUnpackAnonymousLogIntoMap(t *testing.T) {</span>
<span class="term-fg32">+	mockLog := newMockLog(nil, common.HexToHash(&quot;0x0&quot;))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	abiString := `[{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:false,&quot;name&quot;:&quot;amount&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;received&quot;,&quot;type&quot;:&quot;event&quot;}]`</span>
<span class="term-fg32">+	parsedAbi, _ := abi.JSON(strings.NewReader(abiString))</span>
<span class="term-fg32">+	bc := bind.NewBoundContract(common.HexToAddress(&quot;0x0&quot;), parsedAbi, nil, nil, nil)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var received map[string]interface{}</span>
<span class="term-fg32">+	err := bc.UnpackLogIntoMap(received, &quot;received&quot;, mockLog)</span>
<span class="term-fg32">+	if err == nil {</span>
<span class="term-fg32">+		t.Error(&quot;unpacking anonymous event is not supported&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err.Error() != &quot;no event signature&quot; {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected error &#39;no event signature&#39;, got &#39;%s&#39;&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func TestUnpackIndexedSliceTyLogIntoMap(t *testing.T) {
 	sliceBytes, err := rlp.EncodeToBytes([]string{&quot;name1&quot;, &quot;name2&quot;, &quot;name3&quot;, &quot;name4&quot;})
 	if err != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-75dfd1906eec2bd33c11cc24" role="button"
                   aria-expanded="false" aria-controls="id-75dfd1906eec2bd33c11cc24">
                    <code>build/checksums.txt</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/build/checksums.txt" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/build/checksums.txt" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+14</span></div>
                        <div class="text-start"><span class="text-danger">-14</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-75dfd1906eec2bd33c11cc24"><span class="term-fg1">diff --git go-ethereum&#47;build&#47;checksums.txt op-geth&#47;build&#47;checksums.txt</span>
<span class="term-fg1">index e349d3eba03b89d2a482f541f272ec11b4e631a0..9b038582a84444724fbfc4b160897e3a61ea845b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;build&#47;checksums.txt</span>
<span class="term-fg1">+++ op-geth&#47;build&#47;checksums.txt</span>
<span class="term-fg36">@@ -1,19 +1,19 @@</span>
 # This file contains sha256 checksums of optional build dependencies.
&nbsp;
<span class="term-fg31">-4d0e2850d197b4ddad3bdb0196300179d095bb3aefd4dfbc3b36702c3728f8ab  go1.20.2.src.tar.gz</span>
<span class="term-fg31">-c93b8ced9517d07e1cd4c362c6e2d5242cb139e29b417a328fbf19aded08764c  go1.20.2.darwin-amd64.tar.gz</span>
<span class="term-fg31">-7343c87f19e79c0063532e82e1c4d6f42175a32d99f7a4d15e658e88bf97f885  go1.20.2.darwin-arm64.tar.gz</span>
<span class="term-fg31">-14f9be2004e042b3a64d0facb0c020756a9084a5c7333e33b0752b393b6016ea  go1.20.2.freebsd-386.tar.gz</span>
<span class="term-fg31">-b41b67b4f1b56797a7cecf6ee7f47fcf4f93960b2788a3683c07dd009d30b2a4  go1.20.2.freebsd-amd64.tar.gz</span>
<span class="term-fg31">-ee240ed33ae57504c41f04c12236aeaa17fbeb6ea9fcd096cd9dc7a89d10d4db  go1.20.2.linux-386.tar.gz</span>
<span class="term-fg31">-4eaea32f59cde4dc635fbc42161031d13e1c780b87097f4b4234cfce671f1768  go1.20.2.linux-amd64.tar.gz</span>
<span class="term-fg31">-78d632915bb75e9a6356a47a42625fd1a785c83a64a643fedd8f61e31b1b3bef  go1.20.2.linux-arm64.tar.gz</span>
<span class="term-fg31">-d79d56bafd6b52b8d8cbe3f8e967caaac5383a23d7a4fa9ac0e89778cd16a076  go1.20.2.linux-armv6l.tar.gz</span>
<span class="term-fg31">-850564ddb760cb703db63bf20182dc4407abd2ff090a95fa66d6634d172fd095  go1.20.2.linux-ppc64le.tar.gz</span>
<span class="term-fg31">-8da24c5c4205fe8115f594237e5db7bcb1d23df67bc1fa9a999954b1976896e8  go1.20.2.linux-s390x.tar.gz</span>
<span class="term-fg31">-31838b291117495bbb93683603e98d5118bfabd2eb318b4d07540bfd524bab86  go1.20.2.windows-386.zip</span>
<span class="term-fg31">-fe439f0e438f7555a7f5f7194ddb6f4a07b0de1fa414385d19f2aeb26d9f43db  go1.20.2.windows-amd64.zip</span>
<span class="term-fg31">-ac5010c8b8b22849228a8dea698d58b9c7be2195d30c6d778cce0f709858fa64  go1.20.2.windows-arm64.zip</span>
<span class="term-fg32">+e447b498cde50215c4f7619e5124b0fc4e25fb5d16ea47271c47f278e7aa763a  go1.20.3.src.tar.gz</span>
<span class="term-fg32">+c1e1161d6d859deb576e6cfabeb40e3d042ceb1c6f444f617c3c9d76269c3565  go1.20.3.darwin-amd64.tar.gz</span>
<span class="term-fg32">+86b0ed0f2b2df50fa8036eea875d1cf2d76cefdacf247c44639a1464b7e36b95  go1.20.3.darwin-arm64.tar.gz</span>
<span class="term-fg32">+340e80abd047c597fdc0f50a6cc59617f06c297d62f7fc77f4a0164e2da6f7aa  go1.20.3.freebsd-386.tar.gz</span>
<span class="term-fg32">+2169fcd8b6c94c5fbe07c0b470ccfb6001d343f6548ad49f3d9ab78e3b5753c7  go1.20.3.freebsd-amd64.tar.gz</span>
<span class="term-fg32">+e12384311403f1389d14cc1c1295bfb4e0dd5ab919403b80da429f671a223507  go1.20.3.linux-386.tar.gz</span>
<span class="term-fg32">+979694c2c25c735755bf26f4f45e19e64e4811d661dd07b8c010f7a8e18adfca  go1.20.3.linux-amd64.tar.gz</span>
<span class="term-fg32">+eb186529f13f901e7a2c4438a05c2cd90d74706aaa0a888469b2a4a617b6ee54  go1.20.3.linux-arm64.tar.gz</span>
<span class="term-fg32">+b421e90469a83671641f81b6e20df6500f033e9523e89cbe7b7223704dd1035c  go1.20.3.linux-armv6l.tar.gz</span>
<span class="term-fg32">+943c89aa1624ea544a022b31e3d6e16a037200e436370bdd5fd67f3fa60be282  go1.20.3.linux-ppc64le.tar.gz</span>
<span class="term-fg32">+126cf823a5634ef2544b866db107b9d351d3ea70d9e240b0bdcfb46f4dcae54b  go1.20.3.linux-s390x.tar.gz</span>
<span class="term-fg32">+37e9146e1f9d681cfcaa6fee6c7b890c44c64bc50228c9588f3c4231346d33bd  go1.20.3.windows-386.zip</span>
<span class="term-fg32">+143a2837821c7dbacf7744cbb1a8421c1f48307c6fdfaeffc5f8c2f69e1b7932  go1.20.3.windows-amd64.zip</span>
<span class="term-fg32">+158cb159e00bc979f473e0f5b5a561613129c5e51067967b72b8e072e5a4db81  go1.20.3.windows-arm64.zip</span>
&nbsp;
 fba08acc4027f69f07cef48fbff70b8a7ecdfaa1c2aba9ad3fb31d60d9f5d4bc  golangci-lint-1.51.1-darwin-amd64.tar.gz
 75b8f0ff3a4e68147156be4161a49d4576f1be37a0b506473f8c482140c1e7f2  golangci-lint-1.51.1-darwin-arm64.tar.gz</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-941a360f99f67016534d19ce" role="button"
                   aria-expanded="false" aria-controls="id-941a360f99f67016534d19ce">
                    <code>cmd/devp2p/crawl.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/devp2p/crawl.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/devp2p/crawl.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-941a360f99f67016534d19ce"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;devp2p&#47;crawl.go op-geth&#47;cmd&#47;devp2p&#47;crawl.go</span>
<span class="term-fg1">index 8c9755ac1cd47bde9bf83ea74f872cb9aed085fe..1b964164d882d9f822e4a3b7edae7e0ad9646713 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;devp2p&#47;crawl.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;devp2p&#47;crawl.go</span>
<span class="term-fg36">@@ -141,7 +141,7 @@</span> 			log.Info(&quot;Crawling in progress&quot;,
 				&quot;added&quot;, atomic.LoadUint64(&amp;added),
 				&quot;updated&quot;, atomic.LoadUint64(&amp;updated),
 				&quot;removed&quot;, atomic.LoadUint64(&amp;removed),
<span class="term-fg31">-				&quot;ignored(recent)&quot;, atomic.LoadUint64(&amp;removed),</span>
<span class="term-fg32">+				&quot;ignored(recent)&quot;, atomic.LoadUint64(&amp;recent),</span>
 				&quot;ignored(incompatible)&quot;, atomic.LoadUint64(&amp;skipped))
 		}
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5d786c07e9e6d38e3889a918" role="button"
                   aria-expanded="false" aria-controls="id-5d786c07e9e6d38e3889a918">
                    <code>cmd/devp2p/dns_cloudflare.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/devp2p/dns_cloudflare.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/devp2p/dns_cloudflare.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5d786c07e9e6d38e3889a918"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;devp2p&#47;dns_cloudflare.go op-geth&#47;cmd&#47;devp2p&#47;dns_cloudflare.go</span>
<span class="term-fg1">index bfe92257ee5a1185576ca9a094cff96965fe3bef..798fdc73324519d615c889405742d21ad3aef60f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;devp2p&#47;dns_cloudflare.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;devp2p&#47;dns_cloudflare.go</span>
<span class="term-fg36">@@ -144,7 +144,7 @@</span> 			record := cloudflare.DNSRecord{Type: &quot;TXT&quot;, Name: path, Content: val, TTL: ttl}
 			_, err = c.CreateDNSRecord(context.Background(), c.zoneID, record)
 		} else if old.Content != val {
 			&#47;&#47; Entry already exists, only change its content.
<span class="term-fg31">-			log.Debug(fmt.Sprintf(&quot;Updating %s from %q to %q&quot;, path, old.Content, val))</span>
<span class="term-fg32">+			log.Info(fmt.Sprintf(&quot;Updating %s from %q to %q&quot;, path, old.Content, val))</span>
 			updated++
 			old.Content = val
 			err = c.UpdateDNSRecord(context.Background(), c.zoneID, old.ID, old)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f682febc00bc940b9c0258c2" role="button"
                   aria-expanded="false" aria-controls="id-f682febc00bc940b9c0258c2">
                    <code>cmd/devp2p/dns_route53.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/devp2p/dns_route53.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/devp2p/dns_route53.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+20</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f682febc00bc940b9c0258c2"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;devp2p&#47;dns_route53.go op-geth&#47;cmd&#47;devp2p&#47;dns_route53.go</span>
<span class="term-fg1">index 81734eb2ad877404920b417b43b5d9528980192f..400ab1b1cf05c4bd372cb95e3bcf918fc281a65d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;devp2p&#47;dns_route53.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;devp2p&#47;dns_route53.go</span>
<span class="term-fg36">@@ -221,7 +221,13 @@</span> 		lrecords[strings.ToLower(name)] = r
 	}
 	records = lrecords
&nbsp;
<span class="term-fg31">-	var changes []types.Change</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		changes []types.Change</span>
<span class="term-fg32">+		inserts int</span>
<span class="term-fg32">+		upserts int</span>
<span class="term-fg32">+		skips   int</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+</span>
 	for path, newValue := range records {
 		prevRecords, exists := existing[path]
 		prevValue := strings.Join(prevRecords.values, &quot;&quot;)
<span class="term-fg36">@@ -237,20 +243,30 @@</span> 		}
&nbsp;
 		if !exists {
 			&#47;&#47; Entry is unknown, push a new one
<span class="term-fg31">-			log.Info(fmt.Sprintf(&quot;Creating %s = %s&quot;, path, newValue))</span>
<span class="term-fg32">+			log.Debug(fmt.Sprintf(&quot;Creating %s = %s&quot;, path, newValue))</span>
 			changes = append(changes, newTXTChange(&quot;CREATE&quot;, path, ttl, newValue))
<span class="term-fg32">+			inserts++</span>
 		} else if prevValue != newValue || prevRecords.ttl != ttl {
 			&#47;&#47; Entry already exists, only change its content.
 			log.Info(fmt.Sprintf(&quot;Updating %s from %s to %s&quot;, path, prevValue, newValue))
 			changes = append(changes, newTXTChange(&quot;UPSERT&quot;, path, ttl, newValue))
<span class="term-fg32">+			upserts++</span>
 		} else {
 			log.Debug(fmt.Sprintf(&quot;Skipping %s = %s&quot;, path, newValue))
<span class="term-fg32">+			skips++</span>
 		}
 	}
&nbsp;
 	&#47;&#47; Iterate over the old records and delete anything stale.
<span class="term-fg31">-	changes = append(changes, makeDeletionChanges(existing, records)...)</span>
<span class="term-fg32">+	deletions := makeDeletionChanges(existing, records)</span>
<span class="term-fg32">+	changes = append(changes, deletions...)</span>
&nbsp;
<span class="term-fg32">+	log.Info(&quot;Computed DNS changes&quot;,</span>
<span class="term-fg32">+		&quot;changes&quot;, len(changes),</span>
<span class="term-fg32">+		&quot;inserts&quot;, inserts,</span>
<span class="term-fg32">+		&quot;skips&quot;, skips,</span>
<span class="term-fg32">+		&quot;deleted&quot;, len(deletions),</span>
<span class="term-fg32">+		&quot;upserts&quot;, upserts)</span>
 	&#47;&#47; Ensure changes are in the correct order.
 	sortChanges(changes)
 	return changes
<span class="term-fg36">@@ -263,7 +279,7 @@</span> 	for path, set := range records {
 		if _, ok := keep[path]; ok {
 			continue
 		}
<span class="term-fg31">-		log.Info(fmt.Sprintf(&quot;Deleting %s = %s&quot;, path, strings.Join(set.values, &quot;&quot;)))</span>
<span class="term-fg32">+		log.Debug(fmt.Sprintf(&quot;Deleting %s = %s&quot;, path, strings.Join(set.values, &quot;&quot;)))</span>
 		changes = append(changes, newTXTChange(&quot;DELETE&quot;, path, set.ttl, set.values...))
 	}
 	return changes</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-39c1f1b3c371977d5eef0aeb" role="button"
                   aria-expanded="false" aria-controls="id-39c1f1b3c371977d5eef0aeb">
                    <code>cmd/evm/internal/t8ntool/execution.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/evm/internal/t8ntool/execution.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/evm/internal/t8ntool/execution.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-39c1f1b3c371977d5eef0aeb"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">index 5f796c1d6639786896f988903f9cdc5e542137ec..156bce7edb4d30cd98b7b5903c2763a648face47 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg36">@@ -174,7 +174,6 @@</span> 		if err != nil {
 			return nil, nil, err
 		}
 		vmConfig.Tracer = tracer
<span class="term-fg31">-		vmConfig.Debug = (tracer != nil)</span>
 		statedb.SetTxContext(tx.Hash(), txIndex)
&nbsp;
 		var (</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a3633f9dd47c87f596f7f83a" role="button"
                   aria-expanded="false" aria-controls="id-a3633f9dd47c87f596f7f83a">
                    <code>cmd/evm/internal/t8ntool/transition.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/evm/internal/t8ntool/transition.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/evm/internal/t8ntool/transition.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a3633f9dd47c87f596f7f83a"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transition.go op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transition.go</span>
<span class="term-fg1">index cb7466d86cae1cdbc84b0dea3ddac1160d4b4981..0b87edd11cc189e5b0bc58571dfadab05f20e598 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transition.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transition.go</span>
<span class="term-fg36">@@ -180,7 +180,6 @@</span> 	prestate.Env = *inputData.Env
&nbsp;
 	vmConfig := vm.Config{
 		Tracer: tracer,
<span class="term-fg31">-		Debug:  (tracer != nil),</span>
 	}
 	&#47;&#47; Construct the chainconfig
 	var chainConfig *params.ChainConfig
<span class="term-fg36">@@ -250,9 +249,9 @@</span> 	&#47;&#47; Sanity check, to not `panic` in state_transition
 	if chainConfig.IsLondon(big.NewInt(int64(prestate.Env.Number))) {
 		if prestate.Env.BaseFee != nil {
 			&#47;&#47; Already set, base fee has precedent over parent base fee.
<span class="term-fg31">-		} else if prestate.Env.ParentBaseFee != nil {</span>
<span class="term-fg32">+		} else if prestate.Env.ParentBaseFee != nil &amp;&amp; prestate.Env.Number != 0 {</span>
 			parent := &amp;types.Header{
<span class="term-fg31">-				Number:   new(big.Int).SetUint64(prestate.Env.Number),</span>
<span class="term-fg32">+				Number:   new(big.Int).SetUint64(prestate.Env.Number - 1),</span>
 				BaseFee:  prestate.Env.ParentBaseFee,
 				GasUsed:  prestate.Env.ParentGasUsed,
 				GasLimit: prestate.Env.ParentGasLimit,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d3dd4689c1dcab8aec632e0f" role="button"
                   aria-expanded="false" aria-controls="id-d3dd4689c1dcab8aec632e0f">
                    <code>cmd/evm/runner.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/evm/runner.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/evm/runner.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d3dd4689c1dcab8aec632e0f"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;evm&#47;runner.go op-geth&#47;cmd&#47;evm&#47;runner.go</span>
<span class="term-fg1">index 3a010da9f2dc6f3cb9ad4acf9cc1dc2b9d6b01de..18ec3330c4263ee5aa3231a86bf3fe6a0d3e2933 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;evm&#47;runner.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;evm&#47;runner.go</span>
<span class="term-fg36">@@ -40,6 +40,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&#47;logger&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;flags&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;trie&quot;</span>
 	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;
 )
&nbsp;
<span class="term-fg36">@@ -125,6 +126,7 @@</span> 		chainConfig   *params.ChainConfig
 		sender        = common.BytesToAddress([]byte(&quot;sender&quot;))
 		receiver      = common.BytesToAddress([]byte(&quot;receiver&quot;))
 		genesisConfig *core.Genesis
<span class="term-fg32">+		preimages     = ctx.Bool(DumpFlag.Name)</span>
 	)
 	if ctx.Bool(MachineFlag.Name) {
 		tracer = logger.NewJSONLogger(logconfig, os.Stdout)
<span class="term-fg36">@@ -139,10 +141,12 @@</span> 		gen := readGenesis(ctx.String(GenesisFlag.Name))
 		genesisConfig = gen
 		db := rawdb.NewMemoryDatabase()
 		genesis := gen.MustCommit(db)
<span class="term-fg31">-		statedb, _ = state.New(genesis.Root(), state.NewDatabase(db), nil)</span>
<span class="term-fg32">+		sdb := state.NewDatabaseWithConfig(db, &amp;trie.Config{Preimages: preimages})</span>
<span class="term-fg32">+		statedb, _ = state.New(genesis.Root(), sdb, nil)</span>
 		chainConfig = gen.Config
 	} else {
<span class="term-fg31">-		statedb, _ = state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase()), nil)</span>
<span class="term-fg32">+		sdb := state.NewDatabaseWithConfig(rawdb.NewMemoryDatabase(), &amp;trie.Config{Preimages: preimages})</span>
<span class="term-fg32">+		statedb, _ = state.New(common.Hash{}, sdb, nil)</span>
 		genesisConfig = new(core.Genesis)
 	}
 	if ctx.String(SenderFlag.Name) != &quot;&quot; {
<span class="term-fg36">@@ -214,7 +218,6 @@</span> 		Coinbase:    genesisConfig.Coinbase,
 		BlockNumber: new(big.Int).SetUint64(genesisConfig.Number),
 		EVMConfig: vm.Config{
 			Tracer: tracer,
<span class="term-fg31">-			Debug:  ctx.Bool(DebugFlag.Name) || ctx.Bool(MachineFlag.Name),</span>
 		},
 	}
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d84191d74848889cc5ca78c5" role="button"
                   aria-expanded="false" aria-controls="id-d84191d74848889cc5ca78c5">
                    <code>cmd/evm/staterunner.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/evm/staterunner.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/evm/staterunner.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d84191d74848889cc5ca78c5"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;evm&#47;staterunner.go op-geth&#47;cmd&#47;evm&#47;staterunner.go</span>
<span class="term-fg1">index 5eba25c725a3b8408953a82ad50eed9fdd19ce23..e9229eaeca2179dfb2dcacd6ea372c817ab9e920 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;evm&#47;staterunner.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;evm&#47;staterunner.go</span>
<span class="term-fg36">@@ -92,7 +92,6 @@</span> 	}
 	&#47;&#47; Iterate over all the tests, run them and aggregate the results
 	cfg := vm.Config{
 		Tracer: tracer,
<span class="term-fg31">-		Debug:  ctx.Bool(DebugFlag.Name) || ctx.Bool(MachineFlag.Name),</span>
 	}
 	results := make([]StatetestResult, 0, len(tests))
 	for key, test := range tests {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c7f4c59bcf65ab2961bf8519" role="button"
                   aria-expanded="false" aria-controls="id-c7f4c59bcf65ab2961bf8519">
                    <code>cmd/geth/accountcmd.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/cmd/geth/accountcmd.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/cmd/geth/accountcmd.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c7f4c59bcf65ab2961bf8519"><span class="term-fg1">diff --git go-ethereum&#47;cmd&#47;geth&#47;accountcmd.go op-geth&#47;cmd&#47;geth&#47;accountcmd.go</span>
<span class="term-fg1">index 5158b7606cdef2494f8d1111cd7a93af98e350f1..a36da7d55f2c59601ce978c5c34187a8bc841b15 100644</span>
<span class="term-fg1">--- go-ethereum&#47;cmd&#47;geth&#47;accountcmd.go</span>
<span class="term-fg1">+++ op-geth&#47;cmd&#47;geth&#47;accountcmd.go</span>
<span class="term-fg36">@@ -301,7 +301,11 @@</span> 	if ctx.Args().Len() == 0 {
 		utils.Fatalf(&quot;No accounts specified to update&quot;)
 	}
 	stack, _ := makeConfigNode(ctx)
<span class="term-fg31">-	ks := stack.AccountManager().Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	backends := stack.AccountManager().Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(backends) == 0 {</span>
<span class="term-fg32">+		utils.Fatalf(&quot;Keystore is not available&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	ks := backends[0].(*keystore.KeyStore)</span>
&nbsp;
 	for _, addr := range ctx.Args().Slice() {
 		account, oldPassword := unlockAccount(ks, addr, 0, nil)
<span class="term-fg36">@@ -326,7 +330,11 @@</span>
 	stack, _ := makeConfigNode(ctx)
 	passphrase := utils.GetPassPhraseWithList(&quot;&quot;, false, 0, utils.MakePasswordList(ctx))
&nbsp;
<span class="term-fg31">-	ks := stack.AccountManager().Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	backends := stack.AccountManager().Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(backends) == 0 {</span>
<span class="term-fg32">+		utils.Fatalf(&quot;Keystore is not available&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	ks := backends[0].(*keystore.KeyStore)</span>
 	acct, err := ks.ImportPreSaleKey(keyJSON, passphrase)
 	if err != nil {
 		utils.Fatalf(&quot;%v&quot;, err)
<span class="term-fg36">@@ -347,7 +355,11 @@</span> 	}
 	stack, _ := makeConfigNode(ctx)
 	passphrase := utils.GetPassPhraseWithList(&quot;Your new account is locked with a password. Please give a password. Do not forget this password.&quot;, true, 0, utils.MakePasswordList(ctx))
&nbsp;
<span class="term-fg31">-	ks := stack.AccountManager().Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	backends := stack.AccountManager().Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(backends) == 0 {</span>
<span class="term-fg32">+		utils.Fatalf(&quot;Keystore is not available&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	ks := backends[0].(*keystore.KeyStore)</span>
 	acct, err := ks.ImportECDSA(key, passphrase)
 	if err != nil {
 		utils.Fatalf(&quot;Could not create the account: %v&quot;, err)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b707e25b18ea7d67144a3c60" role="button"
                   aria-expanded="false" aria-controls="id-b707e25b18ea7d67144a3c60">
                    <code>common/path.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/common/path.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/common/path.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b707e25b18ea7d67144a3c60"><span class="term-fg1">diff --git go-ethereum&#47;common&#47;path.go op-geth&#47;common&#47;path.go</span>
<span class="term-fg1">index 69820cfe5decbd5f3d3e766ed4ae8331e8288d8b..c1e382fd29c41423999313a4a9814e735f899933 100644</span>
<span class="term-fg1">--- go-ethereum&#47;common&#47;path.go</span>
<span class="term-fg1">+++ op-geth&#47;common&#47;path.go</span>
<span class="term-fg36">@@ -17,18 +17,9 @@</span>
 package common
&nbsp;
 import (
<span class="term-fg31">-	&quot;fmt&quot;</span>
 	&quot;os&quot;
 	&quot;path&#47;filepath&quot;
<span class="term-fg31">-	&quot;runtime&quot;</span>
 )
<span class="term-fg31">-</span>
<span class="term-fg31">-&#47;&#47; MakeName creates a node name that follows the ethereum convention</span>
<span class="term-fg31">-&#47;&#47; for such names. It adds the operation system name and Go runtime version</span>
<span class="term-fg31">-&#47;&#47; the name.</span>
<span class="term-fg31">-func MakeName(name, version string) string {</span>
<span class="term-fg31">-	return fmt.Sprintf(&quot;%s&#47;v%s&#47;%s&#47;%s&quot;, name, version, runtime.GOOS, runtime.Version())</span>
<span class="term-fg31">-}</span>
&nbsp;
 &#47;&#47; FileExist checks if a file exists at filePath.
 func FileExist(filePath string) bool {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-31a8530e368c00193cff16f1" role="button"
                   aria-expanded="false" aria-controls="id-31a8530e368c00193cff16f1">
                    <code>common/types.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/common/types.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/common/types.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-31a8530e368c00193cff16f1"><span class="term-fg1">diff --git go-ethereum&#47;common&#47;types.go op-geth&#47;common&#47;types.go</span>
<span class="term-fg1">index 218ca0be4c44a12e8275d8d51e0d784aa806094e..0b68a19dd3191dd2db225f24f59562afa86fdbf2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;common&#47;types.go</span>
<span class="term-fg1">+++ op-geth&#47;common&#47;types.go</span>
<span class="term-fg36">@@ -400,7 +400,7 @@</span> 	return json.Unmarshal(input, &amp;ma.original)
 }
&nbsp;
 &#47;&#47; MarshalJSON marshals the original value
<span class="term-fg31">-func (ma *MixedcaseAddress) MarshalJSON() ([]byte, error) {</span>
<span class="term-fg32">+func (ma MixedcaseAddress) MarshalJSON() ([]byte, error) {</span>
 	if strings.HasPrefix(ma.original, &quot;0x&quot;) || strings.HasPrefix(ma.original, &quot;0X&quot;) {
 		return json.Marshal(fmt.Sprintf(&quot;0x%s&quot;, ma.original[2:]))
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d9f9074518440ab4b97cce90" role="button"
                   aria-expanded="false" aria-controls="id-d9f9074518440ab4b97cce90">
                    <code>common/types_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/common/types_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/common/types_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+26</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d9f9074518440ab4b97cce90"><span class="term-fg1">diff --git go-ethereum&#47;common&#47;types_test.go op-geth&#47;common&#47;types_test.go</span>
<span class="term-fg1">index 94492278d84ac6c787e5c0281f697943176917aa..88c642522d80076799409ed0c5cb57fdfc995e48 100644</span>
<span class="term-fg1">--- go-ethereum&#47;common&#47;types_test.go</span>
<span class="term-fg1">+++ op-geth&#47;common&#47;types_test.go</span>
<span class="term-fg36">@@ -154,6 +154,31 @@</span> 		testAddr.Hex()
 	}
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; Test checks if the customized json marshaller of MixedcaseAddress object</span>
<span class="term-fg32">+&#47;&#47; is invoked correctly. In golang the struct pointer will inherit the</span>
<span class="term-fg32">+&#47;&#47; non-pointer receiver methods, the reverse is not true. In the case of</span>
<span class="term-fg32">+&#47;&#47; MixedcaseAddress, it must define the MarshalJSON method in the object</span>
<span class="term-fg32">+&#47;&#47; but not the pointer level, so that this customized marshalled can be used</span>
<span class="term-fg32">+&#47;&#47; for both MixedcaseAddress object and pointer.</span>
<span class="term-fg32">+func TestMixedcaseAddressMarshal(t *testing.T) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		output string</span>
<span class="term-fg32">+		input  = &quot;0xae967917c465db8578ca9024c205720b1a3651A9&quot;</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	addr, err := NewMixedcaseAddressFromString(input)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatal(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	blob, err := json.Marshal(*addr)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatal(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	json.Unmarshal(blob, &amp;output)</span>
<span class="term-fg32">+	if output != input {</span>
<span class="term-fg32">+		t.Fatal(&quot;Failed to marshal&#47;unmarshal MixedcaseAddress object&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func TestMixedcaseAccount_Address(t *testing.T) {
 	&#47;&#47; https:&#47;&#47;github.com&#47;ethereum&#47;EIPs&#47;blob&#47;master&#47;EIPS&#47;eip-55.md
 	&#47;&#47; Note: 0X{checksum_addr} is not valid according to spec above
<span class="term-fg36">@@ -177,7 +202,7 @@</span> 			t.Errorf(&quot;Expected checksum %v, got checksum %v, input %v&quot;, r.Valid, got, r.A.String())
 		}
 	}
&nbsp;
<span class="term-fg31">-	&#47;&#47;These should throw exceptions:</span>
<span class="term-fg32">+	&#47;&#47; These should throw exceptions:</span>
 	var r2 []MixedcaseAddress
 	for _, r := range []string{
 		`[&quot;0x11111111111111111111122222222222233333&quot;]`,     &#47;&#47; Too short</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9e6fd8e010b61a87a1c62aca" role="button"
                   aria-expanded="false" aria-controls="id-9e6fd8e010b61a87a1c62aca">
                    <code>consensus/clique/clique.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/clique/clique.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/clique/clique.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9e6fd8e010b61a87a1c62aca"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;clique&#47;clique.go op-geth&#47;consensus&#47;clique&#47;clique.go</span>
<span class="term-fg1">index 6c20803b2a117b2fbc0e2cb46cb36e5aa4590346..2345a5ca030f767e1d6d1b5917d4a5ec15f6dd84 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;clique&#47;clique.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;clique&#47;clique.go</span>
<span class="term-fg36">@@ -301,9 +301,8 @@</span> 	}
 	if chain.Config().IsShanghai(header.Time) {
 		return fmt.Errorf(&quot;clique does not support shanghai fork&quot;)
 	}
<span class="term-fg31">-	&#47;&#47; If all checks passed, validate any special fields for hard forks</span>
<span class="term-fg31">-	if err := misc.VerifyForkHashes(chain.Config(), header, false); err != nil {</span>
<span class="term-fg31">-		return err</span>
<span class="term-fg32">+	if chain.Config().IsCancun(header.Time) {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;clique does not support cancun fork&quot;)</span>
 	}
 	&#47;&#47; All basic checks passed, verify cascading fields
 	return c.verifyCascadingFields(chain, header, parents)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f39e38de1ff1cb13640de141" role="button"
                   aria-expanded="false" aria-controls="id-f39e38de1ff1cb13640de141">
                    <code>consensus/ethash/algorithm.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/ethash/algorithm.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/ethash/algorithm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f39e38de1ff1cb13640de141"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;ethash&#47;algorithm.go op-geth&#47;consensus&#47;ethash&#47;algorithm.go</span>
<span class="term-fg1">index d539183822833c0817110bc2635c70f487e0c197..a2a6081f55cfd48c575e57f7d1e62d28ae12294b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;ethash&#47;algorithm.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;ethash&#47;algorithm.go</span>
<span class="term-fg36">@@ -163,7 +163,7 @@</span> 	size := uint64(len(cache))
 	rows := int(size) &#47; hashBytes
&nbsp;
 	&#47;&#47; Start a monitoring goroutine to report progress on low end devices
<span class="term-fg31">-	var progress uint32</span>
<span class="term-fg32">+	var progress atomic.Uint32</span>
&nbsp;
 	done := make(chan struct{})
 	defer close(done)
<span class="term-fg36">@@ -174,7 +174,7 @@</span> 			select {
 			case &lt;-done:
 				return
 			case &lt;-time.After(3 * time.Second):
<span class="term-fg31">-				logger.Info(&quot;Generating ethash verification cache&quot;, &quot;percentage&quot;, atomic.LoadUint32(&amp;progress)*100&#47;uint32(rows)&#47;(cacheRounds+1), &quot;elapsed&quot;, common.PrettyDuration(time.Since(start)))</span>
<span class="term-fg32">+				logger.Info(&quot;Generating ethash verification cache&quot;, &quot;percentage&quot;, progress.Load()*100&#47;uint32(rows)&#47;(cacheRounds+1), &quot;elapsed&quot;, common.PrettyDuration(time.Since(start)))</span>
 			}
 		}
 	}()
<span class="term-fg36">@@ -185,7 +185,7 @@</span> 	&#47;&#47; Sequentially produce the initial dataset
 	keccak512(cache, seed)
 	for offset := uint64(hashBytes); offset &lt; size; offset += hashBytes {
 		keccak512(cache[offset:], cache[offset-hashBytes:offset])
<span class="term-fg31">-		atomic.AddUint32(&amp;progress, 1)</span>
<span class="term-fg32">+		progress.Add(1)</span>
 	}
 	&#47;&#47; Use a low-round version of randmemohash
 	temp := make([]byte, hashBytes)
<span class="term-fg36">@@ -200,7 +200,7 @@</span> 			)
 			bitutil.XORBytes(temp, cache[srcOff:srcOff+hashBytes], cache[xorOff:xorOff+hashBytes])
 			keccak512(cache[dstOff:], temp)
&nbsp;
<span class="term-fg31">-			atomic.AddUint32(&amp;progress, 1)</span>
<span class="term-fg32">+			progress.Add(1)</span>
 		}
 	}
 	&#47;&#47; Swap the byte order on big endian systems and return
<span class="term-fg36">@@ -299,7 +299,7 @@</span>
 	var pend sync.WaitGroup
 	pend.Add(threads)
&nbsp;
<span class="term-fg31">-	var progress uint64</span>
<span class="term-fg32">+	var progress atomic.Uint64</span>
 	for i := 0; i &lt; threads; i++ {
 		go func(id int) {
 			defer pend.Done()
<span class="term-fg36">@@ -323,7 +323,7 @@</span> 					swap(item)
 				}
 				copy(dataset[index*hashBytes:], item)
&nbsp;
<span class="term-fg31">-				if status := atomic.AddUint64(&amp;progress, 1); status%percent == 0 {</span>
<span class="term-fg32">+				if status := progress.Add(1); status%percent == 0 {</span>
 					logger.Info(&quot;Generating DAG in progress&quot;, &quot;percentage&quot;, (status*100)&#47;(size&#47;hashBytes), &quot;elapsed&quot;, common.PrettyDuration(time.Since(start)))
 				}
 			}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a36187c452c0a8b334fa8ee" role="button"
                   aria-expanded="false" aria-controls="id-9a36187c452c0a8b334fa8ee">
                    <code>consensus/ethash/consensus.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/ethash/consensus.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/ethash/consensus.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a36187c452c0a8b334fa8ee"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;ethash&#47;consensus.go op-geth&#47;consensus&#47;ethash&#47;consensus.go</span>
<span class="term-fg1">index c3c06c541cab5cbe02d36ebb57e6e0885b2bbc74..e3e0f28b3e92fa4491a2d0ac42cf43740e94c16e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;ethash&#47;consensus.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;ethash&#47;consensus.go</span>
<span class="term-fg36">@@ -313,6 +313,9 @@</span> 	}
 	if chain.Config().IsShanghai(header.Time) {
 		return fmt.Errorf(&quot;ethash does not support shanghai fork&quot;)
 	}
<span class="term-fg32">+	if chain.Config().IsCancun(header.Time) {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;ethash does not support cancun fork&quot;)</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Verify the engine specific seal securing the block
 	if seal {
 		if err := ethash.verifySeal(chain, header, false); err != nil {
<span class="term-fg36">@@ -321,9 +324,6 @@</span> 		}
 	}
 	&#47;&#47; If all checks passed, validate any special fields for hard forks
 	if err := misc.VerifyDAOHeaderExtraData(chain.Config(), header); err != nil {
<span class="term-fg31">-		return err</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if err := misc.VerifyForkHashes(chain.Config(), header, uncle); err != nil {</span>
 		return err
 	}
 	return nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d733e97c101ea46c254d0ff4" role="button"
                   aria-expanded="false" aria-controls="id-d733e97c101ea46c254d0ff4">
                    <code>consensus/ethash/ethash.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/ethash/ethash.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/ethash/ethash.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+8</span></div>
                        <div class="text-start"><span class="text-danger">-8</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d733e97c101ea46c254d0ff4"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;ethash&#47;ethash.go op-geth&#47;consensus&#47;ethash&#47;ethash.go</span>
<span class="term-fg1">index 6cb312482795a89c404d4f316279ddbaeb2b4408..462f1095643286c116d487ed304a0487b75336e7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;ethash&#47;ethash.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;ethash&#47;ethash.go</span>
<span class="term-fg36">@@ -308,12 +308,12 @@</span> }
&nbsp;
 &#47;&#47; dataset wraps an ethash dataset with some metadata to allow easier concurrent use.
 type dataset struct {
<span class="term-fg31">-	epoch   uint64    &#47;&#47; Epoch for which this cache is relevant</span>
<span class="term-fg31">-	dump    *os.File  &#47;&#47; File descriptor of the memory mapped cache</span>
<span class="term-fg31">-	mmap    mmap.MMap &#47;&#47; Memory map itself to unmap before releasing</span>
<span class="term-fg31">-	dataset []uint32  &#47;&#47; The actual cache data content</span>
<span class="term-fg31">-	once    sync.Once &#47;&#47; Ensures the cache is generated only once</span>
<span class="term-fg31">-	done    uint32    &#47;&#47; Atomic flag to determine generation status</span>
<span class="term-fg32">+	epoch   uint64      &#47;&#47; Epoch for which this cache is relevant</span>
<span class="term-fg32">+	dump    *os.File    &#47;&#47; File descriptor of the memory mapped cache</span>
<span class="term-fg32">+	mmap    mmap.MMap   &#47;&#47; Memory map itself to unmap before releasing</span>
<span class="term-fg32">+	dataset []uint32    &#47;&#47; The actual cache data content</span>
<span class="term-fg32">+	once    sync.Once   &#47;&#47; Ensures the cache is generated only once</span>
<span class="term-fg32">+	done    atomic.Bool &#47;&#47; Atomic flag to determine generation status</span>
 }
&nbsp;
 &#47;&#47; newDataset creates a new ethash mining dataset and returns it as a plain Go
<span class="term-fg36">@@ -326,7 +326,7 @@</span> &#47;&#47; generate ensures that the dataset content is generated before use.
 func (d *dataset) generate(dir string, limit int, lock bool, test bool) {
 	d.once.Do(func() {
 		&#47;&#47; Mark the dataset generated after we&#39;re done. This is needed for remote
<span class="term-fg31">-		defer atomic.StoreUint32(&amp;d.done, 1)</span>
<span class="term-fg32">+		defer d.done.Store(true)</span>
&nbsp;
 		csize := cacheSize(d.epoch*epochLength + 1)
 		dsize := datasetSize(d.epoch*epochLength + 1)
<span class="term-fg36">@@ -390,7 +390,7 @@</span> &#47;&#47; generated returns whether this particular dataset finished generating already
 &#47;&#47; or not (it may not have been started at all). This is useful for remote miners
 &#47;&#47; to default to verification caches instead of blocking on DAG generations.
 func (d *dataset) generated() bool {
<span class="term-fg31">-	return atomic.LoadUint32(&amp;d.done) == 1</span>
<span class="term-fg32">+	return d.done.Load()</span>
 }
&nbsp;
 &#47;&#47; finalizer closes any file handlers and memory maps open.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-471e5ccdced0cdd9c6e1ee6e" role="button"
                   aria-expanded="false" aria-controls="id-471e5ccdced0cdd9c6e1ee6e">
                    <code>consensus/misc/eip1559_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/misc/eip1559_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/misc/eip1559_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-471e5ccdced0cdd9c6e1ee6e"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;eip1559_test.go op-geth&#47;consensus&#47;misc&#47;eip1559_test.go</span>
<span class="term-fg1">index 23cd9023de24ada97baa47b530d4f14bf8a43b16..1a9f96bc432624ec2a539e30478dd80f77fd721e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;misc&#47;eip1559_test.go</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;misc&#47;eip1559_test.go</span>
<span class="term-fg36">@@ -34,7 +34,6 @@</span> 		HomesteadBlock:          original.HomesteadBlock,
 		DAOForkBlock:            original.DAOForkBlock,
 		DAOForkSupport:          original.DAOForkSupport,
 		EIP150Block:             original.EIP150Block,
<span class="term-fg31">-		EIP150Hash:              original.EIP150Hash,</span>
 		EIP155Block:             original.EIP155Block,
 		EIP158Block:             original.EIP158Block,
 		ByzantiumBlock:          original.ByzantiumBlock,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f4527b5ad5422f00788ea49c" role="button"
                   aria-expanded="false" aria-controls="id-f4527b5ad5422f00788ea49c">
                    <code>consensus/misc/eip4844.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/misc/eip4844.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+54</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f4527b5ad5422f00788ea49c"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;eip4844.go op-geth&#47;consensus&#47;misc&#47;eip4844.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..66ca9bd26d864d76881a3ba7090a69f572f5e0df</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;misc&#47;eip4844.go</span>
<span class="term-fg36">@@ -0,0 +1,54 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2023 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package misc</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	minDataGasPrice            = big.NewInt(params.BlobTxMinDataGasprice)</span>
<span class="term-fg32">+	dataGaspriceUpdateFraction = big.NewInt(params.BlobTxDataGaspriceUpdateFraction)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CalcBlobFee calculates the blobfee from the header&#39;s excess data gas field.</span>
<span class="term-fg32">+func CalcBlobFee(excessDataGas *big.Int) *big.Int {</span>
<span class="term-fg32">+	&#47;&#47; If this block does not yet have EIP-4844 enabled, return the starting fee</span>
<span class="term-fg32">+	if excessDataGas == nil {</span>
<span class="term-fg32">+		return big.NewInt(params.BlobTxMinDataGasprice)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return fakeExponential(minDataGasPrice, excessDataGas, dataGaspriceUpdateFraction)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; fakeExponential approximates factor * e ** (numerator &#47; denominator) using</span>
<span class="term-fg32">+&#47;&#47; Taylor expansion.</span>
<span class="term-fg32">+func fakeExponential(factor, numerator, denominator *big.Int) *big.Int {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		output = new(big.Int)</span>
<span class="term-fg32">+		accum  = new(big.Int).Mul(factor, denominator)</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	for i := 1; accum.Sign() &gt; 0; i++ {</span>
<span class="term-fg32">+		output.Add(output, accum)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		accum.Mul(accum, numerator)</span>
<span class="term-fg32">+		accum.Div(accum, denominator)</span>
<span class="term-fg32">+		accum.Div(accum, big.NewInt(int64(i)))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return output.Div(output, denominator)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-68bda055cec63322081a289d" role="button"
                   aria-expanded="false" aria-controls="id-68bda055cec63322081a289d">
                    <code>consensus/misc/eip4844_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/consensus/misc/eip4844_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+85</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-68bda055cec63322081a289d"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;eip4844_test.go op-geth&#47;consensus&#47;misc&#47;eip4844_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5838cab8e669d0bb1717726c849930934966be47</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;consensus&#47;misc&#47;eip4844_test.go</span>
<span class="term-fg36">@@ -0,0 +1,85 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2023 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package misc</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCalcBlobFee(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		excessDataGas int64</span>
<span class="term-fg32">+		blobfee       int64</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{0, 1},</span>
<span class="term-fg32">+		{1542706, 1},</span>
<span class="term-fg32">+		{1542707, 2},</span>
<span class="term-fg32">+		{10 * 1024 * 1024, 111},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	have := CalcBlobFee(nil)</span>
<span class="term-fg32">+	if have.Int64() != params.BlobTxMinDataGasprice {</span>
<span class="term-fg32">+		t.Errorf(&quot;nil test: blobfee mismatch: have %v, want %v&quot;, have, params.BlobTxMinDataGasprice)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for i, tt := range tests {</span>
<span class="term-fg32">+		have := CalcBlobFee(big.NewInt(tt.excessDataGas))</span>
<span class="term-fg32">+		if have.Int64() != tt.blobfee {</span>
<span class="term-fg32">+			t.Errorf(&quot;test %d: blobfee mismatch: have %v want %v&quot;, i, have, tt.blobfee)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFakeExponential(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		factor      int64</span>
<span class="term-fg32">+		numerator   int64</span>
<span class="term-fg32">+		denominator int64</span>
<span class="term-fg32">+		want        int64</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		&#47;&#47; When numerator == 0 the return value should always equal the value of factor</span>
<span class="term-fg32">+		{1, 0, 1, 1},</span>
<span class="term-fg32">+		{38493, 0, 1000, 38493},</span>
<span class="term-fg32">+		{0, 1234, 2345, 0}, &#47;&#47; should be 0</span>
<span class="term-fg32">+		{1, 2, 1, 6},       &#47;&#47; approximate 7.389</span>
<span class="term-fg32">+		{1, 4, 2, 6},</span>
<span class="term-fg32">+		{1, 3, 1, 16}, &#47;&#47; approximate 20.09</span>
<span class="term-fg32">+		{1, 6, 2, 18},</span>
<span class="term-fg32">+		{1, 4, 1, 49}, &#47;&#47; approximate 54.60</span>
<span class="term-fg32">+		{1, 8, 2, 50},</span>
<span class="term-fg32">+		{10, 8, 2, 542}, &#47;&#47; approximate 540.598</span>
<span class="term-fg32">+		{11, 8, 2, 596}, &#47;&#47; approximate 600.58</span>
<span class="term-fg32">+		{1, 5, 1, 136},  &#47;&#47; approximate 148.4</span>
<span class="term-fg32">+		{1, 5, 2, 11},   &#47;&#47; approximate 12.18</span>
<span class="term-fg32">+		{2, 5, 2, 23},   &#47;&#47; approximate 24.36</span>
<span class="term-fg32">+		{1, 50000000, 2225652, 5709098764},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for i, tt := range tests {</span>
<span class="term-fg32">+		f, n, d := big.NewInt(tt.factor), big.NewInt(tt.numerator), big.NewInt(tt.denominator)</span>
<span class="term-fg32">+		original := fmt.Sprintf(&quot;%d %d %d&quot;, f, n, d)</span>
<span class="term-fg32">+		have := fakeExponential(f, n, d)</span>
<span class="term-fg32">+		if have.Int64() != tt.want {</span>
<span class="term-fg32">+			t.Errorf(&quot;test %d: fake exponential mismatch: have %v want %v&quot;, i, have, tt.want)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		later := fmt.Sprintf(&quot;%d %d %d&quot;, f, n, d)</span>
<span class="term-fg32">+		if original != later {</span>
<span class="term-fg32">+			t.Errorf(&quot;test %d: fake exponential modified arguments: have\n%v\nwant\n%v&quot;, i, later, original)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c8ac23b58e3cf7648442959e" role="button"
                   aria-expanded="false" aria-controls="id-c8ac23b58e3cf7648442959e">
                    <code>consensus/misc/forks.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/consensus/misc/forks.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <span class="text-muted">(deleted)</span>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-43</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c8ac23b58e3cf7648442959e"><span class="term-fg1">diff --git go-ethereum&#47;consensus&#47;misc&#47;forks.go op-geth&#47;consensus&#47;misc&#47;forks.go</span>
<span class="term-fg1">deleted file mode 100644</span>
<span class="term-fg1">index a6f3303ea6faa4a46c4660a5fe67f7cd90da070c..0000000000000000000000000000000000000000</span>
<span class="term-fg1">--- go-ethereum&#47;consensus&#47;misc&#47;forks.go</span>
<span class="term-fg1">+++ &#47;dev&#47;null</span>
<span class="term-fg36">@@ -1,43 +0,0 @@</span>
<span class="term-fg31">-&#47;&#47; Copyright 2017 The go-ethereum Authors</span>
<span class="term-fg31">-&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg31">-&#47;&#47;</span>
<span class="term-fg31">-&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg31">-&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg31">-&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg31">-&#47;&#47; (at your option) any later version.</span>
<span class="term-fg31">-&#47;&#47;</span>
<span class="term-fg31">-&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg31">-&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg31">-&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg31">-&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg31">-&#47;&#47;</span>
<span class="term-fg31">-&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg31">-&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-package misc</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-import (</span>
<span class="term-fg31">-	&quot;fmt&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg31">-)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-&#47;&#47; VerifyForkHashes verifies that blocks conforming to network hard-forks do have</span>
<span class="term-fg31">-&#47;&#47; the correct hashes, to avoid clients going off on different chains. This is an</span>
<span class="term-fg31">-&#47;&#47; optional feature.</span>
<span class="term-fg31">-func VerifyForkHashes(config *params.ChainConfig, header *types.Header, uncle bool) error {</span>
<span class="term-fg31">-	&#47;&#47; We don&#39;t care about uncles</span>
<span class="term-fg31">-	if uncle {</span>
<span class="term-fg31">-		return nil</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; If the homestead reprice hash is set, validate it</span>
<span class="term-fg31">-	if config.EIP150Block != nil &amp;&amp; config.EIP150Block.Cmp(header.Number) == 0 {</span>
<span class="term-fg31">-		if config.EIP150Hash != (common.Hash{}) &amp;&amp; config.EIP150Hash != header.Hash() {</span>
<span class="term-fg31">-			return fmt.Errorf(&quot;homestead gas reprice fork: have %#x, want %#x&quot;, header.Hash(), config.EIP150Hash)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; All ok, return</span>
<span class="term-fg31">-	return nil</span>
<span class="term-fg31">-}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a0b37cac2dd277de0306fc15" role="button"
                   aria-expanded="false" aria-controls="id-a0b37cac2dd277de0306fc15">
                    <code>core/blockchain.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/blockchain.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/blockchain.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+20</span></div>
                        <div class="text-start"><span class="text-danger">-17</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a0b37cac2dd277de0306fc15"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;blockchain.go op-geth&#47;core&#47;blockchain.go</span>
<span class="term-fg1">index 8fc520e7760ff825b8691aa90f868f971ab50f9b..c3119f8378bb92c72db6cd994a084946ebf9f69c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;blockchain.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;blockchain.go</span>
<span class="term-fg36">@@ -174,7 +174,7 @@</span> 	snaps         *snapshot.Tree                   &#47;&#47; Snapshot tree for fast trie leaf access
 	triegc        *prque.Prque[int64, common.Hash] &#47;&#47; Priority queue mapping block numbers to tries to gc
 	gcproc        time.Duration                    &#47;&#47; Accumulates canonical block processing for trie dumping
 	lastWrite     uint64                           &#47;&#47; Last block when the state was flushed
<span class="term-fg31">-	flushInterval int64                            &#47;&#47; Time interval (processing time) after which to flush a state</span>
<span class="term-fg32">+	flushInterval atomic.Int64                     &#47;&#47; Time interval (processing time) after which to flush a state</span>
 	triedb        *trie.Database                   &#47;&#47; The database handler for maintaining trie nodes.
 	stateCache    state.Database                   &#47;&#47; State database to reuse between imports (contains state cache)
&nbsp;
<span class="term-fg36">@@ -215,8 +215,8 @@</span> 	futureBlocks *lru.Cache[common.Hash, *types.Block]
&nbsp;
 	wg            sync.WaitGroup &#47;&#47;
 	quit          chan struct{}  &#47;&#47; shutdown signal, closed in Stop.
<span class="term-fg31">-	running       int32          &#47;&#47; 0 if chain is running, 1 when stopped</span>
<span class="term-fg31">-	procInterrupt int32          &#47;&#47; interrupt signaler for block processing</span>
<span class="term-fg32">+	stopping      atomic.Bool    &#47;&#47; false if chain is running, true when stopped</span>
<span class="term-fg32">+	procInterrupt atomic.Bool    &#47;&#47; interrupt signaler for block processing</span>
&nbsp;
 	engine     consensus.Engine
 	validator  Validator &#47;&#47; Block and state validator interface
<span class="term-fg36">@@ -233,7 +233,6 @@</span> func NewBlockChain(db ethdb.Database, cacheConfig *CacheConfig, genesis *Genesis, overrides *ChainOverrides, engine consensus.Engine, vmConfig vm.Config, shouldPreserve func(header *types.Header) bool, txLookupLimit *uint64) (*BlockChain, error) {
 	if cacheConfig == nil {
 		cacheConfig = defaultCacheConfig
 	}
<span class="term-fg31">-</span>
 	&#47;&#47; Open trie database with provided config
 	triedb := trie.NewDatabaseWithConfig(db, &amp;trie.Config{
 		Cache:     cacheConfig.TrieCleanLimit,
<span class="term-fg36">@@ -255,12 +254,15 @@</span> 	}
 	log.Info(strings.Repeat(&quot;-&quot;, 153))
 	log.Info(&quot;&quot;)
&nbsp;
<span class="term-fg32">+	if chainConfig.IsOptimism() &amp;&amp; chainConfig.RegolithTime == nil {</span>
<span class="term-fg32">+		log.Warn(&quot;Optimism RegolithTime has not been set&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	bc := &amp;BlockChain{
 		chainConfig:   chainConfig,
 		cacheConfig:   cacheConfig,
 		db:            db,
 		triedb:        triedb,
<span class="term-fg31">-		flushInterval: int64(cacheConfig.TrieTimeLimit),</span>
 		triegc:        prque.New[int64, common.Hash](nil),
 		quit:          make(chan struct{}),
 		chainmu:       syncx.NewClosableMutex(),
<span class="term-fg36">@@ -273,6 +275,7 @@</span> 		futureBlocks:  lru.NewCache[common.Hash, *types.Block](maxFutureBlocks),
 		engine:        engine,
 		vmConfig:      vmConfig,
 	}
<span class="term-fg32">+	bc.flushInterval.Store(int64(cacheConfig.TrieTimeLimit))</span>
 	bc.forker = NewForkChoice(bc, shouldPreserve)
 	bc.stateCache = state.NewDatabaseWithNodeDB(bc.db, bc.triedb)
 	bc.validator = NewBlockValidator(chainConfig, bc, engine)
<span class="term-fg36">@@ -909,14 +912,14 @@</span> 	bc.currentBlock.Store(block.Header())
 	headBlockGauge.Update(int64(block.NumberU64()))
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; stop stops the blockchain service. If any imports are currently in progress</span>
<span class="term-fg32">+&#47;&#47; stopWithoutSaving stops the blockchain service. If any imports are currently in progress</span>
 &#47;&#47; it will abort them using the procInterrupt. This method stops all running
 &#47;&#47; goroutines, but does not do all the post-stop work of persisting data.
 &#47;&#47; OBS! It is generally recommended to use the Stop method!
 &#47;&#47; This method has been exposed to allow tests to stop the blockchain while simulating
 &#47;&#47; a crash.
 func (bc *BlockChain) stopWithoutSaving() {
<span class="term-fg31">-	if !atomic.CompareAndSwapInt32(&amp;bc.running, 0, 1) {</span>
<span class="term-fg32">+	if !bc.stopping.CompareAndSwap(false, true) {</span>
 		return
 	}
&nbsp;
<span class="term-fg36">@@ -998,12 +1001,12 @@</span> &#47;&#47; StopInsert interrupts all insertion methods, causing them to return
 &#47;&#47; errInsertionInterrupted as soon as possible. Insertion is permanently disabled after
 &#47;&#47; calling this method.
 func (bc *BlockChain) StopInsert() {
<span class="term-fg31">-	atomic.StoreInt32(&amp;bc.procInterrupt, 1)</span>
<span class="term-fg32">+	bc.procInterrupt.Store(true)</span>
 }
&nbsp;
 &#47;&#47; insertStopped returns true after StopInsert has been called.
 func (bc *BlockChain) insertStopped() bool {
<span class="term-fg31">-	return atomic.LoadInt32(&amp;bc.procInterrupt) == 1</span>
<span class="term-fg32">+	return bc.procInterrupt.Load()</span>
 }
&nbsp;
 func (bc *BlockChain) procFutureBlocks() {
<span class="term-fg36">@@ -1382,7 +1385,7 @@</span> 		bc.triedb.Cap(limit - ethdb.IdealBatchSize)
 	}
 	&#47;&#47; Find the next state trie we need to commit
 	chosen := current - TriesInMemory
<span class="term-fg31">-	flushInterval := time.Duration(atomic.LoadInt64(&amp;bc.flushInterval))</span>
<span class="term-fg32">+	flushInterval := time.Duration(bc.flushInterval.Load())</span>
 	&#47;&#47; If we exceeded time allowance, flush an entire trie to disk
 	if bc.gcproc &gt; flushInterval {
 		&#47;&#47; If the header is missing (canonical chain behind), we&#39;re reorging a low
<span class="term-fg36">@@ -1735,7 +1738,7 @@</span> 		activeState = statedb
&nbsp;
 		&#47;&#47; If we have a followup block, run that against the current state to pre-cache
 		&#47;&#47; transactions and probabilistically some of the account&#47;storage trie nodes.
<span class="term-fg31">-		var followupInterrupt uint32</span>
<span class="term-fg32">+		var followupInterrupt atomic.Bool</span>
 		if !bc.cacheConfig.TrieCleanNoPrefetch {
 			if followup, err := it.peek(); followup != nil &amp;&amp; err == nil {
 				throwaway, _ := state.New(parent.Root, bc.stateCache, bc.snaps)
<span class="term-fg36">@@ -1744,7 +1747,7 @@</span> 				go func(start time.Time, followup *types.Block, throwaway *state.StateDB) {
 					bc.prefetcher.Prefetch(followup, throwaway, bc.vmConfig, &amp;followupInterrupt)
&nbsp;
 					blockPrefetchExecuteTimer.Update(time.Since(start))
<span class="term-fg31">-					if atomic.LoadUint32(&amp;followupInterrupt) == 1 {</span>
<span class="term-fg32">+					if followupInterrupt.Load() {</span>
 						blockPrefetchInterruptMeter.Mark(1)
 					}
 				}(time.Now(), followup, throwaway)
<span class="term-fg36">@@ -1756,7 +1759,7 @@</span> 		pstart := time.Now()
 		receipts, logs, usedGas, err := bc.processor.Process(block, statedb, bc.vmConfig)
 		if err != nil {
 			bc.reportBlock(block, receipts, err)
<span class="term-fg31">-			atomic.StoreUint32(&amp;followupInterrupt, 1)</span>
<span class="term-fg32">+			followupInterrupt.Store(true)</span>
 			return it.index, err
 		}
 		ptime := time.Since(pstart)
<span class="term-fg36">@@ -1764,7 +1767,7 @@</span>
 		vstart := time.Now()
 		if err := bc.validator.ValidateState(block, statedb, receipts, usedGas); err != nil {
 			bc.reportBlock(block, receipts, err)
<span class="term-fg31">-			atomic.StoreUint32(&amp;followupInterrupt, 1)</span>
<span class="term-fg32">+			followupInterrupt.Store(true)</span>
 			return it.index, err
 		}
 		vtime := time.Since(vstart)
<span class="term-fg36">@@ -1797,7 +1800,7 @@</span> 			err = bc.writeBlockWithState(block, receipts, statedb)
 		} else {
 			status, err = bc.writeBlockAndSetHead(block, receipts, logs, statedb, false)
 		}
<span class="term-fg31">-		atomic.StoreUint32(&amp;followupInterrupt, 1)</span>
<span class="term-fg32">+		followupInterrupt.Store(true)</span>
 		if err != nil {
 			return it.index, err
 		}
<span class="term-fg36">@@ -2050,7 +2053,7 @@</span> &#47;&#47; collectLogs collects the logs that were generated or removed during
 &#47;&#47; the processing of a block. These logs are later announced as deleted or reborn.
 func (bc *BlockChain) collectLogs(b *types.Block, removed bool) []*types.Log {
 	receipts := rawdb.ReadRawReceipts(bc.db, b.Hash(), b.NumberU64())
<span class="term-fg31">-	receipts.DeriveFields(bc.chainConfig, b.Hash(), b.NumberU64(), b.BaseFee(), b.Transactions())</span>
<span class="term-fg32">+	receipts.DeriveFields(bc.chainConfig, b.Hash(), b.NumberU64(), b.Time(), b.BaseFee(), b.Transactions())</span>
&nbsp;
 	var logs []*types.Log
 	for _, receipt := range receipts {
<span class="term-fg36">@@ -2497,5 +2500,5 @@</span> &#47;&#47; SetTrieFlushInterval configures how often in-memory tries are persisted to disk.
 &#47;&#47; The interval is in terms of block processing time, not wall clock.
 &#47;&#47; It is thread-safe and can be called repeatedly without side effects.
 func (bc *BlockChain) SetTrieFlushInterval(interval time.Duration) {
<span class="term-fg31">-	atomic.StoreInt64(&amp;bc.flushInterval, int64(interval))</span>
<span class="term-fg32">+	bc.flushInterval.Store(int64(interval))</span>
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b70b126a2fda4d41a4f15e9" role="button"
                   aria-expanded="false" aria-controls="id-5b70b126a2fda4d41a4f15e9">
                    <code>core/blockchain_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/blockchain_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/blockchain_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b70b126a2fda4d41a4f15e9"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;blockchain_test.go op-geth&#47;core&#47;blockchain_test.go</span>
<span class="term-fg1">index 0f9ef6a1921a51af022926c8075ba8808f011480..01ad157cc290f90f55703ffbd61246f7aa6689fa 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;blockchain_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;blockchain_test.go</span>
<span class="term-fg36">@@ -3024,7 +3024,6 @@</span> 		b.AddTx(tx)
 	})
 	&#47;&#47; Import the canonical chain
 	chain, err := NewBlockChain(rawdb.NewMemoryDatabase(), nil, gspec, nil, engine, vm.Config{
<span class="term-fg31">-		Debug:  true,</span>
 		Tracer: logger.NewJSONLogger(nil, os.Stdout),
 	}, nil, nil)
 	if err != nil {
<span class="term-fg36">@@ -3102,7 +3101,6 @@</span> 		b.AddTx(tx)
 	})
 	&#47;&#47; Import the canonical chain
 	chain, err := NewBlockChain(rawdb.NewMemoryDatabase(), nil, gspec, nil, engine, vm.Config{
<span class="term-fg31">-		Debug:  true,</span>
 		Tracer: logger.NewJSONLogger(nil, os.Stdout),
 	}, nil, nil)
 	if err != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c132d70ca6b7dfbb2aa02b1" role="button"
                   aria-expanded="false" aria-controls="id-8c132d70ca6b7dfbb2aa02b1">
                    <code>core/bloombits/matcher.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/bloombits/matcher.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/bloombits/matcher.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c132d70ca6b7dfbb2aa02b1"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;bloombits&#47;matcher.go op-geth&#47;core&#47;bloombits&#47;matcher.go</span>
<span class="term-fg1">index 0d2f6f950d86a6f74e53317e22f1873711e48add..d8f932041bc0d28ce2af5428068ca46912269f4f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;bloombits&#47;matcher.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;bloombits&#47;matcher.go</span>
<span class="term-fg36">@@ -83,7 +83,7 @@</span> 	counters   chan chan uint       &#47;&#47; Retriever processes waiting for task count reports
 	retrievals chan chan *Retrieval &#47;&#47; Retriever processes waiting for task allocations
 	deliveries chan *Retrieval      &#47;&#47; Retriever processes waiting for task response deliveries
&nbsp;
<span class="term-fg31">-	running uint32 &#47;&#47; Atomic flag whether a session is live or not</span>
<span class="term-fg32">+	running atomic.Bool &#47;&#47; Atomic flag whether a session is live or not</span>
 }
&nbsp;
 &#47;&#47; NewMatcher creates a new pipeline for retrieving bloom bit streams and doing
<span class="term-fg36">@@ -146,10 +146,10 @@</span> &#47;&#47; a given range of blocks. If there are no more matches in the range, the result
 &#47;&#47; channel is closed.
 func (m *Matcher) Start(ctx context.Context, begin, end uint64, results chan uint64) (*MatcherSession, error) {
 	&#47;&#47; Make sure we&#39;re not creating concurrent sessions
<span class="term-fg31">-	if atomic.SwapUint32(&amp;m.running, 1) == 1 {</span>
<span class="term-fg32">+	if m.running.Swap(true) {</span>
 		return nil, errors.New(&quot;matcher already running&quot;)
 	}
<span class="term-fg31">-	defer atomic.StoreUint32(&amp;m.running, 0)</span>
<span class="term-fg32">+	defer m.running.Store(false)</span>
&nbsp;
 	&#47;&#47; Initiate a new matching round
 	session := &amp;MatcherSession{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f8e4afa5f4dc19b4be770144" role="button"
                   aria-expanded="false" aria-controls="id-f8e4afa5f4dc19b4be770144">
                    <code>core/bloombits/matcher_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/bloombits/matcher_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/bloombits/matcher_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f8e4afa5f4dc19b4be770144"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;bloombits&#47;matcher_test.go op-geth&#47;core&#47;bloombits&#47;matcher_test.go</span>
<span class="term-fg1">index 93d4632b8587bf8b0b768fe649682f4c90c29629..36764c3f174b421cd52a1f0daa15009c1bce31e1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;bloombits&#47;matcher_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;bloombits&#47;matcher_test.go</span>
<span class="term-fg36">@@ -160,7 +160,7 @@</span> 			}
 		}
 	}
 	&#47;&#47; Track the number of retrieval requests made
<span class="term-fg31">-	var requested uint32</span>
<span class="term-fg32">+	var requested atomic.Uint32</span>
&nbsp;
 	&#47;&#47; Start the matching session for the filter and the retriever goroutines
 	quit := make(chan struct{})
<span class="term-fg36">@@ -208,15 +208,15 @@</span> 	&#47;&#47; Clean up the session and ensure we match the expected retrieval count
 	session.Close()
 	close(quit)
&nbsp;
<span class="term-fg31">-	if retrievals != 0 &amp;&amp; requested != retrievals {</span>
<span class="term-fg31">-		t.Errorf(&quot;filter = %v  blocks = %v  intermittent = %v: request count mismatch, have #%v, want #%v&quot;, filter, blocks, intermittent, requested, retrievals)</span>
<span class="term-fg32">+	if retrievals != 0 &amp;&amp; requested.Load() != retrievals {</span>
<span class="term-fg32">+		t.Errorf(&quot;filter = %v  blocks = %v  intermittent = %v: request count mismatch, have #%v, want #%v&quot;, filter, blocks, intermittent, requested.Load(), retrievals)</span>
 	}
<span class="term-fg31">-	return requested</span>
<span class="term-fg32">+	return requested.Load()</span>
 }
&nbsp;
 &#47;&#47; startRetrievers starts a batch of goroutines listening for section requests
 &#47;&#47; and serving them.
<span class="term-fg31">-func startRetrievers(session *MatcherSession, quit chan struct{}, retrievals *uint32, batch int) {</span>
<span class="term-fg32">+func startRetrievers(session *MatcherSession, quit chan struct{}, retrievals *atomic.Uint32, batch int) {</span>
 	requests := make(chan chan *Retrieval)
&nbsp;
 	for i := 0; i &lt; 10; i++ {
<span class="term-fg36">@@ -238,7 +238,7 @@</span> 					task.Bitsets = make([][]byte, len(task.Sections))
 					for i, section := range task.Sections {
 						if rand.Int()%4 != 0 { &#47;&#47; Handle occasional missing deliveries
 							task.Bitsets[i] = generateBitset(task.Bit, section)
<span class="term-fg31">-							atomic.AddUint32(retrievals, 1)</span>
<span class="term-fg32">+							retrievals.Add(1)</span>
 						}
 					}
 					request &lt;- task</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-af9f953c8dee6e8ef7395705" role="button"
                   aria-expanded="false" aria-controls="id-af9f953c8dee6e8ef7395705">
                    <code>core/bloombits/scheduler_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/bloombits/scheduler_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/bloombits/scheduler_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-af9f953c8dee6e8ef7395705"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;bloombits&#47;scheduler_test.go op-geth&#47;core&#47;bloombits&#47;scheduler_test.go</span>
<span class="term-fg1">index 49e113c117bad675e0141ebb4ea01fbcd174cbf8..dcaaa915258a0fe26d893fe626acfb7e975a47c3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;bloombits&#47;scheduler_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;bloombits&#47;scheduler_test.go</span>
<span class="term-fg36">@@ -45,13 +45,13 @@</span>
 	fetch := make(chan *request, 16)
 	defer close(fetch)
&nbsp;
<span class="term-fg31">-	var delivered uint32</span>
<span class="term-fg32">+	var delivered atomic.Uint32</span>
 	for i := 0; i &lt; fetchers; i++ {
 		go func() {
 			defer fetchPend.Done()
&nbsp;
 			for req := range fetch {
<span class="term-fg31">-				atomic.AddUint32(&amp;delivered, 1)</span>
<span class="term-fg32">+				delivered.Add(1)</span>
&nbsp;
 				f.deliver([]uint64{
 					req.section + uint64(requests), &#47;&#47; Non-requested data (ensure it doesn&#39;t go out of bounds)
<span class="term-fg36">@@ -97,7 +97,7 @@</span> 		}()
 	}
 	pend.Wait()
&nbsp;
<span class="term-fg31">-	if have := atomic.LoadUint32(&amp;delivered); int(have) != requests {</span>
<span class="term-fg32">+	if have := delivered.Load(); int(have) != requests {</span>
 		t.Errorf(&quot;request count mismatch: have %v, want %v&quot;, have, requests)
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9f2c39697ec16da4cfa2d2e3" role="button"
                   aria-expanded="false" aria-controls="id-9f2c39697ec16da4cfa2d2e3">
                    <code>core/chain_indexer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/chain_indexer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/chain_indexer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9f2c39697ec16da4cfa2d2e3"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;chain_indexer.go op-geth&#47;core&#47;chain_indexer.go</span>
<span class="term-fg1">index 95901a0eaa71f20e03a69fbe6b5dd1dca3a4645e..23ab23ef0fb902f251f9fcb56341f29c1f1d1790 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;chain_indexer.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;chain_indexer.go</span>
<span class="term-fg36">@@ -75,7 +75,7 @@</span> 	indexDb  ethdb.Database      &#47;&#47; Prefixed table-view of the db to write index metadata into
 	backend  ChainIndexerBackend &#47;&#47; Background processor generating the index data content
 	children []*ChainIndexer     &#47;&#47; Child indexers to cascade chain updates to
&nbsp;
<span class="term-fg31">-	active    uint32          &#47;&#47; Flag whether the event loop was started</span>
<span class="term-fg32">+	active    atomic.Bool     &#47;&#47; Flag whether the event loop was started</span>
 	update    chan struct{}   &#47;&#47; Notification channel that headers should be processed
 	quit      chan chan error &#47;&#47; Quit channel to tear down running goroutines
 	ctx       context.Context
<span class="term-fg36">@@ -166,7 +166,7 @@</span> 	if err := &lt;-errc; err != nil {
 		errs = append(errs, err)
 	}
 	&#47;&#47; If needed, tear down the secondary event loop
<span class="term-fg31">-	if atomic.LoadUint32(&amp;c.active) != 0 {</span>
<span class="term-fg32">+	if c.active.Load() {</span>
 		c.quit &lt;- errc
 		if err := &lt;-errc; err != nil {
 			errs = append(errs, err)
<span class="term-fg36">@@ -196,7 +196,7 @@</span> &#47;&#47; started for the outermost indexer to push chain head events into a processing
 &#47;&#47; queue.
 func (c *ChainIndexer) eventLoop(currentHeader *types.Header, events chan ChainHeadEvent, sub event.Subscription) {
 	&#47;&#47; Mark the chain indexer as active, requiring an additional teardown
<span class="term-fg31">-	atomic.StoreUint32(&amp;c.active, 1)</span>
<span class="term-fg32">+	c.active.Store(true)</span>
&nbsp;
 	defer sub.Unsubscribe()
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e091f1799bb1e9c360f16193" role="button"
                   aria-expanded="false" aria-controls="id-e091f1799bb1e9c360f16193">
                    <code>core/error.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/error.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/error.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e091f1799bb1e9c360f16193"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;error.go op-geth&#47;core&#47;error.go</span>
<span class="term-fg1">index 872ba8d365d8c152641f2dcd32b39343a285bd4d..d99b85e2490725b35c5797c93060ac7009b909d8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;error.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;error.go</span>
<span class="term-fg36">@@ -100,4 +100,7 @@</span> 	ErrFeeCapTooLow = errors.New(&quot;max fee per gas less than block base fee&quot;)
&nbsp;
 	&#47;&#47; ErrSenderNoEOA is returned if the sender of a transaction is a contract.
 	ErrSenderNoEOA = errors.New(&quot;sender not an eoa&quot;)
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; ErrSystemTxNotSupported is returned for any deposit tx with IsSystemTx=true after the Regolith fork</span>
<span class="term-fg32">+	ErrSystemTxNotSupported = errors.New(&quot;system tx not supported&quot;)</span>
 )</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f66dd13dcd9970a22b592cda" role="button"
                   aria-expanded="false" aria-controls="id-f66dd13dcd9970a22b592cda">
                    <code>core/evm.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/evm.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/evm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f66dd13dcd9970a22b592cda"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;evm.go op-geth&#47;core&#47;evm.go</span>
<span class="term-fg1">index bd4f2b0e55f1cf039549830eed93514272962171..527a81ad29d6d1b2faedb37579fce28d2ad24efd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;evm.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;evm.go</span>
<span class="term-fg36">@@ -23,6 +23,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
 )
&nbsp;
 &#47;&#47; ChainContext supports retrieving headers and consensus parameters from the
<span class="term-fg36">@@ -36,7 +37,7 @@</span> 	GetHeader(common.Hash, uint64) *types.Header
 }
&nbsp;
 &#47;&#47; NewEVMBlockContext creates a new context for use in the EVM.
<span class="term-fg31">-func NewEVMBlockContext(header *types.Header, chain ChainContext, author *common.Address) vm.BlockContext {</span>
<span class="term-fg32">+func NewEVMBlockContext(header *types.Header, chain ChainContext, author *common.Address, config *params.ChainConfig, statedb types.StateGetter) vm.BlockContext {</span>
 	var (
 		beneficiary common.Address
 		baseFee     *big.Int
<span class="term-fg36">@@ -66,6 +67,7 @@</span> 		Difficulty:  new(big.Int).Set(header.Difficulty),
 		BaseFee:     baseFee,
 		GasLimit:    header.GasLimit,
 		Random:      random,
<span class="term-fg32">+		L1CostFunc:  types.NewL1CostFunc(config, statedb),</span>
 	}
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b558db2be184d369325bc1ae" role="button"
                   aria-expanded="false" aria-controls="id-b558db2be184d369325bc1ae">
                    <code>core/rawdb/accessors_chain.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/accessors_chain.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/accessors_chain.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b558db2be184d369325bc1ae"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;accessors_chain.go op-geth&#47;core&#47;rawdb&#47;accessors_chain.go</span>
<span class="term-fg1">index 3d0f36ba7644cce44fb330e4201cd544e483b659..7e41476b42e7734471dd99c3223af79979021d6e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;accessors_chain.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;accessors_chain.go</span>
<span class="term-fg36">@@ -637,13 +637,11 @@</span> 		log.Error(&quot;Missing body but have receipt&quot;, &quot;hash&quot;, hash, &quot;number&quot;, number)
 		return nil
 	}
 	header := ReadHeader(db, hash, number)
<span class="term-fg31">-	var baseFee *big.Int</span>
 	if header == nil {
<span class="term-fg31">-		baseFee = big.NewInt(0)</span>
<span class="term-fg31">-	} else {</span>
<span class="term-fg31">-		baseFee = header.BaseFee</span>
<span class="term-fg32">+		log.Error(&quot;Missing header but have receipt&quot;, &quot;hash&quot;, hash, &quot;number&quot;, number)</span>
<span class="term-fg32">+		return nil</span>
 	}
<span class="term-fg31">-	if err := receipts.DeriveFields(config, hash, number, baseFee, body.Transactions); err != nil {</span>
<span class="term-fg32">+	if err := receipts.DeriveFields(config, hash, number, header.Time, header.BaseFee, body.Transactions); err != nil {</span>
 		log.Error(&quot;Failed to derive block receipts fields&quot;, &quot;hash&quot;, hash, &quot;number&quot;, number, &quot;err&quot;, err)
 		return nil
 	}
<span class="term-fg36">@@ -681,6 +679,15 @@</span> type storedReceiptRLP struct {
 	PostStateOrStatus []byte
 	CumulativeGasUsed uint64
 	Logs              []*types.Log
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Remaining fields are declared to allow the receipt RLP to be parsed without errors.</span>
<span class="term-fg32">+	&#47;&#47; However, they must not be used as they may not be populated correctly due to multiple receipt formats</span>
<span class="term-fg32">+	&#47;&#47; being combined into a single list of optional fields which can be mistaken for each other.</span>
<span class="term-fg32">+	&#47;&#47; DepositNonce (*uint64) from Regolith deposit tx receipts will be parsed into L1GasUsed</span>
<span class="term-fg32">+	L1GasUsed  *big.Int `rlp:&quot;optional&quot;` &#47;&#47; OVM legacy</span>
<span class="term-fg32">+	L1GasPrice *big.Int `rlp:&quot;optional&quot;` &#47;&#47; OVM legacy</span>
<span class="term-fg32">+	L1Fee      *big.Int `rlp:&quot;optional&quot;` &#47;&#47; OVM legacy</span>
<span class="term-fg32">+	FeeScalar  string   `rlp:&quot;optional&quot;` &#47;&#47; OVM legacy</span>
 }
&nbsp;
 &#47;&#47; ReceiptLogs is a barebone version of ReceiptForStorage which only keeps</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fcfe4ab316f6f2cf69e11845" role="button"
                   aria-expanded="false" aria-controls="id-fcfe4ab316f6f2cf69e11845">
                    <code>core/rawdb/accessors_chain_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/accessors_chain_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/accessors_chain_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+41</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fcfe4ab316f6f2cf69e11845"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;accessors_chain_test.go op-geth&#47;core&#47;rawdb&#47;accessors_chain_test.go</span>
<span class="term-fg1">index 84eae1d90d25fc6025854543f97a33a704da031e..a99da4a84bd2ef22eae2d0f7f2af225443993dfa 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;accessors_chain_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;accessors_chain_test.go</span>
<span class="term-fg36">@@ -27,10 +27,12 @@</span> 	&quot;reflect&quot;
 	&quot;testing&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
 	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;
 )
&nbsp;
<span class="term-fg36">@@ -347,6 +349,9 @@</span> 	&#47;&#47; Create a live block since we need metadata to reconstruct the receipt
 	tx1 := types.NewTransaction(1, common.HexToAddress(&quot;0x1&quot;), big.NewInt(1), 1, big.NewInt(1), nil)
 	tx2 := types.NewTransaction(2, common.HexToAddress(&quot;0x2&quot;), big.NewInt(2), 2, big.NewInt(2), nil)
&nbsp;
<span class="term-fg32">+	header := &amp;types.Header{</span>
<span class="term-fg32">+		Number: big.NewInt(0),</span>
<span class="term-fg32">+	}</span>
 	body := &amp;types.Body{Transactions: types.Transactions{tx1, tx2}}
&nbsp;
 	&#47;&#47; Create the two receipts to manage afterwards
<span class="term-fg36">@@ -378,12 +383,15 @@</span> 	receipt2.Bloom = types.CreateBloom(types.Receipts{receipt2})
 	receipts := []*types.Receipt{receipt1, receipt2}
&nbsp;
 	&#47;&#47; Check that no receipt entries are in a pristine database
<span class="term-fg31">-	hash := common.BytesToHash([]byte{0x03, 0x14})</span>
<span class="term-fg32">+	hash := header.Hash()</span>
 	if rs := ReadReceipts(db, hash, 0, params.TestChainConfig); len(rs) != 0 {
 		t.Fatalf(&quot;non existent receipts returned: %v&quot;, rs)
 	}
 	&#47;&#47; Insert the body that corresponds to the receipts
 	WriteBody(db, hash, 0, body)
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Insert the header that corresponds to the receipts</span>
<span class="term-fg32">+	WriteHeader(db, header)</span>
&nbsp;
 	&#47;&#47; Insert the receipt slice into the database and check presence
 	WriteReceipts(db, hash, 0, receipts)
<span class="term-fg36">@@ -698,6 +706,7 @@</span>
 	body := &amp;types.Body{Transactions: types.Transactions{tx1, tx2}}
&nbsp;
 	&#47;&#47; Create the two receipts to manage afterwards
<span class="term-fg32">+	depositNonce := uint64(math.MaxUint64)</span>
 	receipt1 := &amp;types.Receipt{
 		Status:            types.ReceiptStatusFailed,
 		CumulativeGasUsed: 1,
<span class="term-fg36">@@ -708,6 +717,7 @@</span> 		},
 		TxHash:          tx1.Hash(),
 		ContractAddress: common.BytesToAddress([]byte{0x01, 0x11, 0x11}),
 		GasUsed:         111111,
<span class="term-fg32">+		DepositNonce:    &amp;depositNonce,</span>
 	}
 	receipt1.Bloom = types.CreateBloom(types.Receipts{receipt1})
&nbsp;
<span class="term-fg36">@@ -765,6 +775,36 @@</span> 				t.Fatalf(&quot;receipt #%d: receipt mismatch: have %s, want %s&quot;, i, hex.EncodeToString(rlpHave), hex.EncodeToString(rlpWant))
 			}
 		}
 	}
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestParseLegacyReceiptRLP(t *testing.T) {</span>
<span class="term-fg32">+	&#47;&#47; Create a gasUsed value greater than a uint64 can represent</span>
<span class="term-fg32">+	gasUsed := big.NewInt(0)</span>
<span class="term-fg32">+	gasUsed = gasUsed.SetUint64(math.MaxUint64)</span>
<span class="term-fg32">+	gasUsed = gasUsed.Add(gasUsed, big.NewInt(math.MaxInt64))</span>
<span class="term-fg32">+	sanityCheck := (&amp;big.Int{}).SetUint64(gasUsed.Uint64())</span>
<span class="term-fg32">+	require.NotEqual(t, gasUsed, sanityCheck)</span>
<span class="term-fg32">+	receipt := types.LegacyOptimismStoredReceiptRLP{</span>
<span class="term-fg32">+		CumulativeGasUsed: 1,</span>
<span class="term-fg32">+		Logs: []*types.LogForStorage{</span>
<span class="term-fg32">+			{Address: common.BytesToAddress([]byte{0x11})},</span>
<span class="term-fg32">+			{Address: common.BytesToAddress([]byte{0x01, 0x11})},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		L1GasUsed:  gasUsed,</span>
<span class="term-fg32">+		L1GasPrice: gasUsed,</span>
<span class="term-fg32">+		L1Fee:      gasUsed,</span>
<span class="term-fg32">+		FeeScalar:  &quot;6&quot;,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	data, err := rlp.EncodeToBytes(receipt)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	var result storedReceiptRLP</span>
<span class="term-fg32">+	err = rlp.DecodeBytes(data, &amp;result)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	require.Equal(t, receipt.L1GasUsed, result.L1GasUsed)</span>
<span class="term-fg32">+	require.Equal(t, receipt.L1GasPrice, result.L1GasPrice)</span>
<span class="term-fg32">+	require.Equal(t, receipt.L1Fee, result.L1Fee)</span>
<span class="term-fg32">+	require.Equal(t, receipt.FeeScalar, result.FeeScalar)</span>
 }
&nbsp;
 func TestDeriveLogFields(t *testing.T) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-812cd5645c434268c3c225ec" role="button"
                   aria-expanded="false" aria-controls="id-812cd5645c434268c3c225ec">
                    <code>core/rawdb/accessors_indexes_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/accessors_indexes_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/accessors_indexes_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-812cd5645c434268c3c225ec"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;accessors_indexes_test.go op-geth&#47;core&#47;rawdb&#47;accessors_indexes_test.go</span>
<span class="term-fg1">index 4734e986e27234a34c30a1df6e866eec065e3921..c5447b16d2bd8afb0c4ed7e5f475b801cbdd4fe6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;accessors_indexes_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;accessors_indexes_test.go</span>
<span class="term-fg36">@@ -45,9 +45,10 @@</span> func (h *testHasher) Reset() {
 	h.hasher.Reset()
 }
&nbsp;
<span class="term-fg31">-func (h *testHasher) Update(key, val []byte) {</span>
<span class="term-fg32">+func (h *testHasher) Update(key, val []byte) error {</span>
 	h.hasher.Write(key)
 	h.hasher.Write(val)
<span class="term-fg32">+	return nil</span>
 }
&nbsp;
 func (h *testHasher) Hash() common.Hash {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02103a6a665cb1b1cd96441b" role="button"
                   aria-expanded="false" aria-controls="id-02103a6a665cb1b1cd96441b">
                    <code>core/rawdb/chain_freezer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/chain_freezer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/chain_freezer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+11</span></div>
                        <div class="text-start"><span class="text-danger">-13</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02103a6a665cb1b1cd96441b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;chain_freezer.go op-geth&#47;core&#47;rawdb&#47;chain_freezer.go</span>
<span class="term-fg1">index 167afc38894ca665cb4c73d74de3b2b417083b79..22dbda4a2107a7e3376aa450a2579bcdca7d54d3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;chain_freezer.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;chain_freezer.go</span>
<span class="term-fg36">@@ -43,10 +43,7 @@</span> &#47;&#47; chainFreezer is a wrapper of freezer with additional chain freezing feature.
 &#47;&#47; The background thread will keep moving ancient chain segments from key-value
 &#47;&#47; database to flat files for saving space on live database.
 type chainFreezer struct {
<span class="term-fg31">-	&#47;&#47; WARNING: The `threshold` field is accessed atomically. On 32 bit platforms, only</span>
<span class="term-fg31">-	&#47;&#47; 64-bit aligned fields can be atomic. The struct is guaranteed to be so aligned,</span>
<span class="term-fg31">-	&#47;&#47; so take advantage of that (https:&#47;&#47;golang.org&#47;pkg&#47;sync&#47;atomic&#47;#pkg-note-BUG).</span>
<span class="term-fg31">-	threshold uint64 &#47;&#47; Number of recent blocks not to freeze (params.FullImmutabilityThreshold apart from tests)</span>
<span class="term-fg32">+	threshold atomic.Uint64 &#47;&#47; Number of recent blocks not to freeze (params.FullImmutabilityThreshold apart from tests)</span>
&nbsp;
 	*Freezer
 	quit    chan struct{}
<span class="term-fg36">@@ -60,12 +57,13 @@</span> 	freezer, err := NewChainFreezer(datadir, namespace, readonly)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg31">-	return &amp;chainFreezer{</span>
<span class="term-fg31">-		Freezer:   freezer,</span>
<span class="term-fg31">-		threshold: params.FullImmutabilityThreshold,</span>
<span class="term-fg31">-		quit:      make(chan struct{}),</span>
<span class="term-fg31">-		trigger:   make(chan chan struct{}),</span>
<span class="term-fg31">-	}, nil</span>
<span class="term-fg32">+	cf := chainFreezer{</span>
<span class="term-fg32">+		Freezer: freezer,</span>
<span class="term-fg32">+		quit:    make(chan struct{}),</span>
<span class="term-fg32">+		trigger: make(chan chan struct{}),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	cf.threshold.Store(params.FullImmutabilityThreshold)</span>
<span class="term-fg32">+	return &amp;cf, nil</span>
 }
&nbsp;
 &#47;&#47; Close closes the chain freezer instance and terminates the background thread.
<span class="term-fg36">@@ -124,8 +122,8 @@</span> 			backoff = true
 			continue
 		}
 		number := ReadHeaderNumber(nfdb, hash)
<span class="term-fg31">-		threshold := atomic.LoadUint64(&amp;f.threshold)</span>
<span class="term-fg31">-		frozen := atomic.LoadUint64(&amp;f.frozen)</span>
<span class="term-fg32">+		threshold := f.threshold.Load()</span>
<span class="term-fg32">+		frozen := f.frozen.Load()</span>
 		switch {
 		case number == nil:
 			log.Error(&quot;Current full block number unavailable&quot;, &quot;hash&quot;, hash)
<span class="term-fg36">@@ -186,7 +184,7 @@</span> 		batch.Reset()
&nbsp;
 		&#47;&#47; Wipe out side chains also and track dangling side chains
 		var dangling []common.Hash
<span class="term-fg31">-		frozen = atomic.LoadUint64(&amp;f.frozen) &#47;&#47; Needs reload after during freezeRange</span>
<span class="term-fg32">+		frozen = f.frozen.Load() &#47;&#47; Needs reload after during freezeRange</span>
 		for number := first; number &lt; frozen; number++ {
 			&#47;&#47; Always keep the genesis block in active database
 			if number != 0 {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-87cb22b95df405f73b056f95" role="button"
                   aria-expanded="false" aria-controls="id-87cb22b95df405f73b056f95">
                    <code>core/rawdb/chain_iterator.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/chain_iterator.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/chain_iterator.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-87cb22b95df405f73b056f95"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;chain_iterator.go op-geth&#47;core&#47;rawdb&#47;chain_iterator.go</span>
<span class="term-fg1">index 102943516eff45594a7cc18856008bac4691becd..56bb15b718adf4b94ced7ce5d6f8e707409e7c5f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;chain_iterator.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;chain_iterator.go</span>
<span class="term-fg36">@@ -132,11 +132,12 @@</span> 			}
 		}
 	}
 	&#47;&#47; process runs in parallel
<span class="term-fg31">-	nThreadsAlive := int32(threads)</span>
<span class="term-fg32">+	var nThreadsAlive atomic.Int32</span>
<span class="term-fg32">+	nThreadsAlive.Store(int32(threads))</span>
 	process := func() {
 		defer func() {
 			&#47;&#47; Last processor closes the result channel
<span class="term-fg31">-			if atomic.AddInt32(&amp;nThreadsAlive, -1) == 0 {</span>
<span class="term-fg32">+			if nThreadsAlive.Add(-1) == 0 {</span>
 				close(hashesCh)
 			}
 		}()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-64ffe9bba80491d16d56e0e2" role="button"
                   aria-expanded="false" aria-controls="id-64ffe9bba80491d16d56e0e2">
                    <code>core/rawdb/database.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/database.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/database.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-64ffe9bba80491d16d56e0e2"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;database.go op-geth&#47;core&#47;rawdb&#47;database.go</span>
<span class="term-fg1">index 6c545032f96992703251c5bbd526e84ef24d8a16..b8cc36a811e5b594eb7f5d2fb381b9fef4526d99 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;database.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;database.go</span>
<span class="term-fg36">@@ -24,7 +24,6 @@</span> 	&quot;os&quot;
 	&quot;path&quot;
 	&quot;path&#47;filepath&quot;
 	&quot;strings&quot;
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -72,9 +71,9 @@</span> 		return errReadOnly
 	}
 	&#47;&#47; Set the freezer threshold to a temporary value
 	defer func(old uint64) {
<span class="term-fg31">-		atomic.StoreUint64(&amp;frdb.AncientStore.(*chainFreezer).threshold, old)</span>
<span class="term-fg31">-	}(atomic.LoadUint64(&amp;frdb.AncientStore.(*chainFreezer).threshold))</span>
<span class="term-fg31">-	atomic.StoreUint64(&amp;frdb.AncientStore.(*chainFreezer).threshold, threshold)</span>
<span class="term-fg32">+		frdb.AncientStore.(*chainFreezer).threshold.Store(old)</span>
<span class="term-fg32">+	}(frdb.AncientStore.(*chainFreezer).threshold.Load())</span>
<span class="term-fg32">+	frdb.AncientStore.(*chainFreezer).threshold.Store(threshold)</span>
&nbsp;
 	&#47;&#47; Trigger a freeze cycle and block until it&#39;s done
 	trigger := make(chan struct{}, 1)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2b1d590524930813fc830c8c" role="button"
                   aria-expanded="false" aria-controls="id-2b1d590524930813fc830c8c">
                    <code>core/rawdb/freezer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/freezer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/freezer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+25</span></div>
                        <div class="text-start"><span class="text-danger">-28</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2b1d590524930813fc830c8c"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;freezer.go op-geth&#47;core&#47;rawdb&#47;freezer.go</span>
<span class="term-fg1">index 60e2c56e0ff75bfe94c2598dc3f381b0019f2beb..323dc1ddb32687f9c68355ad8e7e3b452fe7576a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;freezer.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;freezer.go</span>
<span class="term-fg36">@@ -62,11 +62,8 @@</span> &#47;&#47;   - The memory mapping ensures we can max out system memory for caching without
 &#47;&#47;     reserving it for go-ethereum. This would also reduce the memory requirements
 &#47;&#47;     of Geth, and thus also GC overhead.
 type Freezer struct {
<span class="term-fg31">-	&#47;&#47; WARNING: The `frozen` and `tail` fields are accessed atomically. On 32 bit platforms, only</span>
<span class="term-fg31">-	&#47;&#47; 64-bit aligned fields can be atomic. The struct is guaranteed to be so aligned,</span>
<span class="term-fg31">-	&#47;&#47; so take advantage of that (https:&#47;&#47;golang.org&#47;pkg&#47;sync&#47;atomic&#47;#pkg-note-BUG).</span>
<span class="term-fg31">-	frozen uint64 &#47;&#47; Number of blocks already frozen</span>
<span class="term-fg31">-	tail   uint64 &#47;&#47; Number of the first stored item in the freezer</span>
<span class="term-fg32">+	frozen atomic.Uint64 &#47;&#47; Number of blocks already frozen</span>
<span class="term-fg32">+	tail   atomic.Uint64 &#47;&#47; Number of the first stored item in the freezer</span>
&nbsp;
 	&#47;&#47; This lock synchronizes writers and the truncate operation, as well as
 	&#47;&#47; the &quot;atomic&quot; (batched) read operations.
<span class="term-fg36">@@ -212,12 +209,12 @@</span> }
&nbsp;
 &#47;&#47; Ancients returns the length of the frozen items.
 func (f *Freezer) Ancients() (uint64, error) {
<span class="term-fg31">-	return atomic.LoadUint64(&amp;f.frozen), nil</span>
<span class="term-fg32">+	return f.frozen.Load(), nil</span>
 }
&nbsp;
 &#47;&#47; Tail returns the number of first stored item in the freezer.
 func (f *Freezer) Tail() (uint64, error) {
<span class="term-fg31">-	return atomic.LoadUint64(&amp;f.tail), nil</span>
<span class="term-fg32">+	return f.tail.Load(), nil</span>
 }
&nbsp;
 &#47;&#47; AncientSize returns the ancient size of the specified category.
<span class="term-fg36">@@ -251,7 +248,7 @@</span> 	f.writeLock.Lock()
 	defer f.writeLock.Unlock()
&nbsp;
 	&#47;&#47; Roll back all tables to the starting position in case of error.
<span class="term-fg31">-	prevItem := atomic.LoadUint64(&amp;f.frozen)</span>
<span class="term-fg32">+	prevItem := f.frozen.Load()</span>
 	defer func() {
 		if err != nil {
 			&#47;&#47; The write operation has failed. Go back to the previous item position.
<span class="term-fg36">@@ -272,7 +269,7 @@</span> 	item, writeSize, err := f.writeBatch.commit()
 	if err != nil {
 		return 0, err
 	}
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.frozen, item)</span>
<span class="term-fg32">+	f.frozen.Store(item)</span>
 	return writeSize, nil
 }
&nbsp;
<span class="term-fg36">@@ -284,7 +281,7 @@</span> 	}
 	f.writeLock.Lock()
 	defer f.writeLock.Unlock()
&nbsp;
<span class="term-fg31">-	if atomic.LoadUint64(&amp;f.frozen) &lt;= items {</span>
<span class="term-fg32">+	if f.frozen.Load() &lt;= items {</span>
 		return nil
 	}
 	for _, table := range f.tables {
<span class="term-fg36">@@ -292,7 +289,7 @@</span> 		if err := table.truncateHead(items); err != nil {
 			return err
 		}
 	}
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.frozen, items)</span>
<span class="term-fg32">+	f.frozen.Store(items)</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -304,7 +301,7 @@</span> 	}
 	f.writeLock.Lock()
 	defer f.writeLock.Unlock()
&nbsp;
<span class="term-fg31">-	if atomic.LoadUint64(&amp;f.tail) &gt;= tail {</span>
<span class="term-fg32">+	if f.tail.Load() &gt;= tail {</span>
 		return nil
 	}
 	for _, table := range f.tables {
<span class="term-fg36">@@ -312,7 +309,7 @@</span> 		if err := table.truncateTail(tail); err != nil {
 			return err
 		}
 	}
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.tail, tail)</span>
<span class="term-fg32">+	f.tail.Store(tail)</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -343,22 +340,22 @@</span> 		name string
 	)
 	&#47;&#47; Hack to get boundary of any table
 	for kind, table := range f.tables {
<span class="term-fg31">-		head = atomic.LoadUint64(&amp;table.items)</span>
<span class="term-fg31">-		tail = atomic.LoadUint64(&amp;table.itemHidden)</span>
<span class="term-fg32">+		head = table.items.Load()</span>
<span class="term-fg32">+		tail = table.itemHidden.Load()</span>
 		name = kind
 		break
 	}
 	&#47;&#47; Now check every table against those boundaries.
 	for kind, table := range f.tables {
<span class="term-fg31">-		if head != atomic.LoadUint64(&amp;table.items) {</span>
<span class="term-fg31">-			return fmt.Errorf(&quot;freezer tables %s and %s have differing head: %d != %d&quot;, kind, name, atomic.LoadUint64(&amp;table.items), head)</span>
<span class="term-fg32">+		if head != table.items.Load() {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;freezer tables %s and %s have differing head: %d != %d&quot;, kind, name, table.items.Load(), head)</span>
 		}
<span class="term-fg31">-		if tail != atomic.LoadUint64(&amp;table.itemHidden) {</span>
<span class="term-fg31">-			return fmt.Errorf(&quot;freezer tables %s and %s have differing tail: %d != %d&quot;, kind, name, atomic.LoadUint64(&amp;table.itemHidden), tail)</span>
<span class="term-fg32">+		if tail != table.itemHidden.Load() {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;freezer tables %s and %s have differing tail: %d != %d&quot;, kind, name, table.itemHidden.Load(), tail)</span>
 		}
 	}
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.frozen, head)</span>
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.tail, tail)</span>
<span class="term-fg32">+	f.frozen.Store(head)</span>
<span class="term-fg32">+	f.tail.Store(tail)</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -369,11 +366,11 @@</span> 		head = uint64(math.MaxUint64)
 		tail = uint64(0)
 	)
 	for _, table := range f.tables {
<span class="term-fg31">-		items := atomic.LoadUint64(&amp;table.items)</span>
<span class="term-fg32">+		items := table.items.Load()</span>
 		if head &gt; items {
 			head = items
 		}
<span class="term-fg31">-		hidden := atomic.LoadUint64(&amp;table.itemHidden)</span>
<span class="term-fg32">+		hidden := table.itemHidden.Load()</span>
 		if hidden &gt; tail {
 			tail = hidden
 		}
<span class="term-fg36">@@ -386,8 +383,8 @@</span> 		if err := table.truncateTail(tail); err != nil {
 			return err
 		}
 	}
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.frozen, head)</span>
<span class="term-fg31">-	atomic.StoreUint64(&amp;f.tail, tail)</span>
<span class="term-fg32">+	f.frozen.Store(head)</span>
<span class="term-fg32">+	f.tail.Store(tail)</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -413,7 +410,7 @@</span> 	&#47;&#47; with the item as argument. If `fn` returns an error the iteration stops
 	&#47;&#47; and that error will be returned.
 	forEach := func(t *freezerTable, offset uint64, fn func(uint64, []byte) error) error {
 		var (
<span class="term-fg31">-			items     = atomic.LoadUint64(&amp;t.items)</span>
<span class="term-fg32">+			items     = t.items.Load()</span>
 			batchSize = uint64(1024)
 			maxBytes  = uint64(1024 * 1024)
 		)
<span class="term-fg36">@@ -436,7 +433,7 @@</span> 		return nil
 	}
 	&#47;&#47; TODO(s1na): This is a sanity-check since as of now no process does tail-deletion. But the migration
 	&#47;&#47; process assumes no deletion at tail and needs to be modified to account for that.
<span class="term-fg31">-	if table.itemOffset &gt; 0 || table.itemHidden &gt; 0 {</span>
<span class="term-fg32">+	if table.itemOffset.Load() &gt; 0 || table.itemHidden.Load() &gt; 0 {</span>
 		return fmt.Errorf(&quot;migration not supported for tail-deleted freezers&quot;)
 	}
 	ancientsPath := filepath.Dir(table.index.Name())
<span class="term-fg36">@@ -452,7 +449,7 @@</span> 		batch  = newTable.newBatch()
 		out    []byte
 		start  = time.Now()
 		logged = time.Now()
<span class="term-fg31">-		offset = newTable.items</span>
<span class="term-fg32">+		offset = newTable.items.Load()</span>
 	)
 	if offset &gt; 0 {
 		log.Info(&quot;found previous migration attempt&quot;, &quot;migrated&quot;, offset)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0be7a5c47804c42025fb5655" role="button"
                   aria-expanded="false" aria-controls="id-0be7a5c47804c42025fb5655">
                    <code>core/rawdb/freezer_batch.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/freezer_batch.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/freezer_batch.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0be7a5c47804c42025fb5655"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;freezer_batch.go op-geth&#47;core&#47;rawdb&#47;freezer_batch.go</span>
<span class="term-fg1">index 54c98cee08078599f149291a962f634d1276e742..3cc7d84f4ef4f12850f724bdc8028556190301ae 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;freezer_batch.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;freezer_batch.go</span>
<span class="term-fg36">@@ -18,7 +18,6 @@</span> package rawdb
&nbsp;
 import (
 	&quot;fmt&quot;
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
<span class="term-fg36">@@ -107,7 +106,7 @@</span> &#47;&#47; reset clears the batch for reuse.
 func (batch *freezerTableBatch) reset() {
 	batch.dataBuffer = batch.dataBuffer[:0]
 	batch.indexBuffer = batch.indexBuffer[:0]
<span class="term-fg31">-	batch.curItem = atomic.LoadUint64(&amp;batch.t.items)</span>
<span class="term-fg32">+	batch.curItem = batch.t.items.Load()</span>
 	batch.totalBytes = 0
 }
&nbsp;
<span class="term-fg36">@@ -201,7 +200,7 @@</span> 	batch.indexBuffer = batch.indexBuffer[:0]
&nbsp;
 	&#47;&#47; Update headBytes of table.
 	batch.t.headBytes += dataSize
<span class="term-fg31">-	atomic.StoreUint64(&amp;batch.t.items, batch.curItem)</span>
<span class="term-fg32">+	batch.t.items.Store(batch.curItem)</span>
&nbsp;
 	&#47;&#47; Update metrics.
 	batch.t.sizeGauge.Inc(dataSize + indexSize)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2ebcc556cf1bccfe3bede9fe" role="button"
                   aria-expanded="false" aria-controls="id-2ebcc556cf1bccfe3bede9fe">
                    <code>core/rawdb/freezer_table.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/freezer_table.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/freezer_table.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+28</span></div>
                        <div class="text-start"><span class="text-danger">-28</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2ebcc556cf1bccfe3bede9fe"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;freezer_table.go op-geth&#47;core&#47;rawdb&#47;freezer_table.go</span>
<span class="term-fg1">index b111797d5297765a0aa5a11ae4ae8ab8f942e722..928b37d70b2dfa6c11adb310e0265c15b7e2a8ac 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;freezer_table.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;freezer_table.go</span>
<span class="term-fg36">@@ -88,18 +88,15 @@</span> &#47;&#47; freezerTable represents a single chained data table within the freezer (e.g. blocks).
 &#47;&#47; It consists of a data file (snappy encoded arbitrary data blobs) and an indexEntry
 &#47;&#47; file (uncompressed 64 bit indices into the data file).
 type freezerTable struct {
<span class="term-fg31">-	&#47;&#47; WARNING: The `items` field is accessed atomically. On 32 bit platforms, only</span>
<span class="term-fg31">-	&#47;&#47; 64-bit aligned fields can be atomic. The struct is guaranteed to be so aligned,</span>
<span class="term-fg31">-	&#47;&#47; so take advantage of that (https:&#47;&#47;golang.org&#47;pkg&#47;sync&#47;atomic&#47;#pkg-note-BUG).</span>
<span class="term-fg31">-	items      uint64 &#47;&#47; Number of items stored in the table (including items removed from tail)</span>
<span class="term-fg31">-	itemOffset uint64 &#47;&#47; Number of items removed from the table</span>
<span class="term-fg32">+	items      atomic.Uint64 &#47;&#47; Number of items stored in the table (including items removed from tail)</span>
<span class="term-fg32">+	itemOffset atomic.Uint64 &#47;&#47; Number of items removed from the table</span>
&nbsp;
 	&#47;&#47; itemHidden is the number of items marked as deleted. Tail deletion is
 	&#47;&#47; only supported at file level which means the actual deletion will be
 	&#47;&#47; delayed until the entire data file is marked as deleted. Before that
 	&#47;&#47; these items will be hidden to prevent being visited again. The value
 	&#47;&#47; should never be lower than itemOffset.
<span class="term-fg31">-	itemHidden uint64</span>
<span class="term-fg32">+	itemHidden atomic.Uint64</span>
&nbsp;
 	noCompression bool &#47;&#47; if true, disables snappy compression. Note: does not work retroactively
 	readonly      bool
<span class="term-fg36">@@ -241,14 +238,14 @@</span> 	&#47;&#47; The total removed items is represented with an uint32,
 	&#47;&#47; which is not enough in theory but enough in practice.
 	&#47;&#47; TODO: use uint64 to represent total removed items.
 	t.tailId = firstIndex.filenum
<span class="term-fg31">-	t.itemOffset = uint64(firstIndex.offset)</span>
<span class="term-fg32">+	t.itemOffset.Store(uint64(firstIndex.offset))</span>
&nbsp;
 	&#47;&#47; Load metadata from the file
<span class="term-fg31">-	meta, err := loadMetadata(t.meta, t.itemOffset)</span>
<span class="term-fg32">+	meta, err := loadMetadata(t.meta, t.itemOffset.Load())</span>
 	if err != nil {
 		return err
 	}
<span class="term-fg31">-	t.itemHidden = meta.VirtualTail</span>
<span class="term-fg32">+	t.itemHidden.Store(meta.VirtualTail)</span>
&nbsp;
 	&#47;&#47; Read the last index, use the default value in case the freezer is empty
 	if offsetsSize == indexEntrySize {
<span class="term-fg36">@@ -331,7 +328,7 @@</span> 			return err
 		}
 	}
 	&#47;&#47; Update the item and byte counters and return
<span class="term-fg31">-	t.items = t.itemOffset + uint64(offsetsSize&#47;indexEntrySize-1) &#47;&#47; last indexEntry points to the end of the data file</span>
<span class="term-fg32">+	t.items.Store(t.itemOffset.Load() + uint64(offsetsSize&#47;indexEntrySize-1)) &#47;&#47; last indexEntry points to the end of the data file</span>
 	t.headBytes = contentSize
 	t.headId = lastIndex.filenum
&nbsp;
<span class="term-fg36">@@ -346,9 +343,9 @@</span> 	if err := t.preopen(); err != nil {
 		return err
 	}
 	if verbose {
<span class="term-fg31">-		t.logger.Info(&quot;Chain freezer table opened&quot;, &quot;items&quot;, t.items, &quot;size&quot;, t.headBytes)</span>
<span class="term-fg32">+		t.logger.Info(&quot;Chain freezer table opened&quot;, &quot;items&quot;, t.items.Load(), &quot;size&quot;, t.headBytes)</span>
 	} else {
<span class="term-fg31">-		t.logger.Debug(&quot;Chain freezer table opened&quot;, &quot;items&quot;, t.items, &quot;size&quot;, common.StorageSize(t.headBytes))</span>
<span class="term-fg32">+		t.logger.Debug(&quot;Chain freezer table opened&quot;, &quot;items&quot;, t.items.Load(), &quot;size&quot;, common.StorageSize(t.headBytes))</span>
 	}
 	return nil
 }
<span class="term-fg36">@@ -382,11 +379,11 @@</span> 	t.lock.Lock()
 	defer t.lock.Unlock()
&nbsp;
 	&#47;&#47; Ensure the given truncate target falls in the correct range
<span class="term-fg31">-	existing := atomic.LoadUint64(&amp;t.items)</span>
<span class="term-fg32">+	existing := t.items.Load()</span>
 	if existing &lt;= items {
 		return nil
 	}
<span class="term-fg31">-	if items &lt; atomic.LoadUint64(&amp;t.itemHidden) {</span>
<span class="term-fg32">+	if items &lt; t.itemHidden.Load() {</span>
 		return errors.New(&quot;truncation below tail&quot;)
 	}
 	&#47;&#47; We need to truncate, save the old size for metrics tracking
<span class="term-fg36">@@ -403,7 +400,7 @@</span> 	log(&quot;Truncating freezer table&quot;, &quot;items&quot;, existing, &quot;limit&quot;, items)
&nbsp;
 	&#47;&#47; Truncate the index file first, the tail position is also considered
 	&#47;&#47; when calculating the new freezer table length.
<span class="term-fg31">-	length := items - atomic.LoadUint64(&amp;t.itemOffset)</span>
<span class="term-fg32">+	length := items - t.itemOffset.Load()</span>
 	if err := truncateFreezerFile(t.index, int64(length+1)*indexEntrySize); err != nil {
 		return err
 	}
<span class="term-fg36">@@ -438,7 +435,7 @@</span> 		return err
 	}
 	&#47;&#47; All data files truncated, set internal counters and return
 	t.headBytes = int64(expected.offset)
<span class="term-fg31">-	atomic.StoreUint64(&amp;t.items, items)</span>
<span class="term-fg32">+	t.items.Store(items)</span>
&nbsp;
 	&#47;&#47; Retrieve the new size and update the total size counter
 	newSize, err := t.sizeNolock()
<span class="term-fg36">@@ -455,10 +452,10 @@</span> 	t.lock.Lock()
 	defer t.lock.Unlock()
&nbsp;
 	&#47;&#47; Ensure the given truncate target falls in the correct range
<span class="term-fg31">-	if atomic.LoadUint64(&amp;t.itemHidden) &gt;= items {</span>
<span class="term-fg32">+	if t.itemHidden.Load() &gt;= items {</span>
 		return nil
 	}
<span class="term-fg31">-	if atomic.LoadUint64(&amp;t.items) &lt; items {</span>
<span class="term-fg32">+	if t.items.Load() &lt; items {</span>
 		return errors.New(&quot;truncation above head&quot;)
 	}
 	&#47;&#47; Load the new tail index by the given new tail position
<span class="term-fg36">@@ -466,10 +463,10 @@</span> 	var (
 		newTailId uint32
 		buffer    = make([]byte, indexEntrySize)
 	)
<span class="term-fg31">-	if atomic.LoadUint64(&amp;t.items) == items {</span>
<span class="term-fg32">+	if t.items.Load() == items {</span>
 		newTailId = t.headId
 	} else {
<span class="term-fg31">-		offset := items - atomic.LoadUint64(&amp;t.itemOffset)</span>
<span class="term-fg32">+		offset := items - t.itemOffset.Load()</span>
 		if _, err := t.index.ReadAt(buffer, int64((offset+1)*indexEntrySize)); err != nil {
 			return err
 		}
<span class="term-fg36">@@ -478,7 +475,7 @@</span> 		newTail.unmarshalBinary(buffer)
 		newTailId = newTail.filenum
 	}
 	&#47;&#47; Update the virtual tail marker and hidden these entries in table.
<span class="term-fg31">-	atomic.StoreUint64(&amp;t.itemHidden, items)</span>
<span class="term-fg32">+	t.itemHidden.Store(items)</span>
 	if err := writeMetadata(t.meta, newMetadata(items)); err != nil {
 		return err
 	}
<span class="term-fg36">@@ -501,7 +498,7 @@</span> 	}
 	&#47;&#47; Count how many items can be deleted from the file.
 	var (
 		newDeleted = items
<span class="term-fg31">-		deleted    = atomic.LoadUint64(&amp;t.itemOffset)</span>
<span class="term-fg32">+		deleted    = t.itemOffset.Load()</span>
 	)
 	for current := items - 1; current &gt;= deleted; current -= 1 {
 		if _, err := t.index.ReadAt(buffer, int64((current-deleted+1)*indexEntrySize)); err != nil {
<span class="term-fg36">@@ -541,7 +538,7 @@</span> 		return err
 	}
 	&#47;&#47; Release any files before the current tail
 	t.tailId = newTailId
<span class="term-fg31">-	atomic.StoreUint64(&amp;t.itemOffset, newDeleted)</span>
<span class="term-fg32">+	t.itemOffset.Store(newDeleted)</span>
 	t.releaseFilesBefore(t.tailId, true)
&nbsp;
 	&#47;&#47; Retrieve the new size and update the total size counter
<span class="term-fg36">@@ -654,7 +651,7 @@</span> &#47;&#47; so that the items are within bounds. If this method is used to read out of bounds,
 &#47;&#47; it will return error.
 func (t *freezerTable) getIndices(from, count uint64) ([]*indexEntry, error) {
 	&#47;&#47; Apply the table-offset
<span class="term-fg31">-	from = from - t.itemOffset</span>
<span class="term-fg32">+	from = from - t.itemOffset.Load()</span>
 	&#47;&#47; For reading N items, we need N+1 indices.
 	buffer := make([]byte, (count+1)*indexEntrySize)
 	if _, err := t.index.ReadAt(buffer, int64(from*indexEntrySize)); err != nil {
<span class="term-fg36">@@ -744,8 +741,8 @@</span> 	if t.index == nil || t.head == nil || t.meta == nil {
 		return nil, nil, errClosed
 	}
 	var (
<span class="term-fg31">-		items  = atomic.LoadUint64(&amp;t.items)      &#47;&#47; the total items(head + 1)</span>
<span class="term-fg31">-		hidden = atomic.LoadUint64(&amp;t.itemHidden) &#47;&#47; the number of hidden items</span>
<span class="term-fg32">+		items  = t.items.Load()      &#47;&#47; the total items(head + 1)</span>
<span class="term-fg32">+		hidden = t.itemHidden.Load() &#47;&#47; the number of hidden items</span>
 	)
 	&#47;&#47; Ensure the start is written, not deleted from the tail, and that the
 	&#47;&#47; caller actually wants something
<span class="term-fg36">@@ -826,13 +823,16 @@</span> 			}
 			break
 		}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Update metrics.</span>
<span class="term-fg32">+	t.readMeter.Mark(int64(totalSize))</span>
 	return output[:outputSize], sizes, nil
 }
&nbsp;
 &#47;&#47; has returns an indicator whether the specified number data is still accessible
 &#47;&#47; in the freezer table.
 func (t *freezerTable) has(number uint64) bool {
<span class="term-fg31">-	return atomic.LoadUint64(&amp;t.items) &gt; number &amp;&amp; atomic.LoadUint64(&amp;t.itemHidden) &lt;= number</span>
<span class="term-fg32">+	return t.items.Load() &gt; number &amp;&amp; t.itemHidden.Load() &lt;= number</span>
 }
&nbsp;
 &#47;&#47; size returns the total data size in the freezer table.
<span class="term-fg36">@@ -922,7 +922,7 @@</span> 		fmt.Fprintf(w, &quot;Failed to decode freezer table %v\n&quot;, err)
 		return
 	}
 	fmt.Fprintf(w, &quot;Version %d count %d, deleted %d, hidden %d\n&quot;, meta.Version,
<span class="term-fg31">-		atomic.LoadUint64(&amp;t.items), atomic.LoadUint64(&amp;t.itemOffset), atomic.LoadUint64(&amp;t.itemHidden))</span>
<span class="term-fg32">+		t.items.Load(), t.itemOffset.Load(), t.itemHidden.Load())</span>
&nbsp;
 	buf := make([]byte, indexEntrySize)
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02502ecbff46e6eb3c7f6de1" role="button"
                   aria-expanded="false" aria-controls="id-02502ecbff46e6eb3c7f6de1">
                    <code>core/rawdb/freezer_table_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/freezer_table_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/freezer_table_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+19</span></div>
                        <div class="text-start"><span class="text-danger">-20</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02502ecbff46e6eb3c7f6de1"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;freezer_table_test.go op-geth&#47;core&#47;rawdb&#47;freezer_table_test.go</span>
<span class="term-fg1">index 6181d4d72cac546454ef4af55f6f19364a00af18..5c4cc40eddc7aec293a29d194e5ca509467131e8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;freezer_table_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;freezer_table_test.go</span>
<span class="term-fg36">@@ -24,7 +24,6 @@</span> 	&quot;math&#47;rand&quot;
 	&quot;os&quot;
 	&quot;path&#47;filepath&quot;
 	&quot;reflect&quot;
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
 	&quot;testing&quot;
 	&quot;testing&#47;quick&quot;
&nbsp;
<span class="term-fg36">@@ -191,7 +190,7 @@</span> 		&#47;&#47; Write 15 bytes 255 times
 		writeChunks(t, f, 255, 15)
&nbsp;
 		&#47;&#47; The last item should be there
<span class="term-fg31">-		if _, err = f.Retrieve(f.items - 1); err != nil {</span>
<span class="term-fg32">+		if _, err = f.Retrieve(f.items.Load() - 1); err != nil {</span>
 			t.Fatal(err)
 		}
 		f.Close()
<span class="term-fg36">@@ -317,7 +316,7 @@</span> 		&#47;&#47; Write 15 bytes 9 times : 150 bytes
 		writeChunks(t, f, 9, 15)
&nbsp;
 		&#47;&#47; The last item should be there
<span class="term-fg31">-		if _, err = f.Retrieve(f.items - 1); err != nil {</span>
<span class="term-fg32">+		if _, err = f.Retrieve(f.items.Load() - 1); err != nil {</span>
 			f.Close()
 			t.Fatal(err)
 		}
<span class="term-fg36">@@ -350,8 +349,8 @@</span> 		if err != nil {
 			t.Fatal(err)
 		}
 		defer f.Close()
<span class="term-fg31">-		if f.items != 7 {</span>
<span class="term-fg31">-			t.Fatalf(&quot;expected %d items, got %d&quot;, 7, f.items)</span>
<span class="term-fg32">+		if f.items.Load() != 7 {</span>
<span class="term-fg32">+			t.Fatalf(&quot;expected %d items, got %d&quot;, 7, f.items.Load())</span>
 		}
 		if err := assertFileSize(fileToCrop, 15); err != nil {
 			t.Fatal(err)
<span class="term-fg36">@@ -374,7 +373,7 @@</span> 		&#47;&#47; Write 15 bytes 30 times
 		writeChunks(t, f, 30, 15)
&nbsp;
 		&#47;&#47; The last item should be there
<span class="term-fg31">-		if _, err = f.Retrieve(f.items - 1); err != nil {</span>
<span class="term-fg32">+		if _, err = f.Retrieve(f.items.Load() - 1); err != nil {</span>
 			t.Fatal(err)
 		}
 		f.Close()
<span class="term-fg36">@@ -388,8 +387,8 @@</span> 			t.Fatal(err)
 		}
 		defer f.Close()
 		f.truncateHead(10) &#47;&#47; 150 bytes
<span class="term-fg31">-		if f.items != 10 {</span>
<span class="term-fg31">-			t.Fatalf(&quot;expected %d items, got %d&quot;, 10, f.items)</span>
<span class="term-fg32">+		if f.items.Load() != 10 {</span>
<span class="term-fg32">+			t.Fatalf(&quot;expected %d items, got %d&quot;, 10, f.items.Load())</span>
 		}
 		&#47;&#47; 45, 45, 45, 15 -- bytes should be 15
 		if f.headBytes != 15 {
<span class="term-fg36">@@ -444,9 +443,9 @@</span> 		f, err := newTable(os.TempDir(), fname, rm, wm, sg, 50, true, false)
 		if err != nil {
 			t.Fatal(err)
 		}
<span class="term-fg31">-		if f.items != 1 {</span>
<span class="term-fg32">+		if f.items.Load() != 1 {</span>
 			f.Close()
<span class="term-fg31">-			t.Fatalf(&quot;expected %d items, got %d&quot;, 0, f.items)</span>
<span class="term-fg32">+			t.Fatalf(&quot;expected %d items, got %d&quot;, 0, f.items.Load())</span>
 		}
&nbsp;
 		&#47;&#47; Write 40 bytes
<span class="term-fg36">@@ -483,7 +482,7 @@</span> 		&#47;&#47; Write 15 bytes 30 times
 		writeChunks(t, f, 30, 15)
&nbsp;
 		&#47;&#47; The last item should be there
<span class="term-fg31">-		if _, err = f.Retrieve(f.items - 1); err != nil {</span>
<span class="term-fg32">+		if _, err = f.Retrieve(f.items.Load() - 1); err != nil {</span>
 			t.Fatal(err)
 		}
 		f.Close()
<span class="term-fg36">@@ -495,9 +494,9 @@</span> 		f, err := newTable(os.TempDir(), fname, rm, wm, sg, 50, true, false)
 		if err != nil {
 			t.Fatal(err)
 		}
<span class="term-fg31">-		if f.items != 30 {</span>
<span class="term-fg32">+		if f.items.Load() != 30 {</span>
 			f.Close()
<span class="term-fg31">-			t.Fatalf(&quot;expected %d items, got %d&quot;, 0, f.items)</span>
<span class="term-fg32">+			t.Fatalf(&quot;expected %d items, got %d&quot;, 0, f.items.Load())</span>
 		}
 		for y := byte(0); y &lt; 30; y++ {
 			f.Retrieve(uint64(y))
<span class="term-fg36">@@ -1210,13 +1209,13 @@</span> 			if err != nil {
 				rt[i].err = fmt.Errorf(&quot;failed to reload table %v&quot;, err)
 			}
 		case opCheckAll:
<span class="term-fg31">-			tail := atomic.LoadUint64(&amp;f.itemHidden)</span>
<span class="term-fg31">-			head := atomic.LoadUint64(&amp;f.items)</span>
<span class="term-fg32">+			tail := f.itemHidden.Load()</span>
<span class="term-fg32">+			head := f.items.Load()</span>
&nbsp;
 			if tail == head {
 				continue
 			}
<span class="term-fg31">-			got, err := f.RetrieveItems(atomic.LoadUint64(&amp;f.itemHidden), head-tail, 100000)</span>
<span class="term-fg32">+			got, err := f.RetrieveItems(f.itemHidden.Load(), head-tail, 100000)</span>
 			if err != nil {
 				rt[i].err = err
 			} else {
<span class="term-fg36">@@ -1238,7 +1237,7 @@</span> 			var blobs [][]byte
 			if len(step.items) == 0 {
 				continue
 			}
<span class="term-fg31">-			tail := atomic.LoadUint64(&amp;f.itemHidden)</span>
<span class="term-fg32">+			tail := f.itemHidden.Load()</span>
 			for i := 0; i &lt; len(step.items); i++ {
 				blobs = append(blobs, values[step.items[i]-tail])
 			}
<span class="term-fg36">@@ -1254,7 +1253,7 @@</span>
 		case opTruncateHead:
 			f.truncateHead(step.target)
&nbsp;
<span class="term-fg31">-			length := atomic.LoadUint64(&amp;f.items) - atomic.LoadUint64(&amp;f.itemHidden)</span>
<span class="term-fg32">+			length := f.items.Load() - f.itemHidden.Load()</span>
 			values = values[:length]
&nbsp;
 		case opTruncateHeadAll:
<span class="term-fg36">@@ -1262,10 +1261,10 @@</span> 			f.truncateHead(step.target)
 			values = nil
&nbsp;
 		case opTruncateTail:
<span class="term-fg31">-			prev := atomic.LoadUint64(&amp;f.itemHidden)</span>
<span class="term-fg32">+			prev := f.itemHidden.Load()</span>
 			f.truncateTail(step.target)
&nbsp;
<span class="term-fg31">-			truncated := atomic.LoadUint64(&amp;f.itemHidden) - prev</span>
<span class="term-fg32">+			truncated := f.itemHidden.Load() - prev</span>
 			values = values[truncated:]
&nbsp;
 		case opTruncateTailAll:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-49b60a89cfc91618d8b1b7bc" role="button"
                   aria-expanded="false" aria-controls="id-49b60a89cfc91618d8b1b7bc">
                    <code>core/rawdb/freezer_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/rawdb/freezer_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/rawdb/freezer_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49b60a89cfc91618d8b1b7bc"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;rawdb&#47;freezer_test.go op-geth&#47;core&#47;rawdb&#47;freezer_test.go</span>
<span class="term-fg1">index 5896e43ce232cf0233aa1440a141d40fe62e40be..630c9029b0f5223c5df377bcf8bc84f927b07563 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;rawdb&#47;freezer_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;rawdb&#47;freezer_test.go</span>
<span class="term-fg36">@@ -267,10 +267,10 @@</span> 	require.NoError(t, aBatch.commit())
 	bBatch := f.tables[&quot;b&quot;].newBatch()
 	require.NoError(t, bBatch.AppendRaw(0, item))
 	require.NoError(t, bBatch.commit())
<span class="term-fg31">-	if f.tables[&quot;a&quot;].items != 3 {</span>
<span class="term-fg32">+	if f.tables[&quot;a&quot;].items.Load() != 3 {</span>
 		t.Fatalf(&quot;unexpected number of items in table&quot;)
 	}
<span class="term-fg31">-	if f.tables[&quot;b&quot;].items != 1 {</span>
<span class="term-fg32">+	if f.tables[&quot;b&quot;].items.Load() != 1 {</span>
 		t.Fatalf(&quot;unexpected number of items in table&quot;)
 	}
 	require.NoError(t, f.Close())</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-57f3736ae8a922f8bb7a105a" role="button"
                   aria-expanded="false" aria-controls="id-57f3736ae8a922f8bb7a105a">
                    <code>core/state/database.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/database.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/database.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+16</span></div>
                        <div class="text-start"><span class="text-danger">-16</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-57f3736ae8a922f8bb7a105a"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;database.go op-geth&#47;core&#47;state&#47;database.go</span>
<span class="term-fg1">index d3c36c10ac5dfee73592ea0b9c262fdf22242afa..82f620b4608310add0618817d7f6532cbf6e2213 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;database.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;database.go</span>
<span class="term-fg36">@@ -68,36 +68,36 @@</span> 	&#47;&#47;
 	&#47;&#47; TODO(fjl): remove this when StateTrie is removed
 	GetKey([]byte) []byte
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryGet returns the value for key stored in the trie. The value bytes must</span>
<span class="term-fg31">-	&#47;&#47; not be modified by the caller. If a node was not found in the database, a</span>
<span class="term-fg31">-	&#47;&#47; trie.MissingNodeError is returned.</span>
<span class="term-fg31">-	TryGet(key []byte) ([]byte, error)</span>
<span class="term-fg32">+	&#47;&#47; GetStorage returns the value for key stored in the trie. The value bytes</span>
<span class="term-fg32">+	&#47;&#47; must not be modified by the caller. If a node was not found in the database,</span>
<span class="term-fg32">+	&#47;&#47; a trie.MissingNodeError is returned.</span>
<span class="term-fg32">+	GetStorage(addr common.Address, key []byte) ([]byte, error)</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryGetAccount abstracts an account read from the trie. It retrieves the</span>
<span class="term-fg32">+	&#47;&#47; GetAccount abstracts an account read from the trie. It retrieves the</span>
 	&#47;&#47; account blob from the trie with provided account address and decodes it
 	&#47;&#47; with associated decoding algorithm. If the specified account is not in
 	&#47;&#47; the trie, nil will be returned. If the trie is corrupted(e.g. some nodes
 	&#47;&#47; are missing or the account blob is incorrect for decoding), an error will
 	&#47;&#47; be returned.
<span class="term-fg31">-	TryGetAccount(address common.Address) (*types.StateAccount, error)</span>
<span class="term-fg32">+	GetAccount(address common.Address) (*types.StateAccount, error)</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryUpdate associates key with value in the trie. If value has length zero, any</span>
<span class="term-fg31">-	&#47;&#47; existing value is deleted from the trie. The value bytes must not be modified</span>
<span class="term-fg32">+	&#47;&#47; UpdateStorage associates key with value in the trie. If value has length zero,</span>
<span class="term-fg32">+	&#47;&#47; any existing value is deleted from the trie. The value bytes must not be modified</span>
 	&#47;&#47; by the caller while they are stored in the trie. If a node was not found in the
 	&#47;&#47; database, a trie.MissingNodeError is returned.
<span class="term-fg31">-	TryUpdate(key, value []byte) error</span>
<span class="term-fg32">+	UpdateStorage(addr common.Address, key, value []byte) error</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryUpdateAccount abstracts an account write to the trie. It encodes the</span>
<span class="term-fg32">+	&#47;&#47; UpdateAccount abstracts an account write to the trie. It encodes the</span>
 	&#47;&#47; provided account object with associated algorithm and then updates it
 	&#47;&#47; in the trie with provided address.
<span class="term-fg31">-	TryUpdateAccount(address common.Address, account *types.StateAccount) error</span>
<span class="term-fg32">+	UpdateAccount(address common.Address, account *types.StateAccount) error</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryDelete removes any existing value for key from the trie. If a node was not</span>
<span class="term-fg31">-	&#47;&#47; found in the database, a trie.MissingNodeError is returned.</span>
<span class="term-fg31">-	TryDelete(key []byte) error</span>
<span class="term-fg32">+	&#47;&#47; DeleteStorage removes any existing value for key from the trie. If a node</span>
<span class="term-fg32">+	&#47;&#47; was not found in the database, a trie.MissingNodeError is returned.</span>
<span class="term-fg32">+	DeleteStorage(addr common.Address, key []byte) error</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; TryDeleteAccount abstracts an account deletion from the trie.</span>
<span class="term-fg31">-	TryDeleteAccount(address common.Address) error</span>
<span class="term-fg32">+	&#47;&#47; DeleteAccount abstracts an account deletion from the trie.</span>
<span class="term-fg32">+	DeleteAccount(address common.Address) error</span>
&nbsp;
 	&#47;&#47; Hash returns the root hash of the trie. It does not write to the database and
 	&#47;&#47; can be used even if the trie doesn&#39;t have one.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-50ce62b47e5d5161a96d4778" role="button"
                   aria-expanded="false" aria-controls="id-50ce62b47e5d5161a96d4778">
                    <code>core/state/snapshot/conversion.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/conversion.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/conversion.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-50ce62b47e5d5161a96d4778"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;conversion.go op-geth&#47;core&#47;state&#47;snapshot&#47;conversion.go</span>
<span class="term-fg1">index ed7cb963ad0f3c2cd0f18d787e2c1810a1dd944e..0e583e6269baa6b8cd13bbee1c1b1a989d5f4b8b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;conversion.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;conversion.go</span>
<span class="term-fg36">@@ -371,7 +371,7 @@</span> 		}
 	}
 	t := trie.NewStackTrieWithOwner(nodeWriter, owner)
 	for leaf := range in {
<span class="term-fg31">-		t.TryUpdate(leaf.key[:], leaf.value)</span>
<span class="term-fg32">+		t.Update(leaf.key[:], leaf.value)</span>
 	}
 	var root common.Hash
 	if db == nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4b877ccebafdabe1b78f1f37" role="button"
                   aria-expanded="false" aria-controls="id-4b877ccebafdabe1b78f1f37">
                    <code>core/state/snapshot/difflayer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/difflayer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/difflayer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4b877ccebafdabe1b78f1f37"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;difflayer.go op-geth&#47;core&#47;state&#47;snapshot&#47;difflayer.go</span>
<span class="term-fg1">index f916a020e7bcff5662726429e6d7d019b9f823f7..4701acccd399dbcb625728992c7720ed70849d21 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;difflayer.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;difflayer.go</span>
<span class="term-fg36">@@ -103,7 +103,7 @@</span> 	parent snapshot   &#47;&#47; Parent snapshot modified by this one, never nil
 	memory uint64     &#47;&#47; Approximate guess as to how much memory we use
&nbsp;
 	root  common.Hash &#47;&#47; Root hash to which this snapshot diff belongs to
<span class="term-fg31">-	stale uint32      &#47;&#47; Signals that the layer became stale (state progressed)</span>
<span class="term-fg32">+	stale atomic.Bool &#47;&#47; Signals that the layer became stale (state progressed)</span>
&nbsp;
 	&#47;&#47; destructSet is a very special helper marker. If an account is marked as
 	&#47;&#47; deleted, then it&#39;s recorded in this set. However it&#39;s allowed that an account
<span class="term-fg36">@@ -267,7 +267,7 @@</span>
 &#47;&#47; Stale return whether this layer has become stale (was flattened across) or if
 &#47;&#47; it&#39;s still live.
 func (dl *diffLayer) Stale() bool {
<span class="term-fg31">-	return atomic.LoadUint32(&amp;dl.stale) != 0</span>
<span class="term-fg32">+	return dl.stale.Load()</span>
 }
&nbsp;
 &#47;&#47; Account directly retrieves the account associated with a particular hash in
<span class="term-fg36">@@ -449,7 +449,7 @@</span> 	defer parent.lock.Unlock()
&nbsp;
 	&#47;&#47; Before actually writing all our data to the parent, first ensure that the
 	&#47;&#47; parent hasn&#39;t been &#39;corrupted&#39; by someone else already flattening into it
<span class="term-fg31">-	if atomic.SwapUint32(&amp;parent.stale, 1) != 0 {</span>
<span class="term-fg32">+	if parent.stale.Swap(true) {</span>
 		panic(&quot;parent diff layer is stale&quot;) &#47;&#47; we&#39;ve flattened into the same parent from two children, boo
 	}
 	&#47;&#47; Overwrite all the updated accounts blindly, merge the sorted list</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b3022a6f12d483f6c142b612" role="button"
                   aria-expanded="false" aria-controls="id-b3022a6f12d483f6c142b612">
                    <code>core/state/snapshot/generate.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/generate.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/generate.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b3022a6f12d483f6c142b612"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;generate.go op-geth&#47;core&#47;state&#47;snapshot&#47;generate.go</span>
<span class="term-fg1">index d46705d31e3fef40e86677377b08b3295c67b797..68c2f574b873f2bd59d243dfa41f23f6d738651a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;generate.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;generate.go</span>
<span class="term-fg36">@@ -230,7 +230,7 @@</span> 	root := trieId.Root
 	if origin == nil &amp;&amp; !diskMore {
 		stackTr := trie.NewStackTrie(nil)
 		for i, key := range keys {
<span class="term-fg31">-			stackTr.TryUpdate(key, vals[i])</span>
<span class="term-fg32">+			stackTr.Update(key, vals[i])</span>
 		}
 		if gotRoot := stackTr.Hash(); gotRoot != root {
 			return &amp;proofResult{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2f95fbd68772f24c6ae13085" role="button"
                   aria-expanded="false" aria-controls="id-2f95fbd68772f24c6ae13085">
                    <code>core/state/snapshot/generate_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/generate_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/generate_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+7</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2f95fbd68772f24c6ae13085"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;generate_test.go op-geth&#47;core&#47;state&#47;snapshot&#47;generate_test.go</span>
<span class="term-fg1">index 1bac4fd5604c6c946c7b9d633a7df233913d8278..546132e7dd80c29de354bb4091008fa5acd45f0d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;generate_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;generate_test.go</span>
<span class="term-fg36">@@ -161,7 +161,7 @@</span> }
&nbsp;
 func (t *testHelper) addTrieAccount(acckey string, acc *Account) {
 	val, _ := rlp.EncodeToBytes(acc)
<span class="term-fg31">-	t.accTrie.Update([]byte(acckey), val)</span>
<span class="term-fg32">+	t.accTrie.MustUpdate([]byte(acckey), val)</span>
 }
&nbsp;
 func (t *testHelper) addSnapAccount(acckey string, acc *Account) {
<span class="term-fg36">@@ -186,7 +186,7 @@</span> func (t *testHelper) makeStorageTrie(stateRoot, owner common.Hash, keys []string, vals []string, commit bool) []byte {
 	id := trie.StorageTrieID(stateRoot, owner, common.Hash{})
 	stTrie, _ := trie.NewStateTrie(id, t.triedb)
 	for i, k := range keys {
<span class="term-fg31">-		stTrie.Update([]byte(k), []byte(vals[i]))</span>
<span class="term-fg32">+		stTrie.MustUpdate([]byte(k), []byte(vals[i]))</span>
 	}
 	if !commit {
 		return stTrie.Hash().Bytes()
<span class="term-fg36">@@ -491,7 +491,7 @@</span> 			true,
 		)
 		acc := &amp;Account{Balance: big.NewInt(1), Root: stRoot, CodeHash: types.EmptyCodeHash.Bytes()}
 		val, _ := rlp.EncodeToBytes(acc)
<span class="term-fg31">-		helper.accTrie.Update([]byte(&quot;acc-1&quot;), val) &#47;&#47; 0x9250573b9c18c664139f3b6a7a8081b7d8f8916a8fcc5d94feec6c29f5fd4e9e</span>
<span class="term-fg32">+		helper.accTrie.MustUpdate([]byte(&quot;acc-1&quot;), val) &#47;&#47; 0x9250573b9c18c664139f3b6a7a8081b7d8f8916a8fcc5d94feec6c29f5fd4e9e</span>
&nbsp;
 		&#47;&#47; Identical in the snap
 		key := hashData([]byte(&quot;acc-1&quot;))
<span class="term-fg36">@@ -562,7 +562,7 @@</span> 			true,
 		)
 		acc := &amp;Account{Balance: big.NewInt(1), Root: stRoot, CodeHash: types.EmptyCodeHash.Bytes()}
 		val, _ := rlp.EncodeToBytes(acc)
<span class="term-fg31">-		helper.accTrie.Update([]byte(&quot;acc-1&quot;), val) &#47;&#47; 0x9250573b9c18c664139f3b6a7a8081b7d8f8916a8fcc5d94feec6c29f5fd4e9e</span>
<span class="term-fg32">+		helper.accTrie.MustUpdate([]byte(&quot;acc-1&quot;), val) &#47;&#47; 0x9250573b9c18c664139f3b6a7a8081b7d8f8916a8fcc5d94feec6c29f5fd4e9e</span>
&nbsp;
 		&#47;&#47; Identical in the snap
 		key := hashData([]byte(&quot;acc-1&quot;))
<span class="term-fg36">@@ -613,8 +613,8 @@</span> 	helper := newHelper()
 	{
 		acc := &amp;Account{Balance: big.NewInt(1), Root: types.EmptyRootHash.Bytes(), CodeHash: types.EmptyCodeHash.Bytes()}
 		val, _ := rlp.EncodeToBytes(acc)
<span class="term-fg31">-		helper.accTrie.Update(common.HexToHash(&quot;0x03&quot;).Bytes(), val)</span>
<span class="term-fg31">-		helper.accTrie.Update(common.HexToHash(&quot;0x07&quot;).Bytes(), val)</span>
<span class="term-fg32">+		helper.accTrie.MustUpdate(common.HexToHash(&quot;0x03&quot;).Bytes(), val)</span>
<span class="term-fg32">+		helper.accTrie.MustUpdate(common.HexToHash(&quot;0x07&quot;).Bytes(), val)</span>
&nbsp;
 		rawdb.WriteAccountSnapshot(helper.diskdb, common.HexToHash(&quot;0x01&quot;), val)
 		rawdb.WriteAccountSnapshot(helper.diskdb, common.HexToHash(&quot;0x02&quot;), val)
<span class="term-fg36">@@ -650,7 +650,7 @@</span> 	helper := newHelper()
 	{
 		acc := &amp;Account{Balance: big.NewInt(1), Root: types.EmptyRootHash.Bytes(), CodeHash: types.EmptyCodeHash.Bytes()}
 		val, _ := rlp.EncodeToBytes(acc)
<span class="term-fg31">-		helper.accTrie.Update(common.HexToHash(&quot;0x03&quot;).Bytes(), val)</span>
<span class="term-fg32">+		helper.accTrie.MustUpdate(common.HexToHash(&quot;0x03&quot;).Bytes(), val)</span>
&nbsp;
 		junk := make([]byte, 100)
 		copy(junk, []byte{0xde, 0xad})</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a26eaa542301a7cdfb6e666d" role="button"
                   aria-expanded="false" aria-controls="id-a26eaa542301a7cdfb6e666d">
                    <code>core/state/snapshot/snapshot.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/snapshot.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/snapshot.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a26eaa542301a7cdfb6e666d"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;snapshot.go op-geth&#47;core&#47;state&#47;snapshot&#47;snapshot.go</span>
<span class="term-fg1">index 0f3fa2c7a4f0b8fea8b8380e5f35bff521398953..2e57a059dd7c10e770eec1ce2649af48deddaa74 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;snapshot.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;snapshot.go</span>
<span class="term-fg36">@@ -22,7 +22,6 @@</span> 	&quot;bytes&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
 	&quot;sync&quot;
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;rawdb&quot;
<span class="term-fg36">@@ -272,7 +271,7 @@</span>
 		case *diffLayer:
 			&#47;&#47; If the layer is a simple diff, simply mark as stale
 			layer.lock.Lock()
<span class="term-fg31">-			atomic.StoreUint32(&amp;layer.stale, 1)</span>
<span class="term-fg32">+			layer.stale.Store(true)</span>
 			layer.lock.Unlock()
&nbsp;
 		default:
<span class="term-fg36">@@ -726,7 +725,7 @@</span>
 		case *diffLayer:
 			&#47;&#47; If the layer is a simple diff, simply mark as stale
 			layer.lock.Lock()
<span class="term-fg31">-			atomic.StoreUint32(&amp;layer.stale, 1)</span>
<span class="term-fg32">+			layer.stale.Store(true)</span>
 			layer.lock.Unlock()
&nbsp;
 		default:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4ebfce8cb4fef6025d504b89" role="button"
                   aria-expanded="false" aria-controls="id-4ebfce8cb4fef6025d504b89">
                    <code>core/state/snapshot/snapshot_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/snapshot/snapshot_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/snapshot/snapshot_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4ebfce8cb4fef6025d504b89"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;snapshot&#47;snapshot_test.go op-geth&#47;core&#47;state&#47;snapshot&#47;snapshot_test.go</span>
<span class="term-fg1">index 6893f6001e335104f99c5edd63bfe55a42dc5603..249da10aa643f2babd42812dc6425f9d07162cbc 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;snapshot&#47;snapshot_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;snapshot&#47;snapshot_test.go</span>
<span class="term-fg36">@@ -118,7 +118,7 @@</span> 	&#47;&#47; Commit the diff layer onto the disk and ensure it&#39;s persisted
 	if err := snaps.Cap(common.HexToHash(&quot;0x02&quot;), 0); err != nil {
 		t.Fatalf(&quot;failed to merge diff layer onto disk: %v&quot;, err)
 	}
<span class="term-fg31">-	&#47;&#47; Since the base layer was modified, ensure that data retrieval on the external reference fail</span>
<span class="term-fg32">+	&#47;&#47; Since the base layer was modified, ensure that data retrievals on the external reference fail</span>
 	if acc, err := ref.Account(common.HexToHash(&quot;0x01&quot;)); err != ErrSnapshotStale {
 		t.Errorf(&quot;stale reference returned account: %#x (err: %v)&quot;, acc, err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-aff553ce6484cc0ba7db1959" role="button"
                   aria-expanded="false" aria-controls="id-aff553ce6484cc0ba7db1959">
                    <code>core/state/state_object.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/state_object.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/state_object.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-aff553ce6484cc0ba7db1959"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;state_object.go op-geth&#47;core&#47;state&#47;state_object.go</span>
<span class="term-fg1">index 7e34cba44a8299c1ea843ca1b50fae98a248f3eb..95fe6f52fa8434aa3bb48cce16fa469f7e0fa0a2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;state_object.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;state_object.go</span>
<span class="term-fg36">@@ -201,7 +201,7 @@</span> 		if err != nil {
 			s.db.setError(err)
 			return common.Hash{}
 		}
<span class="term-fg31">-		enc, err = tr.TryGet(key.Bytes())</span>
<span class="term-fg32">+		enc, err = tr.GetStorage(s.address, key.Bytes())</span>
 		if metrics.EnabledExpensive {
 			s.db.StorageReads += time.Since(start)
 		}
<span class="term-fg36">@@ -253,7 +253,7 @@</span> 			slotsToPrefetch = append(slotsToPrefetch, common.CopyBytes(key[:])) &#47;&#47; Copy needed for closure
 		}
 	}
 	if s.db.prefetcher != nil &amp;&amp; prefetch &amp;&amp; len(slotsToPrefetch) &gt; 0 &amp;&amp; s.data.Root != types.EmptyRootHash {
<span class="term-fg31">-		s.db.prefetcher.prefetch(s.addrHash, s.data.Root, slotsToPrefetch)</span>
<span class="term-fg32">+		s.db.prefetcher.prefetch(s.addrHash, s.data.Root, s.address, slotsToPrefetch)</span>
 	}
 	if len(s.dirtyStorage) &gt; 0 {
 		s.dirtyStorage = make(Storage)
<span class="term-fg36">@@ -294,7 +294,7 @@</span> 		s.originStorage[key] = value
&nbsp;
 		var v []byte
 		if (value == common.Hash{}) {
<span class="term-fg31">-			if err := tr.TryDelete(key[:]); err != nil {</span>
<span class="term-fg32">+			if err := tr.DeleteStorage(s.address, key[:]); err != nil {</span>
 				s.db.setError(err)
 				return nil, err
 			}
<span class="term-fg36">@@ -302,7 +302,7 @@</span> 			s.db.StorageDeleted += 1
 		} else {
 			&#47;&#47; Encoding []byte cannot fail, ok to ignore the error.
 			v, _ = rlp.EncodeToBytes(common.TrimLeftZeroes(value[:]))
<span class="term-fg31">-			if err := tr.TryUpdate(key[:], v); err != nil {</span>
<span class="term-fg32">+			if err := tr.UpdateStorage(s.address, key[:], v); err != nil {</span>
 				s.db.setError(err)
 				return nil, err
 			}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-06a0421e500e32ddfe5a77a2" role="button"
                   aria-expanded="false" aria-controls="id-06a0421e500e32ddfe5a77a2">
                    <code>core/state/statedb.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/statedb.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/statedb.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-06a0421e500e32ddfe5a77a2"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;statedb.go op-geth&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg1">index 54d5040451be1c7198f09d94d8271a5b0e78c463..b89f4bfd8c322202da2a85a0da3e3daee08269af 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg36">@@ -512,7 +512,7 @@</span> 		defer func(start time.Time) { s.AccountUpdates += time.Since(start) }(time.Now())
 	}
 	&#47;&#47; Encode the account and update the account trie
 	addr := obj.Address()
<span class="term-fg31">-	if err := s.trie.TryUpdateAccount(addr, &amp;obj.data); err != nil {</span>
<span class="term-fg32">+	if err := s.trie.UpdateAccount(addr, &amp;obj.data); err != nil {</span>
 		s.setError(fmt.Errorf(&quot;updateStateObject (%x) error: %v&quot;, addr[:], err))
 	}
&nbsp;
<span class="term-fg36">@@ -533,7 +533,7 @@</span> 		defer func(start time.Time) { s.AccountUpdates += time.Since(start) }(time.Now())
 	}
 	&#47;&#47; Delete the account from the trie
 	addr := obj.Address()
<span class="term-fg31">-	if err := s.trie.TryDeleteAccount(addr); err != nil {</span>
<span class="term-fg32">+	if err := s.trie.DeleteAccount(addr); err != nil {</span>
 		s.setError(fmt.Errorf(&quot;deleteStateObject (%x) error: %v&quot;, addr[:], err))
 	}
 }
<span class="term-fg36">@@ -587,7 +587,7 @@</span> 	&#47;&#47; If snapshot unavailable or reading from it failed, load from the database
 	if data == nil {
 		start := time.Now()
 		var err error
<span class="term-fg31">-		data, err = s.trie.TryGetAccount(addr)</span>
<span class="term-fg32">+		data, err = s.trie.GetAccount(addr)</span>
 		if metrics.EnabledExpensive {
 			s.AccountReads += time.Since(start)
 		}
<span class="term-fg36">@@ -871,7 +871,7 @@</span> 		&#47;&#47; the commit-phase will be a lot faster
 		addressesToPrefetch = append(addressesToPrefetch, common.CopyBytes(addr[:])) &#47;&#47; Copy needed for closure
 	}
 	if s.prefetcher != nil &amp;&amp; len(addressesToPrefetch) &gt; 0 {
<span class="term-fg31">-		s.prefetcher.prefetch(common.Hash{}, s.originalRoot, addressesToPrefetch)</span>
<span class="term-fg32">+		s.prefetcher.prefetch(common.Hash{}, s.originalRoot, common.Address{}, addressesToPrefetch)</span>
 	}
 	&#47;&#47; Invalidate journal because reverting across transactions is not allowed.
 	s.clearJournalAndRefund()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ba94973af10802b80f5fddf2" role="button"
                   aria-expanded="false" aria-controls="id-ba94973af10802b80f5fddf2">
                    <code>core/state/sync_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/sync_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/sync_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ba94973af10802b80f5fddf2"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;sync_test.go op-geth&#47;core&#47;state&#47;sync_test.go</span>
<span class="term-fg1">index aff91268aafdf8cb205a9f9e4f6ccdd99b44d3b2..090d55e473f9dfa33aaeffe2c952f47d2ac32cb6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;sync_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;sync_test.go</span>
<span class="term-fg36">@@ -213,14 +213,14 @@</span> 		}
 		for i, node := range nodeElements {
 			if bypath {
 				if len(node.syncPath) == 1 {
<span class="term-fg31">-					data, _, err := srcTrie.TryGetNode(node.syncPath[0])</span>
<span class="term-fg32">+					data, _, err := srcTrie.GetNode(node.syncPath[0])</span>
 					if err != nil {
 						t.Fatalf(&quot;failed to retrieve node data for path %x: %v&quot;, node.syncPath[0], err)
 					}
 					nodeResults[i] = trie.NodeSyncResult{Path: node.path, Data: data}
 				} else {
 					var acc types.StateAccount
<span class="term-fg31">-					if err := rlp.DecodeBytes(srcTrie.Get(node.syncPath[0]), &amp;acc); err != nil {</span>
<span class="term-fg32">+					if err := rlp.DecodeBytes(srcTrie.MustGet(node.syncPath[0]), &amp;acc); err != nil {</span>
 						t.Fatalf(&quot;failed to decode account on path %x: %v&quot;, node.syncPath[0], err)
 					}
 					id := trie.StorageTrieID(srcRoot, common.BytesToHash(node.syncPath[0]), acc.Root)
<span class="term-fg36">@@ -228,7 +228,7 @@</span> 					stTrie, err := trie.New(id, srcDb.TrieDB())
 					if err != nil {
 						t.Fatalf(&quot;failed to retriev storage trie for path %x: %v&quot;, node.syncPath[1], err)
 					}
<span class="term-fg31">-					data, _, err := stTrie.TryGetNode(node.syncPath[1])</span>
<span class="term-fg32">+					data, _, err := stTrie.GetNode(node.syncPath[1])</span>
 					if err != nil {
 						t.Fatalf(&quot;failed to retrieve node data for path %x: %v&quot;, node.syncPath[1], err)
 					}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-694d5a721b8e895648e9cb7a" role="button"
                   aria-expanded="false" aria-controls="id-694d5a721b8e895648e9cb7a">
                    <code>core/state/trie_prefetcher.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/trie_prefetcher.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/trie_prefetcher.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-694d5a721b8e895648e9cb7a"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;trie_prefetcher.go op-geth&#47;core&#47;state&#47;trie_prefetcher.go</span>
<span class="term-fg1">index f142c86bbfa0644cb87d27266a6d313d8bb0aa51..844f72fc106bf3a76006865fe7c2a4d80c983c29 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;trie_prefetcher.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;trie_prefetcher.go</span>
<span class="term-fg36">@@ -141,7 +141,7 @@</span> 	return copy
 }
&nbsp;
 &#47;&#47; prefetch schedules a batch of trie items to prefetch.
<span class="term-fg31">-func (p *triePrefetcher) prefetch(owner common.Hash, root common.Hash, keys [][]byte) {</span>
<span class="term-fg32">+func (p *triePrefetcher) prefetch(owner common.Hash, root common.Hash, addr common.Address, keys [][]byte) {</span>
 	&#47;&#47; If the prefetcher is an inactive one, bail out
 	if p.fetches != nil {
 		return
<span class="term-fg36">@@ -150,7 +150,7 @@</span> 	&#47;&#47; Active fetcher, schedule the retrievals
 	id := p.trieID(owner, root)
 	fetcher := p.fetchers[id]
 	if fetcher == nil {
<span class="term-fg31">-		fetcher = newSubfetcher(p.db, p.root, owner, root)</span>
<span class="term-fg32">+		fetcher = newSubfetcher(p.db, p.root, owner, root, addr)</span>
 		p.fetchers[id] = fetcher
 	}
 	fetcher.schedule(keys)
<span class="term-fg36">@@ -205,11 +205,12 @@</span> &#47;&#47; single trie. It is spawned when a new root is encountered and lives until the
 &#47;&#47; main prefetcher is paused and either all requested items are processed or if
 &#47;&#47; the trie being worked on is retrieved from the prefetcher.
 type subfetcher struct {
<span class="term-fg31">-	db    Database    &#47;&#47; Database to load trie nodes through</span>
<span class="term-fg31">-	state common.Hash &#47;&#47; Root hash of the state to prefetch</span>
<span class="term-fg31">-	owner common.Hash &#47;&#47; Owner of the trie, usually account hash</span>
<span class="term-fg31">-	root  common.Hash &#47;&#47; Root hash of the trie to prefetch</span>
<span class="term-fg31">-	trie  Trie        &#47;&#47; Trie being populated with nodes</span>
<span class="term-fg32">+	db    Database       &#47;&#47; Database to load trie nodes through</span>
<span class="term-fg32">+	state common.Hash    &#47;&#47; Root hash of the state to prefetch</span>
<span class="term-fg32">+	owner common.Hash    &#47;&#47; Owner of the trie, usually account hash</span>
<span class="term-fg32">+	root  common.Hash    &#47;&#47; Root hash of the trie to prefetch</span>
<span class="term-fg32">+	addr  common.Address &#47;&#47; Address of the account that the trie belongs to</span>
<span class="term-fg32">+	trie  Trie           &#47;&#47; Trie being populated with nodes</span>
&nbsp;
 	tasks [][]byte   &#47;&#47; Items queued up for retrieval
 	lock  sync.Mutex &#47;&#47; Lock protecting the task queue
<span class="term-fg36">@@ -226,12 +227,13 @@</span> }
&nbsp;
 &#47;&#47; newSubfetcher creates a goroutine to prefetch state items belonging to a
 &#47;&#47; particular root hash.
<span class="term-fg31">-func newSubfetcher(db Database, state common.Hash, owner common.Hash, root common.Hash) *subfetcher {</span>
<span class="term-fg32">+func newSubfetcher(db Database, state common.Hash, owner common.Hash, root common.Hash, addr common.Address) *subfetcher {</span>
 	sf := &amp;subfetcher{
 		db:    db,
 		state: state,
 		owner: owner,
 		root:  root,
<span class="term-fg32">+		addr:  addr,</span>
 		wake:  make(chan struct{}, 1),
 		stop:  make(chan struct{}),
 		term:  make(chan struct{}),
<span class="term-fg36">@@ -336,7 +338,11 @@</span> 					&#47;&#47; No termination request yet, prefetch the next entry
 					if _, ok := sf.seen[string(task)]; ok {
 						sf.dups++
 					} else {
<span class="term-fg31">-						sf.trie.TryGet(task)</span>
<span class="term-fg32">+						if len(task) == common.AddressLength {</span>
<span class="term-fg32">+							sf.trie.GetAccount(common.BytesToAddress(task))</span>
<span class="term-fg32">+						} else {</span>
<span class="term-fg32">+							sf.trie.GetStorage(sf.addr, task)</span>
<span class="term-fg32">+						}</span>
 						sf.seen[string(task)] = struct{}{}
 					}
 				}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3a8d62ee2ba0fb258fc772c4" role="button"
                   aria-expanded="false" aria-controls="id-3a8d62ee2ba0fb258fc772c4">
                    <code>core/state/trie_prefetcher_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/state/trie_prefetcher_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/state/trie_prefetcher_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+8</span></div>
                        <div class="text-start"><span class="text-danger">-8</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3a8d62ee2ba0fb258fc772c4"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;state&#47;trie_prefetcher_test.go op-geth&#47;core&#47;state&#47;trie_prefetcher_test.go</span>
<span class="term-fg1">index cb0b67d7ea79f0fb9a179d98b1d0c30be4038ff2..501bb70840f0c7f6c256e76d2fda23c25aa366ff 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;state&#47;trie_prefetcher_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;state&#47;trie_prefetcher_test.go</span>
<span class="term-fg36">@@ -47,19 +47,19 @@</span> func TestCopyAndClose(t *testing.T) {
 	db := filledStateDB()
 	prefetcher := newTriePrefetcher(db.db, db.originalRoot, &quot;&quot;)
 	skey := common.HexToHash(&quot;aaa&quot;)
<span class="term-fg31">-	prefetcher.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg31">-	prefetcher.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	prefetcher.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	prefetcher.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	time.Sleep(1 * time.Second)
 	a := prefetcher.trie(common.Hash{}, db.originalRoot)
<span class="term-fg31">-	prefetcher.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	prefetcher.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	b := prefetcher.trie(common.Hash{}, db.originalRoot)
 	cpy := prefetcher.copy()
<span class="term-fg31">-	cpy.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg31">-	cpy.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	cpy.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	cpy.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	c := cpy.trie(common.Hash{}, db.originalRoot)
 	prefetcher.close()
 	cpy2 := cpy.copy()
<span class="term-fg31">-	cpy2.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	cpy2.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	d := cpy2.trie(common.Hash{}, db.originalRoot)
 	cpy.close()
 	cpy2.close()
<span class="term-fg36">@@ -72,7 +72,7 @@</span> func TestUseAfterClose(t *testing.T) {
 	db := filledStateDB()
 	prefetcher := newTriePrefetcher(db.db, db.originalRoot, &quot;&quot;)
 	skey := common.HexToHash(&quot;aaa&quot;)
<span class="term-fg31">-	prefetcher.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	prefetcher.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	a := prefetcher.trie(common.Hash{}, db.originalRoot)
 	prefetcher.close()
 	b := prefetcher.trie(common.Hash{}, db.originalRoot)
<span class="term-fg36">@@ -88,7 +88,7 @@</span> func TestCopyClose(t *testing.T) {
 	db := filledStateDB()
 	prefetcher := newTriePrefetcher(db.db, db.originalRoot, &quot;&quot;)
 	skey := common.HexToHash(&quot;aaa&quot;)
<span class="term-fg31">-	prefetcher.prefetch(common.Hash{}, db.originalRoot, [][]byte{skey.Bytes()})</span>
<span class="term-fg32">+	prefetcher.prefetch(common.Hash{}, db.originalRoot, common.Address{}, [][]byte{skey.Bytes()})</span>
 	cpy := prefetcher.copy()
 	a := prefetcher.trie(common.Hash{}, db.originalRoot)
 	b := cpy.trie(common.Hash{}, db.originalRoot)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-60105f6e409ae3fbd8f95bcf" role="button"
                   aria-expanded="false" aria-controls="id-60105f6e409ae3fbd8f95bcf">
                    <code>core/types.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-60105f6e409ae3fbd8f95bcf"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types.go op-geth&#47;core&#47;types.go</span>
<span class="term-fg1">index 4c5b74a49865b26d3d9c10ed7b90bf490aec683d..36eb0d1dedbedeadf8db49ea35faf77da5e1d010 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types.go</span>
<span class="term-fg36">@@ -17,6 +17,8 @@</span>
 package core
&nbsp;
 import (
<span class="term-fg32">+	&quot;sync&#47;atomic&quot;</span>
<span class="term-fg32">+</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;
<span class="term-fg36">@@ -39,7 +41,7 @@</span> type Prefetcher interface {
 	&#47;&#47; Prefetch processes the state changes according to the Ethereum rules by running
 	&#47;&#47; the transaction messages using the statedb, but any changes are discarded. The
 	&#47;&#47; only goal is to pre-cache transaction signatures and state trie nodes.
<span class="term-fg31">-	Prefetch(block *types.Block, statedb *state.StateDB, cfg vm.Config, interrupt *uint32)</span>
<span class="term-fg32">+	Prefetch(block *types.Block, statedb *state.StateDB, cfg vm.Config, interrupt *atomic.Bool)</span>
 }
&nbsp;
 &#47;&#47; Processor is an interface for processing blocks using a given initial state.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c2afb96c5aa13d5f6e3d03e3" role="button"
                   aria-expanded="false" aria-controls="id-c2afb96c5aa13d5f6e3d03e3">
                    <code>core/types/block.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/block.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/block.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c2afb96c5aa13d5f6e3d03e3"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;block.go op-geth&#47;core&#47;types&#47;block.go</span>
<span class="term-fg1">index e2c71abebd7056b7ad0c09f72ed673bd8304c0db..a1a14f5b1657983e25456a4ef7b964938ea927eb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;block.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;block.go</span>
<span class="term-fg36">@@ -85,6 +85,9 @@</span>
 	&#47;&#47; WithdrawalsHash was added by EIP-4895 and is ignored in legacy headers.
 	WithdrawalsHash *common.Hash `json:&quot;withdrawalsRoot&quot; rlp:&quot;optional&quot;`
&nbsp;
<span class="term-fg32">+	&#47;&#47; ExcessDataGas was added by EIP-4844 and is ignored in legacy headers.</span>
<span class="term-fg32">+	ExcessDataGas *big.Int `json:&quot;excessDataGas&quot; rlp:&quot;optional&quot;`</span>
<span class="term-fg32">+</span>
 	&#47;*
 		TODO (MariusVanDerWijden) Add this field once needed
 		&#47;&#47; Random was added during the merge and contains the BeaconState randomness</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02f9e8bcacb1961b710d83e0" role="button"
                   aria-expanded="false" aria-controls="id-02f9e8bcacb1961b710d83e0">
                    <code>core/types/block_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/block_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/block_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02f9e8bcacb1961b710d83e0"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;block_test.go op-geth&#47;core&#47;types&#47;block_test.go</span>
<span class="term-fg1">index 49197c923764d9c0fc1ea5551b722c925e4bb8a6..966015eb015d85c17d96a4ac551e29d95706fab6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;block_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;block_test.go</span>
<span class="term-fg36">@@ -232,9 +232,10 @@</span> func (h *testHasher) Reset() {
 	h.hasher.Reset()
 }
&nbsp;
<span class="term-fg31">-func (h *testHasher) Update(key, val []byte) {</span>
<span class="term-fg32">+func (h *testHasher) Update(key, val []byte) error {</span>
 	h.hasher.Write(key)
 	h.hasher.Write(val)
<span class="term-fg32">+	return nil</span>
 }
&nbsp;
 func (h *testHasher) Hash() common.Hash {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2efeae3648be1910fc252932" role="button"
                   aria-expanded="false" aria-controls="id-2efeae3648be1910fc252932">
                    <code>core/types/hashing.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/hashing.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/hashing.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2efeae3648be1910fc252932"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;hashing.go op-geth&#47;core&#47;types&#47;hashing.go</span>
<span class="term-fg1">index 3df75432a4b438677737afbf859348024aec9de0..fbdeaf0d0793c61b2e8e8c08cfb265e2468c387e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;hashing.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;hashing.go</span>
<span class="term-fg36">@@ -62,7 +62,7 @@</span> &#47;&#47; TrieHasher is the tool used to calculate the hash of derivable list.
 &#47;&#47; This is internal, do not use.
 type TrieHasher interface {
 	Reset()
<span class="term-fg31">-	Update([]byte, []byte)</span>
<span class="term-fg32">+	Update([]byte, []byte) error</span>
 	Hash() common.Hash
 }
&nbsp;
<span class="term-fg36">@@ -83,7 +83,7 @@</span> 	&#47;&#47; written to it must not alias.
 	return common.CopyBytes(buf.Bytes())
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; DeriveSha creates the tree hashes of transactions and receipts in a block header.</span>
<span class="term-fg32">+&#47;&#47; DeriveSha creates the tree hashes of transactions, receipts, and withdrawals in a block header.</span>
 func DeriveSha(list DerivableList, hasher TrieHasher) common.Hash {
 	hasher.Reset()
&nbsp;
<span class="term-fg36">@@ -93,6 +93,9 @@</span>
 	&#47;&#47; StackTrie requires values to be inserted in increasing hash order, which is not the
 	&#47;&#47; order that `list` provides hashes in. This insertion sequence ensures that the
 	&#47;&#47; order is correct.
<span class="term-fg32">+	&#47;&#47;</span>
<span class="term-fg32">+	&#47;&#47; The error returned by hasher is omitted because hasher will produce an incorrect</span>
<span class="term-fg32">+	&#47;&#47; hash in case any error occurs.</span>
 	var indexBuf []byte
 	for i := 1; i &lt; list.Len() &amp;&amp; i &lt;= 0x7f; i++ {
 		indexBuf = rlp.AppendUint64(indexBuf[:0], uint64(i))</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-773b2aee28f1656d446c425c" role="button"
                   aria-expanded="false" aria-controls="id-773b2aee28f1656d446c425c">
                    <code>core/types/hashing_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/hashing_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/hashing_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-773b2aee28f1656d446c425c"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;hashing_test.go op-geth&#47;core&#47;types&#47;hashing_test.go</span>
<span class="term-fg1">index 294a3977d03b03ce46170b5220f731c181296f33..c5b9f690d801092097e31ad786f7eaf7474e4465 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;hashing_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;hashing_test.go</span>
<span class="term-fg36">@@ -219,9 +219,10 @@</span> func (d *hashToHumanReadable) Reset() {
 	d.data = make([]byte, 0)
 }
&nbsp;
<span class="term-fg31">-func (d *hashToHumanReadable) Update(i []byte, i2 []byte) {</span>
<span class="term-fg32">+func (d *hashToHumanReadable) Update(i []byte, i2 []byte) error {</span>
 	l := fmt.Sprintf(&quot;%x %x\n&quot;, i, i2)
 	d.data = append(d.data, []byte(l)...)
<span class="term-fg32">+	return nil</span>
 }
&nbsp;
 func (d *hashToHumanReadable) Hash() common.Hash {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1351e89c6850707268aa9b3c" role="button"
                   aria-expanded="false" aria-controls="id-1351e89c6850707268aa9b3c">
                    <code>core/types/receipt_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/types/receipt_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/receipt_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+171</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1351e89c6850707268aa9b3c"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;receipt_test.go op-geth&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg1">index 376177f976efb48b55e887c7229462a89246b16e..3f3df0398357e71b5915b8f63e6adbdce9327067 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg36">@@ -19,6 +19,7 @@</span>
 import (
 	&quot;bytes&quot;
 	&quot;encoding&#47;json&quot;
<span class="term-fg32">+	&quot;fmt&quot;</span>
 	&quot;math&quot;
 	&quot;math&#47;big&quot;
 	&quot;reflect&quot;
<span class="term-fg36">@@ -28,6 +29,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 	&quot;github.com&#47;kylelemons&#47;godebug&#47;diff&quot;
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
 )
&nbsp;
 var (
<span class="term-fg36">@@ -81,6 +83,42 @@</span> 			},
 		},
 		Type: DynamicFeeTxType,
 	}
<span class="term-fg32">+	depositReceiptNoNonce = &amp;Receipt{</span>
<span class="term-fg32">+		Status:            ReceiptStatusFailed,</span>
<span class="term-fg32">+		CumulativeGasUsed: 1,</span>
<span class="term-fg32">+		Logs: []*Log{</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x01, 0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		Type: DepositTxType,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	nonce                   = uint64(1234)</span>
<span class="term-fg32">+	depositReceiptWithNonce = &amp;Receipt{</span>
<span class="term-fg32">+		Status:            ReceiptStatusFailed,</span>
<span class="term-fg32">+		CumulativeGasUsed: 1,</span>
<span class="term-fg32">+		DepositNonce:      &amp;nonce,</span>
<span class="term-fg32">+		Logs: []*Log{</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x01, 0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		Type: DepositTxType,</span>
<span class="term-fg32">+	}</span>
 )
&nbsp;
 func TestDecodeEmptyTypedReceipt(t *testing.T) {
<span class="term-fg36">@@ -137,8 +175,13 @@</span> 			Gas:       5,
 			GasTipCap: big.NewInt(56),
 			GasFeeCap: big.NewInt(1055),
 		}),
<span class="term-fg32">+		NewTx(&amp;DepositTx{</span>
<span class="term-fg32">+			To:    nil, &#47;&#47; contract creation</span>
<span class="term-fg32">+			Value: big.NewInt(6),</span>
<span class="term-fg32">+			Gas:   50,</span>
<span class="term-fg32">+		}),</span>
 	}
<span class="term-fg31">-</span>
<span class="term-fg32">+	depNonce := uint64(7)</span>
 	blockNumber := big.NewInt(1)
 	blockHash := common.BytesToHash([]byte{0x03, 0x14})
&nbsp;
<span class="term-fg36">@@ -246,12 +289,45 @@</span> 			BlockHash:         blockHash,
 			BlockNumber:       blockNumber,
 			TransactionIndex:  4,
 		},
<span class="term-fg32">+		&amp;Receipt{</span>
<span class="term-fg32">+			Type:              DepositTxType,</span>
<span class="term-fg32">+			PostState:         common.Hash{5}.Bytes(),</span>
<span class="term-fg32">+			CumulativeGasUsed: 50 + 15,</span>
<span class="term-fg32">+			Logs: []*Log{</span>
<span class="term-fg32">+				{</span>
<span class="term-fg32">+					Address: common.BytesToAddress([]byte{0x33}),</span>
<span class="term-fg32">+					&#47;&#47; derived fields:</span>
<span class="term-fg32">+					BlockNumber: blockNumber.Uint64(),</span>
<span class="term-fg32">+					TxHash:      txs[5].Hash(),</span>
<span class="term-fg32">+					TxIndex:     5,</span>
<span class="term-fg32">+					BlockHash:   blockHash,</span>
<span class="term-fg32">+					Index:       4,</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+				{</span>
<span class="term-fg32">+					Address: common.BytesToAddress([]byte{0x03, 0x33}),</span>
<span class="term-fg32">+					&#47;&#47; derived fields:</span>
<span class="term-fg32">+					BlockNumber: blockNumber.Uint64(),</span>
<span class="term-fg32">+					TxHash:      txs[5].Hash(),</span>
<span class="term-fg32">+					TxIndex:     5,</span>
<span class="term-fg32">+					BlockHash:   blockHash,</span>
<span class="term-fg32">+					Index:       5,</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			TxHash:            txs[5].Hash(),</span>
<span class="term-fg32">+			ContractAddress:   common.HexToAddress(&quot;0x3bb898b4bbe24f68a4e9be46cfe72d1787fd74f4&quot;),</span>
<span class="term-fg32">+			GasUsed:           50,</span>
<span class="term-fg32">+			EffectiveGasPrice: big.NewInt(0),</span>
<span class="term-fg32">+			BlockHash:         blockHash,</span>
<span class="term-fg32">+			BlockNumber:       blockNumber,</span>
<span class="term-fg32">+			TransactionIndex:  5,</span>
<span class="term-fg32">+			DepositNonce:      &amp;depNonce,</span>
<span class="term-fg32">+		},</span>
 	}
&nbsp;
 	&#47;&#47; Re-derive receipts.
 	basefee := big.NewInt(1000)
 	derivedReceipts := clearComputedFieldsOnReceipts(receipts)
<span class="term-fg31">-	err := Receipts(derivedReceipts).DeriveFields(params.TestChainConfig, blockHash, blockNumber.Uint64(), basefee, txs)</span>
<span class="term-fg32">+	err := Receipts(derivedReceipts).DeriveFields(params.TestChainConfig, blockHash, blockNumber.Uint64(), 0, basefee, txs)</span>
 	if err != nil {
 		t.Fatalf(&quot;DeriveFields(...) = %v, want &lt;nil&gt;&quot;, err)
 	}
<span class="term-fg36">@@ -398,6 +474,38 @@</span> 		t.Errorf(&quot;receipt unmarshalled from binary mismatch, got %v want %v&quot;, got1559Receipt, eip1559Receipt)
 	}
 }
&nbsp;
<span class="term-fg32">+func TestBedrockDepositReceiptUnchanged(t *testing.T) {</span>
<span class="term-fg32">+	expectedRlp := common.FromHex(&quot;7EF90156A003000000000000000000000000000000000000000000000000000000000000000AB9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0D7940000000000000000000000000000000000000033C001D7940000000000000000000000000000000000000333C002&quot;)</span>
<span class="term-fg32">+	&#47;&#47; Deposit receipt with no nonce</span>
<span class="term-fg32">+	receipt := &amp;Receipt{</span>
<span class="term-fg32">+		Type:              DepositTxType,</span>
<span class="term-fg32">+		PostState:         common.Hash{3}.Bytes(),</span>
<span class="term-fg32">+		CumulativeGasUsed: 10,</span>
<span class="term-fg32">+		Logs: []*Log{</span>
<span class="term-fg32">+			{Address: common.BytesToAddress([]byte{0x33}), Data: []byte{1}, Topics: []common.Hash{}},</span>
<span class="term-fg32">+			{Address: common.BytesToAddress([]byte{0x03, 0x33}), Data: []byte{2}, Topics: []common.Hash{}},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		TxHash:          common.Hash{},</span>
<span class="term-fg32">+		ContractAddress: common.BytesToAddress([]byte{0x03, 0x33, 0x33}),</span>
<span class="term-fg32">+		GasUsed:         4,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	rlp, err := receipt.MarshalBinary()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	require.Equal(t, expectedRlp, rlp)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Consensus values should be unchanged after reparsing</span>
<span class="term-fg32">+	parsed := new(Receipt)</span>
<span class="term-fg32">+	err = parsed.UnmarshalBinary(rlp)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	require.Equal(t, receipt.Status, parsed.Status)</span>
<span class="term-fg32">+	require.Equal(t, receipt.CumulativeGasUsed, parsed.CumulativeGasUsed)</span>
<span class="term-fg32">+	require.Equal(t, receipt.Bloom, parsed.Bloom)</span>
<span class="term-fg32">+	require.EqualValues(t, receipt.Logs, parsed.Logs)</span>
<span class="term-fg32">+	&#47;&#47; And still shouldn&#39;t have a nonce</span>
<span class="term-fg32">+	require.Nil(t, parsed.DepositNonce)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func clearComputedFieldsOnReceipts(receipts []*Receipt) []*Receipt {
 	r := make([]*Receipt, len(receipts))
 	for i, receipt := range receipts {
<span class="term-fg36">@@ -431,3 +539,64 @@</span> 		l[i] = &amp;cpy
 	}
 	return l
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestRoundTripReceipt(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name string</span>
<span class="term-fg32">+		rcpt *Receipt</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{name: &quot;Legacy&quot;, rcpt: legacyReceipt},</span>
<span class="term-fg32">+		{name: &quot;AccessList&quot;, rcpt: accessListReceipt},</span>
<span class="term-fg32">+		{name: &quot;EIP1559&quot;, rcpt: eip1559Receipt},</span>
<span class="term-fg32">+		{name: &quot;DepositNoNonce&quot;, rcpt: depositReceiptNoNonce},</span>
<span class="term-fg32">+		{name: &quot;DepositWithNonce&quot;, rcpt: depositReceiptWithNonce},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, test := range tests {</span>
<span class="term-fg32">+		t.Run(test.name, func(t *testing.T) {</span>
<span class="term-fg32">+			data, err := test.rcpt.MarshalBinary()</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			d := &amp;Receipt{}</span>
<span class="term-fg32">+			err = d.UnmarshalBinary(data)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+			require.Equal(t, test.rcpt, d)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(fmt.Sprintf(&quot;%sRejectExtraData&quot;, test.name), func(t *testing.T) {</span>
<span class="term-fg32">+			data, err := test.rcpt.MarshalBinary()</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+			data = append(data, 1, 2, 3, 4)</span>
<span class="term-fg32">+			d := &amp;Receipt{}</span>
<span class="term-fg32">+			err = d.UnmarshalBinary(data)</span>
<span class="term-fg32">+			require.Error(t, err)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestRoundTripReceiptForStorage(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name string</span>
<span class="term-fg32">+		rcpt *Receipt</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{name: &quot;Legacy&quot;, rcpt: legacyReceipt},</span>
<span class="term-fg32">+		{name: &quot;AccessList&quot;, rcpt: accessListReceipt},</span>
<span class="term-fg32">+		{name: &quot;EIP1559&quot;, rcpt: eip1559Receipt},</span>
<span class="term-fg32">+		{name: &quot;DepositNoNonce&quot;, rcpt: depositReceiptNoNonce},</span>
<span class="term-fg32">+		{name: &quot;DepositWithNonce&quot;, rcpt: depositReceiptWithNonce},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, test := range tests {</span>
<span class="term-fg32">+		t.Run(test.name, func(t *testing.T) {</span>
<span class="term-fg32">+			data, err := rlp.EncodeToBytes((*ReceiptForStorage)(test.rcpt))</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			d := &amp;ReceiptForStorage{}</span>
<span class="term-fg32">+			err = rlp.DecodeBytes(data, d)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+			&#47;&#47; Only check the stored fields - the others are derived later</span>
<span class="term-fg32">+			require.Equal(t, test.rcpt.Status, d.Status)</span>
<span class="term-fg32">+			require.Equal(t, test.rcpt.CumulativeGasUsed, d.CumulativeGasUsed)</span>
<span class="term-fg32">+			require.Equal(t, test.rcpt.Logs, d.Logs)</span>
<span class="term-fg32">+			require.Equal(t, test.rcpt.DepositNonce, d.DepositNonce)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-631e7ecf4408a7c8bd752ede" role="button"
                   aria-expanded="false" aria-controls="id-631e7ecf4408a7c8bd752ede">
                    <code>core/types/rollup_l1_cost_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/types/rollup_l1_cost_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+30</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-631e7ecf4408a7c8bd752ede"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;types&#47;rollup_l1_cost_test.go op-geth&#47;core&#47;types&#47;rollup_l1_cost_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e43ea967ee87a257cfc2afa58396c2eb6685ed76</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;types&#47;rollup_l1_cost_test.go</span>
<span class="term-fg36">@@ -0,0 +1,30 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;rand&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestRollupGasData(t *testing.T) {</span>
<span class="term-fg32">+	for i := 0; i &lt; 100; i++ {</span>
<span class="term-fg32">+		zeroes := rand.Uint64()</span>
<span class="term-fg32">+		ones := rand.Uint64()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		r := RollupGasData{</span>
<span class="term-fg32">+			Zeroes: zeroes,</span>
<span class="term-fg32">+			Ones:   ones,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		time := uint64(1)</span>
<span class="term-fg32">+		cfg := &amp;params.ChainConfig{</span>
<span class="term-fg32">+			RegolithTime: &amp;time,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		gasPreRegolith := r.DataGas(0, cfg)</span>
<span class="term-fg32">+		gasPostRegolith := r.DataGas(1, cfg)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		require.Equal(t, r.Zeroes*params.TxDataZeroGas+(r.Ones+68)*params.TxDataNonZeroGasEIP2028, gasPreRegolith)</span>
<span class="term-fg32">+		require.Equal(t, r.Zeroes*params.TxDataZeroGas+r.Ones*params.TxDataNonZeroGasEIP2028, gasPostRegolith)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-30f312232d659ae3b5732145" role="button"
                   aria-expanded="false" aria-controls="id-30f312232d659ae3b5732145">
                    <code>core/vm/analysis.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/analysis.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/analysis.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-30f312232d659ae3b5732145"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;analysis.go op-geth&#47;core&#47;vm&#47;analysis.go</span>
<span class="term-fg1">index 4aa8cfe70f11d2906dc22ddd1f8878461384d85b..38af9084aca19fe2fa2f9770fe1c11d4c1312e42 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;analysis.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;analysis.go</span>
<span class="term-fg36">@@ -63,7 +63,7 @@</span>
 &#47;&#47; codeBitmap collects data locations in code.
 func codeBitmap(code []byte) bitvec {
 	&#47;&#47; The bitmap is 4 bytes longer than necessary, in case the code
<span class="term-fg31">-	&#47;&#47; ends with a PUSH32, the algorithm will push zeroes onto the</span>
<span class="term-fg32">+	&#47;&#47; ends with a PUSH32, the algorithm will set bits on the</span>
 	&#47;&#47; bitvector outside the bounds of the actual code.
 	bits := make(bitvec, len(code)&#47;8+1+4)
 	return codeBitmapInternal(code, bits)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d31e86579b9c63367baee711" role="button"
                   aria-expanded="false" aria-controls="id-d31e86579b9c63367baee711">
                    <code>core/vm/instructions.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/instructions.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/instructions.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d31e86579b9c63367baee711"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;instructions.go op-geth&#47;core&#47;vm&#47;instructions.go</span>
<span class="term-fg1">index 77b6e02bfcc7253cb2a1890b1b151ec4d7c729f5..505aef41277542669e78179c09f0251c539311ed 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;instructions.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;instructions.go</span>
<span class="term-fg36">@@ -17,8 +17,6 @@</span>
 package vm
&nbsp;
 import (
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
<span class="term-fg31">-</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
<span class="term-fg36">@@ -531,7 +529,7 @@</span> 	return nil, nil
 }
&nbsp;
 func opJump(pc *uint64, interpreter *EVMInterpreter, scope *ScopeContext) ([]byte, error) {
<span class="term-fg31">-	if atomic.LoadInt32(&amp;interpreter.evm.abort) != 0 {</span>
<span class="term-fg32">+	if interpreter.evm.abort.Load() {</span>
 		return nil, errStopToken
 	}
 	pos := scope.Stack.pop()
<span class="term-fg36">@@ -543,7 +541,7 @@</span> 	return nil, nil
 }
&nbsp;
 func opJumpi(pc *uint64, interpreter *EVMInterpreter, scope *ScopeContext) ([]byte, error) {
<span class="term-fg31">-	if atomic.LoadInt32(&amp;interpreter.evm.abort) != 0 {</span>
<span class="term-fg32">+	if interpreter.evm.abort.Load() {</span>
 		return nil, errStopToken
 	}
 	pos, cond := scope.Stack.pop(), scope.Stack.pop()
<span class="term-fg36">@@ -824,9 +822,9 @@</span> 	beneficiary := scope.Stack.pop()
 	balance := interpreter.evm.StateDB.GetBalance(scope.Contract.Address())
 	interpreter.evm.StateDB.AddBalance(beneficiary.Bytes20(), balance)
 	interpreter.evm.StateDB.Suicide(scope.Contract.Address())
<span class="term-fg31">-	if interpreter.evm.Config.Debug {</span>
<span class="term-fg31">-		interpreter.evm.Config.Tracer.CaptureEnter(SELFDESTRUCT, scope.Contract.Address(), beneficiary.Bytes20(), []byte{}, 0, balance)</span>
<span class="term-fg31">-		interpreter.evm.Config.Tracer.CaptureExit([]byte{}, 0, nil)</span>
<span class="term-fg32">+	if tracer := interpreter.evm.Config.Tracer; tracer != nil {</span>
<span class="term-fg32">+		tracer.CaptureEnter(SELFDESTRUCT, scope.Contract.Address(), beneficiary.Bytes20(), []byte{}, 0, balance)</span>
<span class="term-fg32">+		tracer.CaptureExit([]byte{}, 0, nil)</span>
 	}
 	return nil, errStopToken
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0c709759fec621c95e8bfe09" role="button"
                   aria-expanded="false" aria-controls="id-0c709759fec621c95e8bfe09">
                    <code>core/vm/interpreter.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/interpreter.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/interpreter.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0c709759fec621c95e8bfe09"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;interpreter.go op-geth&#47;core&#47;vm&#47;interpreter.go</span>
<span class="term-fg1">index 0ab520b90f0e5d839958b9bf487b6695c2b56fa1..5b2082bc9e90fe2b832c6172238c937b8ccc282d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;interpreter.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;interpreter.go</span>
<span class="term-fg36">@@ -25,7 +25,6 @@</span> )
&nbsp;
 &#47;&#47; Config are the configuration options for the Interpreter
 type Config struct {
<span class="term-fg31">-	Debug                   bool      &#47;&#47; Enables debugging</span>
 	Tracer                  EVMLogger &#47;&#47; Opcode logger
 	NoBaseFee               bool      &#47;&#47; Forces the EIP-1559 baseFee to 0 (needed for 0 price calls)
 	EnablePreimageRecording bool      &#47;&#47; Enables recording of SHA3&#47;keccak preimages
<span class="term-fg36">@@ -143,6 +142,7 @@</span> 		pcCopy  uint64 &#47;&#47; needed for the deferred EVMLogger
 		gasCopy uint64 &#47;&#47; for EVMLogger to log gas remaining before execution
 		logged  bool   &#47;&#47; deferred EVMLogger should ignore already logged steps
 		res     []byte &#47;&#47; result of the opcode execution function
<span class="term-fg32">+		debug   = in.evm.Config.Tracer != nil</span>
 	)
 	&#47;&#47; Don&#39;t move this deferred function, it&#39;s placed before the capturestate-deferred method,
 	&#47;&#47; so that it get&#39;s executed _after_: the capturestate needs the stacks before
<span class="term-fg36">@@ -152,7 +152,7 @@</span> 		returnStack(stack)
 	}()
 	contract.Input = input
&nbsp;
<span class="term-fg31">-	if in.evm.Config.Debug {</span>
<span class="term-fg32">+	if debug {</span>
 		defer func() {
 			if err != nil {
 				if !logged {
<span class="term-fg36">@@ -168,7 +168,7 @@</span> 	&#47;&#47; explicit STOP, RETURN or SELFDESTRUCT is executed, an error occurred during
 	&#47;&#47; the execution of one of the operations or until the done flag is set by the
 	&#47;&#47; parent context.
 	for {
<span class="term-fg31">-		if in.evm.Config.Debug {</span>
<span class="term-fg32">+		if debug {</span>
 			&#47;&#47; Capture pre-execution values for tracing.
 			logged, pcCopy, gasCopy = false, pc, contract.Gas
 		}
<span class="term-fg36">@@ -213,14 +213,14 @@</span> 			if err != nil || !contract.UseGas(dynamicCost) {
 				return nil, ErrOutOfGas
 			}
 			&#47;&#47; Do tracing before memory expansion
<span class="term-fg31">-			if in.evm.Config.Debug {</span>
<span class="term-fg32">+			if debug {</span>
 				in.evm.Config.Tracer.CaptureState(pc, op, gasCopy, cost, callContext, in.returnData, in.evm.depth, err)
 				logged = true
 			}
 			if memorySize &gt; 0 {
 				mem.Resize(memorySize)
 			}
<span class="term-fg31">-		} else if in.evm.Config.Debug {</span>
<span class="term-fg32">+		} else if debug {</span>
 			in.evm.Config.Tracer.CaptureState(pc, op, gasCopy, cost, callContext, in.returnData, in.evm.depth, err)
 			logged = true
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e6d8bb4d085e30826e278c7b" role="button"
                   aria-expanded="false" aria-controls="id-e6d8bb4d085e30826e278c7b">
                    <code>core/vm/jump_table_export.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/jump_table_export.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+74</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e6d8bb4d085e30826e278c7b"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;jump_table_export.go op-geth&#47;core&#47;vm&#47;jump_table_export.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0d61b00ede09851e4757a36e5e2e9b5a37e35cf9</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;jump_table_export.go</span>
<span class="term-fg36">@@ -0,0 +1,74 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2023 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package vm</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; LookupInstructionSet returns the instructionset for the fork configured by</span>
<span class="term-fg32">+&#47;&#47; the rules.</span>
<span class="term-fg32">+func LookupInstructionSet(rules params.Rules) (JumpTable, error) {</span>
<span class="term-fg32">+	switch {</span>
<span class="term-fg32">+	case rules.IsPrague:</span>
<span class="term-fg32">+		return newShanghaiInstructionSet(), errors.New(&quot;prague-fork not defined yet&quot;)</span>
<span class="term-fg32">+	case rules.IsCancun:</span>
<span class="term-fg32">+		return newShanghaiInstructionSet(), errors.New(&quot;cancun-fork not defined yet&quot;)</span>
<span class="term-fg32">+	case rules.IsShanghai:</span>
<span class="term-fg32">+		return newShanghaiInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsMerge:</span>
<span class="term-fg32">+		return newMergeInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsLondon:</span>
<span class="term-fg32">+		return newLondonInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsBerlin:</span>
<span class="term-fg32">+		return newBerlinInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsIstanbul:</span>
<span class="term-fg32">+		return newIstanbulInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsConstantinople:</span>
<span class="term-fg32">+		return newConstantinopleInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsByzantium:</span>
<span class="term-fg32">+		return newByzantiumInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsEIP158:</span>
<span class="term-fg32">+		return newSpuriousDragonInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsEIP150:</span>
<span class="term-fg32">+		return newTangerineWhistleInstructionSet(), nil</span>
<span class="term-fg32">+	case rules.IsHomestead:</span>
<span class="term-fg32">+		return newHomesteadInstructionSet(), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return newFrontierInstructionSet(), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Stack returns the mininum and maximum stack requirements.</span>
<span class="term-fg32">+func (op *operation) Stack() (int, int) {</span>
<span class="term-fg32">+	return op.minStack, op.maxStack</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; HasCost returns true if the opcode has a cost. Opcodes which do _not_ have</span>
<span class="term-fg32">+&#47;&#47; a cost assigned are one of two things:</span>
<span class="term-fg32">+&#47;&#47; - undefined, a.k.a invalid opcodes,</span>
<span class="term-fg32">+&#47;&#47; - the STOP opcode.</span>
<span class="term-fg32">+&#47;&#47; This method can thus be used to check if an opcode is &quot;Invalid (or STOP)&quot;.</span>
<span class="term-fg32">+func (op *operation) HasCost() bool {</span>
<span class="term-fg32">+	&#47;&#47; Ideally, we&#39;d check this:</span>
<span class="term-fg32">+	&#47;&#47;	return op.execute == opUndefined</span>
<span class="term-fg32">+	&#47;&#47; However, go-lang does now allow that. So we&#39;ll just check some other</span>
<span class="term-fg32">+	&#47;&#47; &#39;indicators&#39; that this is an invalid op. Alas, STOP is impossible to</span>
<span class="term-fg32">+	&#47;&#47; filter out</span>
<span class="term-fg32">+	return op.dynamicGas != nil || op.constantGas != 0</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a8969884959a229a383dc898" role="button"
                   aria-expanded="false" aria-controls="id-a8969884959a229a383dc898">
                    <code>core/vm/opcodes.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/opcodes.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/opcodes.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+20</span></div>
                        <div class="text-start"><span class="text-danger">-18</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a8969884959a229a383dc898"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;opcodes.go op-geth&#47;core&#47;vm&#47;opcodes.go</span>
<span class="term-fg1">index 9f199eb8f60a499d844961ca5bd0ae9e13369873..910491c60078fd2f84f8cb0862e4d7481a40f328 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;opcodes.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;opcodes.go</span>
<span class="term-fg36">@@ -204,6 +204,12 @@</span> 	LOG3
 	LOG4
 )
&nbsp;
<span class="term-fg32">+&#47;&#47; 0xb0 range.</span>
<span class="term-fg32">+const (</span>
<span class="term-fg32">+	TLOAD  OpCode = 0xb3</span>
<span class="term-fg32">+	TSTORE OpCode = 0xb4</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
 &#47;&#47; 0xf0 range - closures.
 const (
 	CREATE       OpCode = 0xf0
<span class="term-fg36">@@ -219,12 +225,6 @@</span> 	INVALID      OpCode = 0xfe
 	SELFDESTRUCT OpCode = 0xff
 )
&nbsp;
<span class="term-fg31">-&#47;&#47; 0xb0 range.</span>
<span class="term-fg31">-const (</span>
<span class="term-fg31">-	TLOAD  OpCode = 0xb3</span>
<span class="term-fg31">-	TSTORE OpCode = 0xb4</span>
<span class="term-fg31">-)</span>
<span class="term-fg31">-</span>
 &#47;&#47; Since the opcodes aren&#39;t all in order we can&#39;t use a regular slice.
 var opCodeToString = map[OpCode]string{
 	&#47;&#47; 0x0 range - arithmetic ops.
<span class="term-fg36">@@ -290,9 +290,7 @@</span> 	SELFBALANCE: &quot;SELFBALANCE&quot;,
 	BASEFEE:     &quot;BASEFEE&quot;,
&nbsp;
 	&#47;&#47; 0x50 range - &#39;storage&#39; and execution.
<span class="term-fg31">-	POP: &quot;POP&quot;,</span>
<span class="term-fg31">-	&#47;&#47;DUP:     &quot;DUP&quot;,</span>
<span class="term-fg31">-	&#47;&#47;SWAP:    &quot;SWAP&quot;,</span>
<span class="term-fg32">+	POP:      &quot;POP&quot;,</span>
 	MLOAD:    &quot;MLOAD&quot;,
 	MSTORE:   &quot;MSTORE&quot;,
 	MSTORE8:  &quot;MSTORE8&quot;,
<span class="term-fg36">@@ -306,7 +304,7 @@</span> 	GAS:      &quot;GAS&quot;,
 	JUMPDEST: &quot;JUMPDEST&quot;,
 	PUSH0:    &quot;PUSH0&quot;,
&nbsp;
<span class="term-fg31">-	&#47;&#47; 0x60 range - push.</span>
<span class="term-fg32">+	&#47;&#47; 0x60 range - pushes.</span>
 	PUSH1:  &quot;PUSH1&quot;,
 	PUSH2:  &quot;PUSH2&quot;,
 	PUSH3:  &quot;PUSH3&quot;,
<span class="term-fg36">@@ -340,6 +338,7 @@</span> 	PUSH30: &quot;PUSH30&quot;,
 	PUSH31: &quot;PUSH31&quot;,
 	PUSH32: &quot;PUSH32&quot;,
&nbsp;
<span class="term-fg32">+	&#47;&#47; 0x80 - dups.</span>
 	DUP1:  &quot;DUP1&quot;,
 	DUP2:  &quot;DUP2&quot;,
 	DUP3:  &quot;DUP3&quot;,
<span class="term-fg36">@@ -357,6 +356,7 @@</span> 	DUP14: &quot;DUP14&quot;,
 	DUP15: &quot;DUP15&quot;,
 	DUP16: &quot;DUP16&quot;,
&nbsp;
<span class="term-fg32">+	&#47;&#47; 0x90 - swaps.</span>
 	SWAP1:  &quot;SWAP1&quot;,
 	SWAP2:  &quot;SWAP2&quot;,
 	SWAP3:  &quot;SWAP3&quot;,
<span class="term-fg36">@@ -373,17 +373,19 @@</span> 	SWAP13: &quot;SWAP13&quot;,
 	SWAP14: &quot;SWAP14&quot;,
 	SWAP15: &quot;SWAP15&quot;,
 	SWAP16: &quot;SWAP16&quot;,
<span class="term-fg31">-	LOG0:   &quot;LOG0&quot;,</span>
<span class="term-fg31">-	LOG1:   &quot;LOG1&quot;,</span>
<span class="term-fg31">-	LOG2:   &quot;LOG2&quot;,</span>
<span class="term-fg31">-	LOG3:   &quot;LOG3&quot;,</span>
<span class="term-fg31">-	LOG4:   &quot;LOG4&quot;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; 0xa0 range - logging ops.</span>
<span class="term-fg32">+	LOG0: &quot;LOG0&quot;,</span>
<span class="term-fg32">+	LOG1: &quot;LOG1&quot;,</span>
<span class="term-fg32">+	LOG2: &quot;LOG2&quot;,</span>
<span class="term-fg32">+	LOG3: &quot;LOG3&quot;,</span>
<span class="term-fg32">+	LOG4: &quot;LOG4&quot;,</span>
&nbsp;
 	&#47;&#47; 0xb0 range.
 	TLOAD:  &quot;TLOAD&quot;,
 	TSTORE: &quot;TSTORE&quot;,
&nbsp;
<span class="term-fg31">-	&#47;&#47; 0xf0 range.</span>
<span class="term-fg32">+	&#47;&#47; 0xf0 range - closures.</span>
 	CREATE:       &quot;CREATE&quot;,
 	CALL:         &quot;CALL&quot;,
 	RETURN:       &quot;RETURN&quot;,
<span class="term-fg36">@@ -473,8 +475,6 @@</span> 	&quot;MSIZE&quot;:          MSIZE,
 	&quot;GAS&quot;:            GAS,
 	&quot;JUMPDEST&quot;:       JUMPDEST,
 	&quot;PUSH0&quot;:          PUSH0,
<span class="term-fg31">-	&quot;TLOAD&quot;:          TLOAD,</span>
<span class="term-fg31">-	&quot;TSTORE&quot;:         TSTORE,</span>
 	&quot;PUSH1&quot;:          PUSH1,
 	&quot;PUSH2&quot;:          PUSH2,
 	&quot;PUSH3&quot;:          PUSH3,
<span class="term-fg36">@@ -544,6 +544,8 @@</span> 	&quot;LOG1&quot;:           LOG1,
 	&quot;LOG2&quot;:           LOG2,
 	&quot;LOG3&quot;:           LOG3,
 	&quot;LOG4&quot;:           LOG4,
<span class="term-fg32">+	&quot;TLOAD&quot;:          TLOAD,</span>
<span class="term-fg32">+	&quot;TSTORE&quot;:         TSTORE,</span>
 	&quot;CREATE&quot;:         CREATE,
 	&quot;CREATE2&quot;:        CREATE2,
 	&quot;CALL&quot;:           CALL,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-328b571df23845096441e14c" role="button"
                   aria-expanded="false" aria-controls="id-328b571df23845096441e14c">
                    <code>core/vm/runtime/runtime.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/runtime/runtime.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/runtime/runtime.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-328b571df23845096441e14c"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;runtime&#47;runtime.go op-geth&#47;core&#47;vm&#47;runtime&#47;runtime.go</span>
<span class="term-fg1">index 56ff5eeabe3384c1ff5cc2306c90d8a9deb9fe0d..005ef0c754ae050ee1f0bb3f9109059c6c5d4ecc 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;runtime&#47;runtime.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;runtime&#47;runtime.go</span>
<span class="term-fg36">@@ -57,7 +57,6 @@</span> 			HomesteadBlock:      new(big.Int),
 			DAOForkBlock:        new(big.Int),
 			DAOForkSupport:      false,
 			EIP150Block:         new(big.Int),
<span class="term-fg31">-			EIP150Hash:          common.Hash{},</span>
 			EIP155Block:         new(big.Int),
 			EIP158Block:         new(big.Int),
 			ByzantiumBlock:      new(big.Int),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cae2e311fd1e2749b30b06b8" role="button"
                   aria-expanded="false" aria-controls="id-cae2e311fd1e2749b30b06b8">
                    <code>core/vm/runtime/runtime_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/core/vm/runtime/runtime_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/core/vm/runtime/runtime_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cae2e311fd1e2749b30b06b8"><span class="term-fg1">diff --git go-ethereum&#47;core&#47;vm&#47;runtime&#47;runtime_test.go op-geth&#47;core&#47;vm&#47;runtime&#47;runtime_test.go</span>
<span class="term-fg1">index 607259106536496f06213195b693c480823854fd..62953a43658b8ba7c06516e7c3c44f2c2cf9263e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;core&#47;vm&#47;runtime&#47;runtime_test.go</span>
<span class="term-fg1">+++ op-geth&#47;core&#47;vm&#47;runtime&#47;runtime_test.go</span>
<span class="term-fg36">@@ -335,7 +335,6 @@</span> 		if err != nil {
 			b.Fatal(err)
 		}
 		cfg.EVMConfig = vm.Config{
<span class="term-fg31">-			Debug:  true,</span>
 			Tracer: tracer,
 		}
 	}
<span class="term-fg36">@@ -511,7 +510,6 @@</span> 			comment,
 			code, ops)
 		Execute(code, nil, &amp;Config{
 			EVMConfig: vm.Config{
<span class="term-fg31">-				Debug:     true,</span>
 				Tracer:    logger.NewMarkdownLogger(nil, os.Stdout),
 				ExtraEips: []int{2929},
 			},
<span class="term-fg36">@@ -665,7 +663,6 @@</span> 	} {
 		tracer := logger.NewStructLogger(nil)
 		Execute(tc.code, nil, &amp;Config{
 			EVMConfig: vm.Config{
<span class="term-fg31">-				Debug:  true,</span>
 				Tracer: tracer,
 			},
 		})
<span class="term-fg36">@@ -837,7 +834,6 @@</span> 			_, _, err = Call(main, nil, &amp;Config{
 				GasLimit: 1000000,
 				State:    statedb,
 				EVMConfig: vm.Config{
<span class="term-fg31">-					Debug:  true,</span>
 					Tracer: tracer,
 				}})
 			if err != nil {
<span class="term-fg36">@@ -872,7 +868,6 @@</span> 	}
 	_, _, _, err = Create(code, &amp;Config{
 		State: statedb,
 		EVMConfig: vm.Config{
<span class="term-fg31">-			Debug:  true,</span>
 			Tracer: tracer,
 		}})
 	if err != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8fdada01e8effbd1e2bde20e" role="button"
                   aria-expanded="false" aria-controls="id-8fdada01e8effbd1e2bde20e">
                    <code>eth/api.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/api.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8fdada01e8effbd1e2bde20e"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;api.go op-geth&#47;eth&#47;api.go</span>
<span class="term-fg1">index 66df927ac6419b28c9f4de5080725a77ea314db2..92b7f00fd4017ed2cee517e00aca3f944f106863 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;api.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;api.go</span>
<span class="term-fg36">@@ -324,7 +324,7 @@</span> 			blockRlp = err.Error() &#47;&#47; Hacky, but hey, it works
 		} else {
 			blockRlp = fmt.Sprintf(&quot;%#x&quot;, rlpBytes)
 		}
<span class="term-fg31">-		if blockJSON, err = ethapi.RPCMarshalBlock(block, true, true, api.eth.APIBackend.ChainConfig()); err != nil {</span>
<span class="term-fg32">+		if blockJSON, err = ethapi.RPCMarshalBlock(ctx, block, true, true, api.eth.APIBackend); err != nil {</span>
 			blockJSON = map[string]interface{}{&quot;error&quot;: err.Error()}
 		}
 		results = append(results, &amp;BadBlockArgs{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d823b1e03b87395369f14beb" role="button"
                   aria-expanded="false" aria-controls="id-d823b1e03b87395369f14beb">
                    <code>eth/catalyst/api_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/catalyst/api_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/catalyst/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+27</span></div>
                        <div class="text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d823b1e03b87395369f14beb"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;catalyst&#47;api_test.go op-geth&#47;eth&#47;catalyst&#47;api_test.go</span>
<span class="term-fg1">index fb6e6935ee4612fd3fa263734e32330fb1e854d6..f38122200233132894b29777993c7e25e5698ce5 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;catalyst&#47;api_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;catalyst&#47;api_test.go</span>
<span class="term-fg36">@@ -879,15 +879,10 @@</span> func TestNewPayloadOnInvalidTerminalBlock(t *testing.T) {
 	genesis, preMergeBlocks := generateMergeChain(100, false)
 	n, ethservice := startEthService(t, genesis, preMergeBlocks)
 	defer n.Close()
<span class="term-fg31">-</span>
<span class="term-fg31">-	ethservice.BlockChain().Config().TerminalTotalDifficulty = preMergeBlocks[0].Difficulty() &#47;&#47;.Sub(genesis.Config.TerminalTotalDifficulty, preMergeBlocks[len(preMergeBlocks)-1].Difficulty())</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	var (</span>
<span class="term-fg31">-		api    = NewConsensusAPI(ethservice)</span>
<span class="term-fg31">-		parent = preMergeBlocks[len(preMergeBlocks)-1]</span>
<span class="term-fg31">-	)</span>
<span class="term-fg32">+	api := NewConsensusAPI(ethservice)</span>
&nbsp;
 	&#47;&#47; Test parent already post TTD in FCU
<span class="term-fg32">+	parent := preMergeBlocks[len(preMergeBlocks)-2]</span>
 	fcState := engine.ForkchoiceStateV1{
 		HeadBlockHash:      parent.Hash(),
 		SafeBlockHash:      common.Hash{},
<span class="term-fg36">@@ -913,6 +908,28 @@</span> 	if err != nil {
 		t.Fatalf(&quot;error preparing payload, err=%v&quot;, err)
 	}
 	data := *payload.Resolve().ExecutionPayload
<span class="term-fg32">+	&#47;&#47; We need to recompute the blockhash, since the miner computes a wrong (correct) blockhash</span>
<span class="term-fg32">+	txs, _ := decodeTransactions(data.Transactions)</span>
<span class="term-fg32">+	header := &amp;types.Header{</span>
<span class="term-fg32">+		ParentHash:  data.ParentHash,</span>
<span class="term-fg32">+		UncleHash:   types.EmptyUncleHash,</span>
<span class="term-fg32">+		Coinbase:    data.FeeRecipient,</span>
<span class="term-fg32">+		Root:        data.StateRoot,</span>
<span class="term-fg32">+		TxHash:      types.DeriveSha(types.Transactions(txs), trie.NewStackTrie(nil)),</span>
<span class="term-fg32">+		ReceiptHash: data.ReceiptsRoot,</span>
<span class="term-fg32">+		Bloom:       types.BytesToBloom(data.LogsBloom),</span>
<span class="term-fg32">+		Difficulty:  common.Big0,</span>
<span class="term-fg32">+		Number:      new(big.Int).SetUint64(data.Number),</span>
<span class="term-fg32">+		GasLimit:    data.GasLimit,</span>
<span class="term-fg32">+		GasUsed:     data.GasUsed,</span>
<span class="term-fg32">+		Time:        data.Timestamp,</span>
<span class="term-fg32">+		BaseFee:     data.BaseFeePerGas,</span>
<span class="term-fg32">+		Extra:       data.ExtraData,</span>
<span class="term-fg32">+		MixDigest:   data.Random,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	block := types.NewBlockWithHeader(header).WithBody(txs, nil &#47;* uncles *&#47;)</span>
<span class="term-fg32">+	data.BlockHash = block.Hash()</span>
<span class="term-fg32">+	&#47;&#47; Send the new payload</span>
 	resp2, err := api.NewPayloadV1(data)
 	if err != nil {
 		t.Fatalf(&quot;error sending NewPayload, err=%v&quot;, err)
<span class="term-fg36">@@ -1240,9 +1257,10 @@</span> }
&nbsp;
 func setupBodies(t *testing.T) (*node.Node, *eth.Ethereum, []*types.Block) {
 	genesis, blocks := generateMergeChain(10, true)
<span class="term-fg32">+	&#47;&#47; enable shanghai on the last block</span>
<span class="term-fg32">+	time := blocks[len(blocks)-1].Header().Time + 1</span>
<span class="term-fg32">+	genesis.Config.ShanghaiTime = &amp;time</span>
 	n, ethservice := startEthService(t, genesis, blocks)
<span class="term-fg31">-	&#47;&#47; enable shanghai on the last block</span>
<span class="term-fg31">-	ethservice.BlockChain().Config().ShanghaiTime = &amp;blocks[len(blocks)-1].Header().Time</span>
&nbsp;
 	var (
 		parent = ethservice.BlockChain().CurrentBlock()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c647266ef306c42cdb61a2bd" role="button"
                   aria-expanded="false" aria-controls="id-c647266ef306c42cdb61a2bd">
                    <code>eth/downloader/beaconsync.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/beaconsync.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/beaconsync.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c647266ef306c42cdb61a2bd"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;beaconsync.go op-geth&#47;eth&#47;downloader&#47;beaconsync.go</span>
<span class="term-fg1">index ff985e6b035f49c9d7d76274c877447bf777660f..df8af68bc7980d9e5706b5e426f559cfcf0c333e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;beaconsync.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;beaconsync.go</span>
<span class="term-fg36">@@ -19,7 +19,6 @@</span>
 import (
 	&quot;fmt&quot;
 	&quot;sync&quot;
<span class="term-fg31">-	&quot;sync&#47;atomic&quot;</span>
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -371,7 +370,7 @@</span> 		if from &lt;= head.Number.Uint64() {
 			continue
 		}
 		&#47;&#47; If the pivot block is committed, signal header sync termination
<span class="term-fg31">-		if atomic.LoadInt32(&amp;d.committed) == 1 {</span>
<span class="term-fg32">+		if d.committed.Load() {</span>
 			select {
 			case d.headerProcCh &lt;- nil:
 				return nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3f90da9bb97399e0ec045da1" role="button"
                   aria-expanded="false" aria-controls="id-3f90da9bb97399e0ec045da1">
                    <code>eth/downloader/downloader.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/downloader.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/downloader.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-15</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3f90da9bb97399e0ec045da1"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;downloader.go op-geth&#47;eth&#47;downloader&#47;downloader.go</span>
<span class="term-fg1">index fb9de79912e29765f5f00d885ee53299d8cb8171..a3d8a210600cb83d9a5fa26faf76d3306ead1bd0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;downloader.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;downloader.go</span>
<span class="term-fg36">@@ -98,7 +98,7 @@</span> 	hashes  []common.Hash
 }
&nbsp;
 type Downloader struct {
<span class="term-fg31">-	mode uint32         &#47;&#47; Synchronisation mode defining the strategy used (per sync cycle), use d.getMode() to get the SyncMode</span>
<span class="term-fg32">+	mode atomic.Uint32  &#47;&#47; Synchronisation mode defining the strategy used (per sync cycle), use d.getMode() to get the SyncMode</span>
 	mux  *event.TypeMux &#47;&#47; Event multiplexer to announce sync operation events
&nbsp;
 	checkpoint uint64   &#47;&#47; Checkpoint block number to enforce head against (e.g. snap sync)
<span class="term-fg36">@@ -122,9 +122,9 @@</span> 	badBlock badBlockFn &#47;&#47; Reports a block as rejected by the chain
&nbsp;
 	&#47;&#47; Status
 	synchroniseMock func(id string, hash common.Hash) error &#47;&#47; Replacement for synchronise during testing
<span class="term-fg31">-	synchronising   int32</span>
<span class="term-fg31">-	notified        int32</span>
<span class="term-fg31">-	committed       int32</span>
<span class="term-fg32">+	synchronising   atomic.Bool</span>
<span class="term-fg32">+	notified        atomic.Bool</span>
<span class="term-fg32">+	committed       atomic.Bool</span>
 	ancientLimit    uint64 &#47;&#47; The maximum block number which can be regarded as ancient data.
&nbsp;
 	&#47;&#47; Channels
<span class="term-fg36">@@ -292,7 +292,7 @@</span> }
&nbsp;
 &#47;&#47; Synchronising returns whether the downloader is currently retrieving blocks.
 func (d *Downloader) Synchronising() bool {
<span class="term-fg31">-	return atomic.LoadInt32(&amp;d.synchronising) &gt; 0</span>
<span class="term-fg32">+	return d.synchronising.Load()</span>
 }
&nbsp;
 &#47;&#47; RegisterPeer injects a new download peer into the set of block source to be
<span class="term-fg36">@@ -392,13 +392,13 @@</span> 	if d.synchroniseMock != nil {
 		return d.synchroniseMock(id, hash)
 	}
 	&#47;&#47; Make sure only one goroutine is ever allowed past this point at once
<span class="term-fg31">-	if !atomic.CompareAndSwapInt32(&amp;d.synchronising, 0, 1) {</span>
<span class="term-fg32">+	if !d.synchronising.CompareAndSwap(false, true) {</span>
 		return errBusy
 	}
<span class="term-fg31">-	defer atomic.StoreInt32(&amp;d.synchronising, 0)</span>
<span class="term-fg32">+	defer d.synchronising.Store(false)</span>
&nbsp;
 	&#47;&#47; Post a user notification of the sync (only once per session)
<span class="term-fg31">-	if atomic.CompareAndSwapInt32(&amp;d.notified, 0, 1) {</span>
<span class="term-fg32">+	if d.notified.CompareAndSwap(false, true) {</span>
 		log.Info(&quot;Block synchronisation started&quot;)
 	}
 	if mode == SnapSync {
<span class="term-fg36">@@ -435,7 +435,7 @@</span>
 	defer d.Cancel() &#47;&#47; No matter what, we can&#39;t leave the cancel channel open
&nbsp;
 	&#47;&#47; Atomically set the requested sync mode
<span class="term-fg31">-	atomic.StoreUint32(&amp;d.mode, uint32(mode))</span>
<span class="term-fg32">+	d.mode.Store(uint32(mode))</span>
&nbsp;
 	&#47;&#47; Retrieve the origin peer and initiate the downloading process
 	var p *peerConnection
<span class="term-fg36">@@ -452,7 +452,7 @@</span> 	return d.syncWithPeer(p, hash, td, ttd, beaconMode)
 }
&nbsp;
 func (d *Downloader) getMode() SyncMode {
<span class="term-fg31">-	return SyncMode(atomic.LoadUint32(&amp;d.mode))</span>
<span class="term-fg32">+	return SyncMode(d.mode.Load())</span>
 }
&nbsp;
 &#47;&#47; syncWithPeer starts a block synchronization based on the hash chain from the
<span class="term-fg36">@@ -562,9 +562,9 @@</span> 			&#47;&#47; reenable snap sync
 			rawdb.WriteLastPivotNumber(d.stateDB, pivotNumber)
 		}
 	}
<span class="term-fg31">-	d.committed = 1</span>
<span class="term-fg32">+	d.committed.Store(true)</span>
 	if mode == SnapSync &amp;&amp; pivot.Number.Uint64() != 0 {
<span class="term-fg31">-		d.committed = 0</span>
<span class="term-fg32">+		d.committed.Store(false)</span>
 	}
 	if mode == SnapSync {
 		&#47;&#47; Set the ancient data limitation. If we are running snap sync, all block
<span class="term-fg36">@@ -1128,7 +1128,7 @@</span> 		}
 		&#47;&#47; If no more headers are inbound, notify the content fetchers and return
 		if len(headers) == 0 {
 			&#47;&#47; Don&#39;t abort header fetches while the pivot is downloading
<span class="term-fg31">-			if atomic.LoadInt32(&amp;d.committed) == 0 &amp;&amp; pivot &lt;= from {</span>
<span class="term-fg32">+			if !d.committed.Load() &amp;&amp; pivot &lt;= from {</span>
 				p.log.Debug(&quot;No headers, waiting for pivot commit&quot;)
 				select {
 				case &lt;-time.After(fsHeaderContCheck):
<span class="term-fg36">@@ -1669,7 +1669,7 @@</span> 		} else {
 			results = append(append([]*fetchResult{oldPivot}, oldTail...), results...)
 		}
 		&#47;&#47; Split around the pivot block and process the two sides via snap&#47;full sync
<span class="term-fg31">-		if atomic.LoadInt32(&amp;d.committed) == 0 {</span>
<span class="term-fg32">+		if !d.committed.Load() {</span>
 			latest := results[len(results)-1].Header
 			&#47;&#47; If the height is above the pivot block by 2 sets, it means the pivot
 			&#47;&#47; become stale in the network and it was garbage collected, move to a
<span class="term-fg36">@@ -1794,7 +1794,7 @@</span> 	}
 	if err := d.blockchain.SnapSyncCommitHead(block.Hash()); err != nil {
 		return err
 	}
<span class="term-fg31">-	atomic.StoreInt32(&amp;d.committed, 1)</span>
<span class="term-fg32">+	d.committed.Store(true)</span>
 	return nil
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-024befb5b7ace5dbf58ef164" role="button"
                   aria-expanded="false" aria-controls="id-024befb5b7ace5dbf58ef164">
                    <code>eth/downloader/downloader_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/downloader_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/downloader_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-12</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-024befb5b7ace5dbf58ef164"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;downloader_test.go op-geth&#47;eth&#47;downloader&#47;downloader_test.go</span>
<span class="term-fg1">index a884c1e950b02d8985bce08de993ff4d3157ddf9..37f7a767046989f70766a07157c5cf70d60e69f6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;downloader_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;downloader_test.go</span>
<span class="term-fg36">@@ -476,9 +476,10 @@</span> 	targetBlocks := len(testChainBase.blocks) - 1
 	tester.newPeer(&quot;peer&quot;, protocol, testChainBase.blocks[1:])
&nbsp;
 	&#47;&#47; Wrap the importer to allow stepping
<span class="term-fg31">-	blocked, proceed := uint32(0), make(chan struct{})</span>
<span class="term-fg32">+	var blocked atomic.Uint32</span>
<span class="term-fg32">+	proceed := make(chan struct{})</span>
 	tester.downloader.chainInsertHook = func(results []*fetchResult) {
<span class="term-fg31">-		atomic.StoreUint32(&amp;blocked, uint32(len(results)))</span>
<span class="term-fg32">+		blocked.Store(uint32(len(results)))</span>
 		&lt;-proceed
 	}
 	&#47;&#47; Start a synchronisation concurrently
<span class="term-fg36">@@ -505,7 +506,7 @@</span> 			tester.downloader.queue.lock.Lock()
 			tester.downloader.queue.resultCache.lock.Lock()
 			{
 				cached = tester.downloader.queue.resultCache.countCompleted()
<span class="term-fg31">-				frozen = int(atomic.LoadUint32(&amp;blocked))</span>
<span class="term-fg32">+				frozen = int(blocked.Load())</span>
 				retrieved = int(tester.chain.CurrentSnapBlock().Number.Uint64()) + 1
 			}
 			tester.downloader.queue.resultCache.lock.Unlock()
<span class="term-fg36">@@ -528,8 +529,8 @@</span> 		if cached != blockCacheMaxItems &amp;&amp; cached != blockCacheMaxItems-reorgProtHeaderDelay &amp;&amp; retrieved+cached+frozen != targetBlocks+1 &amp;&amp; retrieved+cached+frozen != targetBlocks+1-reorgProtHeaderDelay {
 			t.Fatalf(&quot;block count mismatch: have %v, want %v (owned %v, blocked %v, target %v)&quot;, cached, blockCacheMaxItems, retrieved, frozen, targetBlocks+1)
 		}
 		&#47;&#47; Permit the blocked blocks to import
<span class="term-fg31">-		if atomic.LoadUint32(&amp;blocked) &gt; 0 {</span>
<span class="term-fg31">-			atomic.StoreUint32(&amp;blocked, uint32(0))</span>
<span class="term-fg32">+		if blocked.Load() &gt; 0 {</span>
<span class="term-fg32">+			blocked.Store(uint32(0))</span>
 			proceed &lt;- struct{}{}
 		}
 	}
<span class="term-fg36">@@ -786,12 +787,12 @@</span> 	chain := testChainBase
 	tester.newPeer(&quot;peer&quot;, protocol, chain.blocks[1:])
&nbsp;
 	&#47;&#47; Instrument the downloader to signal body requests
<span class="term-fg31">-	bodiesHave, receiptsHave := int32(0), int32(0)</span>
<span class="term-fg32">+	var bodiesHave, receiptsHave atomic.Int32</span>
 	tester.downloader.bodyFetchHook = func(headers []*types.Header) {
<span class="term-fg31">-		atomic.AddInt32(&amp;bodiesHave, int32(len(headers)))</span>
<span class="term-fg32">+		bodiesHave.Add(int32(len(headers)))</span>
 	}
 	tester.downloader.receiptFetchHook = func(headers []*types.Header) {
<span class="term-fg31">-		atomic.AddInt32(&amp;receiptsHave, int32(len(headers)))</span>
<span class="term-fg32">+		receiptsHave.Add(int32(len(headers)))</span>
 	}
 	&#47;&#47; Synchronise with the peer and make sure all blocks were retrieved
 	if err := tester.sync(&quot;peer&quot;, nil, mode); err != nil {
<span class="term-fg36">@@ -811,11 +812,11 @@</span> 		if mode == SnapSync &amp;&amp; len(block.Transactions()) &gt; 0 {
 			receiptsNeeded++
 		}
 	}
<span class="term-fg31">-	if int(bodiesHave) != bodiesNeeded {</span>
<span class="term-fg31">-		t.Errorf(&quot;body retrieval count mismatch: have %v, want %v&quot;, bodiesHave, bodiesNeeded)</span>
<span class="term-fg32">+	if int(bodiesHave.Load()) != bodiesNeeded {</span>
<span class="term-fg32">+		t.Errorf(&quot;body retrieval count mismatch: have %v, want %v&quot;, bodiesHave.Load(), bodiesNeeded)</span>
 	}
<span class="term-fg31">-	if int(receiptsHave) != receiptsNeeded {</span>
<span class="term-fg31">-		t.Errorf(&quot;receipt retrieval count mismatch: have %v, want %v&quot;, receiptsHave, receiptsNeeded)</span>
<span class="term-fg32">+	if int(receiptsHave.Load()) != receiptsNeeded {</span>
<span class="term-fg32">+		t.Errorf(&quot;receipt retrieval count mismatch: have %v, want %v&quot;, receiptsHave.Load(), receiptsNeeded)</span>
 	}
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77639cd6aaf97d79fb76e761" role="button"
                   aria-expanded="false" aria-controls="id-77639cd6aaf97d79fb76e761">
                    <code>eth/downloader/queue.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/queue.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/queue.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+9</span></div>
                        <div class="text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77639cd6aaf97d79fb76e761"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;queue.go op-geth&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg1">index 5af5068c98cf424906d292a8fd70b670abbd562d..e9907297a0b93b037a1504fc6a59e2b2953a565e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg36">@@ -61,7 +61,7 @@</span>
 &#47;&#47; fetchResult is a struct collecting partial results from data fetchers until
 &#47;&#47; all outstanding pieces complete and the result as a whole can be processed.
 type fetchResult struct {
<span class="term-fg31">-	pending int32 &#47;&#47; Flag telling what deliveries are outstanding</span>
<span class="term-fg32">+	pending atomic.Int32 &#47;&#47; Flag telling what deliveries are outstanding</span>
&nbsp;
 	Header       *types.Header
 	Uncles       []*types.Header
<span class="term-fg36">@@ -75,38 +75,38 @@</span> 	item := &amp;fetchResult{
 		Header: header,
 	}
 	if !header.EmptyBody() {
<span class="term-fg31">-		item.pending |= (1 &lt;&lt; bodyType)</span>
<span class="term-fg32">+		item.pending.Store(item.pending.Load() | (1 &lt;&lt; bodyType))</span>
 	} else if header.WithdrawalsHash != nil {
 		item.Withdrawals = make(types.Withdrawals, 0)
 	}
 	if fastSync &amp;&amp; !header.EmptyReceipts() {
<span class="term-fg31">-		item.pending |= (1 &lt;&lt; receiptType)</span>
<span class="term-fg32">+		item.pending.Store(item.pending.Load() | (1 &lt;&lt; receiptType))</span>
 	}
 	return item
 }
&nbsp;
 &#47;&#47; SetBodyDone flags the body as finished.
 func (f *fetchResult) SetBodyDone() {
<span class="term-fg31">-	if v := atomic.LoadInt32(&amp;f.pending); (v &amp; (1 &lt;&lt; bodyType)) != 0 {</span>
<span class="term-fg31">-		atomic.AddInt32(&amp;f.pending, -1)</span>
<span class="term-fg32">+	if v := f.pending.Load(); (v &amp; (1 &lt;&lt; bodyType)) != 0 {</span>
<span class="term-fg32">+		f.pending.Add(-1)</span>
 	}
 }
&nbsp;
 &#47;&#47; AllDone checks if item is done.
 func (f *fetchResult) AllDone() bool {
<span class="term-fg31">-	return atomic.LoadInt32(&amp;f.pending) == 0</span>
<span class="term-fg32">+	return f.pending.Load() == 0</span>
 }
&nbsp;
 &#47;&#47; SetReceiptsDone flags the receipts as finished.
 func (f *fetchResult) SetReceiptsDone() {
<span class="term-fg31">-	if v := atomic.LoadInt32(&amp;f.pending); (v &amp; (1 &lt;&lt; receiptType)) != 0 {</span>
<span class="term-fg31">-		atomic.AddInt32(&amp;f.pending, -2)</span>
<span class="term-fg32">+	if v := f.pending.Load(); (v &amp; (1 &lt;&lt; receiptType)) != 0 {</span>
<span class="term-fg32">+		f.pending.Add(-2)</span>
 	}
 }
&nbsp;
 &#47;&#47; Done checks if the given type is done already
 func (f *fetchResult) Done(kind uint) bool {
<span class="term-fg31">-	v := atomic.LoadInt32(&amp;f.pending)</span>
<span class="term-fg32">+	v := f.pending.Load()</span>
 	return v&amp;(1&lt;&lt;kind) == 0
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1f2d53ccb9c0fe4515882aa4" role="button"
                   aria-expanded="false" aria-controls="id-1f2d53ccb9c0fe4515882aa4">
                    <code>eth/downloader/resultstore.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/resultstore.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/resultstore.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1f2d53ccb9c0fe4515882aa4"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;resultstore.go op-geth&#47;eth&#47;downloader&#47;resultstore.go</span>
<span class="term-fg1">index a550f8c1093383fa25f19100741572c8c2dc3033..7f7f5a89e264ff9c7e994d16538fc70f845d9e8b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;resultstore.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;resultstore.go</span>
<span class="term-fg36">@@ -33,7 +33,7 @@</span>
 	&#47;&#47; Internal index of first non-completed entry, updated atomically when needed.
 	&#47;&#47; If all items are complete, this will equal length(items), so
 	&#47;&#47; *important* : is not safe to use for indexing without checking against length
<span class="term-fg31">-	indexIncomplete int32 &#47;&#47; atomic access</span>
<span class="term-fg32">+	indexIncomplete atomic.Int32</span>
&nbsp;
 	&#47;&#47; throttleThreshold is the limit up to which we _want_ to fill the
 	&#47;&#47; results. If blocks are large, we want to limit the results to less
<span class="term-fg36">@@ -146,7 +146,7 @@</span> &#47;&#47; The mthod assumes (at least) rlock is held.
 func (r *resultStore) countCompleted() int {
 	&#47;&#47; We iterate from the already known complete point, and see
 	&#47;&#47; if any more has completed since last count
<span class="term-fg31">-	index := atomic.LoadInt32(&amp;r.indexIncomplete)</span>
<span class="term-fg32">+	index := r.indexIncomplete.Load()</span>
 	for ; ; index++ {
 		if index &gt;= int32(len(r.items)) {
 			break
<span class="term-fg36">@@ -156,7 +156,7 @@</span> 		if result == nil || !result.AllDone() {
 			break
 		}
 	}
<span class="term-fg31">-	atomic.StoreInt32(&amp;r.indexIncomplete, index)</span>
<span class="term-fg32">+	r.indexIncomplete.Store(index)</span>
 	return int(index)
 }
&nbsp;
<span class="term-fg36">@@ -179,7 +179,7 @@</span> 		r.items[i] = nil
 	}
 	&#47;&#47; Advance the expected block number of the first cache entry
 	r.resultOffset += uint64(limit)
<span class="term-fg31">-	atomic.AddInt32(&amp;r.indexIncomplete, int32(-limit))</span>
<span class="term-fg32">+	r.indexIncomplete.Add(int32(-limit))</span>
&nbsp;
 	return results
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-767fb9ef170e1b8ddd0b7cea" role="button"
                   aria-expanded="false" aria-controls="id-767fb9ef170e1b8ddd0b7cea">
                    <code>eth/downloader/skeleton_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/downloader/skeleton_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/downloader/skeleton_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-12</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-767fb9ef170e1b8ddd0b7cea"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;downloader&#47;skeleton_test.go op-geth&#47;eth&#47;downloader&#47;skeleton_test.go</span>
<span class="term-fg1">index b19494a7b069d32ec3f83c84dec5c80b603cbeb4..6a76d78ac817fe6a5f30b6e32ff93e5fe5f65fb8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;downloader&#47;skeleton_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;downloader&#47;skeleton_test.go</span>
<span class="term-fg36">@@ -82,8 +82,8 @@</span> 	headers []*types.Header &#47;&#47; Headers to serve when requested
&nbsp;
 	serve func(origin uint64) []*types.Header &#47;&#47; Hook to allow custom responses
&nbsp;
<span class="term-fg31">-	served  uint64 &#47;&#47; Number of headers served by this peer</span>
<span class="term-fg31">-	dropped uint64 &#47;&#47; Flag whether the peer was dropped (stop responding)</span>
<span class="term-fg32">+	served  atomic.Uint64 &#47;&#47; Number of headers served by this peer</span>
<span class="term-fg32">+	dropped atomic.Uint64 &#47;&#47; Flag whether the peer was dropped (stop responding)</span>
 }
&nbsp;
 &#47;&#47; newSkeletonTestPeer creates a new mock peer to test the skeleton sync with.
<span class="term-fg36">@@ -113,7 +113,7 @@</span> func (p *skeletonTestPeer) RequestHeadersByNumber(origin uint64, amount int, skip int, reverse bool, sink chan *eth.Response) (*eth.Request, error) {
 	&#47;&#47; Since skeleton test peer are in-memory mocks, dropping the does not make
 	&#47;&#47; them inaccessible. As such, check a local `dropped` field to see if the
 	&#47;&#47; peer has been dropped and should not respond any more.
<span class="term-fg31">-	if atomic.LoadUint64(&amp;p.dropped) != 0 {</span>
<span class="term-fg32">+	if p.dropped.Load() != 0 {</span>
 		return nil, errors.New(&quot;peer already dropped&quot;)
 	}
 	&#47;&#47; Skeleton sync retrieves batches of headers going backward without gaps.
<span class="term-fg36">@@ -161,7 +161,7 @@</span> 				headers = append(headers, header)
 			}
 		}
 	}
<span class="term-fg31">-	atomic.AddUint64(&amp;p.served, uint64(len(headers)))</span>
<span class="term-fg32">+	p.served.Add(uint64(len(headers)))</span>
&nbsp;
 	hashes := make([]common.Hash, len(headers))
 	for i, header := range headers {
<span class="term-fg36">@@ -182,7 +182,7 @@</span> 	go func() {
 		sink &lt;- res
 		if err := &lt;-res.Done; err != nil {
 			log.Warn(&quot;Skeleton test peer response rejected&quot;, &quot;err&quot;, err)
<span class="term-fg31">-			atomic.AddUint64(&amp;p.dropped, 1)</span>
<span class="term-fg32">+			p.dropped.Add(1)</span>
 		}
 	}()
 	return req, nil
<span class="term-fg36">@@ -817,7 +817,7 @@</span> 		&#47;&#47; Create a peer dropper to track malicious peers
 		dropped := make(map[string]int)
 		drop := func(peer string) {
 			if p := peerset.Peer(peer); p != nil {
<span class="term-fg31">-				atomic.AddUint64(&amp;p.peer.(*skeletonTestPeer).dropped, 1)</span>
<span class="term-fg32">+				p.peer.(*skeletonTestPeer).dropped.Add(1)</span>
 			}
 			peerset.Unregister(peer)
 			dropped[peer]++
<span class="term-fg36">@@ -895,14 +895,14 @@</span> 		}
 		if !tt.unpredictable {
 			var served uint64
 			for _, peer := range tt.peers {
<span class="term-fg31">-				served += atomic.LoadUint64(&amp;peer.served)</span>
<span class="term-fg32">+				served += peer.served.Load()</span>
 			}
 			if served != tt.midserve {
 				t.Errorf(&quot;test %d, mid state: served headers mismatch: have %d, want %d&quot;, i, served, tt.midserve)
 			}
 			var drops uint64
 			for _, peer := range tt.peers {
<span class="term-fg31">-				drops += atomic.LoadUint64(&amp;peer.dropped)</span>
<span class="term-fg32">+				drops += peer.dropped.Load()</span>
 			}
 			if drops != tt.middrop {
 				t.Errorf(&quot;test %d, mid state: dropped peers mismatch: have %d, want %d&quot;, i, drops, tt.middrop)
<span class="term-fg36">@@ -950,20 +950,20 @@</span> 		&#47;&#47; Check that the peers served no more headers than we actually needed
 		if !tt.unpredictable {
 			served := uint64(0)
 			for _, peer := range tt.peers {
<span class="term-fg31">-				served += atomic.LoadUint64(&amp;peer.served)</span>
<span class="term-fg32">+				served += peer.served.Load()</span>
 			}
 			if tt.newPeer != nil {
<span class="term-fg31">-				served += atomic.LoadUint64(&amp;tt.newPeer.served)</span>
<span class="term-fg32">+				served += tt.newPeer.served.Load()</span>
 			}
 			if served != tt.endserve {
 				t.Errorf(&quot;test %d, end state: served headers mismatch: have %d, want %d&quot;, i, served, tt.endserve)
 			}
 			drops := uint64(0)
 			for _, peer := range tt.peers {
<span class="term-fg31">-				drops += atomic.LoadUint64(&amp;peer.dropped)</span>
<span class="term-fg32">+				drops += peer.dropped.Load()</span>
 			}
 			if tt.newPeer != nil {
<span class="term-fg31">-				drops += atomic.LoadUint64(&amp;tt.newPeer.dropped)</span>
<span class="term-fg32">+				drops += tt.newPeer.dropped.Load()</span>
 			}
 			if drops != tt.enddrop {
 				t.Errorf(&quot;test %d, end state: dropped peers mismatch: have %d, want %d&quot;, i, drops, tt.middrop)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-adedf66cbbc1aabeac785bd6" role="button"
                   aria-expanded="false" aria-controls="id-adedf66cbbc1aabeac785bd6">
                    <code>eth/gasprice/feehistory.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/gasprice/feehistory.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/gasprice/feehistory.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+7</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-adedf66cbbc1aabeac785bd6"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;gasprice&#47;feehistory.go op-geth&#47;eth&#47;gasprice&#47;feehistory.go</span>
<span class="term-fg1">index 47cc31999e015be1bbbd5a169a5b839a1511befe..82edf9a7fb05db40554384c554f1d4e73919300d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;gasprice&#47;feehistory.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;gasprice&#47;feehistory.go</span>
<span class="term-fg36">@@ -142,7 +142,7 @@</span> &#47;&#47; enforcing backend specific limitations. The pending block and corresponding receipts are
 &#47;&#47; also returned if requested and available.
 &#47;&#47; Note: an error is only returned if retrieving the head header has failed. If there are no
 &#47;&#47; retrievable blocks in the specified range then zero block count is returned with no error.
<span class="term-fg31">-func (oracle *Oracle) resolveBlockRange(ctx context.Context, reqEnd rpc.BlockNumber, blocks int) (*types.Block, []*types.Receipt, uint64, int, error) {</span>
<span class="term-fg32">+func (oracle *Oracle) resolveBlockRange(ctx context.Context, reqEnd rpc.BlockNumber, blocks uint64) (*types.Block, []*types.Receipt, uint64, uint64, error) {</span>
 	var (
 		headBlock       *types.Header
 		pendingBlock    *types.Block
<span class="term-fg36">@@ -200,8 +200,8 @@</span> 	if blocks == 0 {
 		return nil, nil, 0, 0, nil
 	}
 	&#47;&#47; Ensure not trying to retrieve before genesis.
<span class="term-fg31">-	if int(reqEnd+1) &lt; blocks {</span>
<span class="term-fg31">-		blocks = int(reqEnd + 1)</span>
<span class="term-fg32">+	if uint64(reqEnd+1) &lt; blocks {</span>
<span class="term-fg32">+		blocks = uint64(reqEnd + 1)</span>
 	}
 	return pendingBlock, pendingReceipts, uint64(reqEnd), blocks, nil
 }
<span class="term-fg36">@@ -220,7 +220,7 @@</span> &#47;&#47;   - gasUsedRatio: gasUsed&#47;gasLimit in the given block
 &#47;&#47;
 &#47;&#47; Note: baseFee includes the next block after the newest of the returned range, because this
 &#47;&#47; value can be derived from the newest block.
<span class="term-fg31">-func (oracle *Oracle) FeeHistory(ctx context.Context, blocks int, unresolvedLastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error) {</span>
<span class="term-fg32">+func (oracle *Oracle) FeeHistory(ctx context.Context, blocks uint64, unresolvedLastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error) {</span>
 	if blocks &lt; 1 {
 		return common.Big0, nil, nil, nil, nil &#47;&#47; returning with no data and no error means there are no retrievable blocks
 	}
<span class="term-fg36">@@ -249,7 +249,7 @@</span> 	pendingBlock, pendingReceipts, lastBlock, blocks, err := oracle.resolveBlockRange(ctx, unresolvedLastBlock, blocks)
 	if err != nil || blocks == 0 {
 		return common.Big0, nil, nil, nil, err
 	}
<span class="term-fg31">-	oldestBlock := lastBlock + 1 - uint64(blocks)</span>
<span class="term-fg32">+	oldestBlock := lastBlock + 1 - blocks</span>
&nbsp;
 	var (
 		next    = oldestBlock
<span class="term-fg36">@@ -259,7 +259,7 @@</span> 	percentileKey := make([]byte, 8*len(rewardPercentiles))
 	for i, p := range rewardPercentiles {
 		binary.LittleEndian.PutUint64(percentileKey[i*8:(i+1)*8], math.Float64bits(p))
 	}
<span class="term-fg31">-	for i := 0; i &lt; maxBlockFetchers &amp;&amp; i &lt; blocks; i++ {</span>
<span class="term-fg32">+	for i := 0; i &lt; maxBlockFetchers &amp;&amp; i &lt; int(blocks); i++ {</span>
 		go func() {
 			for {
 				&#47;&#47; Retrieve the next block number to fetch with this goroutine
<span class="term-fg36">@@ -314,7 +314,7 @@</span> 		fees := &lt;-results
 		if fees.err != nil {
 			return common.Big0, nil, nil, nil, fees.err
 		}
<span class="term-fg31">-		i := int(fees.blockNumber - oldestBlock)</span>
<span class="term-fg32">+		i := fees.blockNumber - oldestBlock</span>
 		if fees.results.baseFee != nil {
 			reward[i], baseFee[i], baseFee[i+1], gasUsedRatio[i] = fees.results.reward, fees.results.baseFee, fees.results.nextBaseFee, fees.results.gasUsedRatio
 		} else {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7cada61e522d549530b3df6f" role="button"
                   aria-expanded="false" aria-controls="id-7cada61e522d549530b3df6f">
                    <code>eth/gasprice/feehistory_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/gasprice/feehistory_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/gasprice/feehistory_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7cada61e522d549530b3df6f"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;gasprice&#47;feehistory_test.go op-geth&#47;eth&#47;gasprice&#47;feehistory_test.go</span>
<span class="term-fg1">index b54874d688476622ed3b99b4a0a5fddd4ec86b80..1bcfb287a571f117af1b01974b4822a6f56cc2e7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;gasprice&#47;feehistory_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;gasprice&#47;feehistory_test.go</span>
<span class="term-fg36">@@ -28,8 +28,8 @@</span>
 func TestFeeHistory(t *testing.T) {
 	var cases = []struct {
 		pending             bool
<span class="term-fg31">-		maxHeader, maxBlock int</span>
<span class="term-fg31">-		count               int</span>
<span class="term-fg32">+		maxHeader, maxBlock uint64</span>
<span class="term-fg32">+		count               uint64</span>
 		last                rpc.BlockNumber
 		percent             []float64
 		expFirst            uint64</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e1f048fcdcd8e18fb9df2ee8" role="button"
                   aria-expanded="false" aria-controls="id-e1f048fcdcd8e18fb9df2ee8">
                    <code>eth/gasprice/gasprice.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/gasprice/gasprice.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/gasprice/gasprice.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e1f048fcdcd8e18fb9df2ee8"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;gasprice&#47;gasprice.go op-geth&#47;eth&#47;gasprice&#47;gasprice.go</span>
<span class="term-fg1">index 604ad5e10432289813d704cff1e783611bfd80b2..8e98a3409bacefc2945f158f04d29297cdb514cb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;gasprice&#47;gasprice.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;gasprice&#47;gasprice.go</span>
<span class="term-fg36">@@ -42,8 +42,8 @@</span>
 type Config struct {
 	Blocks           int
 	Percentile       int
<span class="term-fg31">-	MaxHeaderHistory int</span>
<span class="term-fg31">-	MaxBlockHistory  int</span>
<span class="term-fg32">+	MaxHeaderHistory uint64</span>
<span class="term-fg32">+	MaxBlockHistory  uint64</span>
 	Default          *big.Int `toml:&quot;,omitempty&quot;`
 	MaxPrice         *big.Int `toml:&quot;,omitempty&quot;`
 	IgnorePrice      *big.Int `toml:&quot;,omitempty&quot;`
<span class="term-fg36">@@ -71,7 +71,7 @@</span> 	cacheLock   sync.RWMutex
 	fetchLock   sync.Mutex
&nbsp;
 	checkBlocks, percentile           int
<span class="term-fg31">-	maxHeaderHistory, maxBlockHistory int</span>
<span class="term-fg32">+	maxHeaderHistory, maxBlockHistory uint64</span>
&nbsp;
 	historyCache *lru.Cache[cacheKey, processedFees]
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-455ce32206dafc0d401a1ce9" role="button"
                   aria-expanded="false" aria-controls="id-455ce32206dafc0d401a1ce9">
                    <code>eth/protocols/snap/handler.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/protocols/snap/handler.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/protocols/snap/handler.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-455ce32206dafc0d401a1ce9"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;protocols&#47;snap&#47;handler.go op-geth&#47;eth&#47;protocols&#47;snap&#47;handler.go</span>
<span class="term-fg1">index d7c9400440105675d6a13313fa438abfdf875a06..55781ac54b74c1b9d111548a83feac79d385e37b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;protocols&#47;snap&#47;handler.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;protocols&#47;snap&#47;handler.go</span>
<span class="term-fg36">@@ -418,7 +418,7 @@</span> 			accTrie, err := trie.NewStateTrie(trie.StateTrieID(req.Root), chain.StateCache().TrieDB())
 			if err != nil {
 				return nil, nil
 			}
<span class="term-fg31">-			acc, err := accTrie.TryGetAccountByHash(account)</span>
<span class="term-fg32">+			acc, err := accTrie.GetAccountByHash(account)</span>
 			if err != nil || acc == nil {
 				return nil, nil
 			}
<span class="term-fg36">@@ -510,7 +510,7 @@</span> 			return nil, fmt.Errorf(&quot;%w: zero-item pathset requested&quot;, errBadRequest)
&nbsp;
 		case 1:
 			&#47;&#47; If we&#39;re only retrieving an account trie node, fetch it directly
<span class="term-fg31">-			blob, resolved, err := accTrie.TryGetNode(pathset[0])</span>
<span class="term-fg32">+			blob, resolved, err := accTrie.GetNode(pathset[0])</span>
 			loads += resolved &#47;&#47; always account database reads, even for failures
 			if err != nil {
 				break
<span class="term-fg36">@@ -524,7 +524,7 @@</span> 			&#47;&#47; Storage slots requested, open the storage trie and retrieve from there
 			if snap == nil {
 				&#47;&#47; We don&#39;t have the requested state snapshotted yet (or it is stale),
 				&#47;&#47; but can look up the account via the trie instead.
<span class="term-fg31">-				account, err := accTrie.TryGetAccountByHash(common.BytesToHash(pathset[0]))</span>
<span class="term-fg32">+				account, err := accTrie.GetAccountByHash(common.BytesToHash(pathset[0]))</span>
 				loads += 8 &#47;&#47; We don&#39;t know the exact cost of lookup, this is an estimate
 				if err != nil || account == nil {
 					break
<span class="term-fg36">@@ -545,7 +545,7 @@</span> 			if err != nil {
 				break
 			}
 			for _, path := range pathset[1:] {
<span class="term-fg31">-				blob, resolved, err := stTrie.TryGetNode(path)</span>
<span class="term-fg32">+				blob, resolved, err := stTrie.GetNode(path)</span>
 				loads += resolved &#47;&#47; always account database reads, even for failures
 				if err != nil {
 					break</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e757bad557225b070a8ef1fa" role="button"
                   aria-expanded="false" aria-controls="id-e757bad557225b070a8ef1fa">
                    <code>eth/protocols/snap/sync_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/protocols/snap/sync_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/protocols/snap/sync_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-10</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e757bad557225b070a8ef1fa"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;protocols&#47;snap&#47;sync_test.go op-geth&#47;eth&#47;protocols&#47;snap&#47;sync_test.go</span>
<span class="term-fg1">index 0a6117972953043feb3e615957a8b15a3e4c3fc1..6a3b482d5d20f424e3fd5ae203ac644ac495dd38 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;protocols&#47;snap&#47;sync_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;protocols&#47;snap&#47;sync_test.go</span>
<span class="term-fg36">@@ -216,7 +216,7 @@</span> 	var nodes [][]byte
 	for _, pathset := range paths {
 		switch len(pathset) {
 		case 1:
<span class="term-fg31">-			blob, _, err := t.accountTrie.TryGetNode(pathset[0])</span>
<span class="term-fg32">+			blob, _, err := t.accountTrie.GetNode(pathset[0])</span>
 			if err != nil {
 				t.logger.Info(&quot;Error handling req&quot;, &quot;error&quot;, err)
 				break
<span class="term-fg36">@@ -225,7 +225,7 @@</span> 			nodes = append(nodes, blob)
 		default:
 			account := t.storageTries[(common.BytesToHash(pathset[0]))]
 			for _, path := range pathset[1:] {
<span class="term-fg31">-				blob, _, err := account.TryGetNode(path)</span>
<span class="term-fg32">+				blob, _, err := account.GetNode(path)</span>
 				if err != nil {
 					t.logger.Info(&quot;Error handling req&quot;, &quot;error&quot;, err)
 					break
<span class="term-fg36">@@ -1381,7 +1381,7 @@</span> 			CodeHash: getCodeHash(i),
 		})
 		key := key32(i)
 		elem := &amp;kv{key, value}
<span class="term-fg31">-		accTrie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		accTrie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	sort.Sort(entries)
<span class="term-fg36">@@ -1431,7 +1431,7 @@</span> 			Root:     types.EmptyRootHash,
 			CodeHash: getCodeHash(uint64(i)),
 		})
 		elem := &amp;kv{boundaries[i].Bytes(), value}
<span class="term-fg31">-		accTrie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		accTrie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	&#47;&#47; Fill other accounts if required
<span class="term-fg36">@@ -1443,7 +1443,7 @@</span> 			Root:     types.EmptyRootHash,
 			CodeHash: getCodeHash(i),
 		})
 		elem := &amp;kv{key32(i), value}
<span class="term-fg31">-		accTrie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		accTrie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	sort.Sort(entries)
<span class="term-fg36">@@ -1487,7 +1487,7 @@</span> 			Root:     stRoot,
 			CodeHash: codehash,
 		})
 		elem := &amp;kv{key, value}
<span class="term-fg31">-		accTrie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		accTrie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
&nbsp;
 		storageRoots[common.BytesToHash(key)] = stRoot
<span class="term-fg36">@@ -1551,7 +1551,7 @@</span> 			Root:     stRoot,
 			CodeHash: codehash,
 		})
 		elem := &amp;kv{key, value}
<span class="term-fg31">-		accTrie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		accTrie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
&nbsp;
 		&#47;&#47; we reuse the same one for all accounts
<span class="term-fg36">@@ -1599,7 +1599,7 @@</span> 		slotKey := key32(i)
 		key := crypto.Keccak256Hash(slotKey[:])
&nbsp;
 		elem := &amp;kv{key[:], rlpSlotValue}
<span class="term-fg31">-		trie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		trie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	sort.Sort(entries)
<span class="term-fg36">@@ -1638,7 +1638,7 @@</span> 		key := boundaries[i]
 		val := []byte{0xde, 0xad, 0xbe, 0xef}
&nbsp;
 		elem := &amp;kv{key[:], val}
<span class="term-fg31">-		trie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		trie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	&#47;&#47; Fill other slots if required
<span class="term-fg36">@@ -1650,7 +1650,7 @@</span> 		slotValue := key32(i)
 		rlpSlotValue, _ := rlp.EncodeToBytes(common.TrimLeftZeroes(slotValue[:]))
&nbsp;
 		elem := &amp;kv{key[:], rlpSlotValue}
<span class="term-fg31">-		trie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		trie.MustUpdate(elem.k, elem.v)</span>
 		entries = append(entries, elem)
 	}
 	sort.Sort(entries)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-48cfd3a64ddfa8606a5b6303" role="button"
                   aria-expanded="false" aria-controls="id-48cfd3a64ddfa8606a5b6303">
                    <code>eth/tracers/internal/tracetest/calltrace_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/calltrace_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/calltrace_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+115</span></div>
                        <div class="text-start"><span class="text-danger">-70</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-48cfd3a64ddfa8606a5b6303"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg1">index 62182e3a82b4a7f8287e5f543b6cf8ccadfcde5d..e517d436af93c83e100e7aeba1933a3abd432153 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg36">@@ -31,7 +31,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;rawdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
<span class="term-fg36">@@ -144,7 +143,7 @@</span> 			tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 			if err != nil {
 				t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)
 			}
<span class="term-fg31">-			evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+			evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Tracer: tracer})</span>
 			msg, err := core.TransactionToMessage(tx, signer, nil)
 			if err != nil {
 				t.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
<span class="term-fg36">@@ -247,7 +246,7 @@</span> 		tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), nil)
 		if err != nil {
 			b.Fatalf(&quot;failed to create call tracer: %v&quot;, err)
 		}
<span class="term-fg31">-		evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+		evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Tracer: tracer})</span>
 		snap := statedb.Snapshot()
 		st := core.NewStateTransition(evm, msg, new(core.GasPool).AddGas(tx.Gas()))
 		if _, err = st.TransitionDb(); err != nil {
<span class="term-fg36">@@ -260,75 +259,121 @@</span> 		statedb.RevertToSnapshot(snap)
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TestZeroValueToNotExitCall tests the calltracer(s) on the following:</span>
<span class="term-fg31">-&#47;&#47; Tx to A, A calls B with zero value. B does not already exist.</span>
<span class="term-fg31">-&#47;&#47; Expected: that enter&#47;exit is invoked and the inner call is shown in the result</span>
<span class="term-fg31">-func TestZeroValueToNotExitCall(t *testing.T) {</span>
<span class="term-fg31">-	var to = common.HexToAddress(&quot;0x00000000000000000000000000000000deadbeef&quot;)</span>
<span class="term-fg31">-	privkey, err := crypto.HexToECDSA(&quot;0000000000000000deadbeef00000000000000000000000000000000deadbeef&quot;)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;err %v&quot;, err)</span>
<span class="term-fg32">+func TestInternals(t *testing.T) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		to        = common.HexToAddress(&quot;0x00000000000000000000000000000000deadbeef&quot;)</span>
<span class="term-fg32">+		origin    = common.HexToAddress(&quot;0x00000000000000000000000000000000feed&quot;)</span>
<span class="term-fg32">+		txContext = vm.TxContext{</span>
<span class="term-fg32">+			Origin:   origin,</span>
<span class="term-fg32">+			GasPrice: big.NewInt(1),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		context = vm.BlockContext{</span>
<span class="term-fg32">+			CanTransfer: core.CanTransfer,</span>
<span class="term-fg32">+			Transfer:    core.Transfer,</span>
<span class="term-fg32">+			Coinbase:    common.Address{},</span>
<span class="term-fg32">+			BlockNumber: new(big.Int).SetUint64(8000000),</span>
<span class="term-fg32">+			Time:        5,</span>
<span class="term-fg32">+			Difficulty:  big.NewInt(0x30000),</span>
<span class="term-fg32">+			GasLimit:    uint64(6000000),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	mkTracer := func(name string, cfg json.RawMessage) tracers.Tracer {</span>
<span class="term-fg32">+		tr, err := tracers.DefaultDirectory.New(name, nil, cfg)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return tr</span>
 	}
<span class="term-fg31">-	signer := types.NewEIP155Signer(big.NewInt(1))</span>
<span class="term-fg31">-	tx, err := types.SignNewTx(privkey, signer, &amp;types.LegacyTx{</span>
<span class="term-fg31">-		GasPrice: big.NewInt(0),</span>
<span class="term-fg31">-		Gas:      50000,</span>
<span class="term-fg31">-		To:       &amp;to,</span>
<span class="term-fg31">-	})</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;err %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	origin, _ := signer.Sender(tx)</span>
<span class="term-fg31">-	txContext := vm.TxContext{</span>
<span class="term-fg31">-		Origin:   origin,</span>
<span class="term-fg31">-		GasPrice: big.NewInt(1),</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	context := vm.BlockContext{</span>
<span class="term-fg31">-		CanTransfer: core.CanTransfer,</span>
<span class="term-fg31">-		Transfer:    core.Transfer,</span>
<span class="term-fg31">-		Coinbase:    common.Address{},</span>
<span class="term-fg31">-		BlockNumber: new(big.Int).SetUint64(8000000),</span>
<span class="term-fg31">-		Time:        5,</span>
<span class="term-fg31">-		Difficulty:  big.NewInt(0x30000),</span>
<span class="term-fg31">-		GasLimit:    uint64(6000000),</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	var code = []byte{</span>
<span class="term-fg31">-		byte(vm.PUSH1), 0x0, byte(vm.DUP1), byte(vm.DUP1), byte(vm.DUP1), &#47;&#47; in and outs zero</span>
<span class="term-fg31">-		byte(vm.DUP1), byte(vm.PUSH1), 0xff, byte(vm.GAS), &#47;&#47; value=0,address=0xff, gas=GAS</span>
<span class="term-fg31">-		byte(vm.CALL),</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	var alloc = core.GenesisAlloc{</span>
<span class="term-fg31">-		to: core.GenesisAccount{</span>
<span class="term-fg31">-			Nonce: 1,</span>
<span class="term-fg31">-			Code:  code,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for _, tc := range []struct {</span>
<span class="term-fg32">+		name   string</span>
<span class="term-fg32">+		code   []byte</span>
<span class="term-fg32">+		tracer tracers.Tracer</span>
<span class="term-fg32">+		want   string</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&#47;&#47; TestZeroValueToNotExitCall tests the calltracer(s) on the following:</span>
<span class="term-fg32">+			&#47;&#47; Tx to A, A calls B with zero value. B does not already exist.</span>
<span class="term-fg32">+			&#47;&#47; Expected: that enter&#47;exit is invoked and the inner call is shown in the result</span>
<span class="term-fg32">+			name: &quot;ZeroValueToNotExitCall&quot;,</span>
<span class="term-fg32">+			code: []byte{</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0, byte(vm.DUP1), byte(vm.DUP1), byte(vm.DUP1), &#47;&#47; in and outs zero</span>
<span class="term-fg32">+				byte(vm.DUP1), byte(vm.PUSH1), 0xff, byte(vm.GAS), &#47;&#47; value=0,address=0xff, gas=GAS</span>
<span class="term-fg32">+				byte(vm.CALL),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			tracer: mkTracer(&quot;callTracer&quot;, nil),</span>
<span class="term-fg32">+			want:   `{&quot;from&quot;:&quot;0x000000000000000000000000000000000000feed&quot;,&quot;gas&quot;:&quot;0xc350&quot;,&quot;gasUsed&quot;:&quot;0x54d8&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;calls&quot;:[{&quot;from&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;gas&quot;:&quot;0x6cbf&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000000000ff&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}],&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:   &quot;Stack depletion in LOG0&quot;,</span>
<span class="term-fg32">+			code:   []byte{byte(vm.LOG3)},</span>
<span class="term-fg32">+			tracer: mkTracer(&quot;callTracer&quot;, json.RawMessage(`{ &quot;withLog&quot;: true }`)),</span>
<span class="term-fg32">+			want:   `{&quot;from&quot;:&quot;0x000000000000000000000000000000000000feed&quot;,&quot;gas&quot;:&quot;0xc350&quot;,&quot;gasUsed&quot;:&quot;0xc350&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;error&quot;:&quot;stack underflow (0 \u003c=\u003e 5)&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Mem expansion in LOG0&quot;,</span>
<span class="term-fg32">+			code: []byte{</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x1,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0,</span>
<span class="term-fg32">+				byte(vm.MSTORE),</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0xff,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0,</span>
<span class="term-fg32">+				byte(vm.LOG0),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			tracer: mkTracer(&quot;callTracer&quot;, json.RawMessage(`{ &quot;withLog&quot;: true }`)),</span>
<span class="term-fg32">+			want:   `{&quot;from&quot;:&quot;0x000000000000000000000000000000000000feed&quot;,&quot;gas&quot;:&quot;0xc350&quot;,&quot;gasUsed&quot;:&quot;0x5b9e&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;logs&quot;:[{&quot;address&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;topics&quot;:[],&quot;data&quot;:&quot;0x000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;}],&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}`,</span>
 		},
<span class="term-fg31">-		origin: core.GenesisAccount{</span>
<span class="term-fg31">-			Nonce:   0,</span>
<span class="term-fg31">-			Balance: big.NewInt(500000000000000),</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&#47;&#47; Leads to OOM on the prestate tracer</span>
<span class="term-fg32">+			name: &quot;Prestate-tracer - mem expansion in CREATE2&quot;,</span>
<span class="term-fg32">+			code: []byte{</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x1,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0,</span>
<span class="term-fg32">+				byte(vm.MSTORE),</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x1,</span>
<span class="term-fg32">+				byte(vm.PUSH5), 0xff, 0xff, 0xff, 0xff, 0xff,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x1,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0,</span>
<span class="term-fg32">+				byte(vm.CREATE2),</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0xff,</span>
<span class="term-fg32">+				byte(vm.PUSH1), 0x0,</span>
<span class="term-fg32">+				byte(vm.LOG0),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			tracer: mkTracer(&quot;prestateTracer&quot;, json.RawMessage(`{ &quot;withLog&quot;: true }`)),</span>
<span class="term-fg32">+			want:   `{&quot;0x0000000000000000000000000000000000000000&quot;:{&quot;balance&quot;:&quot;0x0&quot;},&quot;0x000000000000000000000000000000000000feed&quot;:{&quot;balance&quot;:&quot;0x1c6bf52640350&quot;},&quot;0x00000000000000000000000000000000deadbeef&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x6001600052600164ffffffffff60016000f560ff6000a0&quot;}}`,</span>
 		},
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	_, statedb := tests.MakePreState(rawdb.NewMemoryDatabase(), alloc, false)</span>
<span class="term-fg31">-	&#47;&#47; Create the tracer, the EVM environment and run it</span>
<span class="term-fg31">-	tracer, err := tracers.DefaultDirectory.New(&quot;callTracer&quot;, nil, nil)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	evm := vm.NewEVM(context, txContext, statedb, params.MainnetChainConfig, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg31">-	msg, err := core.TransactionToMessage(tx, signer, nil)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	st := core.NewStateTransition(evm, msg, new(core.GasPool).AddGas(tx.Gas()))</span>
<span class="term-fg31">-	if _, err = st.TransitionDb(); err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;failed to execute transaction: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; Retrieve the trace result and compare against the etalon</span>
<span class="term-fg31">-	res, err := tracer.GetResult()</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;failed to retrieve trace result: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	wantStr := `{&quot;from&quot;:&quot;0x682a80a6f560eec50d54e63cbeda1c324c5f8d1b&quot;,&quot;gas&quot;:&quot;0x7148&quot;,&quot;gasUsed&quot;:&quot;0x54d8&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;calls&quot;:[{&quot;from&quot;:&quot;0x00000000000000000000000000000000deadbeef&quot;,&quot;gas&quot;:&quot;0x6cbf&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;to&quot;:&quot;0x00000000000000000000000000000000000000ff&quot;,&quot;input&quot;:&quot;0x&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}],&quot;value&quot;:&quot;0x0&quot;,&quot;type&quot;:&quot;CALL&quot;}`</span>
<span class="term-fg31">-	if string(res) != wantStr {</span>
<span class="term-fg31">-		t.Fatalf(&quot;trace mismatch\n have: %v\n want: %v\n&quot;, string(res), wantStr)</span>
<span class="term-fg32">+	} {</span>
<span class="term-fg32">+		_, statedb := tests.MakePreState(rawdb.NewMemoryDatabase(),</span>
<span class="term-fg32">+			core.GenesisAlloc{</span>
<span class="term-fg32">+				to: core.GenesisAccount{</span>
<span class="term-fg32">+					Code: tc.code,</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+				origin: core.GenesisAccount{</span>
<span class="term-fg32">+					Balance: big.NewInt(500000000000000),</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+			}, false)</span>
<span class="term-fg32">+		evm := vm.NewEVM(context, txContext, statedb, params.MainnetChainConfig, vm.Config{Tracer: tc.tracer})</span>
<span class="term-fg32">+		msg := &amp;core.Message{</span>
<span class="term-fg32">+			To:                &amp;to,</span>
<span class="term-fg32">+			From:              origin,</span>
<span class="term-fg32">+			Value:             big.NewInt(0),</span>
<span class="term-fg32">+			GasLimit:          50000,</span>
<span class="term-fg32">+			GasPrice:          big.NewInt(0),</span>
<span class="term-fg32">+			GasFeeCap:         big.NewInt(0),</span>
<span class="term-fg32">+			GasTipCap:         big.NewInt(0),</span>
<span class="term-fg32">+			SkipAccountChecks: false,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		st := core.NewStateTransition(evm, msg, new(core.GasPool).AddGas(msg.GasLimit))</span>
<span class="term-fg32">+		if _, err := st.TransitionDb(); err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %v: failed to execute transaction: %v&quot;, tc.name, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		&#47;&#47; Retrieve the trace result and compare against the expected</span>
<span class="term-fg32">+		res, err := tc.tracer.GetResult()</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %v: failed to retrieve trace result: %v&quot;, tc.name, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if string(res) != tc.want {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %v: trace mismatch\n have: %v\n want: %v\n&quot;, tc.name, string(res), tc.want)</span>
<span class="term-fg32">+		}</span>
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-787e8cabd10d5c41c33ec197" role="button"
                   aria-expanded="false" aria-controls="id-787e8cabd10d5c41c33ec197">
                    <code>eth/tracers/internal/tracetest/flat_calltrace_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/flat_calltrace_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/flat_calltrace_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-787e8cabd10d5c41c33ec197"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg1">index 8cd5a42bc0c01bb399efcf73ccfb4fc4b62dcb21..16c01de25c61a3f24fdabbef2ee5b361e2ab7349 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg36">@@ -107,7 +107,7 @@</span> 	tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 	if err != nil {
 		return fmt.Errorf(&quot;failed to create call tracer: %v&quot;, err)
 	}
<span class="term-fg31">-	evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+	evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Tracer: tracer})</span>
&nbsp;
 	msg, err := core.TransactionToMessage(tx, signer, nil)
 	if err != nil {
<span class="term-fg36">@@ -124,8 +124,8 @@</span> 	res, err := tracer.GetResult()
 	if err != nil {
 		return fmt.Errorf(&quot;failed to retrieve trace result: %v&quot;, err)
 	}
<span class="term-fg31">-	ret := new([]flatCallTrace)</span>
<span class="term-fg31">-	if err := json.Unmarshal(res, ret); err != nil {</span>
<span class="term-fg32">+	ret := make([]flatCallTrace, 0)</span>
<span class="term-fg32">+	if err := json.Unmarshal(res, &amp;ret); err != nil {</span>
 		return fmt.Errorf(&quot;failed to unmarshal trace result: %v&quot;, err)
 	}
 	if !jsonEqualFlat(ret, test.Result) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-47f67219c0f71b37e6719e2d" role="button"
                   aria-expanded="false" aria-controls="id-47f67219c0f71b37e6719e2d">
                    <code>eth/tracers/internal/tracetest/prestate_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/prestate_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/prestate_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-47f67219c0f71b37e6719e2d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg1">index f578e2f0f5fdba8f0e235e0c558ad32d2be923de..5fc99dd124397aa9c1745e4b602ace577b59ba66 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg36">@@ -114,7 +114,7 @@</span> 			tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 			if err != nil {
 				t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)
 			}
<span class="term-fg31">-			evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+			evm := vm.NewEVM(context, txContext, statedb, test.Genesis.Config, vm.Config{Tracer: tracer})</span>
 			msg, err := core.TransactionToMessage(tx, signer, nil)
 			if err != nil {
 				t.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0bdbcc96a344633ad61edbbe" role="button"
                   aria-expanded="false" aria-controls="id-0bdbcc96a344633ad61edbbe">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/create.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/create.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/create.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0bdbcc96a344633ad61edbbe"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;create.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;create.json</span>
<span class="term-fg1">index 8557f8efd69bb1be8da7a897f956119c3b30d6f9..df0b2872b48b65f203071a346844750d45e48d44 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;create.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;create.json</span>
<span class="term-fg36">@@ -47,7 +47,7 @@</span>   },
   &quot;input&quot;: &quot;0xf907ef098504e3b29200830897be8080b9079c606060405260405160208061077c83398101604052808051906020019091905050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415151561007d57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460006101000a81548160ff02191690831515021790555050610653806101296000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029000000000000000000000000c65e620a3a55451316168d57e268f5702ef56a1129a01060f46676a5dff6f407f0f51eb6f37f5c8c54e238c70221e18e65fc29d3ea65a0557b01c50ff4ffaac8ed6e5d31237a4ecbac843ab1bfe8bb0165a0060df7c54f&quot;,
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x13e4acefe6a6700604929946e70e6443e4e73447&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x5e106&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x897be&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x897be&quot;,
     &quot;input&quot;: &quot;0x606060405260405160208061077c83398101604052808051906020019091905050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415151561007d57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460006101000a81548160ff02191690831515021790555050610653806101296000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029000000000000000000000000c65e620a3a55451316168d57e268f5702ef56a11&quot;,
     &quot;output&quot;: &quot;0x606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6713eb3f4bcd23d38c43b89d" role="button"
                   aria-expanded="false" aria-controls="id-6713eb3f4bcd23d38c43b89d">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/deep_calls.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/deep_calls.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/deep_calls.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6713eb3f4bcd23d38c43b89d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deep_calls.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deep_calls.json</span>
<span class="term-fg1">index 174f23fc456c6835b8c224c5dde0bf062b5bd4fe..975616064af9636b6e14d3a2572cd2fc562b0742 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deep_calls.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deep_calls.json</span>
<span class="term-fg36">@@ -399,7 +399,7 @@</span>         &quot;value&quot;: &quot;0x0&quot;
       }
     ],
     &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x3d090&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x1810b&quot;,
     &quot;input&quot;: &quot;0x51a34eb80000000000000000000000000000000000000000000000280faf689c35ac0000&quot;,
     &quot;to&quot;: &quot;0xc212e03b9e060e36facad5fd8f4435412ca22e6b&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-90bb77571da48cba03167f54" role="button"
                   aria-expanded="false" aria-controls="id-90bb77571da48cba03167f54">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/delegatecall.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/delegatecall.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/delegatecall.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-90bb77571da48cba03167f54"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;delegatecall.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;delegatecall.json</span>
<span class="term-fg1">index 5fd946f734678d6dd0e3ff7126cdd319c2c6c612..6a2cda7dc98901891b22a1f74fc9faa5ae441a0b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;delegatecall.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;delegatecall.json</span>
<span class="term-fg36">@@ -87,7 +87,7 @@</span>         &quot;value&quot;: &quot;0x0&quot;
       }
     ],
     &quot;from&quot;: &quot;0xa529806c67cc6486d4d62024471772f47f6fd672&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d6e28&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xbd55&quot;,
     &quot;input&quot;: &quot;0x7065cb480000000000000000000000001523e55a1ca4efbae03355775ae89f8d7699ad9e&quot;,
     &quot;to&quot;: &quot;0x269296dddce321a6bcbaa2f0181127593d732cba&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-40bc14e72b601723271bd057" role="button"
                   aria-expanded="false" aria-controls="id-40bc14e72b601723271bd057">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/inner_create_oog_outer_throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/inner_create_oog_outer_throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/inner_create_oog_outer_throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-40bc14e72b601723271bd057"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_create_oog_outer_throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">index 95c5889269fc4733416158ef5cfab47da77d61ef..bb16a4a4303a57a370154848f2407eb4d5ef3be7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg36">@@ -67,7 +67,7 @@</span>       }
     ],
     &quot;error&quot;: &quot;invalid jump destination&quot;,
     &quot;from&quot;: &quot;0xe4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x435c8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x493e0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x493e0&quot;,
     &quot;input&quot;: &quot;0x3b91f506000000000000000000000000a14bdd7e5666d784dcce98ad24d383a6b1cd4182000000000000000000000000e4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
     &quot;to&quot;: &quot;0x1d3ddf7caf024f253487e18bc4a15b1a360c170a&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b537856bae4d5f182dacba0" role="button"
                   aria-expanded="false" aria-controls="id-9b537856bae4d5f182dacba0">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/inner_instafail.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/inner_instafail.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/inner_instafail.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b537856bae4d5f182dacba0"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_instafail.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_instafail.json</span>
<span class="term-fg1">index 4d7305a15479137461105a4194ec4c7b41c75cb7..9b45b52fe9ad3c5581704a8022a210007f467b7e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_instafail.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_instafail.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>     &quot;type&quot;: &quot;CALL&quot;,
     &quot;from&quot;: &quot;0x66fdfd05e46126a07465ad24e40cc0597bc1ef31&quot;,
     &quot;to&quot;: &quot;0x6c06b16512b332e6cd8293a2974872674716ce18&quot;,
     &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x1a466&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x1f97e&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x72de&quot;,
     &quot;input&quot;: &quot;0x2e1a7d4d00000000000000000000000000000000000000000000000014d1120d7b160000&quot;
   }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e157802594eb814681e46532" role="button"
                   aria-expanded="false" aria-controls="id-e157802594eb814681e46532">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/inner_revert_reason.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/inner_revert_reason.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/inner_revert_reason.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e157802594eb814681e46532"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_revert_reason.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_revert_reason.json</span>
<span class="term-fg1">index b5355f65fe94d21ce99d970e55f5388d24d49f42..ad0627ccd660be40f8b1cddaf720cc963765e837 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_revert_reason.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_revert_reason.json</span>
<span class="term-fg36">@@ -50,7 +50,7 @@</span>   },
   &quot;input&quot;: &quot;0x02f9029d82053980849502f90085010c388d00832dc6c08080b90241608060405234801561001057600080fd5b50600060405161001f906100a2565b604051809103906000f08015801561003b573d6000803e3d6000fd5b5090508073ffffffffffffffffffffffffffffffffffffffff1663c04062266040518163ffffffff1660e01b815260040160006040518083038186803b15801561008457600080fd5b505afa158015610098573d6000803e3d6000fd5b50505050506100af565b610145806100fc83390190565b603f806100bd6000396000f3fe6080604052600080fdfea264697066735822122077f7dbd3450d6e817079cf3fe27107de5768bb3163a402b94e2206b468eb025664736f6c63430008070033608060405234801561001057600080fd5b50610125806100206000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c8063c040622614602d575b600080fd5b60336035565b005b60036002116076576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401606d906097565b60405180910390fd5b565b6000608360128360b5565b9150608c8260c6565b602082019050919050565b6000602082019050818103600083015260ae816078565b9050919050565b600082825260208201905092915050565b7f546869732063616c6c6564206661696c6564000000000000000000000000000060008201525056fea264697066735822122033f8d92e29d467e5ea08d0024eab0b36b86b8cdb3542c6e89dbaabeb8ffaa42064736f6c63430008070033c001a07566181071cabaf58b70fc41557eb813bfc7a24f5c58554e7fed0bf7c031f169a0420af50b5fe791a4d839e181a676db5250b415dfb35cb85d544db7a1475ae2cc&quot;,
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x3623191d4ccfbbdf09e8ebf6382a1f8257417bc1&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2cd774&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x25590&quot;,
     &quot;input&quot;: &quot;0x608060405234801561001057600080fd5b50600060405161001f906100a2565b604051809103906000f08015801561003b573d6000803e3d6000fd5b5090508073ffffffffffffffffffffffffffffffffffffffff1663c04062266040518163ffffffff1660e01b815260040160006040518083038186803b15801561008457600080fd5b505afa158015610098573d6000803e3d6000fd5b50505050506100af565b610145806100fc83390190565b603f806100bd6000396000f3fe6080604052600080fdfea264697066735822122077f7dbd3450d6e817079cf3fe27107de5768bb3163a402b94e2206b468eb025664736f6c63430008070033608060405234801561001057600080fd5b50610125806100206000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c8063c040622614602d575b600080fd5b60336035565b005b60036002116076576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401606d906097565b60405180910390fd5b565b6000608360128360b5565b9150608c8260c6565b602082019050919050565b6000602082019050818103600083015260ae816078565b9050919050565b600082825260208201905092915050565b7f546869732063616c6c6564206661696c6564000000000000000000000000000060008201525056fea264697066735822122033f8d92e29d467e5ea08d0024eab0b36b86b8cdb3542c6e89dbaabeb8ffaa42064736f6c63430008070033&quot;,
     &quot;output&quot;: &quot;0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000012546869732063616c6c6564206661696c65640000000000000000000000000000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6b1fa20335d81b1dd448049b" role="button"
                   aria-expanded="false" aria-controls="id-6b1fa20335d81b1dd448049b">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/inner_throw_outer_revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/inner_throw_outer_revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/inner_throw_outer_revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6b1fa20335d81b1dd448049b"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_throw_outer_revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">index 2be2dee23f262ed03fe6a4e1d136b83aff8c299e..a023ed6d9bd7c093c3bbe997272eb47b6444f39c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;inner_throw_outer_revert.json</span>
<span class="term-fg36">@@ -71,7 +71,7 @@</span>       }
     ],
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0xd4fcab9f0a6dc0493af47c864f6f17a8a5e2e826&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x78d9e&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x7dfa6&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x7c1c8&quot;,
     &quot;input&quot;: &quot;0x&quot;,
     &quot;to&quot;: &quot;0x33056b5dcac09a9b4becad0e1dcf92c19bd0af76&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-284d75c0cce98aba330b13f8" role="button"
                   aria-expanded="false" aria-controls="id-284d75c0cce98aba330b13f8">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/oog.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/oog.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/oog.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-284d75c0cce98aba330b13f8"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;oog.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;oog.json</span>
<span class="term-fg1">index 8022f53a992d3876116243e714d86810aac20fbc..333bdd038cf5b18fc6e00f86be9aef2dd62eb2e0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;oog.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;oog.json</span>
<span class="term-fg36">@@ -50,7 +50,7 @@</span>   &quot;input&quot;: &quot;0xf8ab820109855d21dba00082ca1d9443064693d3d38ad6a7cb579e0d6d9718c8aa6b6280b844a9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f90001ba0ce3ad83f5530136467b7c2bb225f406bd170f4ad59c254e5103c34eeabb5bd69a0455154527224a42ab405cacf0fe92918a75641ce4152f8db292019a5527aa956&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;out of gas&quot;,
     &quot;from&quot;: &quot;0x94194bc2aaf494501d7880b61274a169f6502a54&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x7045&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0xca1d&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xca1d&quot;,
     &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f9000&quot;,
     &quot;to&quot;: &quot;0x43064693d3d38ad6a7cb579e0d6d9718c8aa6b62&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-85228187c3510afad1061f6c" role="button"
                   aria-expanded="false" aria-controls="id-85228187c3510afad1061f6c">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-85228187c3510afad1061f6c"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert.json</span>
<span class="term-fg1">index aee894d11fdeaac58d94ceee75abb651628dbd78..3207a298a98bb501776810f12a7824dcd19c46c9 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert.json</span>
<span class="term-fg36">@@ -48,7 +48,7 @@</span>   &quot;input&quot;: &quot;0xf9018b0a8505d21dba00832dc6c094abbcd5b340c80b5f1c0545c04c987b87310296ae80b9012473b40a5c000000000000000000000000400de2e016bda6577407dfc379faba9899bc73ef0000000000000000000000002cc31912b2b0f3075a87b3640923d45a26cef3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d79d8e6c7265636f76657279416464726573730000000000000000000000000000000000000000000000000000000000383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988000000000000000000000000000000000000000000000000000000000000000000000000000000001ba0fd659d76a4edbd2a823e324c93f78ad6803b30ff4a9c8bce71ba82798975c70ca06571eecc0b765688ec6c78942c5ee8b585e00988c0141b518287e9be919bc48a&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0x0f6cef2b7fbb504782e35aa82a2207e816a2b7a9&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d55e8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x719b&quot;,
     &quot;input&quot;: &quot;0x73b40a5c000000000000000000000000400de2e016bda6577407dfc379faba9899bc73ef0000000000000000000000002cc31912b2b0f3075a87b3640923d45a26cef3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d79d8e6c7265636f76657279416464726573730000000000000000000000000000000000000000000000000000000000383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988383e3ec32dc0f66d8fe60dbdc2f6815bdf73a98800000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
     &quot;to&quot;: &quot;0xabbcd5b340c80b5f1c0545c04c987b87310296ae&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3fc06b43e05415769e841c7b" role="button"
                   aria-expanded="false" aria-controls="id-3fc06b43e05415769e841c7b">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/revert_reason.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/revert_reason.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/revert_reason.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3fc06b43e05415769e841c7b"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert_reason.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert_reason.json</span>
<span class="term-fg1">index 8c8abd4d6d2411edbdb3cc5aa9fe4841d09ac23a..f02e5c686322dce4b73726726f6e10f827ff9746 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert_reason.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;revert_reason.json</span>
<span class="term-fg36">@@ -27,7 +27,7 @@</span>     &quot;config&quot;: {
       &quot;byzantiumBlock&quot;: 0,
       &quot;constantinopleBlock&quot;: 0,
       &quot;petersburgBlock&quot;: 0,
<span class="term-fg31">-      &quot;IstanbulBlock&quot;:1561651,</span>
<span class="term-fg32">+      &quot;IstanbulBlock&quot;:  1561651,</span>
       &quot;chainId&quot;: 5,
       &quot;daoForkSupport&quot;: true,
       &quot;eip150Block&quot;: 0,
<span class="term-fg36">@@ -53,7 +53,7 @@</span>   &quot;input&quot;: &quot;0xf888068449504f80832dc6c094f58833cf0c791881b494eb79d461e08a1f043f5280a45c19a95c000000000000000000000000f7579c3d8a669c89d5ed246a22eb6db8f6fedbf12da0264664db3e71fae1dbdaf2f53954be149ad3b7ba8a5054b4d89c70febfacc8b1a0212e8398757963f419681839ae8c5a54b411e252473c82d93dda68405ca63294&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0xf7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d7308&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x5940&quot;,
     &quot;input&quot;: &quot;0x5c19a95c000000000000000000000000f7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
     &quot;to&quot;: &quot;0xf58833cf0c791881b494eb79d461e08a1f043f52&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8e4abbdcdd2f66046ef72d00" role="button"
                   aria-expanded="false" aria-controls="id-8e4abbdcdd2f66046ef72d00">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/selfdestruct.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/selfdestruct.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/selfdestruct.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8e4abbdcdd2f66046ef72d00"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;selfdestruct.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;selfdestruct.json</span>
<span class="term-fg1">index a89d4dc7456bc7a5b9f37ecccb27c121a306df21..620df1d6149d097028434a80572e977b3cd4c574 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;selfdestruct.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;selfdestruct.json</span>
<span class="term-fg36">@@ -64,7 +64,7 @@</span>         &quot;value&quot;: &quot;0x4d87094125a369d9bd5&quot;
       }
     ],
     &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x15f90&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x6fcb&quot;,
     &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
     &quot;to&quot;: &quot;0x3b873a919aa0512d5a0f09e6dcceaa4a6727fafe&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-abec921503cc9d6cfcf77d18" role="button"
                   aria-expanded="false" aria-controls="id-abec921503cc9d6cfcf77d18">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/simple.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/simple.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/simple.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-abec921503cc9d6cfcf77d18"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple.json</span>
<span class="term-fg1">index 0a6d66a5c4ca411ef35d4b5c3c0962ea5f566cfb..6c7d01de1fc6b35655737d7a4c8802aa0baf8fd8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple.json</span>
<span class="term-fg36">@@ -69,7 +69,7 @@</span>         &quot;value&quot;: &quot;0x6f05b59d3b20000&quot;
       }
     ],
     &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x15f90&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x9751&quot;,
     &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
     &quot;output&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7bafaf18a8de83a2a381eb6c" role="button"
                   aria-expanded="false" aria-controls="id-7bafaf18a8de83a2a381eb6c">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/simple_onlytop.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/simple_onlytop.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/simple_onlytop.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7bafaf18a8de83a2a381eb6c"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple_onlytop.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple_onlytop.json</span>
<span class="term-fg1">index 5e25a01cef2de489ee9e0fbd5f79cc1c688df2d6..affb4ab033ab521bad30fb0b4a80d9118b53fe4d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple_onlytop.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;simple_onlytop.json</span>
<span class="term-fg36">@@ -61,7 +61,7 @@</span>       &quot;onlyTopCall&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x15f90&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x9751&quot;,
     &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
     &quot;output&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8741bd1fc499a9501d53dacb" role="button"
                   aria-expanded="false" aria-controls="id-8741bd1fc499a9501d53dacb">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer/throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer/throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer/throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8741bd1fc499a9501d53dacb"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;throw.json</span>
<span class="term-fg1">index 76fae3c392b33b244adf364fb218cb6f881acc6d..499b449a6ecef658f2a59f57ae817a457ef30a5c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;throw.json</span>
<span class="term-fg36">@@ -52,7 +52,7 @@</span>   &quot;input&quot;: &quot;0xf88b8206668504a817c8008303d09094c212e03b9e060e36facad5fd8f4435412ca22e6b80a451a34eb8000000000000000000000000000000000000000000000027fad02094277c000029a0692a3b4e7b2842f8dd7832e712c21e09f451f416c8976d5b8d02e8c0c2b4bea9a07645e90fc421b63dd755767fd93d3c03b4ec0c4d8fafa059558d08cf11d59750&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;invalid jump destination&quot;,
     &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x3d090&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x3d090&quot;,
     &quot;input&quot;: &quot;0x51a34eb8000000000000000000000000000000000000000000000027fad02094277c0000&quot;,
     &quot;to&quot;: &quot;0xc212e03b9e060e36facad5fd8f4435412ca22e6b&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-04d1abb5b7fcd41b002c7f63" role="button"
                   aria-expanded="false" aria-controls="id-04d1abb5b7fcd41b002c7f63">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/big_slow.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/big_slow.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/big_slow.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-04d1abb5b7fcd41b002c7f63"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;big_slow.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;big_slow.json</span>
<span class="term-fg1">index e54ede92b02a1e9c477802f48243b581a72dba0a..617f52a14e8a0f97eb735b2211781f427a6690ed 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;big_slow.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;big_slow.json</span>
<span class="term-fg36">@@ -46,7 +46,7 @@</span>   &quot;result&quot;: [
     {
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0xf8bda96b67036ee48107f2a0695ea673479dda56&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x22410c&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x231860&quot;,</span>
         &quot;init&quot;: &quot;0x5b620186a05a131560135760016020526000565b600080601f600039601f565b6000f3&quot;,
         &quot;value&quot;: &quot;0x0&quot;
       },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d71efce66372db8531cd6800" role="button"
                   aria-expanded="false" aria-controls="id-d71efce66372db8531cd6800">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_fail_hide.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_fail_hide.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_fail_hide.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d71efce66372db8531cd6800"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_fail_hide.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_fail_hide.json</span>
<span class="term-fg1">index be198885cbc3382fe2c5d2a085f7d9fdd3dbf376..c796804a4bcd1ac52ac6f8ea43e20512ec306256 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_fail_hide.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_fail_hide.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x19f78&quot;,</span>
         &quot;init&quot;: &quot;0x60206000600060006013600462030d40f260025560005160005500&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a148b7aba79600b3238e8703" role="button"
                   aria-expanded="false" aria-controls="id-a148b7aba79600b3238e8703">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_oog.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_oog.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_oog.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a148b7aba79600b3238e8703"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_oog.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_oog.json</span>
<span class="term-fg1">index 94b864ff497d9626d5b7286b9bb76768c8452f64..fb29e49660d5c3559201cdda51fb416a683de259 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_oog.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_oog.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x1a758&quot;,</span>
         &quot;init&quot;: &quot;0x7f18c547e4f7b0f325ad1e56f57e26c745b09a3e503d86e00e5255ff7f715d3d1c600052601c6020527f73b1693892219d736caba55bdb67216e485557ea6b6af75f37096c9aa6a5a75f6040527feeb940b1d03b21e36b0e47e79769f095fe2ab855bd91e3a38756b7d75a9c4549606052602060806080600060006001610bb7f260025560a060020a60805106600055600054321460015500&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b175c65204a28ed4382296e8" role="button"
                   aria-expanded="false" aria-controls="id-b175c65204a28ed4382296e8">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/callcode_precompiled_throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b175c65204a28ed4382296e8"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_throw.json</span>
<span class="term-fg1">index 506dc5ff68ece9ba717eb6515d347c43e23ecfed..3c1e370f91c7e2bab4762cdd2cec41494f491f73 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;callcode_precompiled_throw.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x1a034&quot;,</span>
         &quot;init&quot;: &quot;0x36600060003760406103e8366000600060095af26001556103e8516002556104085160035500&quot;
       },
       &quot;error&quot;: &quot;out of gas&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5ca16b6c9264fdfaba530114" role="button"
                   aria-expanded="false" aria-controls="id-5ca16b6c9264fdfaba530114">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/create.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/create.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/create.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5ca16b6c9264fdfaba530114"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;create.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;create.json</span>
<span class="term-fg1">index b83236690c2669ce903c68bc3d508c4abae526f4..11bc4eae022b142ff9983527c79f6b6093c1760f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;create.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;create.json</span>
<span class="term-fg36">@@ -49,7 +49,7 @@</span>   &quot;result&quot;: [
     {
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x13e4acefe6a6700604929946e70e6443e4e73447&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x5e106&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x897be&quot;,</span>
         &quot;init&quot;: &quot;0x606060405260405160208061077c83398101604052808051906020019091905050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415151561007d57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460006101000a81548160ff02191690831515021790555050610653806101296000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029000000000000000000000000c65e620a3a55451316168d57e268f5702ef56a11&quot;,
         &quot;value&quot;: &quot;0x0&quot;
       },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-62ef1105703e1481150ed08f" role="button"
                   aria-expanded="false" aria-controls="id-62ef1105703e1481150ed08f">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/deep_calls.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/deep_calls.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/deep_calls.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-62ef1105703e1481150ed08f"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deep_calls.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deep_calls.json</span>
<span class="term-fg1">index 5931b40809225b7b3333ff62d38ae6d05392a31c..375a163614134511bfa6857e6e40010ecb7f2daf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deep_calls.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deep_calls.json</span>
<span class="term-fg36">@@ -113,7 +113,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x3d090&quot;,</span>
         &quot;input&quot;: &quot;0x51a34eb80000000000000000000000000000000000000000000000280faf689c35ac0000&quot;,
         &quot;to&quot;: &quot;0xc212e03b9e060e36facad5fd8f4435412ca22e6b&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f07746154b2ee993fbd721c9" role="button"
                   aria-expanded="false" aria-controls="id-f07746154b2ee993fbd721c9">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f07746154b2ee993fbd721c9"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall.json</span>
<span class="term-fg1">index 3a03ffc0fa96fdc882eed702c981f0aea47f120a..e5a37cbfdd279995ace59a2d07dd1b1ed64cae13 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall.json</span>
<span class="term-fg36">@@ -66,7 +66,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0xa529806c67cc6486d4d62024471772f47f6fd672&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x2d6e28&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
         &quot;input&quot;: &quot;0x7065cb480000000000000000000000001523e55a1ca4efbae03355775ae89f8d7699ad9e&quot;,
         &quot;to&quot;: &quot;0x269296dddce321a6bcbaa2f0181127593d732cba&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ae09d4093ff9033e8a6437ad" role="button"
                   aria-expanded="false" aria-controls="id-ae09d4093ff9033e8a6437ad">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall_parent_value.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall_parent_value.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/delegatecall_parent_value.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ae09d4093ff9033e8a6437ad"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall_parent_value.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall_parent_value.json</span>
<span class="term-fg1">index 800a6a4288de36969e85779873618e0c6311360d..177912420aae51e357315038689edba35f6c89d8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall_parent_value.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;delegatecall_parent_value.json</span>
<span class="term-fg36">@@ -59,7 +59,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x10b68&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x15f90&quot;,</span>
         &quot;input&quot;: &quot;0x4e45375a47413941&quot;,
         &quot;to&quot;: &quot;0x91765918420bcb5ad22ee0997abed04056705798&quot;,
         &quot;value&quot;: &quot;0x8ac7230489e80000&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ba13616f20bb1f25fbbf6fe9" role="button"
                   aria-expanded="false" aria-controls="id-ba13616f20bb1f25fbbf6fe9">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/gas.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/gas.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/gas.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ba13616f20bb1f25fbbf6fe9"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;gas.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;gas.json</span>
<span class="term-fg1">index 3b44a5e2cd9948a960977bb0c3b1f9557e273fcd..d977dbe30d137674f1edad3e3db92724ed08c761 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;gas.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;gas.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x1a9c8&quot;,</span>
         &quot;init&quot;: &quot;0x601b565b6000555b005b630badf00d6003565b63c001f00d6003565b7319e7e376e7c213b7e7e7e46cc70a5dd086daff2a7f22ae6da6b482f9b1b19b0b897c3fd43884180a1c5ee361e1107a1bc635649dda600052601b603f537f16433dce375ce6dc8151d3f0a22728bc4a1d9fd6ed39dfd18b4609331937367f6040527f306964c0cf5d74f04129fdc60b54d35b596dde1bf89ad92cb4123318f4c0e40060605260206080607f60006000600161fffff21560075760805114601257600956&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-de1dd471344b4c0bc44e60ef" role="button"
                   aria-expanded="false" aria-controls="id-de1dd471344b4c0bc44e60ef">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/include_precompiled.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/include_precompiled.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/include_precompiled.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-de1dd471344b4c0bc44e60ef"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;include_precompiled.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;include_precompiled.json</span>
<span class="term-fg1">index d33375bfd2204e19813eba9c40fd524f6419bf46..0f28c07a9be20618a497946247215852342f1945 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;include_precompiled.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;include_precompiled.json</span>
<span class="term-fg36">@@ -83,7 +83,7 @@</span>         &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;balance&quot;: &quot;0x0&quot;,
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x119d28&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x124f80&quot;,</span>
         &quot;input&quot;: &quot;0x13f955e100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000019004000000afbe013b4a83b2f91f3d9b6627cf382394c4914fd2b7510700000000000000008621196eb526a0e02430b6dd5c72fd368e768977f3a8364861e5a471a8ae61a1028f745609c40b185f537a67040000005b53875b0f1381589859adcf938980f4a8fb0af4c8845007000000000000000075289d1c48c8f71deee521a76c8d92948cbe14343991998dfaea6b08596d97dcc891745609c40b18ae825ae704000000abbacd8711f647ab97c6c9b9658eb9bef081e2cedb630f010000000000000000549bcab22422baef6c34af382b227e4b1a27bec3312e04dbb62fc315203c67f30f9d745609c40b180fdfc30304000000e93433dde5128942e47e8722d37ec4dcc1c8a78cf9c4a4030000000000000000bf92c09e8e37b2c8ffbb4b9cadfccc563e474c4feae6997f52d56236fedafce20a9f745609c40b1840cc27de04000000f2e372a0b5b837116eee8f968840393d85975a1531346807000000000000000076bc91399edda1de98976ee0774e2ad3b21dd38ad9f5f34d2c816a832747fe7f4c9e745609c40b18e290e9e000000000000000000000000000000000&quot;,
         &quot;refundAddress&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;to&quot;: &quot;0x6cc68eb482a757c690dd151d2bd5e774ada38bdc&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-791bd246d78b2c376276208c" role="button"
                   aria-expanded="false" aria-controls="id-791bd246d78b2c376276208c">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_create_oog_outer_throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_create_oog_outer_throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_create_oog_outer_throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-791bd246d78b2c376276208c"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_create_oog_outer_throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">index 170948e15669e267f10a6198b0140c0e94f44c48..6c4ce18063eacd42c4599f5bde548076a7e22f16 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg36">@@ -58,7 +58,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0xe4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x435c8&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x493e0&quot;,</span>
         &quot;input&quot;: &quot;0x3b91f506000000000000000000000000a14bdd7e5666d784dcce98ad24d383a6b1cd4182000000000000000000000000e4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
         &quot;to&quot;: &quot;0x1d3ddf7caf024f253487e18bc4a15b1a360c170a&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b758bd8b34a329e72f0fb95" role="button"
                   aria-expanded="false" aria-controls="id-7b758bd8b34a329e72f0fb95">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_instafail.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_instafail.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_instafail.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b758bd8b34a329e72f0fb95"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_instafail.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_instafail.json</span>
<span class="term-fg1">index 328b743270db8bb20f98396fddeb8c263ea3ea34..4de08f2ccaf1a1acb9682b651b3941423b997d79 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_instafail.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_instafail.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x66fdfd05e46126a07465ad24e40cc0597bc1ef31&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x1a466&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x1f97e&quot;,</span>
         &quot;input&quot;: &quot;0x2e1a7d4d00000000000000000000000000000000000000000000000014d1120d7b160000&quot;,
         &quot;to&quot;: &quot;0x6c06b16512b332e6cd8293a2974872674716ce18&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-523c07bbf1026b40f703b95a" role="button"
                   aria-expanded="false" aria-controls="id-523c07bbf1026b40f703b95a">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_precompiled_wrong_gas.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_precompiled_wrong_gas.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_precompiled_wrong_gas.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-523c07bbf1026b40f703b95a"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_precompiled_wrong_gas.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_precompiled_wrong_gas.json</span>
<span class="term-fg1">index 6b5738101c248150136c5debb2bfd7874ec077ec..70442fdb9ab7809a7a51bcc341fb9f9895770fe0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_precompiled_wrong_gas.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_precompiled_wrong_gas.json</span>
<span class="term-fg36">@@ -80,7 +80,7 @@</span>         &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;balance&quot;: &quot;0x0&quot;,
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x119d28&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x124f80&quot;,</span>
         &quot;input&quot;: &quot;0x13f955e100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000019004000000afbe013b4a83b2f91f3d9b6627cf382394c4914fd2b7510700000000000000008621196eb526a0e02430b6dd5c72fd368e768977f3a8364861e5a471a8ae61a1028f745609c40b185f537a67040000005b53875b0f1381589859adcf938980f4a8fb0af4c8845007000000000000000075289d1c48c8f71deee521a76c8d92948cbe14343991998dfaea6b08596d97dcc891745609c40b18ae825ae704000000abbacd8711f647ab97c6c9b9658eb9bef081e2cedb630f010000000000000000549bcab22422baef6c34af382b227e4b1a27bec3312e04dbb62fc315203c67f30f9d745609c40b180fdfc30304000000e93433dde5128942e47e8722d37ec4dcc1c8a78cf9c4a4030000000000000000bf92c09e8e37b2c8ffbb4b9cadfccc563e474c4feae6997f52d56236fedafce20a9f745609c40b1840cc27de04000000f2e372a0b5b837116eee8f968840393d85975a1531346807000000000000000076bc91399edda1de98976ee0774e2ad3b21dd38ad9f5f34d2c816a832747fe7f4c9e745609c40b18e290e9e000000000000000000000000000000000&quot;,
         &quot;refundAddress&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;to&quot;: &quot;0x6cc68eb482a757c690dd151d2bd5e774ada38bdc&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c041d40c06112a2bc4e80e24" role="button"
                   aria-expanded="false" aria-controls="id-c041d40c06112a2bc4e80e24">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_throw_outer_revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_throw_outer_revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/inner_throw_outer_revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c041d40c06112a2bc4e80e24"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_throw_outer_revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">index b11b8e040dd35e0b439ccf4b20f894f8b5ac9f46..bc9470871801a6f230dba9d8cdc855ef9708f6fe 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;inner_throw_outer_revert.json</span>
<span class="term-fg36">@@ -61,7 +61,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0xd4fcab9f0a6dc0493af47c864f6f17a8a5e2e826&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x78d9e&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x7dfa6&quot;,</span>
         &quot;input&quot;: &quot;0x&quot;,
         &quot;to&quot;: &quot;0x33056b5dcac09a9b4becad0e1dcf92c19bd0af76&quot;,
         &quot;value&quot;: &quot;0xe92596fd6290000&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a131299390e6ac9dee57465d" role="button"
                   aria-expanded="false" aria-controls="id-a131299390e6ac9dee57465d">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a131299390e6ac9dee57465d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create.json</span>
<span class="term-fg1">index 64425dbaddac4ada823ccd0b6caba1e615345db0..3fcc61fc806f5c15be80283e94de3bbde5c7ef65 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x3951c&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x53e90&quot;,</span>
         &quot;init&quot;: &quot;0x60606040525b60405161015b806102a0833901809050604051809103906000f0600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908302179055505b610247806100596000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900480632ef9db1314610044578063e37678761461007157610042565b005b61005b6004803590602001803590602001506100ad565b6040518082815260200191505060405180910390f35b61008860048035906020018035906020015061008a565b005b8060006000506000848152602001908152602001600020600050819055505b5050565b6000600060008484604051808381526020018281526020019250505060405180910390209150610120600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff167f6164640000000000000000000000000000000000000000000000000000000000846101e3565b9050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681868660405180807f616464000000000000000000000000000000000000000000000000000000000081526020015060200184815260200183815260200182815260200193505050506000604051808303816000866161da5a03f191505050600060005060008281526020019081526020016000206000505492506101db565b505092915050565b60004340848484604051808581526020018473ffffffffffffffffffffffffffffffffffffffff166c0100000000000000000000000002815260140183815260200182815260200194505050505060405180910390209050610240565b9392505050566060604052610148806100136000396000f30060606040526000357c010000000000000000000000000000000000000000000000000000000090048063471407e614610044578063e37678761461007757610042565b005b6100616004803590602001803590602001803590602001506100b3565b6040518082815260200191505060405180910390f35b61008e600480359060200180359060200150610090565b005b8060006000506000848152602001908152602001600020600050819055505b5050565b6000818301905080506100c684826100d5565b8090506100ce565b9392505050565b3373ffffffffffffffffffffffffffffffffffffffff16828260405180807f7265676973746572496e74000000000000000000000000000000000000000000815260200150602001838152602001828152602001925050506000604051808303816000866161da5a03f1915050505b505056&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c3c2199ce95c4cfa4eb9827d" role="button"
                   aria-expanded="false" aria-controls="id-c3c2199ce95c4cfa4eb9827d">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create2_action_gas.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create2_action_gas.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create2_action_gas.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c3c2199ce95c4cfa4eb9827d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create2_action_gas.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create2_action_gas.json</span>
<span class="term-fg1">index bbd9904d9c7ef919f8dd7c56e1fb96153848a046..0eaa3f867ab3f70867a73a65fa0154ec79bc0884 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create2_action_gas.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create2_action_gas.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf6c&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x19ed8&quot;,</span>
         &quot;init&quot;: &quot;0x6000600060006000f500&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-720f4bc9c9486b7ccaa51c45" role="button"
                   aria-expanded="false" aria-controls="id-720f4bc9c9486b7ccaa51c45">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_action_gas.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_action_gas.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_action_gas.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-720f4bc9c9486b7ccaa51c45"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_action_gas.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_action_gas.json</span>
<span class="term-fg1">index 19ae5fc5d3f0dd48867f3afe2dd801a486a0a767..132b84df361877326473dbc2b6b58baa73dcfd25 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_action_gas.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_action_gas.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x19ee4&quot;,</span>
         &quot;init&quot;: &quot;0x5a600055600060006000f0505a60015500&quot;
       },
       &quot;error&quot;: &quot;out of gas&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5fb6df3cf06f53ce6e0872ba" role="button"
                   aria-expanded="false" aria-controls="id-5fb6df3cf06f53ce6e0872ba">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_inerror.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_inerror.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_create_inerror.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5fb6df3cf06f53ce6e0872ba"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_inerror.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_inerror.json</span>
<span class="term-fg1">index a62d4bb64525e9c30db857aecea8f4b98b803811..28e96684b2df2fc3af6625df309fb6bf9d7ad7d3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_inerror.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_create_inerror.json</span>
<span class="term-fg36">@@ -61,7 +61,7 @@</span>       &quot;action&quot;: {
         &quot;from&quot;: &quot;0xa3b31cbd5168d3c99756660d4b7625d679e12573&quot;,
         &quot;to&quot;: &quot;0x76554b33410b6d90b7dc889bfed0451ad195f27e&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x2e138&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x33450&quot;,</span>
         &quot;input&quot;: &quot;0x391521f4&quot;,
         &quot;callType&quot;: &quot;call&quot;
       },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-87716fd14901c77801ee9d91" role="button"
                   aria-expanded="false" aria-controls="id-87716fd14901c77801ee9d91">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_pointer_issue.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_pointer_issue.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/nested_pointer_issue.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-87716fd14901c77801ee9d91"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_pointer_issue.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_pointer_issue.json</span>
<span class="term-fg1">index 792845538f98f04d9dfd8d96fd9496dd17f9895d..c3191d61bc4e553345d6f2fb2702de4a254faf63 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_pointer_issue.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;nested_pointer_issue.json</span>
<span class="term-fg36">@@ -99,7 +99,7 @@</span>   &quot;result&quot;: [
     {
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x5409ed021d9299bf6814279a6a1411a7e866a631&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x215c47&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x2c8c7f&quot;,</span>
         &quot;init&quot;: &quot;0x60806040523480156200001157600080fd5b5060405162002d2c38038062002d2c83398101806040526200003791908101906200051d565b6000805433600160a060020a031991821617825560018054909116600160a060020a0386161790558251849084908490849081906200007e906004906020870190620003d0565b50825162000094906005906020860190620003d0565b50620000b0836010640100000000620019476200036f82021704565b9150620000cd846010640100000000620019476200036f82021704565b60028054600160a060020a03948516600160a060020a031991821617909155600380549285169290911691909117905550600154604080517f4552433230546f6b656e28616464726573732900000000000000000000000000815290519081900360130181207f6070410800000000000000000000000000000000000000000000000000000000825291909216945063607041089350620001739250906004016200068e565b602060405180830381600087803b1580156200018e57600080fd5b505af1158015620001a3573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250620001c99190810190620004f4565b9050600160a060020a038116151562000219576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200021090620006b0565b60405180910390fd5b6002546040517f095ea7b3000000000000000000000000000000000000000000000000000000008152600160a060020a039091169063095ea7b39062000268908490600019906004016200066f565b602060405180830381600087803b1580156200028357600080fd5b505af115801562000298573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250620002be9190810190620005a1565b506003546040517f095ea7b3000000000000000000000000000000000000000000000000000000008152600160a060020a039091169063095ea7b3906200030e908490600019906004016200066f565b602060405180830381600087803b1580156200032957600080fd5b505af11580156200033e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250620003649190810190620005a1565b50505050506200077a565b600081601401835110151515620003b4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000210906200069e565b506014818301810151910190600160a060020a03165b92915050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200041357805160ff191683800117855562000443565b8280016001018555821562000443579182015b828111156200044357825182559160200191906001019062000426565b506200045192915062000455565b5090565b6200047291905b808211156200045157600081556001016200045c565b90565b600062000483825162000711565b9392505050565b600062000483825162000742565b6000601f82018313620004aa57600080fd5b8151620004c1620004bb82620006e9565b620006c2565b91508082526020830160208301858383011115620004de57600080fd5b620004eb83828462000747565b50505092915050565b6000602082840312156200050757600080fd5b600062000515848462000475565b949350505050565b6000806000606084860312156200053357600080fd5b600062000541868662000475565b93505060208401516001604060020a038111156200055e57600080fd5b6200056c8682870162000498565b92505060408401516001604060020a038111156200058957600080fd5b620005978682870162000498565b9150509250925092565b600060208284031215620005b457600080fd5b60006200051584846200048a565b620005cd8162000711565b82525050565b620005cd816200071d565b602681527f475245415445525f4f525f455155414c5f544f5f32305f4c454e4754485f524560208201527f5155495245440000000000000000000000000000000000000000000000000000604082015260600190565b601881527f554e524547495354455245445f41535345545f50524f58590000000000000000602082015260400190565b620005cd8162000472565b604081016200067f8285620005c2565b62000483602083018462000664565b60208101620003ca8284620005d3565b60208082528101620003ca81620005de565b60208082528101620003ca8162000634565b6040518181016001604060020a0381118282101715620006e157600080fd5b604052919050565b60006001604060020a038211156200070057600080fd5b506020601f91909101601f19160190565b600160a060020a031690565b7fffffffff000000000000000000000000000000000000000000000000000000001690565b151590565b60005b83811015620007645781810151838201526020016200074a565b8381111562000774576000848401525b50505050565b6125a2806200078a6000396000f30060806040526004361061006c5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166318978e8281146100c8578063630f1e6c146100f25780638da5cb5b146101125780639395525c14610134578063f2fde38b14610147575b60025473ffffffffffffffffffffffffffffffffffffffff1633146100c6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612388565b60405180910390fd5b005b6100db6100d6366004611df1565b610167565b6040516100e9929190612488565b60405180910390f35b3480156100fe57600080fd5b506100c661010d366004611eec565b6102f7565b34801561011e57600080fd5b50610127610388565b6040516100e99190612337565b6100db610142366004611d0b565b6103a4565b34801561015357600080fd5b506100c6610162366004611ce5565b61050a565b61016f6119fa565b6101776119fa565b6000806101826105bb565b60048054604080516020601f60027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff610100600188161502019095169490940493840181900481028201810190925282815261025c939092909183018282801561022d5780601f106102025761010080835404028352916020019161022d565b820191906000526020600020905b81548152906001019060200180831161021057829003601f168201915b50505050508c600081518110151561024157fe5b6020908102909101015161014001519063ffffffff61069616565b156102875761026c8b8b8b6107c3565b935061028084600001518560600151610ac1565b90506102ae565b6102928b8b8b610b03565b9350836060015191506102a68883896107c3565b845190935090505b6102c2846020015184602001518888610d15565b6102e98b60008151811015156102d457fe5b90602001906020020151610140015182610f29565b505097509795505050505050565b60005473ffffffffffffffffffffffffffffffffffffffff163314610348576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612438565b61038383838080601f01602080910402602001604051908101604052809392919081815260200183838082843750879450610f299350505050565b505050565b60005473ffffffffffffffffffffffffffffffffffffffff1681565b6103ac6119fa565b6103b46119fa565b60008060006103c16105bb565b60048054604080516020601f60027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6101006001881615020190951694909404938401819004810282018101909252828152610441939092909183018282801561022d5780601f106102025761010080835404028352916020019161022d565b156104925761046a670de0b6b3a7640000610464670de0b6b3a76400008a611045565b3461108f565b92506104778b848c6110e7565b945061048b85600001518660600151610ac1565b90506104d6565b6104ad670d2f13f7789f0000670de0b6b3a76400003461108f565b92506104ba8b848c6110e7565b9450846060015191506104ce89838a6107c3565b855190945090505b6104ea856020015185602001518989610d15565b6104fc8b60008151811015156102d457fe5b505050965096945050505050565b60005473ffffffffffffffffffffffffffffffffffffffff16331461055b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612438565b73ffffffffffffffffffffffffffffffffffffffff8116156105b857600080547fffffffffffffffffffffffff00000000000000000000000000000000000000001673ffffffffffffffffffffffffffffffffffffffff83161790555b50565b600034116105f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612398565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d0e30db0346040518263ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004016000604051808303818588803b15801561067b57600080fd5b505af115801561068f573d6000803e3d6000fd5b5050505050565b6000815183511480156107ba5750816040518082805190602001908083835b602083106106f257805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe090920191602091820191016106b5565b51815160209384036101000a7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0180199092169116179052604051919093018190038120885190955088945090928392508401908083835b6020831061078757805182527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0909201916020918201910161074a565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916145b90505b92915050565b6107cb6119fa565b60608060008060008060006107de6119fa565b8a15156107ea57610ab2565b6004805460408051602060026001851615610100027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0190941693909304601f8101849004840282018401909252818152929183018282801561088e5780601f106108635761010080835404028352916020019161088e565b820191906000526020600020905b81548152906001019060200180831161087157829003601f168201915b505060058054604080516020601f60027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6101006001881615020190951694909404938401819004810282018101909252828152969e509194509250840190508282801561093d5780601f106109125761010080835404028352916020019161093d565b820191906000526020600020905b81548152906001019060200180831161092057829003601f168201915b50505050509650600095508b519450600093505b838514610a7857878c8581518110151561096757fe5b6020908102909101015161014001528b5187908d908690811061098657fe5b60209081029091010151610160015261099f8b87610ac1565b9250610a068c858151811015156109b257fe5b9060200190602002015160a00151610a008e878151811015156109d157fe5b90602001906020020151608001518f888151811015156109ed57fe5b9060200190602002015160e00151610ac1565b8561128b565b9150610a418c85815181101515610a1957fe5b90602001906020020151838c87815181101515610a3257fe5b906020019060200201516112e6565b9050610a4d898261135e565b610a5f89600001518a60600151610ac1565b95508a8610610a6d57610a78565b600190930192610951565b8a861015610ab2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612418565b50505050505050509392505050565b600082821115610afd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123b8565b50900390565b610b0b6119fa565b606080600080600080610b1c6119fa565b60008b6000815181101515610b2d57fe5b6020908102919091018101516101400151600580546040805160026001841615610100027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0190931692909204601f8101869004860283018601909152808252929b5092909190830182828015610be55780601f10610bba57610100808354040283529160200191610be5565b820191906000526020600020905b815481529060010190602001808311610bc857829003601f168201915b505050505096508b519550600094505b848614610cdb57878c86815181101515610c0b57fe5b6020908102909101015161014001528b5187908d9087908110610c2a57fe5b6020908102909101015161016001528851610c46908c90610ac1565b9350610c898c86815181101515610c5957fe5b9060200190602002015160a001518d87815181101515610c7557fe5b90602001906020020151608001518661128b565b9250610cb58c86815181101515610c9c57fe5b90602001906020020151848c88815181101515610a3257fe5b9150610cc1898361135e565b5087518a8110610cd057610cdb565b600190940193610bf5565b8a811015610ab2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612418565b600080808066b1a2bc2ec50000861115610d5b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612448565b610d658888611045565b935034841115610da1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123a8565b610dab3485610ac1565b9250610dc086670de0b6b3a76400008a61108f565b915082821115610dfc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612428565b6000831115610f1f576002546040517f2e1a7d4d00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff90911690632e1a7d4d90610e5b9086906004016124a4565b600060405180830381600087803b158015610e7557600080fd5b505af1158015610e89573d6000803e3d6000fd5b505050506000821115610edb5760405173ffffffffffffffffffffffffffffffffffffffff86169083156108fc029084906000818181858888f19350505050158015610ed9573d6000803e3d6000fd5b505b610ee58383610ac1565b90506000811115610f1f57604051339082156108fc029083906000818181858888f19350505050158015610f1d573d6000803e3d6000fd5b505b5050505050505050565b6000610f3b838263ffffffff6113c016565b604080517f4552433230546f6b656e28616464726573732900000000000000000000000000815290519081900360130190209091507fffffffff0000000000000000000000000000000000000000000000000000000080831691161415610fab57610fa6838361142d565b610383565b604080517f455243373231546f6b656e28616464726573732c75696e7432353629000000008152905190819003601c0190207fffffffff000000000000000000000000000000000000000000000000000000008281169116141561101357610fa6838361161b565b6040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123f8565b600082820183811015611084576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123e8565b8091505b5092915050565b60008083116110ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123d8565b6110dd6110d78584611703565b8461175e565b90505b9392505050565b6110ef6119fa565b60608060008060006110ff6119fa565b89600081518110151561110e57fe5b6020908102919091018101516101400151600580546040805160026001841615610100027fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0190931692909204601f8101869004860283018601909152808252929950929091908301828280156111c65780601f1061119b576101008083540402835291602001916111c6565b820191906000526020600020905b8154815290600101906020018083116111a957829003601f168201915b5050505050945089519350600092505b82841461127e57858a848151811015156111ec57fe5b602090810290910101516101400152895185908b908590811061120b57fe5b90602001906020020151610160018190525061122b898860200151610ac1565b91506112578a8481518110151561123e57fe5b90602001906020020151838a86815181101515610a3257fe5b9050611263878261135e565b602087015189116112735761127e565b6001909201916111d6565b5050505050509392505050565b60008083116112c6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123d8565b6110dd6110d76112d68685611703565b6112e1866001610ac1565b611045565b6112ee6119fa565b606060006112fd868686611775565b600154815191935073ffffffffffffffffffffffffffffffffffffffff1691506080908390602082016000855af1801561135457825184526020830151602085015260408301516040850152606083015160608501525b5050509392505050565b8151815161136c9190611045565b8252602080830151908201516113829190611045565b60208301526040808301519082015161139b9190611045565b6040830152606080830151908201516113b49190611045565b60609092019190915250565b600081600401835110151515611402576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612468565b5001602001517fffffffff000000000000000000000000000000000000000000000000000000001690565b60008061144184601063ffffffff61194716565b604080517f7472616e7366657228616464726573732c75696e7432353629000000000000008152905190819003601901812091935073ffffffffffffffffffffffffffffffffffffffff8416919061149f903390879060240161236d565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff000000000000000000000000000000000000000000000000000000009094169390931783525181519192909182919080838360005b8381101561154357818101518382015260200161152b565b50505050905090810190601f1680156115705780820380516001836020036101000a031916815260200191505b509150506000604051808303816000865af1925050508015156115bf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612408565b3d156115dc575060003d602014156115dc5760206000803e506000515b801515611615576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612408565b50505050565b60008060018314611658576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612478565b61166984601063ffffffff61194716565b915061167c84602463ffffffff6119a816565b6040517f23b872dd00000000000000000000000000000000000000000000000000000000815290915073ffffffffffffffffffffffffffffffffffffffff8316906323b872dd906116d590309033908690600401612345565b600060405180830381600087803b1580156116ef57600080fd5b505af1158015610f1f573d6000803e3d6000fd5b6000808315156117165760009150611088565b5082820282848281151561172657fe5b0414611084576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123e8565b600080828481151561176c57fe5b04949350505050565b604080517fb4be83d5000000000000000000000000000000000000000000000000000000006020808301919091526060602483018181528751608485019081528884015160a48601529488015160c48501529087015160e4840152608087015161010484015260a087015161012484015260c087015161014484015260e08701516101648401526101008701516101848401526101208701516101a4840152610140870180516101c485019081526101608901516101e4860152610180905251805161020485018190529394919384936044870192849261022489019291820191601f82010460005b8181101561187c57835185526020948501949093019260010161185e565b50505050818103610160808401919091528a0151805180835260209283019291820191601f82010460005b818110156118c55783518552602094850194909301926001016118a7565b50505089845250848103602093840190815288518083529093918201918981019190601f82010460005b8181101561190d5783518552602094850194909301926001016118ef565b5050507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08883030188525060405250505050509392505050565b600081601401835110151515611989576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd90612458565b50016014015173ffffffffffffffffffffffffffffffffffffffff1690565b60006107ba83836000816020018351101515156119f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100bd906123c8565b50016020015190565b608060405190810160405280600081526020016000815260200160008152602001600081525090565b60006107ba8235612540565b6000601f82018313611a4057600080fd5b8135611a53611a4e826124d9565b6124b2565b81815260209384019390925082018360005b83811015611a915781358601611a7b8882611b41565b8452506020928301929190910190600101611a65565b5050505092915050565b6000601f82018313611aac57600080fd5b8135611aba611a4e826124d9565b81815260209384019390925082018360005b83811015611a915781358601611ae28882611b90565b8452506020928301929190910190600101611acc565b600080601f83018413611b0a57600080fd5b50813567ffffffffffffffff811115611b2257600080fd5b602083019150836001820283011115611b3a57600080fd5b9250929050565b6000601f82018313611b5257600080fd5b8135611b60611a4e826124fa565b91508082526020830160208301858383011115611b7c57600080fd5b611b8783828461255c565b50505092915050565b60006101808284031215611ba357600080fd5b611bae6101806124b2565b90506000611bbc8484611a23565b8252506020611bcd84848301611a23565b6020830152506040611be184828501611a23565b6040830152506060611bf584828501611a23565b6060830152506080611c0984828501611cd9565b60808301525060a0611c1d84828501611cd9565b60a08301525060c0611c3184828501611cd9565b60c08301525060e0611c4584828501611cd9565b60e083015250610100611c5a84828501611cd9565b61010083015250610120611c7084828501611cd9565b6101208301525061014082013567ffffffffffffffff811115611c9257600080fd5b611c9e84828501611b41565b6101408301525061016082013567ffffffffffffffff811115611cc057600080fd5b611ccc84828501611b41565b6101608301525092915050565b60006107ba8235612559565b600060208284031215611cf757600080fd5b6000611d038484611a23565b949350505050565b60008060008060008060c08789031215611d2457600080fd5b863567ffffffffffffffff811115611d3b57600080fd5b611d4789828a01611a9b565b965050602087013567ffffffffffffffff811115611d6457600080fd5b611d7089828a01611a2f565b955050604087013567ffffffffffffffff811115611d8d57600080fd5b611d9989828a01611a9b565b945050606087013567ffffffffffffffff811115611db657600080fd5b611dc289828a01611a2f565b9350506080611dd389828a01611cd9565b92505060a0611de489828a01611a23565b9150509295509295509295565b600080600080600080600060e0888a031215611e0c57600080fd5b873567ffffffffffffffff811115611e2357600080fd5b611e2f8a828b01611a9b565b9750506020611e408a828b01611cd9565b965050604088013567ffffffffffffffff811115611e5d57600080fd5b611e698a828b01611a2f565b955050606088013567ffffffffffffffff811115611e8657600080fd5b611e928a828b01611a9b565b945050608088013567ffffffffffffffff811115611eaf57600080fd5b611ebb8a828b01611a2f565b93505060a0611ecc8a828b01611cd9565b92505060c0611edd8a828b01611a23565b91505092959891949750929550565b600080600060408486031215611f0157600080fd5b833567ffffffffffffffff811115611f1857600080fd5b611f2486828701611af8565b93509350506020611f3786828701611cd9565b9150509250925092565b611f4a81612540565b82525050565b602381527f44454641554c545f46554e4354494f4e5f574554485f434f4e54524143545f4f60208201527f4e4c590000000000000000000000000000000000000000000000000000000000604082015260600190565b601181527f494e56414c49445f4d53475f56414c5545000000000000000000000000000000602082015260400190565b600d81527f4f564552534f4c445f5745544800000000000000000000000000000000000000602082015260400190565b601181527f55494e543235365f554e444552464c4f57000000000000000000000000000000602082015260400190565b602681527f475245415445525f4f525f455155414c5f544f5f33325f4c454e4754485f524560208201527f5155495245440000000000000000000000000000000000000000000000000000604082015260600190565b601081527f4449564953494f4e5f42595f5a45524f00000000000000000000000000000000602082015260400190565b601081527f55494e543235365f4f564552464c4f5700000000000000000000000000000000602082015260400190565b601781527f554e535550504f525445445f41535345545f50524f5859000000000000000000602082015260400190565b600f81527f5452414e534645525f4641494c45440000000000000000000000000000000000602082015260400190565b601481527f434f4d504c4554455f46494c4c5f4641494c4544000000000000000000000000602082015260400190565b601a81527f494e53554646494349454e545f4554485f52454d41494e494e47000000000000602082015260400190565b601381527f4f4e4c595f434f4e54524143545f4f574e455200000000000000000000000000602082015260400190565b601881527f4645455f50455243454e544147455f544f4f5f4c415247450000000000000000602082015260400190565b602681527f475245415445525f4f525f455155414c5f544f5f32305f4c454e4754485f524560208201527f5155495245440000000000000000000000000000000000000000000000000000604082015260600190565b602581527f475245415445525f4f525f455155414c5f544f5f345f4c454e4754485f52455160208201527f5549524544000000000000000000000000000000000000000000000000000000604082015260600190565b600e81527f494e56414c49445f414d4f554e54000000000000000000000000000000000000602082015260400190565b805160808301906122f9848261232e565b50602082015161230c602085018261232e565b50604082015161231f604085018261232e565b50606082015161161560608501825b611f4a81612559565b602081016107bd8284611f41565b606081016123538286611f41565b6123606020830185611f41565b611d03604083018461232e565b6040810161237b8285611f41565b6110e0602083018461232e565b602080825281016107bd81611f50565b602080825281016107bd81611fa6565b602080825281016107bd81611fd6565b602080825281016107bd81612006565b602080825281016107bd81612036565b602080825281016107bd8161208c565b602080825281016107bd816120bc565b602080825281016107bd816120ec565b602080825281016107bd8161211c565b602080825281016107bd8161214c565b602080825281016107bd8161217c565b602080825281016107bd816121ac565b602080825281016107bd816121dc565b602080825281016107bd8161220c565b602080825281016107bd81612262565b602080825281016107bd816122b8565b610100810161249782856122e8565b6110e060808301846122e8565b602081016107bd828461232e565b60405181810167ffffffffffffffff811182821017156124d157600080fd5b604052919050565b600067ffffffffffffffff8211156124f057600080fd5b5060209081020190565b600067ffffffffffffffff82111561251157600080fd5b506020601f919091017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0160190565b73ffffffffffffffffffffffffffffffffffffffff1690565b90565b828183375060009101525600a265627a7a72305820d9f418f11e0f91f06f6f9d22924be0add925495eeb76a6388b5417adb505eeb36c6578706572696d656e74616cf5003700000000000000000000000048bacb9266a570d521063ef5dd96e61686dbe788000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000024f47261b0000000000000000000000000871dd7c2b4b25e1aa18728e9d5f2af4c4e431f5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024f47261b00000000000000000000000000b1ba0af832d7c05fd64161e0db78e85978e808200000000000000000000000000000000000000000000000000000000&quot;,
         &quot;value&quot;: &quot;0x0&quot;
       },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dc33050d65d25b249e617450" role="button"
                   aria-expanded="false" aria-controls="id-dc33050d65d25b249e617450">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/oog.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/oog.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/oog.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc33050d65d25b249e617450"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;oog.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;oog.json</span>
<span class="term-fg1">index 26ae2f0604b5dc9e0cbbeb18156d740e1d57c346..bd6059faefa122d45b5e9d5553d7ddd6ad5d05cf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;oog.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;oog.json</span>
<span class="term-fg36">@@ -52,7 +52,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x94194bc2aaf494501d7880b61274a169f6502a54&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x7045&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0xca1d&quot;,</span>
         &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f9000&quot;,
         &quot;to&quot;: &quot;0x43064693d3d38ad6a7cb579e0d6d9718c8aa6b62&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-52f6e0178736291ecf28478d" role="button"
                   aria-expanded="false" aria-controls="id-52f6e0178736291ecf28478d">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/option_convert_parity_errors.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/option_convert_parity_errors.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/option_convert_parity_errors.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-52f6e0178736291ecf28478d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;option_convert_parity_errors.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;option_convert_parity_errors.json</span>
<span class="term-fg1">index 0216c318b55a62461752cc7167e4279655ad2d6c..8888d3e68a82d6eee8530799f4cf55b373270867 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;option_convert_parity_errors.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;option_convert_parity_errors.json</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x94194bc2aaf494501d7880b61274a169f6502a54&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x7045&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0xca1d&quot;,</span>
         &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f9000&quot;,
         &quot;to&quot;: &quot;0x43064693d3d38ad6a7cb579e0d6d9718c8aa6b62&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1e0780ab534b480fc5f16aa4" role="button"
                   aria-expanded="false" aria-controls="id-1e0780ab534b480fc5f16aa4">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/result_output.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/result_output.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/result_output.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1e0780ab534b480fc5f16aa4"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;result_output.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;result_output.json</span>
<span class="term-fg1">index f58d20cd2b0475b8af0f9f52b09622e7ab7bc080..62baf333b6e3db4a042c68497b199d19a7f948b1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;result_output.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;result_output.json</span>
<span class="term-fg36">@@ -68,7 +68,7 @@</span>       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;to&quot;: &quot;0x531f76bad925f6a925474996c7d738c1008045f6&quot;,
         &quot;value&quot;: &quot;0xde0b6b3a7640000&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x3b920&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x40b28&quot;,</span>
         &quot;input&quot;: &quot;0x&quot;,
         &quot;callType&quot;: &quot;call&quot;
       },</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-880f1233f37b216ac4a638fc" role="button"
                   aria-expanded="false" aria-controls="id-880f1233f37b216ac4a638fc">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-880f1233f37b216ac4a638fc"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert.json</span>
<span class="term-fg1">index 897aebb0e05bf2a7141a3c8a58c153fe248c3d2f..b0346d860399bb7bcd69c8c12ca0d994bb4c410f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert.json</span>
<span class="term-fg36">@@ -50,7 +50,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x0f6cef2b7fbb504782e35aa82a2207e816a2b7a9&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x2d55e8&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
         &quot;input&quot;: &quot;0x73b40a5c000000000000000000000000400de2e016bda6577407dfc379faba9899bc73ef0000000000000000000000002cc31912b2b0f3075a87b3640923d45a26cef3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d79d8e6c7265636f76657279416464726573730000000000000000000000000000000000000000000000000000000000383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988383e3ec32dc0f66d8fe60dbdc2f6815bdf73a98800000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
         &quot;to&quot;: &quot;0xabbcd5b340c80b5f1c0545c04c987b87310296ae&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a087808b7b0cb854e424d358" role="button"
                   aria-expanded="false" aria-controls="id-a087808b7b0cb854e424d358">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert_reason.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert_reason.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/revert_reason.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a087808b7b0cb854e424d358"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert_reason.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert_reason.json</span>
<span class="term-fg1">index 62dbaf20dc9421bb3ddf0a133dc64993cbb0f3ed..6759b05e520638b747d27379680a7d2d663442ba 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert_reason.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;revert_reason.json</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0xf7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x2d7308&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
         &quot;input&quot;: &quot;0x5c19a95c000000000000000000000000f7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
         &quot;to&quot;: &quot;0xf58833cf0c791881b494eb79d461e08a1f043f52&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b1507a511a14f3080fa8c08c" role="button"
                   aria-expanded="false" aria-controls="id-b1507a511a14f3080fa8c08c">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/selfdestruct.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/selfdestruct.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/selfdestruct.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b1507a511a14f3080fa8c08c"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;selfdestruct.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;selfdestruct.json</span>
<span class="term-fg1">index cd34d0b6d063e17c7d6661672f0261e74a5b975c..74fd87cc6c4d3d3f9d195d36e46c804e1926c2a4 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;selfdestruct.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;selfdestruct.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xcf08&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x19ecc&quot;,</span>
         &quot;init&quot;: &quot;0x605a600053600160006001f0ff00&quot;
       },
       &quot;result&quot;: {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d3d4abbee2df6c67311758d0" role="button"
                   aria-expanded="false" aria-controls="id-d3d4abbee2df6c67311758d0">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/simple.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/simple.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/simple.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d3d4abbee2df6c67311758d0"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;simple.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;simple.json</span>
<span class="term-fg1">index 6d084410a366089765aca9677bfc6edcc2ae86b0..a7244e97470e10844ad5c1bc625e1ca49c3a3ffd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;simple.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;simple.json</span>
<span class="term-fg36">@@ -61,7 +61,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x15f90&quot;,</span>
         &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
         &quot;to&quot;: &quot;0x3b873a919aa0512d5a0f09e6dcceaa4a6727fafe&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-909b0ba3ffae468f61e79486" role="button"
                   aria-expanded="false" aria-controls="id-909b0ba3ffae468f61e79486">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/skip_no_balance_error.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/skip_no_balance_error.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/skip_no_balance_error.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-909b0ba3ffae468f61e79486"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;skip_no_balance_error.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;skip_no_balance_error.json</span>
<span class="term-fg1">index d530fe908b2a2f3ed109e128fab52a2cc62f96ab..96060d554539cef15460e83736d8aa922edb5607 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;skip_no_balance_error.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;skip_no_balance_error.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>       &quot;type&quot;: &quot;create&quot;,
       &quot;action&quot;: {
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
         &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0xd550&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x1aab0&quot;,</span>
         &quot;init&quot;: &quot;0x7f000000000000000000000000945304eb96065b2a98b57a48a06ae28d285a71b57f000000000000000000000000000000000000000000000000000000000000c3507f000000000000000000000000945304eb96065b2a98b57a48a06ae28d285a71b5547f000000000000000000000000000000000000000000000000000000000000c3507f000000000000000000000000000000000000000000000000000000000000c3507f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000037f055&quot;
       },
       &quot;error&quot;: &quot;out of gas&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9119c826c52848e8ca424d23" role="button"
                   aria-expanded="false" aria-controls="id-9119c826c52848e8ca424d23">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/staticcall_precompiled.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/staticcall_precompiled.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/staticcall_precompiled.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9119c826c52848e8ca424d23"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;staticcall_precompiled.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;staticcall_precompiled.json</span>
<span class="term-fg1">index 9291149bdb691a6136c431815b366f251b1b5d7c..45ffbe2db975d7ac1b52bbb26364ff08f0e6b950 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;staticcall_precompiled.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;staticcall_precompiled.json</span>
<span class="term-fg36">@@ -65,7 +65,7 @@</span>         &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;balance&quot;: &quot;0x0&quot;,
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x4053e&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x48196&quot;,</span>
         &quot;input&quot;: &quot;0x200b1e64000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000001b9af799918107e9a339eba0584b8b60b35aae6f087c74f6bfc00c9301849b204d094ed65e09c76c2597f5516f9440aad2921e50dde096e7caaa65a536d4d9265e00000000000000000000000000000000000000000000000000000000000000504269747669657720697320616e20616d617a696e6720776562736974652e20596f752073686f756c6420646566696e6974656c792061646420796f75722070726f6475637420746f2069742e20e282bf00000000000000000000000000000000&quot;,
         &quot;refundAddress&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
         &quot;to&quot;: &quot;0x8521f13dd5e4bc3dab3cf0f01a195a5af899e851&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fc198219d7f133b17b4fad35" role="button"
                   aria-expanded="false" aria-controls="id-fc198219d7f133b17b4fad35">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/suicide.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/suicide.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/suicide.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fc198219d7f133b17b4fad35"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;suicide.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;suicide.json</span>
<span class="term-fg1">index bd9e057c02297be88694cfe9656a2bc3544f8428..16d43767d55252ea25b6eb0310b68812e56366d8 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;suicide.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;suicide.json</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x877bd459c9b7d8576b44e59e09d076c25946f443&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x445708&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x44aa20&quot;,</span>
         &quot;input&quot;: &quot;0x41c0e1b5&quot;,
         &quot;to&quot;: &quot;0x8ee79c5b3f6e1d214d2c4fcf7ea4092a32e26e91&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-37381778671a95856378247f" role="button"
                   aria-expanded="false" aria-controls="id-37381778671a95856378247f">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_flat/throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_flat/throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-37381778671a95856378247f"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;throw.json</span>
<span class="term-fg1">index b119bed5289a199c4aed683b54583d264b0da13e..a001178a42c7b7207759aac366b2b3780294afea 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;throw.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>     {
       &quot;action&quot;: {
         &quot;callType&quot;: &quot;call&quot;,
         &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-        &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x3d090&quot;,</span>
         &quot;input&quot;: &quot;0x51a34eb8000000000000000000000000000000000000000000000027fad02094277c0000&quot;,
         &quot;to&quot;: &quot;0xc212e03b9e060e36facad5fd8f4435412ca22e6b&quot;,
         &quot;value&quot;: &quot;0x0&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b5864152fedeed02cc4a79ff" role="button"
                   aria-expanded="false" aria-controls="id-b5864152fedeed02cc4a79ff">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/create.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/create.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/create.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b5864152fedeed02cc4a79ff"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;create.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;create.json</span>
<span class="term-fg1">index 8557f8efd69bb1be8da7a897f956119c3b30d6f9..df0b2872b48b65f203071a346844750d45e48d44 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;create.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;create.json</span>
<span class="term-fg36">@@ -47,7 +47,7 @@</span>   },
   &quot;input&quot;: &quot;0xf907ef098504e3b29200830897be8080b9079c606060405260405160208061077c83398101604052808051906020019091905050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415151561007d57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460006101000a81548160ff02191690831515021790555050610653806101296000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029000000000000000000000000c65e620a3a55451316168d57e268f5702ef56a1129a01060f46676a5dff6f407f0f51eb6f37f5c8c54e238c70221e18e65fc29d3ea65a0557b01c50ff4ffaac8ed6e5d31237a4ecbac843ab1bfe8bb0165a0060df7c54f&quot;,
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x13e4acefe6a6700604929946e70e6443e4e73447&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x5e106&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x897be&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x897be&quot;,
     &quot;input&quot;: &quot;0x606060405260405160208061077c83398101604052808051906020019091905050600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415151561007d57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600460006101000a81548160ff02191690831515021790555050610653806101296000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029000000000000000000000000c65e620a3a55451316168d57e268f5702ef56a11&quot;,
     &quot;output&quot;: &quot;0x606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305e4382a146100855780631c02708d146100ae5780632e1a7d4d146100c35780635114cb52146100e6578063a37dda2c146100fe578063ae200e7914610153578063b5769f70146101a8575b005b341561009057600080fd5b6100986101d1565b6040518082815260200191505060405180910390f35b34156100b957600080fd5b6100c16101d7565b005b34156100ce57600080fd5b6100e460048080359060200190919050506102eb565b005b6100fc6004808035906020019091905050610513565b005b341561010957600080fd5b6101116105d6565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561015e57600080fd5b6101666105fc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156101b357600080fd5b6101bb610621565b6040518082815260200191505060405180910390f35b60025481565b60011515600460009054906101000a900460ff1615151415156101f957600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806102a15750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156102ac57600080fd5b6000600460006101000a81548160ff0219169083151502179055506003543073ffffffffffffffffffffffffffffffffffffffff163103600281905550565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806103935750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561039e57600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141561048357600060025411801561040757506002548111155b151561041257600080fd5b80600254036002819055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561047e57600080fd5b610510565b600060035411801561049757506003548111155b15156104a257600080fd5b8060035403600381905550600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050f57600080fd5b5b50565b60011515600460009054906101000a900460ff16151514151561053557600080fd5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614801561059657506003548160035401115b80156105bd575080600354013073ffffffffffffffffffffffffffffffffffffffff163110155b15156105c857600080fd5b806003540160038190555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600354815600a165627a7a72305820c3b849e8440987ce43eae3097b77672a69234d516351368b03fe5b7de03807910029&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d22b78a691decdabc70720d1" role="button"
                   aria-expanded="false" aria-controls="id-d22b78a691decdabc70720d1">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/deep_calls.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/deep_calls.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/deep_calls.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d22b78a691decdabc70720d1"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;deep_calls.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;deep_calls.json</span>
<span class="term-fg1">index ef28a930b3bc9744681a880194dacf06b29997a7..80fc0b0ada6821cca676e2b2f8778e0cb8915518 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;deep_calls.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;deep_calls.json</span>
<span class="term-fg36">@@ -404,7 +404,7 @@</span>         &quot;value&quot;: &quot;0x0&quot;
       }
     ],
     &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x3d090&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x1810b&quot;,
     &quot;input&quot;: &quot;0x51a34eb80000000000000000000000000000000000000000000000280faf689c35ac0000&quot;,
     &quot;output&quot;: &quot;0x&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-35cf35402bd49d4de25b33df" role="button"
                   aria-expanded="false" aria-controls="id-35cf35402bd49d4de25b33df">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/delegatecall.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/delegatecall.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/delegatecall.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-35cf35402bd49d4de25b33df"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;delegatecall.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;delegatecall.json</span>
<span class="term-fg1">index c4c1390fa257d4790aa592e60bc504f8d785359e..2cd28bacc4b0c227a500038ea22dd48e115770f3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;delegatecall.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;delegatecall.json</span>
<span class="term-fg36">@@ -86,7 +86,7 @@</span>         &quot;value&quot;: &quot;0x0&quot;
       }
     ],
     &quot;from&quot;: &quot;0xa529806c67cc6486d4d62024471772f47f6fd672&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d6e28&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xbd55&quot;,
     &quot;input&quot;: &quot;0x7065cb480000000000000000000000001523e55a1ca4efbae03355775ae89f8d7699ad9e&quot;,
     &quot;output&quot;: &quot;0x&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6329296f9d872799dc35f768" role="button"
                   aria-expanded="false" aria-controls="id-6329296f9d872799dc35f768">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_create_oog_outer_throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_create_oog_outer_throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_create_oog_outer_throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6329296f9d872799dc35f768"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_create_oog_outer_throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">index 0b60e34d0e11958eb01778f5196e860200d87232..07fda21d4b354fdd14d3b34c1b7b42bade24cd7a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_create_oog_outer_throw.json</span>
<span class="term-fg36">@@ -67,7 +67,7 @@</span>       }
     ],
     &quot;error&quot;: &quot;invalid jump destination&quot;,
     &quot;from&quot;: &quot;0xe4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x435c8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x493e0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x493e0&quot;,
     &quot;input&quot;: &quot;0x3b91f506000000000000000000000000a14bdd7e5666d784dcce98ad24d383a6b1cd4182000000000000000000000000e4a13bc304682a903e9472f469c33801dd18d9e8&quot;,
     &quot;to&quot;: &quot;0x1d3ddf7caf024f253487e18bc4a15b1a360c170a&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c724cd6544ef17378fa095f6" role="button"
                   aria-expanded="false" aria-controls="id-c724cd6544ef17378fa095f6">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_instafail.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_instafail.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_instafail.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c724cd6544ef17378fa095f6"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_instafail.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_instafail.json</span>
<span class="term-fg1">index c1ed766ef902f76e857c682cbbbce47e5629f8c7..16e4136230483c6685f1a404bb05401fac6d9dcd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_instafail.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_instafail.json</span>
<span class="term-fg36">@@ -54,7 +54,7 @@</span>     &quot;type&quot;: &quot;CALL&quot;,
     &quot;from&quot;: &quot;0x66fdfd05e46126a07465ad24e40cc0597bc1ef31&quot;,
     &quot;to&quot;: &quot;0x6c06b16512b332e6cd8293a2974872674716ce18&quot;,
     &quot;value&quot;: &quot;0x0&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x1a466&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x1f97e&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x72de&quot;,
     &quot;input&quot;: &quot;0x2e1a7d4d00000000000000000000000000000000000000000000000014d1120d7b160000&quot;,
     &quot;output&quot;: &quot;0x&quot;,
<span class="term-fg36">@@ -64,7 +64,7 @@</span>         &quot;type&quot;: &quot;CALL&quot;,
         &quot;from&quot;: &quot;0x6c06b16512b332e6cd8293a2974872674716ce18&quot;,
         &quot;to&quot;: &quot;0x66fdfd05e46126a07465ad24e40cc0597bc1ef31&quot;,
         &quot;value&quot;: &quot;0x14d1120d7b160000&quot;,
<span class="term-fg31">-        &quot;error&quot;:&quot;internal failure&quot;,</span>
<span class="term-fg32">+        &quot;error&quot;:  &quot;internal failure&quot;,</span>
         &quot;input&quot;: &quot;0x&quot;
       }
     ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f9a3791d23e408890e88a795" role="button"
                   aria-expanded="false" aria-controls="id-f9a3791d23e408890e88a795">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_throw_outer_revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_throw_outer_revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/inner_throw_outer_revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f9a3791d23e408890e88a795"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_throw_outer_revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">index 2be2dee23f262ed03fe6a4e1d136b83aff8c299e..a023ed6d9bd7c093c3bbe997272eb47b6444f39c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_throw_outer_revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;inner_throw_outer_revert.json</span>
<span class="term-fg36">@@ -71,7 +71,7 @@</span>       }
     ],
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0xd4fcab9f0a6dc0493af47c864f6f17a8a5e2e826&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x78d9e&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x7dfa6&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x7c1c8&quot;,
     &quot;input&quot;: &quot;0x&quot;,
     &quot;to&quot;: &quot;0x33056b5dcac09a9b4becad0e1dcf92c19bd0af76&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e6b9e132c9b0d9bdd0116ecc" role="button"
                   aria-expanded="false" aria-controls="id-e6b9e132c9b0d9bdd0116ecc">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/oog.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/oog.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/oog.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e6b9e132c9b0d9bdd0116ecc"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;oog.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;oog.json</span>
<span class="term-fg1">index 8022f53a992d3876116243e714d86810aac20fbc..333bdd038cf5b18fc6e00f86be9aef2dd62eb2e0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;oog.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;oog.json</span>
<span class="term-fg36">@@ -50,7 +50,7 @@</span>   &quot;input&quot;: &quot;0xf8ab820109855d21dba00082ca1d9443064693d3d38ad6a7cb579e0d6d9718c8aa6b6280b844a9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f90001ba0ce3ad83f5530136467b7c2bb225f406bd170f4ad59c254e5103c34eeabb5bd69a0455154527224a42ab405cacf0fe92918a75641ce4152f8db292019a5527aa956&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;out of gas&quot;,
     &quot;from&quot;: &quot;0x94194bc2aaf494501d7880b61274a169f6502a54&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x7045&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0xca1d&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xca1d&quot;,
     &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000e77b1ac803616503510bed0086e3a7be2627a69900000000000000000000000000000000000000000000000000000009502f9000&quot;,
     &quot;to&quot;: &quot;0x43064693d3d38ad6a7cb579e0d6d9718c8aa6b62&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e455b409153b0016ff5e5f3b" role="button"
                   aria-expanded="false" aria-controls="id-e455b409153b0016ff5e5f3b">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e455b409153b0016ff5e5f3b"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert.json</span>
<span class="term-fg1">index aee894d11fdeaac58d94ceee75abb651628dbd78..3207a298a98bb501776810f12a7824dcd19c46c9 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert.json</span>
<span class="term-fg36">@@ -48,7 +48,7 @@</span>   &quot;input&quot;: &quot;0xf9018b0a8505d21dba00832dc6c094abbcd5b340c80b5f1c0545c04c987b87310296ae80b9012473b40a5c000000000000000000000000400de2e016bda6577407dfc379faba9899bc73ef0000000000000000000000002cc31912b2b0f3075a87b3640923d45a26cef3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d79d8e6c7265636f76657279416464726573730000000000000000000000000000000000000000000000000000000000383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988000000000000000000000000000000000000000000000000000000000000000000000000000000001ba0fd659d76a4edbd2a823e324c93f78ad6803b30ff4a9c8bce71ba82798975c70ca06571eecc0b765688ec6c78942c5ee8b585e00988c0141b518287e9be919bc48a&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0x0f6cef2b7fbb504782e35aa82a2207e816a2b7a9&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d55e8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x719b&quot;,
     &quot;input&quot;: &quot;0x73b40a5c000000000000000000000000400de2e016bda6577407dfc379faba9899bc73ef0000000000000000000000002cc31912b2b0f3075a87b3640923d45a26cef3ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d79d8e6c7265636f76657279416464726573730000000000000000000000000000000000000000000000000000000000383e3ec32dc0f66d8fe60dbdc2f6815bdf73a988383e3ec32dc0f66d8fe60dbdc2f6815bdf73a98800000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
     &quot;to&quot;: &quot;0xabbcd5b340c80b5f1c0545c04c987b87310296ae&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-53e7e1d32b77c9182be30e46" role="button"
                   aria-expanded="false" aria-controls="id-53e7e1d32b77c9182be30e46">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert_reason.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert_reason.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/revert_reason.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-53e7e1d32b77c9182be30e46"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert_reason.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert_reason.json</span>
<span class="term-fg1">index 4f7fee97d930042f0e235ad698b2d9c724b38393..5c7e5629e9d695e91c0dcd37078c4951281e6778 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert_reason.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;revert_reason.json</span>
<span class="term-fg36">@@ -53,7 +53,7 @@</span>   &quot;input&quot;: &quot;0xf888068449504f80832dc6c094f58833cf0c791881b494eb79d461e08a1f043f5280a45c19a95c000000000000000000000000f7579c3d8a669c89d5ed246a22eb6db8f6fedbf12da0264664db3e71fae1dbdaf2f53954be149ad3b7ba8a5054b4d89c70febfacc8b1a0212e8398757963f419681839ae8c5a54b411e252473c82d93dda68405ca63294&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;execution reverted&quot;,
     &quot;from&quot;: &quot;0xf7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2d7308&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x5940&quot;,
     &quot;input&quot;: &quot;0x5c19a95c000000000000000000000000f7579c3d8a669c89d5ed246a22eb6db8f6fedbf1&quot;,
     &quot;to&quot;: &quot;0xf58833cf0c791881b494eb79d461e08a1f043f52&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-549093ba3155b69c4dce1fbf" role="button"
                   aria-expanded="false" aria-controls="id-549093ba3155b69c4dce1fbf">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/selfdestruct.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/selfdestruct.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/selfdestruct.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-549093ba3155b69c4dce1fbf"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;selfdestruct.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;selfdestruct.json</span>
<span class="term-fg1">index 55b63dbdb6c9bae48dd73e6f6bacdb7289e11c5e..11b23a990e9e5d889c44c55c14586bc279925d14 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;selfdestruct.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;selfdestruct.json</span>
<span class="term-fg36">@@ -62,7 +62,7 @@</span>         &quot;value&quot;: &quot;0x4d87094125a369d9bd5&quot;
       }
     ],
     &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x15f90&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x6fcb&quot;,
     &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
     &quot;output&quot;: &quot;0x&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ae1ab3675017618c9fdebb26" role="button"
                   aria-expanded="false" aria-controls="id-ae1ab3675017618c9fdebb26">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/simple.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/simple.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/simple.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ae1ab3675017618c9fdebb26"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;simple.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;simple.json</span>
<span class="term-fg1">index c9192a19f923aea2d98718ef916fc0aff68455da..37723f17dd6b5aa94c37ee29116494a3d6b6c65e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;simple.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;simple.json</span>
<span class="term-fg36">@@ -67,7 +67,7 @@</span>         &quot;value&quot;: &quot;0x6f05b59d3b20000&quot;
       }
     ],
     &quot;from&quot;: &quot;0xb436ba50d378d4bbc8660d312a13df6af6e89dfb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x10738&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x15f90&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x9751&quot;,
     &quot;input&quot;: &quot;0x63e4bff40000000000000000000000000024f658a46fbb89d8ac105e98d7ac7cbbaf27c5&quot;,
     &quot;output&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-aaa94e95255d6d371dbc6cf8" role="button"
                   aria-expanded="false" aria-controls="id-aaa94e95255d6d371dbc6cf8">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_legacy/throw.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/throw.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_legacy/throw.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-aaa94e95255d6d371dbc6cf8"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;throw.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;throw.json</span>
<span class="term-fg1">index 76fae3c392b33b244adf364fb218cb6f881acc6d..499b449a6ecef658f2a59f57ae817a457ef30a5c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;throw.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_legacy&#47;throw.json</span>
<span class="term-fg36">@@ -52,7 +52,7 @@</span>   &quot;input&quot;: &quot;0xf88b8206668504a817c8008303d09094c212e03b9e060e36facad5fd8f4435412ca22e6b80a451a34eb8000000000000000000000000000000000000000000000027fad02094277c000029a0692a3b4e7b2842f8dd7832e712c21e09f451f416c8976d5b8d02e8c0c2b4bea9a07645e90fc421b63dd755767fd93d3c03b4ec0c4d8fafa059558d08cf11d59750&quot;,
   &quot;result&quot;: {
     &quot;error&quot;: &quot;invalid jump destination&quot;,
     &quot;from&quot;: &quot;0x70c9217d814985faef62b124420f8dfbddd96433&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x37b38&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x3d090&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x3d090&quot;,
     &quot;input&quot;: &quot;0x51a34eb8000000000000000000000000000000000000000000000027fad02094277c0000&quot;,
     &quot;to&quot;: &quot;0xc212e03b9e060e36facad5fd8f4435412ca22e6b&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-43fb7840b76bbd1e8a97665d" role="button"
                   aria-expanded="false" aria-controls="id-43fb7840b76bbd1e8a97665d">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/calldata.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/calldata.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/calldata.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-43fb7840b76bbd1e8a97665d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;calldata.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;calldata.json</span>
<span class="term-fg1">index b18c80e58ec51d6074dfdd646de29a138cee43e7..9264f1e2fdf3607053424d3e47d13eec40da6a35 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;calldata.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;calldata.json</span>
<span class="term-fg36">@@ -77,7 +77,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x4f5777744b500616697cb655dcb02ee6cd51deb5&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2dced&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x33085&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x1a9e5&quot;,
     &quot;to&quot;: &quot;0x200edd17f30485a8735878661960cd7a9a95733f&quot;,
     &quot;input&quot;: &quot;0xba51a6df0000000000000000000000000000000000000000000000000000000000000000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2e67c0d2655f38d458daf227" role="button"
                   aria-expanded="false" aria-controls="id-2e67c0d2655f38d458daf227">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/delegatecall.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/delegatecall.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/delegatecall.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2e67c0d2655f38d458daf227"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;delegatecall.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;delegatecall.json</span>
<span class="term-fg1">index 2c82138022ec9e66b98a66403794edd77ac4aec3..f63dbd47dc5c68f91ba425729aefd141716c3f95 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;delegatecall.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;delegatecall.json</span>
<span class="term-fg36">@@ -134,7 +134,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x3de712784baf97260455ae25fb74f574ec9c1add&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x7e2c0&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x84398&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x27ec3&quot;,
     &quot;to&quot;: &quot;0x6ca7f214ab2ddbb9a8e1a1e2c8550e3164e9dba5&quot;,
     &quot;input&quot;: &quot;0xbbd4f854e9efd3ab89acad6a3edf9828c3b00ed1c4a74e974d05d32d3b2fb15aa16fc3770000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000080d29fa5cccfadac&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9813dd363a256e4e8dcae174" role="button"
                   aria-expanded="false" aria-controls="id-9813dd363a256e4e8dcae174">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multi_contracts.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multi_contracts.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multi_contracts.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9813dd363a256e4e8dcae174"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multi_contracts.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multi_contracts.json</span>
<span class="term-fg1">index 649a5b1b566d33079b009e5991ffa0160b5bcd58..5e5d9538672e4e6e5af96b2e8a59ac14a59c93b4 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multi_contracts.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multi_contracts.json</span>
<span class="term-fg36">@@ -299,7 +299,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0xbe3ae5cb97c253dda67181c6e34e43f5c275e08b&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x3514c8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x3567e0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x26e1ef&quot;,
     &quot;to&quot;: &quot;0x03e3d4561a8f8e975fdcd798d32857a20cf25e7e&quot;,
     &quot;input&quot;: &quot;0xbe9a6555&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c514d0a86e03df63b97c3a3c" role="button"
                   aria-expanded="false" aria-controls="id-c514d0a86e03df63b97c3a3c">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multilogs.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multilogs.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/multilogs.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c514d0a86e03df63b97c3a3c"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multilogs.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multilogs.json</span>
<span class="term-fg1">index 858931558a994998c3d6125e2597c708b5861040..1ffffd240e7dc6c6651b78792fab83a0bbd4eaa3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multilogs.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;multilogs.json</span>
<span class="term-fg36">@@ -167,7 +167,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x3fcb0342353c541e210013aaddc2e740b9a33d08&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2b0868&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x2dc6c0&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x2570bf&quot;,
     &quot;to&quot;: &quot;0x350e0ffc780a6a75b44cc52e1ff9092870668945&quot;,
     &quot;input&quot;: &quot;0xe021fadb000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000006e00000000000000000000000000000000000000000000000000000000000000d4000000000000000000000000000000000000000000000000000000000000013a00000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002ff000000000000000000000000000000000000000000000000000000000000034100000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fe000000000000000000000000000000000000000000000000000000000000034200000000000000000000000000000000000000000000000000000000000002fd000000000000000000000000000000000000000000000000000000000000034300000000000000000000000000000000000000000000000000000000000002fd0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003900000000000000000000000000000000000000000000000000000000000000360000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003a00000000000000000000000000000000000000000000000000000000000000350000000000000000000000000000000000000000000000000000000000000035000000000000000000000000000000000000000000000000000000000000003b000000000000000000000000000000000000000000000000000000000000003b00000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000003d000000000000000000000000000000000000000000000000000000000000003d00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003e000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000003700000000000000000000000000000000000000000000000000000000000000370000000000000000000000000000000000000000000000000000000000000039000000000000000000000000000000000000000000000000000000000000003900000000000000000000000000000000000000000000000000000000000000360000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003a00000000000000000000000000000000000000000000000000000000000000350000000000000000000000000000000000000000000000000000000000000035000000000000000000000000000000000000000000000000000000000000003b000000000000000000000000000000000000000000000000000000000000003b00000000000000000000000000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000330000000000000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000003d000000000000000000000000000000000000000000000000000000000000003d00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000003e000000000000000000000000000000000000000000000000000000000000003e0000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000003800000000000000000000000000000000000000000000000000000000000000370000000000000000000000000000000000000000000000000000000000000032fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefefefffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfdfdffffffffffffffffffffffffffffffffffffffffffffffffffffffffffebebebffffffffffffffffffffffffffffffffffffffffffffffffffffffffff888888ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb3b3b3fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcfcfcffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe3e3e3ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff3e3e3effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdbdbdbfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4f4f4fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbfbfbffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb0b0b0fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefefeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa0a0a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5b5b5bffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbababaffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeaeaeaffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa9a9a9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb9b9b9fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbfbfbfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefefefffffffffffffffffffffffffffffffffffffffffffffffffffffffffffefefeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffbababaffffffffffffffffffffffffffffffffffffffffffffffffffffffffff636363fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9f9f9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeaeaeaffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9c9c9cfffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8f8f8fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfdfdfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcfcfcfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfdfdffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4d4e53ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff4f494b00000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e080000000000000000000000000000000000000000000000000000011c37937e08000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8def1a9dff3e106521fc7802" role="button"
                   aria-expanded="false" aria-controls="id-8def1a9dff3e106521fc7802">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/notopic.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/notopic.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/notopic.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8def1a9dff3e106521fc7802"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;notopic.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;notopic.json</span>
<span class="term-fg1">index 09aa7af461e0ba3bb25b6051c3eb24a652faf09c..116606b3c7e5f2ec84bd67541286a26166f00aed 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;notopic.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;notopic.json</span>
<span class="term-fg36">@@ -102,7 +102,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x6412becf35cc7e2a9e7e47966e443f295e1e4f4a&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2bb38&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x30d40&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x249eb&quot;,
     &quot;to&quot;: &quot;0x50739060a2c32dc076e507ae1a893aab28ecfe68&quot;,
     &quot;input&quot;: &quot;0x&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e8f2a3c572ac5b282c08e7ef" role="button"
                   aria-expanded="false" aria-controls="id-e8f2a3c572ac5b282c08e7ef">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/simple.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/simple.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/simple.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e8f2a3c572ac5b282c08e7ef"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;simple.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;simple.json</span>
<span class="term-fg1">index 1a03f0e7fb28d6bc8091cae80bf53976ce6708fc..30f1777067ef31a99b27e894467367ef799f5fd1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;simple.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;simple.json</span>
<span class="term-fg36">@@ -63,7 +63,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0xd1220a0cf47c7b9be7a2e6ba89f429762e7b9adb&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x1f36d&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x24d45&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xc6a5&quot;,
     &quot;to&quot;: &quot;0xf4eced2f682ce333f96f2d8966c613ded8fc95dd&quot;,
     &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000dbf03b407c01e7cd3cbea99509d93f8dddc8c6fb0000000000000000000000000000000000000000000000000000000000989680&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-42c837ead56bb9ff896aebec" role="button"
                   aria-expanded="false" aria-controls="id-42c837ead56bb9ff896aebec">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_failed.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_failed.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_failed.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-42c837ead56bb9ff896aebec"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_failed.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_failed.json</span>
<span class="term-fg1">index 4e0aec529f0a74696fdf54c0edd68bcc6b7776b2..30346d07f1ff71cf7c54d13f0f88bc30b655e6eb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_failed.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_failed.json</span>
<span class="term-fg36">@@ -137,7 +137,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0xe6002189a74b43e6868b20c1311bc108e38aac57&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0xa59c8&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0xaae60&quot;,</span>
     &quot;gasUsed&quot;: &quot;0xaae60&quot;,
     &quot;to&quot;: &quot;0x630a0cd35d5bd57e61410fda76fea850225cda18&quot;,
     &quot;input&quot;: &quot;0xe1fa763800000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d0aead36626d8a8fc273211" role="button"
                   aria-expanded="false" aria-controls="id-9d0aead36626d8a8fc273211">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_partial_failed.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_partial_failed.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/tx_partial_failed.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d0aead36626d8a8fc273211"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_partial_failed.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_partial_failed.json</span>
<span class="term-fg1">index 8df52db23c851112a8650f3d3ca5d32251a83049..eb2514427c917eea2c81ef3f9131a935656c92c7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_partial_failed.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;tx_partial_failed.json</span>
<span class="term-fg36">@@ -75,7 +75,7 @@</span>     &quot;withLog&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x01115b41bd2731353dd3e6abf44818fdc035aaf1&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x28e28&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x30d40&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x288c9&quot;,
     &quot;to&quot;: &quot;0xcf1476387d780169410d4e936d75a206fda2a68c&quot;,
     &quot;input&quot;: &quot;0xb61d27f6000000000000000000000000bb9bc244d798123fde783fcc1c72d3bb8c18941300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000008861393035396362623030303030303030303030303030303030303030303030303930643363313831326465323636396266383037626437373538636562316533343937616337653430303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303031633662663532363334303030000000000000000000000000000000000000000000000000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-078d96be7f12dda5f9b62b16" role="button"
                   aria-expanded="false" aria-controls="id-078d96be7f12dda5f9b62b16">
                    <code>eth/tracers/internal/tracetest/testdata/call_tracer_withLog/with_onlyTopCall.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/with_onlyTopCall.json" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/internal/tracetest/testdata/call_tracer_withLog/with_onlyTopCall.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-078d96be7f12dda5f9b62b16"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;with_onlyTopCall.json op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;with_onlyTopCall.json</span>
<span class="term-fg1">index c805296adb02fa92d29a5023d349577232b6d9b5..e73081107f61c1d8473a23abd89b98aea9ed7ca3 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;with_onlyTopCall.json</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_withLog&#47;with_onlyTopCall.json</span>
<span class="term-fg36">@@ -78,7 +78,7 @@</span>     &quot;onlyTopCall&quot;: true
   },
   &quot;result&quot;: {
     &quot;from&quot;: &quot;0x4f5777744b500616697cb655dcb02ee6cd51deb5&quot;,
<span class="term-fg31">-    &quot;gas&quot;: &quot;0x2dced&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x33085&quot;,</span>
     &quot;gasUsed&quot;: &quot;0x1a9e5&quot;,
     &quot;to&quot;: &quot;0x200edd17f30485a8735878661960cd7a9a95733f&quot;,
     &quot;input&quot;: &quot;0xba51a6df0000000000000000000000000000000000000000000000000000000000000000&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3a28958b5f154596dbdb748b" role="button"
                   aria-expanded="false" aria-controls="id-3a28958b5f154596dbdb748b">
                    <code>eth/tracers/js/goja.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/js/goja.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/js/goja.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-19</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3a28958b5f154596dbdb748b"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;js&#47;goja.go op-geth&#47;eth&#47;tracers&#47;js&#47;goja.go</span>
<span class="term-fg1">index 8e52f5b210777505815345f7f43fac532804e22f..2a2789e93d314ee966cb6088ed4cc45ffb58c0f9 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;js&#47;goja.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;js&#47;goja.go</span>
<span class="term-fg36">@@ -32,10 +32,6 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&quot;
 	jsassets &quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;tracers&#47;js&#47;internal&#47;tracers&quot;
 )
&nbsp;
<span class="term-fg31">-const (</span>
<span class="term-fg31">-	memoryPadLimit = 1024 * 1024</span>
<span class="term-fg31">-)</span>
<span class="term-fg31">-</span>
 var assetTracers = make(map[string]string)
&nbsp;
 &#47;&#47; init retrieves the JavaScript transaction tracers included in go-ethereum.
<span class="term-fg36">@@ -239,7 +235,7 @@</span> 	}
 	t.ctx[&quot;from&quot;] = t.vm.ToValue(from.Bytes())
 	t.ctx[&quot;to&quot;] = t.vm.ToValue(to.Bytes())
 	t.ctx[&quot;input&quot;] = t.vm.ToValue(input)
<span class="term-fg31">-	t.ctx[&quot;gas&quot;] = t.vm.ToValue(gas)</span>
<span class="term-fg32">+	t.ctx[&quot;gas&quot;] = t.vm.ToValue(t.gasLimit)</span>
 	t.ctx[&quot;gasPrice&quot;] = t.vm.ToValue(env.TxContext.GasPrice)
 	valueBig, err := t.toBig(t.vm, value.String())
 	if err != nil {
<span class="term-fg36">@@ -571,14 +567,10 @@</span> 	}
 	if end &lt; begin || begin &lt; 0 {
 		return nil, fmt.Errorf(&quot;tracer accessed out of bound memory: offset %d, end %d&quot;, begin, end)
 	}
<span class="term-fg31">-	mlen := mo.memory.Len()</span>
<span class="term-fg31">-	if end-int64(mlen) &gt; memoryPadLimit {</span>
<span class="term-fg31">-		return nil, fmt.Errorf(&quot;tracer reached limit for padding memory slice: end %d, memorySize %d&quot;, end, mlen)</span>
<span class="term-fg32">+	slice, err := tracers.GetMemoryCopyPadded(mo.memory, begin, end-begin)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
 	}
<span class="term-fg31">-	slice := make([]byte, end-begin)</span>
<span class="term-fg31">-	end = min(end, int64(mo.memory.Len()))</span>
<span class="term-fg31">-	ptr := mo.memory.GetPtr(begin, end-begin)</span>
<span class="term-fg31">-	copy(slice[:], ptr[:])</span>
 	return slice, nil
 }
&nbsp;
<span class="term-fg36">@@ -959,10 +951,3 @@</span> 	o.Set(&quot;memory&quot;, l.memory.setupObject())
 	o.Set(&quot;contract&quot;, l.contract.setupObject())
 	return o
 }
<span class="term-fg31">-</span>
<span class="term-fg31">-func min(a, b int64) int64 {</span>
<span class="term-fg31">-	if a &lt; b {</span>
<span class="term-fg31">-		return a</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	return b</span>
<span class="term-fg31">-}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0d9ad2b4c50a4aa700958753" role="button"
                   aria-expanded="false" aria-controls="id-0d9ad2b4c50a4aa700958753">
                    <code>eth/tracers/js/tracer_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/js/tracer_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/js/tracer_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0d9ad2b4c50a4aa700958753"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;js&#47;tracer_test.go op-geth&#47;eth&#47;tracers&#47;js&#47;tracer_test.go</span>
<span class="term-fg1">index 524d1747493041aa56e2bf225e92e443cc06e4a4..bf6427faf673ff3e83a1a11f63607186bf9f7604 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;js&#47;tracer_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;js&#47;tracer_test.go</span>
<span class="term-fg36">@@ -62,7 +62,7 @@</span> }
&nbsp;
 func runTrace(tracer tracers.Tracer, vmctx *vmContext, chaincfg *params.ChainConfig, contractCode []byte) (json.RawMessage, error) {
 	var (
<span class="term-fg31">-		env             = vm.NewEVM(vmctx.blockCtx, vmctx.txCtx, &amp;dummyStatedb{}, chaincfg, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+		env             = vm.NewEVM(vmctx.blockCtx, vmctx.txCtx, &amp;dummyStatedb{}, chaincfg, vm.Config{Tracer: tracer})</span>
 		gasLimit uint64 = 31000
 		startGas uint64 = 10000
 		value           = big.NewInt(0)
<span class="term-fg36">@@ -150,12 +150,12 @@</span> 			contract: []byte{byte(vm.PUSH1), byte(0xff), byte(vm.PUSH1), byte(0x00), byte(vm.MSTORE8), byte(vm.STOP)},
 		}, {
 			code:     &quot;{res: [], step: function(log) { if (log.op.toString() === &#39;STOP&#39;) { this.res.push(log.memory.slice(5, 1025 * 1024)) } }, fault: function() {}, result: function() { return this.res }}&quot;,
 			want:     &quot;&quot;,
<span class="term-fg31">-			fail:     &quot;tracer reached limit for padding memory slice: end 1049600, memorySize 32 at step (&lt;eval&gt;:1:83(20))    in server-side tracer function &#39;step&#39;&quot;,</span>
<span class="term-fg32">+			fail:     &quot;reached limit for padding memory slice: 1049568 at step (&lt;eval&gt;:1:83(20))    in server-side tracer function &#39;step&#39;&quot;,</span>
 			contract: []byte{byte(vm.PUSH1), byte(0xff), byte(vm.PUSH1), byte(0x00), byte(vm.MSTORE8), byte(vm.STOP)},
 		},
 	} {
 		if have, err := execTracer(tt.code, tt.contract); tt.want != string(have) || tt.fail != err {
<span class="term-fg31">-			t.Errorf(&quot;testcase %d: expected return value to be &#39;%s&#39; got &#39;%s&#39;, error to be &#39;%s&#39; got &#39;%s&#39;\n\tcode: %v&quot;, i, tt.want, string(have), tt.fail, err, tt.code)</span>
<span class="term-fg32">+			t.Errorf(&quot;testcase %d: expected return value to be \n&#39;%s&#39;\n\tgot\n&#39;%s&#39;\nerror to be\n&#39;%s&#39;\n\tgot\n&#39;%s&#39;\n\tcode: %v&quot;, i, tt.want, string(have), tt.fail, err, tt.code)</span>
 		}
 	}
 }
<span class="term-fg36">@@ -180,7 +180,7 @@</span> 	tracer, err := newJsTracer(&quot;{step: function() {}, fault: function() {}, result: function() { return null; }}&quot;, nil, nil)
 	if err != nil {
 		t.Fatal(err)
 	}
<span class="term-fg31">-	env := vm.NewEVM(vm.BlockContext{BlockNumber: big.NewInt(1)}, vm.TxContext{GasPrice: big.NewInt(1)}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+	env := vm.NewEVM(vm.BlockContext{BlockNumber: big.NewInt(1)}, vm.TxContext{GasPrice: big.NewInt(1)}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Tracer: tracer})</span>
 	scope := &amp;vm.ScopeContext{
 		Contract: vm.NewContract(&amp;account{}, &amp;account{}, big.NewInt(0), 0),
 	}
<span class="term-fg36">@@ -204,7 +204,7 @@</span> 		tracer, err := newJsTracer(code, nil, nil)
 		if err != nil {
 			t.Fatal(err)
 		}
<span class="term-fg31">-		env := vm.NewEVM(vm.BlockContext{BlockNumber: big.NewInt(1)}, vm.TxContext{GasPrice: big.NewInt(100)}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+		env := vm.NewEVM(vm.BlockContext{BlockNumber: big.NewInt(1)}, vm.TxContext{GasPrice: big.NewInt(100)}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Tracer: tracer})</span>
 		tracer.CaptureStart(env, common.Address{}, common.Address{}, false, []byte{}, 1000, big.NewInt(0))
 		tracer.CaptureEnd(nil, 0, nil)
 		ret, err := tracer.GetResult()
<span class="term-fg36">@@ -229,7 +229,7 @@</span> 	}
 }
&nbsp;
 func TestIsPrecompile(t *testing.T) {
<span class="term-fg31">-	chaincfg := &amp;params.ChainConfig{ChainID: big.NewInt(1), HomesteadBlock: big.NewInt(0), DAOForkBlock: nil, DAOForkSupport: false, EIP150Block: big.NewInt(0), EIP150Hash: common.Hash{}, EIP155Block: big.NewInt(0), EIP158Block: big.NewInt(0), ByzantiumBlock: big.NewInt(100), ConstantinopleBlock: big.NewInt(0), PetersburgBlock: big.NewInt(0), IstanbulBlock: big.NewInt(200), MuirGlacierBlock: big.NewInt(0), BerlinBlock: big.NewInt(300), LondonBlock: big.NewInt(0), TerminalTotalDifficulty: nil, Ethash: new(params.EthashConfig), Clique: nil}</span>
<span class="term-fg32">+	chaincfg := &amp;params.ChainConfig{ChainID: big.NewInt(1), HomesteadBlock: big.NewInt(0), DAOForkBlock: nil, DAOForkSupport: false, EIP150Block: big.NewInt(0), EIP155Block: big.NewInt(0), EIP158Block: big.NewInt(0), ByzantiumBlock: big.NewInt(100), ConstantinopleBlock: big.NewInt(0), PetersburgBlock: big.NewInt(0), IstanbulBlock: big.NewInt(200), MuirGlacierBlock: big.NewInt(0), BerlinBlock: big.NewInt(300), LondonBlock: big.NewInt(0), TerminalTotalDifficulty: nil, Ethash: new(params.EthashConfig), Clique: nil}</span>
 	chaincfg.ByzantiumBlock = big.NewInt(100)
 	chaincfg.IstanbulBlock = big.NewInt(200)
 	chaincfg.BerlinBlock = big.NewInt(300)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-60c23f1aa3815d3bc54b742d" role="button"
                   aria-expanded="false" aria-controls="id-60c23f1aa3815d3bc54b742d">
                    <code>eth/tracers/logger/logger.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/logger/logger.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/logger/logger.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-60c23f1aa3815d3bc54b742d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;logger&#47;logger.go op-geth&#47;eth&#47;tracers&#47;logger&#47;logger.go</span>
<span class="term-fg1">index 5e75318b9a92af8c866c204b7afdb1364b995957..c7f171c5bdf924b966474f9e43fff0bf9951f706 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;logger&#47;logger.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;logger&#47;logger.go</span>
<span class="term-fg36">@@ -116,8 +116,8 @@</span> 	err      error
 	gasLimit uint64
 	usedGas  uint64
&nbsp;
<span class="term-fg31">-	interrupt uint32 &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg31">-	reason    error  &#47;&#47; Textual reason for the interruption</span>
<span class="term-fg32">+	interrupt atomic.Bool &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg32">+	reason    error       &#47;&#47; Textual reason for the interruption</span>
 }
&nbsp;
 &#47;&#47; NewStructLogger returns a new logger
<span class="term-fg36">@@ -149,7 +149,7 @@</span> &#47;&#47;
 &#47;&#47; CaptureState also tracks SLOAD&#47;SSTORE ops to track storage change.
 func (l *StructLogger) CaptureState(pc uint64, op vm.OpCode, gas, cost uint64, scope *vm.ScopeContext, rData []byte, depth int, err error) {
 	&#47;&#47; If tracing was interrupted, set the error and stop
<span class="term-fg31">-	if atomic.LoadUint32(&amp;l.interrupt) &gt; 0 {</span>
<span class="term-fg32">+	if l.interrupt.Load() {</span>
 		return
 	}
 	&#47;&#47; check if already accumulated the specified number of logs
<span class="term-fg36">@@ -258,7 +258,7 @@</span>
 &#47;&#47; Stop terminates execution of the tracer at the first opportune moment.
 func (l *StructLogger) Stop(err error) {
 	l.reason = err
<span class="term-fg31">-	atomic.StoreUint32(&amp;l.interrupt, 1)</span>
<span class="term-fg32">+	l.interrupt.Store(true)</span>
 }
&nbsp;
 func (l *StructLogger) CaptureTxStart(gasLimit uint64) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0e092cfeec2ba50c084cf9da" role="button"
                   aria-expanded="false" aria-controls="id-0e092cfeec2ba50c084cf9da">
                    <code>eth/tracers/logger/logger_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/logger/logger_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/logger/logger_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0e092cfeec2ba50c084cf9da"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;logger&#47;logger_test.go op-geth&#47;eth&#47;tracers&#47;logger&#47;logger_test.go</span>
<span class="term-fg1">index 1bc7456d31c64b4c15cb60d49e623f77cac72ace..bde43e5ff71abcf86761fa6f352eb9194430a722 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;logger&#47;logger_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;logger&#47;logger_test.go</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span>
 func TestStoreCapture(t *testing.T) {
 	var (
 		logger   = NewStructLogger(nil)
<span class="term-fg31">-		env      = vm.NewEVM(vm.BlockContext{}, vm.TxContext{}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Debug: true, Tracer: logger})</span>
<span class="term-fg32">+		env      = vm.NewEVM(vm.BlockContext{}, vm.TxContext{}, &amp;dummyStatedb{}, params.TestChainConfig, vm.Config{Tracer: logger})</span>
 		contract = vm.NewContract(&amp;dummyContractRef{}, &amp;dummyContractRef{}, new(big.Int), 100000)
 	)
 	contract.Code = []byte{byte(vm.PUSH1), 0x1, byte(vm.PUSH1), 0x0, byte(vm.SSTORE)}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f6aac48772b7ab181e7ed699" role="button"
                   aria-expanded="false" aria-controls="id-f6aac48772b7ab181e7ed699">
                    <code>eth/tracers/native/4byte.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/native/4byte.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/native/4byte.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f6aac48772b7ab181e7ed699"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;native&#47;4byte.go op-geth&#47;eth&#47;tracers&#47;native&#47;4byte.go</span>
<span class="term-fg1">index 1b4649baa33ea81ec9ca1c95bd1c2006a9e1fbbd..5a2c4f91115f72eb57b9fbb4fb6ac0fd93653e7c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;native&#47;4byte.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;native&#47;4byte.go</span>
<span class="term-fg36">@@ -48,7 +48,7 @@</span> &#47;&#47;	}
 type fourByteTracer struct {
 	noopTracer
 	ids               map[string]int   &#47;&#47; ids aggregates the 4byte ids found
<span class="term-fg31">-	interrupt         uint32           &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg32">+	interrupt         atomic.Bool      &#47;&#47; Atomic flag to signal execution interruption</span>
 	reason            error            &#47;&#47; Textual reason for the interruption
 	activePrecompiles []common.Address &#47;&#47; Updated on CaptureStart based on given rules
 }
<span class="term-fg36">@@ -93,7 +93,7 @@</span>
 &#47;&#47; CaptureEnter is called when EVM enters a new scope (via call, create or selfdestruct).
 func (t *fourByteTracer) CaptureEnter(op vm.OpCode, from common.Address, to common.Address, input []byte, gas uint64, value *big.Int) {
 	&#47;&#47; Skip if tracing was interrupted
<span class="term-fg31">-	if atomic.LoadUint32(&amp;t.interrupt) &gt; 0 {</span>
<span class="term-fg32">+	if t.interrupt.Load() {</span>
 		return
 	}
 	if len(input) &lt; 4 {
<span class="term-fg36">@@ -124,7 +124,7 @@</span>
 &#47;&#47; Stop terminates execution of the tracer at the first opportune moment.
 func (t *fourByteTracer) Stop(err error) {
 	t.reason = err
<span class="term-fg31">-	atomic.StoreUint32(&amp;t.interrupt, 1)</span>
<span class="term-fg32">+	t.interrupt.Store(true)</span>
 }
&nbsp;
 func bytesToHex(s []byte) string {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7da50c7f1a5d63e11d471d60" role="button"
                   aria-expanded="false" aria-controls="id-7da50c7f1a5d63e11d471d60">
                    <code>eth/tracers/native/call.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/native/call.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/native/call.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+16</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7da50c7f1a5d63e11d471d60"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;native&#47;call.go op-geth&#47;eth&#47;tracers&#47;native&#47;call.go</span>
<span class="term-fg1">index 02ee152a5aa1a77e0bd99fb76332cd994c172335..4ac03e512fb751961d9c213b060912b32e665056 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;native&#47;call.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;native&#47;call.go</span>
<span class="term-fg36">@@ -102,8 +102,8 @@</span> 	noopTracer
 	callstack []callFrame
 	config    callTracerConfig
 	gasLimit  uint64
<span class="term-fg31">-	interrupt uint32 &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg31">-	reason    error  &#47;&#47; Textual reason for the interruption</span>
<span class="term-fg32">+	interrupt atomic.Bool &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg32">+	reason    error       &#47;&#47; Textual reason for the interruption</span>
 }
&nbsp;
 type callTracerConfig struct {
<span class="term-fg36">@@ -133,7 +133,7 @@</span> 		Type:  vm.CALL,
 		From:  from,
 		To:    &amp;toCopy,
 		Input: common.CopyBytes(input),
<span class="term-fg31">-		Gas:   gas,</span>
<span class="term-fg32">+		Gas:   t.gasLimit,</span>
 		Value: value,
 	}
 	if create {
<span class="term-fg36">@@ -148,6 +148,10 @@</span> }
&nbsp;
 &#47;&#47; CaptureState implements the EVMLogger interface to trace a single step of VM execution.
 func (t *callTracer) CaptureState(pc uint64, op vm.OpCode, gas, cost uint64, scope *vm.ScopeContext, rData []byte, depth int, err error) {
<span class="term-fg32">+	&#47;&#47; skip if the previous op caused an error</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Only logs need to be captured via opcode processing
 	if !t.config.WithLog {
 		return
<span class="term-fg36">@@ -157,7 +161,7 @@</span> 	if t.config.OnlyTopCall &amp;&amp; depth &gt; 0 {
 		return
 	}
 	&#47;&#47; Skip if tracing was interrupted
<span class="term-fg31">-	if atomic.LoadUint32(&amp;t.interrupt) &gt; 0 {</span>
<span class="term-fg32">+	if t.interrupt.Load() {</span>
 		return
 	}
 	switch op {
<span class="term-fg36">@@ -176,7 +180,12 @@</span> 			topic := stackData[len(stackData)-2-(i+1)]
 			topics[i] = common.Hash(topic.Bytes32())
 		}
&nbsp;
<span class="term-fg31">-		data := scope.Memory.GetCopy(int64(mStart.Uint64()), int64(mSize.Uint64()))</span>
<span class="term-fg32">+		data, err := tracers.GetMemoryCopyPadded(scope.Memory, int64(mStart.Uint64()), int64(mSize.Uint64()))</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			&#47;&#47; mSize was unrealistically large</span>
<span class="term-fg32">+			return</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
 		log := callLog{Address: scope.Contract.Address(), Topics: topics, Data: hexutil.Bytes(data)}
 		t.callstack[len(t.callstack)-1].Logs = append(t.callstack[len(t.callstack)-1].Logs, log)
 	}
<span class="term-fg36">@@ -188,7 +197,7 @@</span> 	if t.config.OnlyTopCall {
 		return
 	}
 	&#47;&#47; Skip if tracing was interrupted
<span class="term-fg31">-	if atomic.LoadUint32(&amp;t.interrupt) &gt; 0 {</span>
<span class="term-fg32">+	if t.interrupt.Load() {</span>
 		return
 	}
&nbsp;
<span class="term-fg36">@@ -253,7 +262,7 @@</span>
 &#47;&#47; Stop terminates execution of the tracer at the first opportune moment.
 func (t *callTracer) Stop(err error) {
 	t.reason = err
<span class="term-fg31">-	atomic.StoreUint32(&amp;t.interrupt, 1)</span>
<span class="term-fg32">+	t.interrupt.Store(true)</span>
 }
&nbsp;
 &#47;&#47; clearFailedLogs clears the logs of a callframe and all its children</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-792617ea7304c4b99de4f1cb" role="button"
                   aria-expanded="false" aria-controls="id-792617ea7304c4b99de4f1cb">
                    <code>eth/tracers/native/prestate.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/native/prestate.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/native/prestate.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-792617ea7304c4b99de4f1cb"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;native&#47;prestate.go op-geth&#47;eth&#47;tracers&#47;native&#47;prestate.go</span>
<span class="term-fg1">index 948d09ef767c1be1040768141123cfb04b8b25ce..b71d5d62152d2f2915fdc00b06b6e3e6c11dd9fb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;native&#47;prestate.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;native&#47;prestate.go</span>
<span class="term-fg36">@@ -62,8 +62,8 @@</span> 	create    bool
 	to        common.Address
 	gasLimit  uint64 &#47;&#47; Amount of gas bought for the whole tx
 	config    prestateTracerConfig
<span class="term-fg31">-	interrupt uint32 &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg31">-	reason    error  &#47;&#47; Textual reason for the interruption</span>
<span class="term-fg32">+	interrupt atomic.Bool &#47;&#47; Atomic flag to signal execution interruption</span>
<span class="term-fg32">+	reason    error       &#47;&#47; Textual reason for the interruption</span>
 	created   map[common.Address]bool
 	deleted   map[common.Address]bool
 }
<span class="term-fg36">@@ -133,6 +133,13 @@</span> }
&nbsp;
 &#47;&#47; CaptureState implements the EVMLogger interface to trace a single step of VM execution.
 func (t *prestateTracer) CaptureState(pc uint64, op vm.OpCode, gas, cost uint64, scope *vm.ScopeContext, rData []byte, depth int, err error) {
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Skip if tracing was interrupted</span>
<span class="term-fg32">+	if t.interrupt.Load() {</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
 	stack := scope.Stack
 	stackData := stack.Data()
 	stackLen := len(stackData)
<span class="term-fg36">@@ -256,7 +263,7 @@</span>
 &#47;&#47; Stop terminates execution of the tracer at the first opportune moment.
 func (t *prestateTracer) Stop(err error) {
 	t.reason = err
<span class="term-fg31">-	atomic.StoreUint32(&amp;t.interrupt, 1)</span>
<span class="term-fg32">+	t.interrupt.Store(true)</span>
 }
&nbsp;
 &#47;&#47; lookupAccount fetches details of an account and adds it to the prestate</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6b255a2a318e267ddd72765d" role="button"
                   aria-expanded="false" aria-controls="id-6b255a2a318e267ddd72765d">
                    <code>eth/tracers/tracers.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/tracers.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/tracers.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+25</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6b255a2a318e267ddd72765d"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;tracers.go op-geth&#47;eth&#47;tracers&#47;tracers.go</span>
<span class="term-fg1">index 856f52a10de382e6743cbbdcb5c06b67b90c7cd3..023f73ef3708b5f0ae59129f588b3a0ccb226992 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;tracers.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;tracers.go</span>
<span class="term-fg36">@@ -19,6 +19,7 @@</span> package tracers
&nbsp;
 import (
 	&quot;encoding&#47;json&quot;
<span class="term-fg32">+	&quot;fmt&quot;</span>
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -95,3 +96,27 @@</span> 	}
 	&#47;&#47; JS eval will execute JS code
 	return true
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+const (</span>
<span class="term-fg32">+	memoryPadLimit = 1024 * 1024</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetMemoryCopyPadded returns offset + size as a new slice.</span>
<span class="term-fg32">+&#47;&#47; It zero-pads the slice if it extends beyond memory bounds.</span>
<span class="term-fg32">+func GetMemoryCopyPadded(m *vm.Memory, offset, size int64) ([]byte, error) {</span>
<span class="term-fg32">+	if offset &lt; 0 || size &lt; 0 {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;offset or size must not be negative&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if int(offset+size) &lt; m.Len() { &#47;&#47; slice fully inside memory</span>
<span class="term-fg32">+		return m.GetCopy(offset, size), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	paddingNeeded := int(offset+size) - m.Len()</span>
<span class="term-fg32">+	if paddingNeeded &gt; memoryPadLimit {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;reached limit for padding memory slice: %d&quot;, paddingNeeded)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	cpy := make([]byte, size)</span>
<span class="term-fg32">+	if overlap := int64(m.Len()) - offset; overlap &gt; 0 {</span>
<span class="term-fg32">+		copy(cpy, m.GetPtr(offset, overlap))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy, nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-376314eeb8348bc8bd74521e" role="button"
                   aria-expanded="false" aria-controls="id-376314eeb8348bc8bd74521e">
                    <code>eth/tracers/tracers_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/eth/tracers/tracers_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/eth/tracers/tracers_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+39</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-376314eeb8348bc8bd74521e"><span class="term-fg1">diff --git go-ethereum&#47;eth&#47;tracers&#47;tracers_test.go op-geth&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg1">index 7c5ec65650ee5dc10a27ea4a408834da4cd8aa49..759e3a4dd38ee9c59700adf327af4428b288b205 100644</span>
<span class="term-fg1">--- go-ethereum&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg1">+++ op-geth&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg36">@@ -87,7 +87,7 @@</span> 		&#47;&#47;DisableStorage: true,
 		&#47;&#47;EnableMemory: false,
 		&#47;&#47;EnableReturnData: false,
 	})
<span class="term-fg31">-	evm := vm.NewEVM(context, txContext, statedb, params.AllEthashProtocolChanges, vm.Config{Debug: true, Tracer: tracer})</span>
<span class="term-fg32">+	evm := vm.NewEVM(context, txContext, statedb, params.AllEthashProtocolChanges, vm.Config{Tracer: tracer})</span>
 	msg, err := core.TransactionToMessage(tx, signer, nil)
 	if err != nil {
 		b.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
<span class="term-fg36">@@ -109,3 +109,41 @@</span> 		}
 		tracer.Reset()
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestMemCopying(t *testing.T) {</span>
<span class="term-fg32">+	for i, tc := range []struct {</span>
<span class="term-fg32">+		memsize  int64</span>
<span class="term-fg32">+		offset   int64</span>
<span class="term-fg32">+		size     int64</span>
<span class="term-fg32">+		wantErr  string</span>
<span class="term-fg32">+		wantSize int</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{0, 0, 100, &quot;&quot;, 100},    &#47;&#47; Should pad up to 100</span>
<span class="term-fg32">+		{0, 100, 0, &quot;&quot;, 0},      &#47;&#47; No need to pad (0 size)</span>
<span class="term-fg32">+		{100, 50, 100, &quot;&quot;, 100}, &#47;&#47; Should pad 100-150</span>
<span class="term-fg32">+		{100, 50, 5, &quot;&quot;, 5},     &#47;&#47; Wanted range fully within memory</span>
<span class="term-fg32">+		{100, -50, 0, &quot;offset or size must not be negative&quot;, 0},                        &#47;&#47; Errror</span>
<span class="term-fg32">+		{0, 1, 1024*1024 + 1, &quot;reached limit for padding memory slice: 1048578&quot;, 0},    &#47;&#47; Errror</span>
<span class="term-fg32">+		{10, 0, 1024*1024 + 100, &quot;reached limit for padding memory slice: 1048666&quot;, 0}, &#47;&#47; Errror</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	} {</span>
<span class="term-fg32">+		mem := vm.NewMemory()</span>
<span class="term-fg32">+		mem.Resize(uint64(tc.memsize))</span>
<span class="term-fg32">+		cpy, err := GetMemoryCopyPadded(mem, tc.offset, tc.size)</span>
<span class="term-fg32">+		if want := tc.wantErr; want != &quot;&quot; {</span>
<span class="term-fg32">+			if err == nil {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: want &#39;%v&#39; have no error&quot;, i, want)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if have := err.Error(); want != have {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: want &#39;%v&#39; have &#39;%v&#39;&quot;, i, want, have)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			continue</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %d: unexpected error: %v&quot;, i, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if want, have := tc.wantSize, len(cpy); have != want {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %d: want %v have %v&quot;, i, want, have)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3caec3b98de89aa35c2f1435" role="button"
                   aria-expanded="false" aria-controls="id-3caec3b98de89aa35c2f1435">
                    <code>ethclient/ethclient.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/ethclient/ethclient.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/ethclient/ethclient.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+16</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3caec3b98de89aa35c2f1435"><span class="term-fg1">diff --git go-ethereum&#47;ethclient&#47;ethclient.go op-geth&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg1">index c8353b25ae210aef48f5288a381fa776166e4e79..47beaf63cc0e2771ebfa1ca0519fa091532cb037 100644</span>
<span class="term-fg1">--- go-ethereum&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg1">+++ op-geth&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg36">@@ -320,7 +320,14 @@</span>
 &#47;&#47; SubscribeNewHead subscribes to notifications about the current blockchain head
 &#47;&#47; on the given channel.
 func (ec *Client) SubscribeNewHead(ctx context.Context, ch chan&lt;- *types.Header) (ethereum.Subscription, error) {
<span class="term-fg31">-	return ec.c.EthSubscribe(ctx, ch, &quot;newHeads&quot;)</span>
<span class="term-fg32">+	sub, err := ec.c.EthSubscribe(ctx, ch, &quot;newHeads&quot;)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		&#47;&#47; Defensively prefer returning nil interface explicitly on error-path, instead</span>
<span class="term-fg32">+		&#47;&#47; of letting default golang behavior wrap it with non-nil interface that stores</span>
<span class="term-fg32">+		&#47;&#47; nil concrete type value.</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return sub, nil</span>
 }
&nbsp;
 &#47;&#47; State Access
<span class="term-fg36">@@ -389,7 +396,14 @@</span> 	arg, err := toFilterArg(q)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg31">-	return ec.c.EthSubscribe(ctx, ch, &quot;logs&quot;, arg)</span>
<span class="term-fg32">+	sub, err := ec.c.EthSubscribe(ctx, ch, &quot;logs&quot;, arg)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		&#47;&#47; Defensively prefer returning nil interface explicitly on error-path, instead</span>
<span class="term-fg32">+		&#47;&#47; of letting default golang behavior wrap it with non-nil interface that stores</span>
<span class="term-fg32">+		&#47;&#47; nil concrete type value.</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return sub, nil</span>
 }
&nbsp;
 func toFilterArg(q ethereum.FilterQuery) (interface{}, error) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8e6b20552fc6541f05e6be71" role="button"
                   aria-expanded="false" aria-controls="id-8e6b20552fc6541f05e6be71">
                    <code>ethdb/pebble/pebble.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/ethdb/pebble/pebble.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/ethdb/pebble/pebble.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+17</span></div>
                        <div class="text-start"><span class="text-danger">-17</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8e6b20552fc6541f05e6be71"><span class="term-fg1">diff --git go-ethereum&#47;ethdb&#47;pebble&#47;pebble.go op-geth&#47;ethdb&#47;pebble&#47;pebble.go</span>
<span class="term-fg1">index 4e374c9e283284be282936f92436cba390a7af74..7c01b879b8e77ecc3a867d5df07a5da2f09afd31 100644</span>
<span class="term-fg1">--- go-ethereum&#47;ethdb&#47;pebble&#47;pebble.go</span>
<span class="term-fg1">+++ op-geth&#47;ethdb&#47;pebble&#47;pebble.go</span>
<span class="term-fg36">@@ -75,14 +75,14 @@</span> 	quitChan chan chan error &#47;&#47; Quit channel to stop the metrics collection before closing the database
&nbsp;
 	log log.Logger &#47;&#47; Contextual logger tracking the database path
&nbsp;
<span class="term-fg31">-	activeComp          int       &#47;&#47; Current number of active compactions</span>
<span class="term-fg31">-	compStartTime       time.Time &#47;&#47; The start time of the earliest currently-active compaction</span>
<span class="term-fg31">-	compTime            int64     &#47;&#47; Total time spent in compaction in ns</span>
<span class="term-fg31">-	level0Comp          uint32    &#47;&#47; Total number of level-zero compactions</span>
<span class="term-fg31">-	nonLevel0Comp       uint32    &#47;&#47; Total number of non level-zero compactions</span>
<span class="term-fg31">-	writeDelayStartTime time.Time &#47;&#47; The start time of the latest write stall</span>
<span class="term-fg31">-	writeDelayCount     int64     &#47;&#47; Total number of write stall counts</span>
<span class="term-fg31">-	writeDelayTime      int64     &#47;&#47; Total time spent in write stalls</span>
<span class="term-fg32">+	activeComp          int           &#47;&#47; Current number of active compactions</span>
<span class="term-fg32">+	compStartTime       time.Time     &#47;&#47; The start time of the earliest currently-active compaction</span>
<span class="term-fg32">+	compTime            atomic.Int64  &#47;&#47; Total time spent in compaction in ns</span>
<span class="term-fg32">+	level0Comp          atomic.Uint32 &#47;&#47; Total number of level-zero compactions</span>
<span class="term-fg32">+	nonLevel0Comp       atomic.Uint32 &#47;&#47; Total number of non level-zero compactions</span>
<span class="term-fg32">+	writeDelayStartTime time.Time     &#47;&#47; The start time of the latest write stall</span>
<span class="term-fg32">+	writeDelayCount     atomic.Int64  &#47;&#47; Total number of write stall counts</span>
<span class="term-fg32">+	writeDelayTime      atomic.Int64  &#47;&#47; Total time spent in write stalls</span>
 }
&nbsp;
 func (d *Database) onCompactionBegin(info pebble.CompactionInfo) {
<span class="term-fg36">@@ -91,16 +91,16 @@</span> 		d.compStartTime = time.Now()
 	}
 	l0 := info.Input[0]
 	if l0.Level == 0 {
<span class="term-fg31">-		atomic.AddUint32(&amp;d.level0Comp, 1)</span>
<span class="term-fg32">+		d.level0Comp.Add(1)</span>
 	} else {
<span class="term-fg31">-		atomic.AddUint32(&amp;d.nonLevel0Comp, 1)</span>
<span class="term-fg32">+		d.nonLevel0Comp.Add(1)</span>
 	}
 	d.activeComp++
 }
&nbsp;
 func (d *Database) onCompactionEnd(info pebble.CompactionInfo) {
 	if d.activeComp == 1 {
<span class="term-fg31">-		atomic.AddInt64(&amp;d.compTime, int64(time.Since(d.compStartTime)))</span>
<span class="term-fg32">+		d.compTime.Add(int64(time.Since(d.compStartTime)))</span>
 	} else if d.activeComp == 0 {
 		panic(&quot;should not happen&quot;)
 	}
<span class="term-fg36">@@ -112,7 +112,7 @@</span> 	d.writeDelayStartTime = time.Now()
 }
&nbsp;
 func (d *Database) onWriteStallEnd() {
<span class="term-fg31">-	atomic.AddInt64(&amp;d.writeDelayTime, int64(time.Since(d.writeDelayStartTime)))</span>
<span class="term-fg32">+	d.writeDelayTime.Add(int64(time.Since(d.writeDelayStartTime)))</span>
 }
&nbsp;
 &#47;&#47; New returns a wrapped pebble DB object. The namespace is the prefix that the
<span class="term-fg36">@@ -407,11 +407,11 @@</span> 			compRead  int64
 			nWrite    int64
&nbsp;
 			metrics            = d.db.Metrics()
<span class="term-fg31">-			compTime           = atomic.LoadInt64(&amp;d.compTime)</span>
<span class="term-fg31">-			writeDelayCount    = atomic.LoadInt64(&amp;d.writeDelayCount)</span>
<span class="term-fg31">-			writeDelayTime     = atomic.LoadInt64(&amp;d.writeDelayTime)</span>
<span class="term-fg31">-			nonLevel0CompCount = int64(atomic.LoadUint32(&amp;d.nonLevel0Comp))</span>
<span class="term-fg31">-			level0CompCount    = int64(atomic.LoadUint32(&amp;d.level0Comp))</span>
<span class="term-fg32">+			compTime           = d.compTime.Load()</span>
<span class="term-fg32">+			writeDelayCount    = d.writeDelayCount.Load()</span>
<span class="term-fg32">+			writeDelayTime     = d.writeDelayTime.Load()</span>
<span class="term-fg32">+			nonLevel0CompCount = int64(d.nonLevel0Comp.Load())</span>
<span class="term-fg32">+			level0CompCount    = int64(d.level0Comp.Load())</span>
 		)
 		writeDelayTimes[i%2] = writeDelayTime
 		writeDelayCounts[i%2] = writeDelayCount</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-63f00ff8e53de3c6ffe85168" role="button"
                   aria-expanded="false" aria-controls="id-63f00ff8e53de3c6ffe85168">
                    <code>graphql/graphql.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/graphql/graphql.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/graphql/graphql.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+137</span></div>
                        <div class="text-start"><span class="text-danger">-153</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-63f00ff8e53de3c6ffe85168"><span class="term-fg1">diff --git go-ethereum&#47;graphql&#47;graphql.go op-geth&#47;graphql&#47;graphql.go</span>
<span class="term-fg1">index 0c13cc80f5559383bb3721dfac375bd63a06a934..45a1f7a2aa7459aa389779e5c492fa5600b3c326 100644</span>
<span class="term-fg1">--- go-ethereum&#47;graphql&#47;graphql.go</span>
<span class="term-fg1">+++ op-geth&#47;graphql&#47;graphql.go</span>
<span class="term-fg36">@@ -24,6 +24,7 @@</span> 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
 	&quot;sort&quot;
 	&quot;strconv&quot;
<span class="term-fg32">+	&quot;sync&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg36">@@ -184,32 +185,39 @@</span>
 &#47;&#47; Transaction represents an Ethereum transaction.
 &#47;&#47; backend and hash are mandatory; all others will be fetched when required.
 type Transaction struct {
<span class="term-fg31">-	r     *Resolver</span>
<span class="term-fg31">-	hash  common.Hash</span>
<span class="term-fg32">+	r    *Resolver</span>
<span class="term-fg32">+	hash common.Hash &#47;&#47; Must be present after initialization</span>
<span class="term-fg32">+	mu   sync.Mutex</span>
<span class="term-fg32">+	&#47;&#47; mu protects following resources</span>
 	tx    *types.Transaction
 	block *Block
 	index uint64
 }
&nbsp;
 &#47;&#47; resolve returns the internal transaction object, fetching it if needed.
<span class="term-fg31">-func (t *Transaction) resolve(ctx context.Context) (*types.Transaction, error) {</span>
<span class="term-fg31">-	if t.tx == nil {</span>
<span class="term-fg31">-		&#47;&#47; Try to return an already finalized transaction</span>
<span class="term-fg31">-		tx, blockHash, _, index, err := t.r.backend.GetTransaction(ctx, t.hash)</span>
<span class="term-fg31">-		if err == nil &amp;&amp; tx != nil {</span>
<span class="term-fg31">-			t.tx = tx</span>
<span class="term-fg31">-			blockNrOrHash := rpc.BlockNumberOrHashWithHash(blockHash, false)</span>
<span class="term-fg31">-			t.block = &amp;Block{</span>
<span class="term-fg31">-				r:            t.r,</span>
<span class="term-fg31">-				numberOrHash: &amp;blockNrOrHash,</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			t.index = index</span>
<span class="term-fg31">-			return t.tx, nil</span>
<span class="term-fg32">+&#47;&#47; It also returns the block the tx blongs to, unless it is a pending tx.</span>
<span class="term-fg32">+func (t *Transaction) resolve(ctx context.Context) (*types.Transaction, *Block, error) {</span>
<span class="term-fg32">+	t.mu.Lock()</span>
<span class="term-fg32">+	defer t.mu.Unlock()</span>
<span class="term-fg32">+	if t.tx != nil {</span>
<span class="term-fg32">+		return t.tx, t.block, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Try to return an already finalized transaction</span>
<span class="term-fg32">+	tx, blockHash, _, index, err := t.r.backend.GetTransaction(ctx, t.hash)</span>
<span class="term-fg32">+	if err == nil &amp;&amp; tx != nil {</span>
<span class="term-fg32">+		t.tx = tx</span>
<span class="term-fg32">+		blockNrOrHash := rpc.BlockNumberOrHashWithHash(blockHash, false)</span>
<span class="term-fg32">+		t.block = &amp;Block{</span>
<span class="term-fg32">+			r:            t.r,</span>
<span class="term-fg32">+			numberOrHash: &amp;blockNrOrHash,</span>
<span class="term-fg32">+			hash:         blockHash,</span>
 		}
<span class="term-fg31">-		&#47;&#47; No finalized transaction, try to retrieve it from the pool</span>
<span class="term-fg31">-		t.tx = t.r.backend.GetPoolTransaction(t.hash)</span>
<span class="term-fg32">+		t.index = index</span>
<span class="term-fg32">+		return t.tx, t.block, nil</span>
 	}
<span class="term-fg31">-	return t.tx, nil</span>
<span class="term-fg32">+	&#47;&#47; No finalized transaction, try to retrieve it from the pool</span>
<span class="term-fg32">+	t.tx = t.r.backend.GetPoolTransaction(t.hash)</span>
<span class="term-fg32">+	return t.tx, nil, nil</span>
 }
&nbsp;
 func (t *Transaction) Hash(ctx context.Context) common.Hash {
<span class="term-fg36">@@ -217,7 +225,7 @@</span> 	return t.hash
 }
&nbsp;
 func (t *Transaction) InputData(ctx context.Context) (hexutil.Bytes, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Bytes{}, err
 	}
<span class="term-fg36">@@ -225,7 +233,7 @@</span> 	return tx.Data(), nil
 }
&nbsp;
 func (t *Transaction) Gas(ctx context.Context) (hexutil.Uint64, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return 0, err
 	}
<span class="term-fg36">@@ -233,7 +241,7 @@</span> 	return hexutil.Uint64(tx.Gas()), nil
 }
&nbsp;
 func (t *Transaction) GasPrice(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, block, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Big{}, err
 	}
<span class="term-fg36">@@ -241,8 +249,8 @@</span> 	switch tx.Type() {
 	case types.AccessListTxType:
 		return hexutil.Big(*tx.GasPrice()), nil
 	case types.DynamicFeeTxType:
<span class="term-fg31">-		if t.block != nil {</span>
<span class="term-fg31">-			if baseFee, _ := t.block.BaseFeePerGas(ctx); baseFee != nil {</span>
<span class="term-fg32">+		if block != nil {</span>
<span class="term-fg32">+			if baseFee, _ := block.BaseFeePerGas(ctx); baseFee != nil {</span>
 				&#47;&#47; price = min(tip, gasFeeCap - baseFee) + baseFee
 				return (hexutil.Big)(*math.BigMin(new(big.Int).Add(tx.GasTipCap(), baseFee.ToInt()), tx.GasFeeCap())), nil
 			}
<span class="term-fg36">@@ -254,15 +262,15 @@</span> 	}
 }
&nbsp;
 func (t *Transaction) EffectiveGasPrice(ctx context.Context) (*hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, block, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
 	&#47;&#47; Pending tx
<span class="term-fg31">-	if t.block == nil {</span>
<span class="term-fg32">+	if block == nil {</span>
 		return nil, nil
 	}
<span class="term-fg31">-	header, err := t.block.resolveHeader(ctx)</span>
<span class="term-fg32">+	header, err := block.resolveHeader(ctx)</span>
 	if err != nil || header == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -273,7 +281,7 @@</span> 	return (*hexutil.Big)(math.BigMin(new(big.Int).Add(tx.GasTipCap(), header.BaseFee), tx.GasFeeCap())), nil
 }
&nbsp;
 func (t *Transaction) MaxFeePerGas(ctx context.Context) (*hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -288,7 +296,7 @@</span> 	}
 }
&nbsp;
 func (t *Transaction) MaxPriorityFeePerGas(ctx context.Context) (*hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -303,15 +311,15 @@</span> 	}
 }
&nbsp;
 func (t *Transaction) EffectiveTip(ctx context.Context) (*hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, block, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
 	&#47;&#47; Pending tx
<span class="term-fg31">-	if t.block == nil {</span>
<span class="term-fg32">+	if block == nil {</span>
 		return nil, nil
 	}
<span class="term-fg31">-	header, err := t.block.resolveHeader(ctx)</span>
<span class="term-fg32">+	header, err := block.resolveHeader(ctx)</span>
 	if err != nil || header == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -327,7 +335,7 @@</span> 	return (*hexutil.Big)(tip), nil
 }
&nbsp;
 func (t *Transaction) Value(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Big{}, err
 	}
<span class="term-fg36">@@ -338,7 +346,7 @@</span> 	return hexutil.Big(*tx.Value()), nil
 }
&nbsp;
 func (t *Transaction) Nonce(ctx context.Context) (hexutil.Uint64, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return 0, err
 	}
<span class="term-fg36">@@ -346,7 +354,7 @@</span> 	return hexutil.Uint64(tx.Nonce()), nil
 }
&nbsp;
 func (t *Transaction) To(ctx context.Context, args BlockNumberArgs) (*Account, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -362,7 +370,7 @@</span> 	}, nil
 }
&nbsp;
 func (t *Transaction) From(ctx context.Context, args BlockNumberArgs) (*Account, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -376,17 +384,20 @@</span> 	}, nil
 }
&nbsp;
 func (t *Transaction) Block(ctx context.Context) (*Block, error) {
<span class="term-fg31">-	if _, err := t.resolve(ctx); err != nil {</span>
<span class="term-fg32">+	_, block, err := t.resolve(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
 		return nil, err
 	}
<span class="term-fg31">-	return t.block, nil</span>
<span class="term-fg32">+	return block, nil</span>
 }
&nbsp;
 func (t *Transaction) Index(ctx context.Context) (*int32, error) {
<span class="term-fg31">-	if _, err := t.resolve(ctx); err != nil {</span>
<span class="term-fg32">+	_, block, err := t.resolve(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
 		return nil, err
 	}
<span class="term-fg31">-	if t.block == nil {</span>
<span class="term-fg32">+	&#47;&#47; Pending tx</span>
<span class="term-fg32">+	if block == nil {</span>
 		return nil, nil
 	}
 	index := int32(t.index)
<span class="term-fg36">@@ -395,13 +406,15 @@</span> }
&nbsp;
 &#47;&#47; getReceipt returns the receipt associated with this transaction, if any.
 func (t *Transaction) getReceipt(ctx context.Context) (*types.Receipt, error) {
<span class="term-fg31">-	if _, err := t.resolve(ctx); err != nil {</span>
<span class="term-fg32">+	_, block, err := t.resolve(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
 		return nil, err
 	}
<span class="term-fg31">-	if t.block == nil {</span>
<span class="term-fg32">+	&#47;&#47; Pending tx</span>
<span class="term-fg32">+	if block == nil {</span>
 		return nil, nil
 	}
<span class="term-fg31">-	receipts, err := t.block.resolveReceipts(ctx)</span>
<span class="term-fg32">+	receipts, err := block.resolveReceipts(ctx)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -451,28 +464,25 @@</span> 	}, nil
 }
&nbsp;
 func (t *Transaction) Logs(ctx context.Context) (*[]*Log, error) {
<span class="term-fg31">-	if _, err := t.resolve(ctx); err != nil {</span>
<span class="term-fg32">+	_, block, err := t.resolve(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
 		return nil, err
 	}
<span class="term-fg31">-	if t.block == nil {</span>
<span class="term-fg32">+	&#47;&#47; Pending tx</span>
<span class="term-fg32">+	if block == nil {</span>
 		return nil, nil
 	}
<span class="term-fg31">-	if _, ok := t.block.numberOrHash.Hash(); !ok {</span>
<span class="term-fg31">-		header, err := t.r.backend.HeaderByNumberOrHash(ctx, *t.block.numberOrHash)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return nil, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		hash := header.Hash()</span>
<span class="term-fg31">-		t.block.numberOrHash.BlockHash = &amp;hash</span>
<span class="term-fg32">+	h, err := block.Hash(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
 	}
<span class="term-fg31">-	return t.getLogs(ctx)</span>
<span class="term-fg32">+	return t.getLogs(ctx, h)</span>
 }
&nbsp;
 &#47;&#47; getLogs returns log objects for the given tx.
 &#47;&#47; Assumes block hash is resolved.
<span class="term-fg31">-func (t *Transaction) getLogs(ctx context.Context) (*[]*Log, error) {</span>
<span class="term-fg32">+func (t *Transaction) getLogs(ctx context.Context, hash common.Hash) (*[]*Log, error) {</span>
 	var (
<span class="term-fg31">-		hash, _   = t.block.numberOrHash.Hash()</span>
 		filter    = t.r.filterSystem.NewBlockFilter(hash, nil, nil)
 		logs, err = filter.Logs(ctx)
 	)
<span class="term-fg36">@@ -494,7 +504,7 @@</span> 	return &amp;ret, nil
 }
&nbsp;
 func (t *Transaction) Type(ctx context.Context) (*int32, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -503,7 +513,7 @@</span> 	return &amp;txType, nil
 }
&nbsp;
 func (t *Transaction) AccessList(ctx context.Context) (*[]*AccessTuple, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -519,7 +529,7 @@</span> 	return &amp;ret, nil
 }
&nbsp;
 func (t *Transaction) R(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Big{}, err
 	}
<span class="term-fg36">@@ -528,7 +538,7 @@</span> 	return hexutil.Big(*r), nil
 }
&nbsp;
 func (t *Transaction) S(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Big{}, err
 	}
<span class="term-fg36">@@ -537,7 +547,7 @@</span> 	return hexutil.Big(*s), nil
 }
&nbsp;
 func (t *Transaction) V(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Big{}, err
 	}
<span class="term-fg36">@@ -546,7 +556,7 @@</span> 	return hexutil.Big(*v), nil
 }
&nbsp;
 func (t *Transaction) Raw(ctx context.Context) (hexutil.Bytes, error) {
<span class="term-fg31">-	tx, err := t.resolve(ctx)</span>
<span class="term-fg32">+	tx, _, err := t.resolve(ctx)</span>
 	if err != nil || tx == nil {
 		return hexutil.Bytes{}, err
 	}
<span class="term-fg36">@@ -568,16 +578,20 @@</span> &#47;&#47; backend, and numberOrHash are mandatory. All other fields are lazily fetched
 &#47;&#47; when required.
 type Block struct {
 	r            *Resolver
<span class="term-fg31">-	numberOrHash *rpc.BlockNumberOrHash</span>
<span class="term-fg31">-	hash         common.Hash</span>
<span class="term-fg31">-	header       *types.Header</span>
<span class="term-fg31">-	block        *types.Block</span>
<span class="term-fg31">-	receipts     []*types.Receipt</span>
<span class="term-fg32">+	numberOrHash *rpc.BlockNumberOrHash &#47;&#47; Field resolvers assume numberOrHash is always present</span>
<span class="term-fg32">+	mu           sync.Mutex</span>
<span class="term-fg32">+	&#47;&#47; mu protects following resources</span>
<span class="term-fg32">+	hash     common.Hash &#47;&#47; Must be resolved during initialization</span>
<span class="term-fg32">+	header   *types.Header</span>
<span class="term-fg32">+	block    *types.Block</span>
<span class="term-fg32">+	receipts []*types.Receipt</span>
 }
&nbsp;
 &#47;&#47; resolve returns the internal Block object representing this block, fetching
 &#47;&#47; it if necessary.
 func (b *Block) resolve(ctx context.Context) (*types.Block, error) {
<span class="term-fg32">+	b.mu.Lock()</span>
<span class="term-fg32">+	defer b.mu.Unlock()</span>
 	if b.block != nil {
 		return b.block, nil
 	}
<span class="term-fg36">@@ -587,10 +601,10 @@</span> 		b.numberOrHash = &amp;latest
 	}
 	var err error
 	b.block, err = b.r.backend.BlockByNumberOrHash(ctx, *b.numberOrHash)
<span class="term-fg31">-	if b.block != nil &amp;&amp; b.header == nil {</span>
<span class="term-fg31">-		b.header = b.block.Header()</span>
<span class="term-fg31">-		if hash, ok := b.numberOrHash.Hash(); ok {</span>
<span class="term-fg31">-			b.hash = hash</span>
<span class="term-fg32">+	if b.block != nil {</span>
<span class="term-fg32">+		b.hash = b.block.Hash()</span>
<span class="term-fg32">+		if b.header == nil {</span>
<span class="term-fg32">+			b.header = b.block.Header()</span>
 		}
 	}
 	return b.block, err
<span class="term-fg36">@@ -600,39 +614,39 @@</span> &#47;&#47; resolveHeader returns the internal Header object for this block, fetching it
 &#47;&#47; if necessary. Call this function instead of `resolve` unless you need the
 &#47;&#47; additional data (transactions and uncles).
 func (b *Block) resolveHeader(ctx context.Context) (*types.Header, error) {
<span class="term-fg32">+	b.mu.Lock()</span>
<span class="term-fg32">+	defer b.mu.Unlock()</span>
<span class="term-fg32">+	if b.header != nil {</span>
<span class="term-fg32">+		return b.header, nil</span>
<span class="term-fg32">+	}</span>
 	if b.numberOrHash == nil &amp;&amp; b.hash == (common.Hash{}) {
 		return nil, errBlockInvariant
 	}
 	var err error
<span class="term-fg31">-	if b.header == nil {</span>
<span class="term-fg31">-		if b.hash != (common.Hash{}) {</span>
<span class="term-fg31">-			b.header, err = b.r.backend.HeaderByHash(ctx, b.hash)</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			b.header, err = b.r.backend.HeaderByNumberOrHash(ctx, *b.numberOrHash)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+	b.header, err = b.r.backend.HeaderByNumberOrHash(ctx, *b.numberOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if b.hash == (common.Hash{}) {</span>
<span class="term-fg32">+		b.hash = b.header.Hash()</span>
 	}
<span class="term-fg31">-	return b.header, err</span>
<span class="term-fg32">+	return b.header, nil</span>
 }
&nbsp;
 &#47;&#47; resolveReceipts returns the list of receipts for this block, fetching them
 &#47;&#47; if necessary.
 func (b *Block) resolveReceipts(ctx context.Context) ([]*types.Receipt, error) {
<span class="term-fg31">-	if b.receipts == nil {</span>
<span class="term-fg31">-		hash := b.hash</span>
<span class="term-fg31">-		if hash == (common.Hash{}) {</span>
<span class="term-fg31">-			header, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-			if err != nil {</span>
<span class="term-fg31">-				return nil, err</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			hash = header.Hash()</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		receipts, err := b.r.backend.GetReceipts(ctx, hash)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return nil, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		b.receipts = receipts</span>
<span class="term-fg32">+	b.mu.Lock()</span>
<span class="term-fg32">+	defer b.mu.Unlock()</span>
<span class="term-fg32">+	if b.receipts != nil {</span>
<span class="term-fg32">+		return b.receipts, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	receipts, err := b.r.backend.GetReceipts(ctx, b.hash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
 	}
<span class="term-fg31">-	return b.receipts, nil</span>
<span class="term-fg32">+	b.receipts = receipts</span>
<span class="term-fg32">+	return receipts, nil</span>
 }
&nbsp;
 func (b *Block) Number(ctx context.Context) (Long, error) {
<span class="term-fg36">@@ -645,13 +659,8 @@</span> 	return Long(header.Number.Uint64()), nil
 }
&nbsp;
 func (b *Block) Hash(ctx context.Context) (common.Hash, error) {
<span class="term-fg31">-	if b.hash == (common.Hash{}) {</span>
<span class="term-fg31">-		header, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return common.Hash{}, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		b.hash = header.Hash()</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+	b.mu.Lock()</span>
<span class="term-fg32">+	defer b.mu.Unlock()</span>
 	return b.hash, nil
 }
&nbsp;
<span class="term-fg36">@@ -705,11 +714,18 @@</span> 	}
 	if b.header == nil || b.header.Number.Uint64() &lt; 1 {
 		return nil, nil
 	}
<span class="term-fg31">-	num := rpc.BlockNumberOrHashWithNumber(rpc.BlockNumber(b.header.Number.Uint64() - 1))</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		num       = rpc.BlockNumber(b.header.Number.Uint64() - 1)</span>
<span class="term-fg32">+		hash      = b.header.ParentHash</span>
<span class="term-fg32">+		numOrHash = rpc.BlockNumberOrHash{</span>
<span class="term-fg32">+			BlockNumber: &amp;num,</span>
<span class="term-fg32">+			BlockHash:   &amp;hash,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	)</span>
 	return &amp;Block{
 		r:            b.r,
<span class="term-fg31">-		numberOrHash: &amp;num,</span>
<span class="term-fg31">-		hash:         b.header.ParentHash,</span>
<span class="term-fg32">+		numberOrHash: &amp;numOrHash,</span>
<span class="term-fg32">+		hash:         hash,</span>
 	}, nil
 }
&nbsp;
<span class="term-fg36">@@ -798,6 +814,7 @@</span> 		ret = append(ret, &amp;Block{
 			r:            b.r,
 			numberOrHash: &amp;blockNumberOrHash,
 			header:       uncle,
<span class="term-fg32">+			hash:         uncle.Hash(),</span>
 		})
 	}
 	return &amp;ret, nil
<span class="term-fg36">@@ -820,17 +837,13 @@</span> 	return header.Bloom.Bytes(), nil
 }
&nbsp;
 func (b *Block) TotalDifficulty(ctx context.Context) (hexutil.Big, error) {
<span class="term-fg31">-	h := b.hash</span>
<span class="term-fg31">-	if h == (common.Hash{}) {</span>
<span class="term-fg31">-		header, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return hexutil.Big{}, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		h = header.Hash()</span>
<span class="term-fg32">+	hash, err := b.Hash(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return hexutil.Big{}, err</span>
 	}
<span class="term-fg31">-	td := b.r.backend.GetTd(ctx, h)</span>
<span class="term-fg32">+	td := b.r.backend.GetTd(ctx, hash)</span>
 	if td == nil {
<span class="term-fg31">-		return hexutil.Big{}, fmt.Errorf(&quot;total difficulty not found %x&quot;, b.hash)</span>
<span class="term-fg32">+		return hexutil.Big{}, fmt.Errorf(&quot;total difficulty not found %x&quot;, hash)</span>
 	}
 	return hexutil.Big(*td), nil
 }
<span class="term-fg36">@@ -948,6 +961,7 @@</span> 	return &amp;Block{
 		r:            b.r,
 		numberOrHash: &amp;blockNumberOrHash,
 		header:       uncle,
<span class="term-fg32">+		hash:         uncle.Hash(),</span>
 	}, nil
 }
&nbsp;
<span class="term-fg36">@@ -997,15 +1011,11 @@</span> 	var topics [][]common.Hash
 	if args.Filter.Topics != nil {
 		topics = *args.Filter.Topics
 	}
<span class="term-fg31">-	hash := b.hash</span>
<span class="term-fg31">-	if hash == (common.Hash{}) {</span>
<span class="term-fg31">-		header, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return nil, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		hash = header.Hash()</span>
<span class="term-fg31">-	}</span>
 	&#47;&#47; Construct the range filter
<span class="term-fg32">+	hash, err := b.Hash(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
 	filter := b.r.filterSystem.NewBlockFilter(hash, addresses, topics)
&nbsp;
 	&#47;&#47; Run the filter and return all the logs
<span class="term-fg36">@@ -1015,12 +1025,6 @@</span>
 func (b *Block) Account(ctx context.Context, args struct {
 	Address common.Address
 }) (*Account, error) {
<span class="term-fg31">-	if b.numberOrHash == nil {</span>
<span class="term-fg31">-		_, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return nil, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
 	return &amp;Account{
 		r:             b.r,
 		address:       args.Address,
<span class="term-fg36">@@ -1063,12 +1067,6 @@</span>
 func (b *Block) Call(ctx context.Context, args struct {
 	Data ethapi.TransactionArgs
 }) (*CallResult, error) {
<span class="term-fg31">-	if b.numberOrHash == nil {</span>
<span class="term-fg31">-		_, err := b.resolve(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return nil, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
 	result, err := ethapi.DoCall(ctx, b.r.backend, args.Data, *b.numberOrHash, nil, b.r.backend.RPCEVMTimeout(), b.r.backend.RPCGasCap())
 	if err != nil {
 		return nil, err
<span class="term-fg36">@@ -1088,12 +1086,6 @@</span>
 func (b *Block) EstimateGas(ctx context.Context, args struct {
 	Data ethapi.TransactionArgs
 }) (Long, error) {
<span class="term-fg31">-	if b.numberOrHash == nil {</span>
<span class="term-fg31">-		_, err := b.resolveHeader(ctx)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return 0, err</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
 	gas, err := ethapi.DoEstimateGas(ctx, b.r.backend, args.Data, *b.numberOrHash, b.r.backend.RPCGasCap())
 	return Long(gas), err
 }
<span class="term-fg36">@@ -1173,29 +1165,21 @@</span> func (r *Resolver) Block(ctx context.Context, args struct {
 	Number *Long
 	Hash   *common.Hash
 }) (*Block, error) {
<span class="term-fg31">-	var block *Block</span>
<span class="term-fg32">+	var numberOrHash rpc.BlockNumberOrHash</span>
 	if args.Number != nil {
 		if *args.Number &lt; 0 {
 			return nil, nil
 		}
 		number := rpc.BlockNumber(*args.Number)
<span class="term-fg31">-		numberOrHash := rpc.BlockNumberOrHashWithNumber(number)</span>
<span class="term-fg31">-		block = &amp;Block{</span>
<span class="term-fg31">-			r:            r,</span>
<span class="term-fg31">-			numberOrHash: &amp;numberOrHash,</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+		numberOrHash = rpc.BlockNumberOrHashWithNumber(number)</span>
 	} else if args.Hash != nil {
<span class="term-fg31">-		numberOrHash := rpc.BlockNumberOrHashWithHash(*args.Hash, false)</span>
<span class="term-fg31">-		block = &amp;Block{</span>
<span class="term-fg31">-			r:            r,</span>
<span class="term-fg31">-			numberOrHash: &amp;numberOrHash,</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+		numberOrHash = rpc.BlockNumberOrHashWithHash(*args.Hash, false)</span>
 	} else {
<span class="term-fg31">-		numberOrHash := rpc.BlockNumberOrHashWithNumber(rpc.LatestBlockNumber)</span>
<span class="term-fg31">-		block = &amp;Block{</span>
<span class="term-fg31">-			r:            r,</span>
<span class="term-fg31">-			numberOrHash: &amp;numberOrHash,</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+		numberOrHash = rpc.BlockNumberOrHashWithNumber(rpc.LatestBlockNumber)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	block := &amp;Block{</span>
<span class="term-fg32">+		r:            r,</span>
<span class="term-fg32">+		numberOrHash: &amp;numberOrHash,</span>
 	}
 	&#47;&#47; Resolve the header, return nil if it doesn&#39;t exist.
 	&#47;&#47; Note we don&#39;t resolve block directly here since it will require an
<span class="term-fg36">@@ -1256,7 +1240,7 @@</span> 		r:    r,
 		hash: args.Hash,
 	}
 	&#47;&#47; Resolve the transaction; if it doesn&#39;t exist, return nil.
<span class="term-fg31">-	t, err := tx.resolve(ctx)</span>
<span class="term-fg32">+	t, _, err := tx.resolve(ctx)</span>
 	if err != nil {
 		return nil, err
 	} else if t == nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8d7fc28ba42565bb54dd2306" role="button"
                   aria-expanded="false" aria-controls="id-8d7fc28ba42565bb54dd2306">
                    <code>graphql/graphql_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/graphql/graphql_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/graphql/graphql_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+62</span></div>
                        <div class="text-start"><span class="text-danger">-17</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8d7fc28ba42565bb54dd2306"><span class="term-fg1">diff --git go-ethereum&#47;graphql&#47;graphql_test.go op-geth&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg1">index 46acd1529342aebf27fdfdf3f5a4ea1f6d3df846..9354eac0f359e6da351fc6a2f17e777ed1a6baf5 100644</span>
<span class="term-fg1">--- go-ethereum&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg1">+++ op-geth&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg36">@@ -156,6 +156,7 @@</span> 		if err != nil {
 			t.Fatalf(&quot;could not post: %v&quot;, err)
 		}
 		bodyBytes, err := io.ReadAll(resp.Body)
<span class="term-fg32">+		resp.Body.Close()</span>
 		if err != nil {
 			t.Fatalf(&quot;could not read from response body: %v&quot;, err)
 		}
<span class="term-fg36">@@ -239,6 +240,7 @@</span> 		if err != nil {
 			t.Fatalf(&quot;could not post: %v&quot;, err)
 		}
 		bodyBytes, err := io.ReadAll(resp.Body)
<span class="term-fg32">+		resp.Body.Close()</span>
 		if err != nil {
 			t.Fatalf(&quot;could not read from response body: %v&quot;, err)
 		}
<span class="term-fg36">@@ -263,11 +265,12 @@</span> 	resp, err := http.Post(fmt.Sprintf(&quot;%s&#47;graphql&quot;, stack.HTTPEndpoint()), &quot;application&#47;json&quot;, body)
 	if err != nil {
 		t.Fatalf(&quot;could not post: %v&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
 	&#47;&#47; make sure the request is not handled successfully
 	assert.Equal(t, http.StatusNotFound, resp.StatusCode)
 }
&nbsp;
<span class="term-fg31">-func TestGraphQLTransactionLogs(t *testing.T) {</span>
<span class="term-fg32">+func TestGraphQLConcurrentResolvers(t *testing.T) {</span>
 	var (
 		key, _  = crypto.GenerateKey()
 		addr    = crypto.PubkeyToAddress(key.PublicKey)
<span class="term-fg36">@@ -292,8 +295,9 @@</span> 		stack  = createNode(t)
 	)
 	defer stack.Close()
&nbsp;
<span class="term-fg31">-	handler := newGQLService(t, stack, genesis, 1, func(i int, gen *core.BlockGen) {</span>
<span class="term-fg31">-		tx, _ := types.SignNewTx(key, signer, &amp;types.LegacyTx{To: &amp;dad, Gas: 100000, GasPrice: big.NewInt(params.InitialBaseFee)})</span>
<span class="term-fg32">+	var tx *types.Transaction</span>
<span class="term-fg32">+	handler, chain := newGQLService(t, stack, genesis, 1, func(i int, gen *core.BlockGen) {</span>
<span class="term-fg32">+		tx, _ = types.SignNewTx(key, signer, &amp;types.LegacyTx{To: &amp;dad, Gas: 100000, GasPrice: big.NewInt(params.InitialBaseFee)})</span>
 		gen.AddTx(tx)
 		tx, _ = types.SignNewTx(key, signer, &amp;types.LegacyTx{To: &amp;dad, Nonce: 1, Gas: 100000, GasPrice: big.NewInt(params.InitialBaseFee)})
 		gen.AddTx(tx)
<span class="term-fg36">@@ -304,18 +308,59 @@</span> 	&#47;&#47; start node
 	if err := stack.Start(); err != nil {
 		t.Fatalf(&quot;could not start node: %v&quot;, err)
 	}
<span class="term-fg31">-	query := `{block { transactions { logs { account { address } } } } }`</span>
<span class="term-fg31">-	res := handler.Schema.Exec(context.Background(), query, &quot;&quot;, map[string]interface{}{})</span>
<span class="term-fg31">-	if res.Errors != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;graphql query failed: %v&quot;, res.Errors)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	have, err := json.Marshal(res.Data)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatalf(&quot;failed to encode graphql response: %s&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	want := fmt.Sprintf(`{&quot;block&quot;:{&quot;transactions&quot;:[{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]},{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]},{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]}]}}`, dadStr, dadStr, dadStr, dadStr, dadStr, dadStr)</span>
<span class="term-fg31">-	if string(have) != want {</span>
<span class="term-fg31">-		t.Errorf(&quot;response unmatch. expected %s, got %s&quot;, want, have)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for i, tt := range []struct {</span>
<span class="term-fg32">+		body string</span>
<span class="term-fg32">+		want string</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		&#47;&#47; Multiple txes race to get&#47;set the block hash.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: &quot;{block { transactions { logs { account { address } } } } }&quot;,</span>
<span class="term-fg32">+			want: fmt.Sprintf(`{&quot;block&quot;:{&quot;transactions&quot;:[{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]},{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]},{&quot;logs&quot;:[{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}},{&quot;account&quot;:{&quot;address&quot;:&quot;%s&quot;}}]}]}}`, dadStr, dadStr, dadStr, dadStr, dadStr, dadStr),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Multiple fields of a tx race to resolve it. Happens in this case</span>
<span class="term-fg32">+		&#47;&#47; because resolving the tx body belonging to a log is delayed.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: `{block { logs(filter: {}) { transaction { nonce value gasPrice }}}}`,</span>
<span class="term-fg32">+			want: `{&quot;block&quot;:{&quot;logs&quot;:[{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x0&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}},{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x0&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}},{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x1&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}},{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x1&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}},{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x2&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}},{&quot;transaction&quot;:{&quot;nonce&quot;:&quot;0x2&quot;,&quot;value&quot;:&quot;0x0&quot;,&quot;gasPrice&quot;:&quot;0x3b9aca00&quot;}}]}}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Multiple txes of a block race to set&#47;retrieve receipts of a block.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: &quot;{block { transactions { status gasUsed } } }&quot;,</span>
<span class="term-fg32">+			want: `{&quot;block&quot;:{&quot;transactions&quot;:[{&quot;status&quot;:1,&quot;gasUsed&quot;:21768},{&quot;status&quot;:1,&quot;gasUsed&quot;:21768},{&quot;status&quot;:1,&quot;gasUsed&quot;:21768}]}}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Multiple fields of block race to resolve header and body.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: &quot;{ block { number hash gasLimit ommerCount transactionCount totalDifficulty } }&quot;,</span>
<span class="term-fg32">+			want: fmt.Sprintf(`{&quot;block&quot;:{&quot;number&quot;:1,&quot;hash&quot;:&quot;%s&quot;,&quot;gasLimit&quot;:11500000,&quot;ommerCount&quot;:0,&quot;transactionCount&quot;:3,&quot;totalDifficulty&quot;:&quot;0x200000&quot;}}`, chain[len(chain)-1].Hash()),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Multiple fields of a block race to resolve the header and body.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: fmt.Sprintf(`{ transaction(hash: &quot;%s&quot;) { block { number hash gasLimit ommerCount transactionCount } } }`, tx.Hash()),</span>
<span class="term-fg32">+			want: fmt.Sprintf(`{&quot;transaction&quot;:{&quot;block&quot;:{&quot;number&quot;:1,&quot;hash&quot;:&quot;%s&quot;,&quot;gasLimit&quot;:11500000,&quot;ommerCount&quot;:0,&quot;transactionCount&quot;:3}}}`, chain[len(chain)-1].Hash()),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Account fields race the resolve the state object.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: fmt.Sprintf(`{ block { account(address: &quot;%s&quot;) { balance transactionCount code } } }`, dadStr),</span>
<span class="term-fg32">+			want: `{&quot;block&quot;:{&quot;account&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;transactionCount&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x60006000a060006000a060006000f3&quot;}}}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Test values for a non-existent account.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			body: fmt.Sprintf(`{ block { account(address: &quot;%s&quot;) { balance transactionCount code } } }`, &quot;0x1111111111111111111111111111111111111111&quot;),</span>
<span class="term-fg32">+			want: `{&quot;block&quot;:{&quot;account&quot;:{&quot;balance&quot;:&quot;0x0&quot;,&quot;transactionCount&quot;:&quot;0x0&quot;,&quot;code&quot;:&quot;0x&quot;}}}`,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	} {</span>
<span class="term-fg32">+		res := handler.Schema.Exec(context.Background(), tt.body, &quot;&quot;, map[string]interface{}{})</span>
<span class="term-fg32">+		if res.Errors != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;failed to execute query for testcase #%d: %v&quot;, i, res.Errors)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		have, err := json.Marshal(res.Data)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;failed to encode graphql response for testcase #%d: %s&quot;, i, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if string(have) != tt.want {</span>
<span class="term-fg32">+			t.Errorf(&quot;response unmatch for testcase #%d.\nExpected:\n%s\nGot:\n%s\n&quot;, i, tt.want, have)</span>
<span class="term-fg32">+		}</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -333,7 +378,7 @@</span> 	}
 	return stack
 }
&nbsp;
<span class="term-fg31">-func newGQLService(t *testing.T, stack *node.Node, gspec *core.Genesis, genBlocks int, genfunc func(i int, gen *core.BlockGen)) *handler {</span>
<span class="term-fg32">+func newGQLService(t *testing.T, stack *node.Node, gspec *core.Genesis, genBlocks int, genfunc func(i int, gen *core.BlockGen)) (*handler, []*types.Block) {</span>
 	ethConf := &amp;ethconfig.Config{
 		Genesis: gspec,
 		Ethash: ethash.Config{
<span class="term-fg36">@@ -364,5 +409,5 @@</span> 	handler, err := newHandler(stack, ethBackend.APIBackend, filterSystem, []string{}, []string{})
 	if err != nil {
 		t.Fatalf(&quot;could not create graphql service: %v&quot;, err)
 	}
<span class="term-fg31">-	return handler</span>
<span class="term-fg32">+	return handler, chain</span>
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3e9524c9b133e1689aec8c1b" role="button"
                   aria-expanded="false" aria-controls="id-3e9524c9b133e1689aec8c1b">
                    <code>internal/debug/flags.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/internal/debug/flags.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/internal/debug/flags.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+136</span></div>
                        <div class="text-start"><span class="text-danger">-21</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3e9524c9b133e1689aec8c1b"><span class="term-fg1">diff --git go-ethereum&#47;internal&#47;debug&#47;flags.go op-geth&#47;internal&#47;debug&#47;flags.go</span>
<span class="term-fg1">index e014a85d7fc87af359ccd36617e2dda6b7351d6f..d425a17db42b707471fb623b55cb026ee1892040 100644</span>
<span class="term-fg1">--- go-ethereum&#47;internal&#47;debug&#47;flags.go</span>
<span class="term-fg1">+++ op-geth&#47;internal&#47;debug&#47;flags.go</span>
<span class="term-fg36">@@ -20,8 +20,9 @@</span> import (
 	&quot;fmt&quot;
 	&quot;io&quot;
 	&quot;net&#47;http&quot;
<span class="term-fg31">-	_ &quot;net&#47;http&#47;pprof&quot; &#47;&#47; nolint: gosec</span>
<span class="term-fg32">+	_ &quot;net&#47;http&#47;pprof&quot;</span>
 	&quot;os&quot;
<span class="term-fg32">+	&quot;path&#47;filepath&quot;</span>
 	&quot;runtime&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;flags&quot;
<span class="term-fg36">@@ -32,6 +33,7 @@</span> 	&quot;github.com&#47;fjl&#47;memsize&#47;memsizeui&quot;
 	&quot;github.com&#47;mattn&#47;go-colorable&quot;
 	&quot;github.com&#47;mattn&#47;go-isatty&quot;
 	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;
<span class="term-fg32">+	&quot;gopkg.in&#47;natefinch&#47;lumberjack.v2&quot;</span>
 )
&nbsp;
 var Memsize memsizeui.Handler
<span class="term-fg36">@@ -41,17 +43,30 @@</span> 	verbosityFlag = &amp;cli.IntFlag{
 		Name:     &quot;verbosity&quot;,
 		Usage:    &quot;Logging verbosity: 0=silent, 1=error, 2=warn, 3=info, 4=debug, 5=detail&quot;,
 		Value:    3,
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logVmoduleFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.vmodule&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Per-module verbosity: comma-separated list of &lt;pattern&gt;=&lt;level&gt; (e.g. eth&#47;*=5,p2p=4)&quot;,</span>
<span class="term-fg32">+		Value:    &quot;&quot;,</span>
 		Category: flags.LoggingCategory,
 	}
 	vmoduleFlag = &amp;cli.StringFlag{
 		Name:     &quot;vmodule&quot;,
 		Usage:    &quot;Per-module verbosity: comma-separated list of &lt;pattern&gt;=&lt;level&gt; (e.g. eth&#47;*=5,p2p=4)&quot;,
 		Value:    &quot;&quot;,
<span class="term-fg32">+		Hidden:   true,</span>
 		Category: flags.LoggingCategory,
 	}
 	logjsonFlag = &amp;cli.BoolFlag{
 		Name:     &quot;log.json&quot;,
 		Usage:    &quot;Format logs with JSON&quot;,
<span class="term-fg32">+		Hidden:   true,</span>
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logFormatFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.format&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Log format to use (json|logfmt|terminal)&quot;,</span>
 		Category: flags.LoggingCategory,
 	}
 	logFileFlag = &amp;cli.StringFlag{
<span class="term-fg36">@@ -70,6 +85,34 @@</span> 		Name:     &quot;log.debug&quot;,
 		Usage:    &quot;Prepends log messages with call-site location (file and line number)&quot;,
 		Category: flags.LoggingCategory,
 	}
<span class="term-fg32">+	logRotateFlag = &amp;cli.BoolFlag{</span>
<span class="term-fg32">+		Name:  &quot;log.rotate&quot;,</span>
<span class="term-fg32">+		Usage: &quot;Enables log file rotation&quot;,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logMaxSizeMBsFlag = &amp;cli.IntFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.maxsize&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Maximum size in MBs of a single log file&quot;,</span>
<span class="term-fg32">+		Value:    100,</span>
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logMaxBackupsFlag = &amp;cli.IntFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.maxbackups&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Maximum number of log files to retain&quot;,</span>
<span class="term-fg32">+		Value:    10,</span>
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logMaxAgeFlag = &amp;cli.IntFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.maxage&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Maximum number of days to retain a log file&quot;,</span>
<span class="term-fg32">+		Value:    30,</span>
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	logCompressFlag = &amp;cli.BoolFlag{</span>
<span class="term-fg32">+		Name:     &quot;log.compress&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Compress the log files&quot;,</span>
<span class="term-fg32">+		Value:    false,</span>
<span class="term-fg32">+		Category: flags.LoggingCategory,</span>
<span class="term-fg32">+	}</span>
 	pprofFlag = &amp;cli.BoolFlag{
 		Name:     &quot;pprof&quot;,
 		Usage:    &quot;Enable the pprof HTTP server&quot;,
<span class="term-fg36">@@ -113,11 +156,18 @@</span>
 &#47;&#47; Flags holds all command-line flags required for debugging.
 var Flags = []cli.Flag{
 	verbosityFlag,
<span class="term-fg32">+	logVmoduleFlag,</span>
 	vmoduleFlag,
<span class="term-fg31">-	logjsonFlag,</span>
<span class="term-fg31">-	logFileFlag,</span>
 	backtraceAtFlag,
 	debugFlag,
<span class="term-fg32">+	logjsonFlag,</span>
<span class="term-fg32">+	logFormatFlag,</span>
<span class="term-fg32">+	logFileFlag,</span>
<span class="term-fg32">+	logRotateFlag,</span>
<span class="term-fg32">+	logMaxSizeMBsFlag,</span>
<span class="term-fg32">+	logMaxBackupsFlag,</span>
<span class="term-fg32">+	logMaxAgeFlag,</span>
<span class="term-fg32">+	logCompressFlag,</span>
 	pprofFlag,
 	pprofAddrFlag,
 	pprofPortFlag,
<span class="term-fg36">@@ -141,35 +191,83 @@</span>
 &#47;&#47; Setup initializes profiling and logging based on the CLI flags.
 &#47;&#47; It should be called as early as possible in the program.
 func Setup(ctx *cli.Context) error {
<span class="term-fg31">-	logFile := ctx.String(logFileFlag.Name)</span>
<span class="term-fg31">-	useColor := logFile == &quot;&quot; &amp;&amp; os.Getenv(&quot;TERM&quot;) != &quot;dumb&quot; &amp;&amp; (isatty.IsTerminal(os.Stderr.Fd()) || isatty.IsCygwinTerminal(os.Stderr.Fd()))</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	var logfmt log.Format</span>
<span class="term-fg31">-	if ctx.Bool(logjsonFlag.Name) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		logfmt     log.Format</span>
<span class="term-fg32">+		output     = io.Writer(os.Stderr)</span>
<span class="term-fg32">+		logFmtFlag = ctx.String(logFormatFlag.Name)</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	switch {</span>
<span class="term-fg32">+	case ctx.Bool(logjsonFlag.Name):</span>
<span class="term-fg32">+		&#47;&#47; Retain backwards compatibility with `--log.json` flag if `--log.format` not set</span>
<span class="term-fg32">+		defer log.Warn(&quot;The flag &#39;--log.json&#39; is deprecated, please use &#39;--log.format=json&#39; instead&quot;)</span>
<span class="term-fg32">+		logfmt = log.JSONFormat()</span>
<span class="term-fg32">+	case logFmtFlag == &quot;json&quot;:</span>
 		logfmt = log.JSONFormat()
<span class="term-fg31">-	} else {</span>
<span class="term-fg32">+	case logFmtFlag == &quot;logfmt&quot;:</span>
<span class="term-fg32">+		logfmt = log.LogfmtFormat()</span>
<span class="term-fg32">+	case logFmtFlag == &quot;&quot;, logFmtFlag == &quot;terminal&quot;:</span>
<span class="term-fg32">+		useColor := (isatty.IsTerminal(os.Stderr.Fd()) || isatty.IsCygwinTerminal(os.Stderr.Fd())) &amp;&amp; os.Getenv(&quot;TERM&quot;) != &quot;dumb&quot;</span>
<span class="term-fg32">+		if useColor {</span>
<span class="term-fg32">+			output = colorable.NewColorableStderr()</span>
<span class="term-fg32">+		}</span>
 		logfmt = log.TerminalFormat(useColor)
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		&#47;&#47; Unknown log format specified</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;unknown log format: %v&quot;, ctx.String(logFormatFlag.Name))</span>
 	}
<span class="term-fg31">-</span>
<span class="term-fg31">-	if logFile != &quot;&quot; {</span>
<span class="term-fg31">-		var err error</span>
<span class="term-fg31">-		logOutputStream, err = log.FileHandler(logFile, logfmt)</span>
<span class="term-fg31">-		if err != nil {</span>
<span class="term-fg31">-			return err</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		stdHandler = log.StreamHandler(output, logfmt)</span>
<span class="term-fg32">+		ostream    = stdHandler</span>
<span class="term-fg32">+		logFile    = ctx.String(logFileFlag.Name)</span>
<span class="term-fg32">+		rotation   = ctx.Bool(logRotateFlag.Name)</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	if len(logFile) &gt; 0 {</span>
<span class="term-fg32">+		if err := validateLogLocation(filepath.Dir(logFile)); err != nil {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;failed to initiatilize file logger: %v&quot;, err)</span>
 		}
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	context := []interface{}{&quot;rotate&quot;, rotation}</span>
<span class="term-fg32">+	if len(logFmtFlag) &gt; 0 {</span>
<span class="term-fg32">+		context = append(context, &quot;format&quot;, logFmtFlag)</span>
 	} else {
<span class="term-fg31">-		output := io.Writer(os.Stderr)</span>
<span class="term-fg31">-		if useColor {</span>
<span class="term-fg31">-			output = colorable.NewColorableStderr()</span>
<span class="term-fg32">+		context = append(context, &quot;format&quot;, &quot;terminal&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if rotation {</span>
<span class="term-fg32">+		&#47;&#47; Lumberjack uses &lt;processname&gt;-lumberjack.log in is.TempDir() if empty.</span>
<span class="term-fg32">+		&#47;&#47; so typically &#47;tmp&#47;geth-lumberjack.log on linux</span>
<span class="term-fg32">+		if len(logFile) &gt; 0 {</span>
<span class="term-fg32">+			context = append(context, &quot;location&quot;, logFile)</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			context = append(context, &quot;location&quot;, filepath.Join(os.TempDir(), &quot;geth-lumberjack.log&quot;))</span>
 		}
<span class="term-fg31">-		logOutputStream = log.StreamHandler(output, logfmt)</span>
<span class="term-fg32">+		ostream = log.MultiHandler(log.StreamHandler(&amp;lumberjack.Logger{</span>
<span class="term-fg32">+			Filename:   logFile,</span>
<span class="term-fg32">+			MaxSize:    ctx.Int(logMaxSizeMBsFlag.Name),</span>
<span class="term-fg32">+			MaxBackups: ctx.Int(logMaxBackupsFlag.Name),</span>
<span class="term-fg32">+			MaxAge:     ctx.Int(logMaxAgeFlag.Name),</span>
<span class="term-fg32">+			Compress:   ctx.Bool(logCompressFlag.Name),</span>
<span class="term-fg32">+		}, logfmt), stdHandler)</span>
<span class="term-fg32">+	} else if logFile != &quot;&quot; {</span>
<span class="term-fg32">+		if logOutputStream, err := log.FileHandler(logFile, logfmt); err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			ostream = log.MultiHandler(logOutputStream, stdHandler)</span>
<span class="term-fg32">+			context = append(context, &quot;location&quot;, logFile)</span>
<span class="term-fg32">+		}</span>
 	}
<span class="term-fg31">-	glogger.SetHandler(logOutputStream)</span>
<span class="term-fg32">+	glogger.SetHandler(ostream)</span>
&nbsp;
 	&#47;&#47; logging
 	verbosity := ctx.Int(verbosityFlag.Name)
 	glogger.Verbosity(log.Lvl(verbosity))
<span class="term-fg31">-	vmodule := ctx.String(vmoduleFlag.Name)</span>
<span class="term-fg32">+	vmodule := ctx.String(logVmoduleFlag.Name)</span>
<span class="term-fg32">+	if vmodule == &quot;&quot; {</span>
<span class="term-fg32">+		&#47;&#47; Retain backwards compatibility with `--vmodule` flag if `--log.vmodule` not set</span>
<span class="term-fg32">+		vmodule = ctx.String(vmoduleFlag.Name)</span>
<span class="term-fg32">+		if vmodule != &quot;&quot; {</span>
<span class="term-fg32">+			defer log.Warn(&quot;The flag &#39;--vmodule&#39; is deprecated, please use &#39;--log.vmodule&#39; instead&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	glogger.Vmodule(vmodule)
&nbsp;
 	debug := ctx.Bool(debugFlag.Name)
<span class="term-fg36">@@ -215,6 +313,9 @@</span> 		&#47;&#47; This context value (&quot;metrics.addr&quot;) represents the utils.MetricsHTTPFlag.Name.
 		&#47;&#47; It cannot be imported because it will cause a cyclical dependency.
 		StartPProf(address, !ctx.IsSet(&quot;metrics.addr&quot;))
 	}
<span class="term-fg32">+	if len(logFile) &gt; 0 || rotation {</span>
<span class="term-fg32">+		log.Info(&quot;Logging configured&quot;, context...)</span>
<span class="term-fg32">+	}</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -242,3 +343,17 @@</span> 	if closer, ok := logOutputStream.(io.Closer); ok {
 		closer.Close()
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func validateLogLocation(path string) error {</span>
<span class="term-fg32">+	if err := os.MkdirAll(path, os.ModePerm); err != nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;error creating the directory: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Check if the path is writable by trying to create a temporary file</span>
<span class="term-fg32">+	tmp := filepath.Join(path, &quot;tmp&quot;)</span>
<span class="term-fg32">+	if f, err := os.Create(tmp); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		f.Close()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return os.Remove(tmp)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-85c94ccdc1e15b27dc3f0846" role="button"
                   aria-expanded="false" aria-controls="id-85c94ccdc1e15b27dc3f0846">
                    <code>light/odr_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/light/odr_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/light/odr_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-85c94ccdc1e15b27dc3f0846"><span class="term-fg1">diff --git go-ethereum&#47;light&#47;odr_test.go op-geth&#47;light&#47;odr_test.go</span>
<span class="term-fg1">index 173298bb77f2705bbea9a7fe6db44b7c132aef0d..31ec261811d7a9a85995e781ba8af9e9bffd3b1a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;light&#47;odr_test.go</span>
<span class="term-fg1">+++ op-geth&#47;light&#47;odr_test.go</span>
<span class="term-fg36">@@ -211,7 +211,7 @@</span> 			Data:              data,
 			SkipAccountChecks: true,
 		}
 		txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-		context := core.NewEVMBlockContext(header, chain, nil)</span>
<span class="term-fg32">+		context := core.NewEVMBlockContext(header, chain, nil, config, st)</span>
 		vmenv := vm.NewEVM(context, txContext, st, config, vm.Config{NoBaseFee: true})
 		gp := new(core.GasPool).AddGas(math.MaxUint64)
 		result, _ := core.ApplyMessage(vmenv, msg, gp)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a2701d2ac6ad7415aea8ff69" role="button"
                   aria-expanded="false" aria-controls="id-a2701d2ac6ad7415aea8ff69">
                    <code>light/odr_util.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/light/odr_util.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/light/odr_util.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a2701d2ac6ad7415aea8ff69"><span class="term-fg1">diff --git go-ethereum&#47;light&#47;odr_util.go op-geth&#47;light&#47;odr_util.go</span>
<span class="term-fg1">index 786b54132aa720840f5f9dde2e088c85557d477d..37a1b7a633fb9771653825ed8c58e862a6eebd93 100644</span>
<span class="term-fg1">--- go-ethereum&#47;light&#47;odr_util.go</span>
<span class="term-fg1">+++ op-geth&#47;light&#47;odr_util.go</span>
<span class="term-fg36">@@ -175,7 +175,7 @@</span> 		}
 		genesis := rawdb.ReadCanonicalHash(odr.Database(), 0)
 		config := rawdb.ReadChainConfig(odr.Database(), genesis)
&nbsp;
<span class="term-fg31">-		if err := receipts.DeriveFields(config, block.Hash(), block.NumberU64(), block.BaseFee(), block.Transactions()); err != nil {</span>
<span class="term-fg32">+		if err := receipts.DeriveFields(config, block.Hash(), block.NumberU64(), block.Time(), block.BaseFee(), block.Transactions()); err != nil {</span>
 			return nil, err
 		}
 		rawdb.WriteReceipts(odr.Database(), hash, number, receipts)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c54a8a37f9f0e68373f89363" role="button"
                   aria-expanded="false" aria-controls="id-c54a8a37f9f0e68373f89363">
                    <code>light/postprocess.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/light/postprocess.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/light/postprocess.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+8</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c54a8a37f9f0e68373f89363"><span class="term-fg1">diff --git go-ethereum&#47;light&#47;postprocess.go op-geth&#47;light&#47;postprocess.go</span>
<span class="term-fg1">index e800a1f0f7f08721f697b1ff8eb128d75a107bfb..763ba27529ce4cc898316d5c815544cf470536e7 100644</span>
<span class="term-fg1">--- go-ethereum&#47;light&#47;postprocess.go</span>
<span class="term-fg1">+++ op-geth&#47;light&#47;postprocess.go</span>
<span class="term-fg36">@@ -206,8 +206,7 @@</span> 	}
 	var encNumber [8]byte
 	binary.BigEndian.PutUint64(encNumber[:], num)
 	data, _ := rlp.EncodeToBytes(ChtNode{hash, td})
<span class="term-fg31">-	c.trie.Update(encNumber[:], data)</span>
<span class="term-fg31">-	return nil</span>
<span class="term-fg32">+	return c.trie.Update(encNumber[:], data)</span>
 }
&nbsp;
 &#47;&#47; Commit implements core.ChainIndexerBackend
<span class="term-fg36">@@ -450,10 +449,15 @@</span> 		comp := bitutil.CompressBytes(decomp)
&nbsp;
 		decompSize += uint64(len(decomp))
 		compSize += uint64(len(comp))
<span class="term-fg32">+</span>
<span class="term-fg32">+		var terr error</span>
 		if len(comp) &gt; 0 {
<span class="term-fg31">-			b.trie.Update(encKey[:], comp)</span>
<span class="term-fg32">+			terr = b.trie.Update(encKey[:], comp)</span>
 		} else {
<span class="term-fg31">-			b.trie.Delete(encKey[:])</span>
<span class="term-fg32">+			terr = b.trie.Delete(encKey[:])</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if terr != nil {</span>
<span class="term-fg32">+			return terr</span>
 		}
 	}
 	root, nodes := b.trie.Commit(false)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-693497fd10a5643d58e7d359" role="button"
                   aria-expanded="false" aria-controls="id-693497fd10a5643d58e7d359">
                    <code>light/trie.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/light/trie.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/light/trie.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-12</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-693497fd10a5643d58e7d359"><span class="term-fg1">diff --git go-ethereum&#47;light&#47;trie.go op-geth&#47;light&#47;trie.go</span>
<span class="term-fg1">index 0ccab1588d3d9629bfd31ce0b51a460e0cf1238c..38dd6b5c27dc906fe543526fed6767f2d7e7620e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;light&#47;trie.go</span>
<span class="term-fg1">+++ op-geth&#47;light&#47;trie.go</span>
<span class="term-fg36">@@ -105,21 +105,21 @@</span> 	id   *TrieID
 	trie *trie.Trie
 }
&nbsp;
<span class="term-fg31">-func (t *odrTrie) TryGet(key []byte) ([]byte, error) {</span>
<span class="term-fg32">+func (t *odrTrie) GetStorage(_ common.Address, key []byte) ([]byte, error) {</span>
 	key = crypto.Keccak256(key)
 	var res []byte
 	err := t.do(key, func() (err error) {
<span class="term-fg31">-		res, err = t.trie.TryGet(key)</span>
<span class="term-fg32">+		res, err = t.trie.Get(key)</span>
 		return err
 	})
 	return res, err
 }
&nbsp;
<span class="term-fg31">-func (t *odrTrie) TryGetAccount(address common.Address) (*types.StateAccount, error) {</span>
<span class="term-fg32">+func (t *odrTrie) GetAccount(address common.Address) (*types.StateAccount, error) {</span>
 	var res types.StateAccount
 	key := crypto.Keccak256(address.Bytes())
 	err := t.do(key, func() (err error) {
<span class="term-fg31">-		value, err := t.trie.TryGet(key)</span>
<span class="term-fg32">+		value, err := t.trie.Get(key)</span>
 		if err != nil {
 			return err
 		}
<span class="term-fg36">@@ -131,36 +131,36 @@</span> 	})
 	return &amp;res, err
 }
&nbsp;
<span class="term-fg31">-func (t *odrTrie) TryUpdateAccount(address common.Address, acc *types.StateAccount) error {</span>
<span class="term-fg32">+func (t *odrTrie) UpdateAccount(address common.Address, acc *types.StateAccount) error {</span>
 	key := crypto.Keccak256(address.Bytes())
 	value, err := rlp.EncodeToBytes(acc)
 	if err != nil {
 		return fmt.Errorf(&quot;decoding error in account update: %w&quot;, err)
 	}
 	return t.do(key, func() error {
<span class="term-fg31">-		return t.trie.TryUpdate(key, value)</span>
<span class="term-fg32">+		return t.trie.Update(key, value)</span>
 	})
 }
&nbsp;
<span class="term-fg31">-func (t *odrTrie) TryUpdate(key, value []byte) error {</span>
<span class="term-fg32">+func (t *odrTrie) UpdateStorage(_ common.Address, key, value []byte) error {</span>
 	key = crypto.Keccak256(key)
 	return t.do(key, func() error {
<span class="term-fg31">-		return t.trie.TryUpdate(key, value)</span>
<span class="term-fg32">+		return t.trie.Update(key, value)</span>
 	})
 }
&nbsp;
<span class="term-fg31">-func (t *odrTrie) TryDelete(key []byte) error {</span>
<span class="term-fg32">+func (t *odrTrie) DeleteStorage(_ common.Address, key []byte) error {</span>
 	key = crypto.Keccak256(key)
 	return t.do(key, func() error {
<span class="term-fg31">-		return t.trie.TryDelete(key)</span>
<span class="term-fg32">+		return t.trie.Delete(key)</span>
 	})
 }
&nbsp;
 &#47;&#47; TryDeleteAccount abstracts an account deletion from the trie.
<span class="term-fg31">-func (t *odrTrie) TryDeleteAccount(address common.Address) error {</span>
<span class="term-fg32">+func (t *odrTrie) DeleteAccount(address common.Address) error {</span>
 	key := crypto.Keccak256(address.Bytes())
 	return t.do(key, func() error {
<span class="term-fg31">-		return t.trie.TryDelete(key)</span>
<span class="term-fg32">+		return t.trie.Delete(key)</span>
 	})
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-88a29715c3454eed7c58c2d5" role="button"
                   aria-expanded="false" aria-controls="id-88a29715c3454eed7c58c2d5">
                    <code>log/format.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/log/format.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/log/format.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+41</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-88a29715c3454eed7c58c2d5"><span class="term-fg1">diff --git go-ethereum&#47;log&#47;format.go op-geth&#47;log&#47;format.go</span>
<span class="term-fg1">index d7e2f820afe7940539ab37928b8ffcb79b8ffc0d..b10786efa04c777363911abef81434ef32e5cb37 100644</span>
<span class="term-fg1">--- go-ethereum&#47;log&#47;format.go</span>
<span class="term-fg1">+++ op-geth&#47;log&#47;format.go</span>
<span class="term-fg36">@@ -12,6 +12,8 @@</span> 	&quot;sync&quot;
 	&quot;sync&#47;atomic&quot;
 	&quot;time&quot;
 	&quot;unicode&#47;utf8&quot;
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 const (
<span class="term-fg36">@@ -339,12 +341,20 @@</span> 		&#47;&#47; expensive.
 		return v.Format(timeFormat)
&nbsp;
 	case *big.Int:
<span class="term-fg31">-		&#47;&#47; Big ints get consumed by the Stringer clause so we need to handle</span>
<span class="term-fg32">+		&#47;&#47; Big ints get consumed by the Stringer clause, so we need to handle</span>
 		&#47;&#47; them earlier on.
 		if v == nil {
 			return &quot;&lt;nil&gt;&quot;
 		}
 		return formatLogfmtBigInt(v)
<span class="term-fg32">+</span>
<span class="term-fg32">+	case *uint256.Int:</span>
<span class="term-fg32">+		&#47;&#47; Uint256s get consumed by the Stringer clause, so we need to handle</span>
<span class="term-fg32">+		&#47;&#47; them earlier on.</span>
<span class="term-fg32">+		if v == nil {</span>
<span class="term-fg32">+			return &quot;&lt;nil&gt;&quot;</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return formatLogfmtUint256(v)</span>
 	}
 	if term {
 		if s, ok := value.(TerminalStringer); ok {
<span class="term-fg36">@@ -446,6 +456,36 @@</span> 	}
&nbsp;
 	var (
 		text  = n.String()
<span class="term-fg32">+		buf   = make([]byte, len(text)+len(text)&#47;3)</span>
<span class="term-fg32">+		comma = 0</span>
<span class="term-fg32">+		i     = len(buf) - 1</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	for j := len(text) - 1; j &gt;= 0; j, i = j-1, i-1 {</span>
<span class="term-fg32">+		c := text[j]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		switch {</span>
<span class="term-fg32">+		case c == &#39;-&#39;:</span>
<span class="term-fg32">+			buf[i] = c</span>
<span class="term-fg32">+		case comma == 3:</span>
<span class="term-fg32">+			buf[i] = &#39;,&#39;</span>
<span class="term-fg32">+			i--</span>
<span class="term-fg32">+			comma = 0</span>
<span class="term-fg32">+			fallthrough</span>
<span class="term-fg32">+		default:</span>
<span class="term-fg32">+			buf[i] = c</span>
<span class="term-fg32">+			comma++</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return string(buf[i+1:])</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; formatLogfmtUint256 formats n with thousand separators.</span>
<span class="term-fg32">+func formatLogfmtUint256(n *uint256.Int) string {</span>
<span class="term-fg32">+	if n.IsUint64() {</span>
<span class="term-fg32">+		return FormatLogfmtUint64(n.Uint64())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		text  = n.Dec()</span>
 		buf   = make([]byte, len(text)+len(text)&#47;3)
 		comma = 0
 		i     = len(buf) - 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cfdeb08b4b7e7794ded3bfb2" role="button"
                   aria-expanded="false" aria-controls="id-cfdeb08b4b7e7794ded3bfb2">
                    <code>log/format_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/log/format_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/log/format_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+20</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cfdeb08b4b7e7794ded3bfb2"><span class="term-fg1">diff --git go-ethereum&#47;log&#47;format_test.go op-geth&#47;log&#47;format_test.go</span>
<span class="term-fg1">index cfcfe85802a48fc38d0d4b2867582427a229a79d..e08c1d1a4a9c7fa18230dd1bf15bce42de7c04fc 100644</span>
<span class="term-fg1">--- go-ethereum&#47;log&#47;format_test.go</span>
<span class="term-fg1">+++ op-geth&#47;log&#47;format_test.go</span>
<span class="term-fg36">@@ -7,6 +7,8 @@</span> 	&quot;math&#47;big&quot;
 	&quot;math&#47;rand&quot;
 	&quot;strings&quot;
 	&quot;testing&quot;
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 func TestPrettyInt64(t *testing.T) {
<span class="term-fg36">@@ -75,6 +77,24 @@</span>
 	for _, tt := range tests {
 		v, _ := new(big.Int).SetString(tt.int, 10)
 		if have := formatLogfmtBigInt(v); have != tt.s {
<span class="term-fg32">+			t.Errorf(&quot;invalid output %s, want %s&quot;, have, tt.s)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestPrettyUint256(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		int string</span>
<span class="term-fg32">+		s   string</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{&quot;111222333444555678999&quot;, &quot;111,222,333,444,555,678,999&quot;},</span>
<span class="term-fg32">+		{&quot;11122233344455567899900&quot;, &quot;11,122,233,344,455,567,899,900&quot;},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for _, tt := range tests {</span>
<span class="term-fg32">+		v := new(uint256.Int)</span>
<span class="term-fg32">+		v.SetFromDecimal(tt.int)</span>
<span class="term-fg32">+		if have := formatLogfmtUint256(v); have != tt.s {</span>
 			t.Errorf(&quot;invalid output %s, want %s&quot;, have, tt.s)
 		}
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-011e80b2543acb8db3ebe532" role="button"
                   aria-expanded="false" aria-controls="id-011e80b2543acb8db3ebe532">
                    <code>metrics/counter.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/counter.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/counter.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+7</span></div>
                        <div class="text-start"><span class="text-danger">-7</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-011e80b2543acb8db3ebe532"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;counter.go op-geth&#47;metrics&#47;counter.go</span>
<span class="term-fg1">index 2f78c90d5c64c6b376898aec3f2466c46222ee4a..55e1c59540f62f491e563aa864c73b1c04631eba 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;counter.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;counter.go</span>
<span class="term-fg36">@@ -38,13 +38,13 @@</span> func NewCounter() Counter {
 	if !Enabled {
 		return NilCounter{}
 	}
<span class="term-fg31">-	return &amp;StandardCounter{0}</span>
<span class="term-fg32">+	return &amp;StandardCounter{}</span>
 }
&nbsp;
 &#47;&#47; NewCounterForced constructs a new StandardCounter and returns it no matter if
 &#47;&#47; the global switch is enabled or not.
 func NewCounterForced() Counter {
<span class="term-fg31">-	return &amp;StandardCounter{0}</span>
<span class="term-fg32">+	return &amp;StandardCounter{}</span>
 }
&nbsp;
 &#47;&#47; NewRegisteredCounter constructs and registers a new StandardCounter.
<span class="term-fg36">@@ -115,27 +115,27 @@</span>
 &#47;&#47; StandardCounter is the standard implementation of a Counter and uses the
 &#47;&#47; sync&#47;atomic package to manage a single int64 value.
 type StandardCounter struct {
<span class="term-fg31">-	count int64</span>
<span class="term-fg32">+	count atomic.Int64</span>
 }
&nbsp;
 &#47;&#47; Clear sets the counter to zero.
 func (c *StandardCounter) Clear() {
<span class="term-fg31">-	atomic.StoreInt64(&amp;c.count, 0)</span>
<span class="term-fg32">+	c.count.Store(0)</span>
 }
&nbsp;
 &#47;&#47; Count returns the current count.
 func (c *StandardCounter) Count() int64 {
<span class="term-fg31">-	return atomic.LoadInt64(&amp;c.count)</span>
<span class="term-fg32">+	return c.count.Load()</span>
 }
&nbsp;
 &#47;&#47; Dec decrements the counter by the given amount.
 func (c *StandardCounter) Dec(i int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;c.count, -i)</span>
<span class="term-fg32">+	c.count.Add(-i)</span>
 }
&nbsp;
 &#47;&#47; Inc increments the counter by the given amount.
 func (c *StandardCounter) Inc(i int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;c.count, i)</span>
<span class="term-fg32">+	c.count.Add(i)</span>
 }
&nbsp;
 &#47;&#47; Snapshot returns a read-only copy of the counter.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f18ddc0e78816df3aa6262cf" role="button"
                   aria-expanded="false" aria-controls="id-f18ddc0e78816df3aa6262cf">
                    <code>metrics/counter_float64.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/counter_float64.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+155</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f18ddc0e78816df3aa6262cf"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;counter_float64.go op-geth&#47;metrics&#47;counter_float64.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..d1197bb8e0ae9e7747f1eff36e9ae7ebc9b7210a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;counter_float64.go</span>
<span class="term-fg36">@@ -0,0 +1,155 @@</span>
<span class="term-fg32">+package metrics</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&quot;</span>
<span class="term-fg32">+	&quot;sync&#47;atomic&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CounterFloat64 holds a float64 value that can be incremented and decremented.</span>
<span class="term-fg32">+type CounterFloat64 interface {</span>
<span class="term-fg32">+	Clear()</span>
<span class="term-fg32">+	Count() float64</span>
<span class="term-fg32">+	Dec(float64)</span>
<span class="term-fg32">+	Inc(float64)</span>
<span class="term-fg32">+	Snapshot() CounterFloat64</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetOrRegisterCounterFloat64 returns an existing CounterFloat64 or constructs and registers</span>
<span class="term-fg32">+&#47;&#47; a new StandardCounterFloat64.</span>
<span class="term-fg32">+func GetOrRegisterCounterFloat64(name string, r Registry) CounterFloat64 {</span>
<span class="term-fg32">+	if nil == r {</span>
<span class="term-fg32">+		r = DefaultRegistry</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return r.GetOrRegister(name, NewCounterFloat64).(CounterFloat64)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetOrRegisterCounterFloat64Forced returns an existing CounterFloat64 or constructs and registers a</span>
<span class="term-fg32">+&#47;&#47; new CounterFloat64 no matter the global switch is enabled or not.</span>
<span class="term-fg32">+&#47;&#47; Be sure to unregister the counter from the registry once it is of no use to</span>
<span class="term-fg32">+&#47;&#47; allow for garbage collection.</span>
<span class="term-fg32">+func GetOrRegisterCounterFloat64Forced(name string, r Registry) CounterFloat64 {</span>
<span class="term-fg32">+	if nil == r {</span>
<span class="term-fg32">+		r = DefaultRegistry</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return r.GetOrRegister(name, NewCounterFloat64Forced).(CounterFloat64)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewCounterFloat64 constructs a new StandardCounterFloat64.</span>
<span class="term-fg32">+func NewCounterFloat64() CounterFloat64 {</span>
<span class="term-fg32">+	if !Enabled {</span>
<span class="term-fg32">+		return NilCounterFloat64{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;StandardCounterFloat64{}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewCounterFloat64Forced constructs a new StandardCounterFloat64 and returns it no matter if</span>
<span class="term-fg32">+&#47;&#47; the global switch is enabled or not.</span>
<span class="term-fg32">+func NewCounterFloat64Forced() CounterFloat64 {</span>
<span class="term-fg32">+	return &amp;StandardCounterFloat64{}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewRegisteredCounterFloat64 constructs and registers a new StandardCounterFloat64.</span>
<span class="term-fg32">+func NewRegisteredCounterFloat64(name string, r Registry) CounterFloat64 {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	if nil == r {</span>
<span class="term-fg32">+		r = DefaultRegistry</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.Register(name, c)</span>
<span class="term-fg32">+	return c</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewRegisteredCounterFloat64Forced constructs and registers a new StandardCounterFloat64</span>
<span class="term-fg32">+&#47;&#47; and launches a goroutine no matter the global switch is enabled or not.</span>
<span class="term-fg32">+&#47;&#47; Be sure to unregister the counter from the registry once it is of no use to</span>
<span class="term-fg32">+&#47;&#47; allow for garbage collection.</span>
<span class="term-fg32">+func NewRegisteredCounterFloat64Forced(name string, r Registry) CounterFloat64 {</span>
<span class="term-fg32">+	c := NewCounterFloat64Forced()</span>
<span class="term-fg32">+	if nil == r {</span>
<span class="term-fg32">+		r = DefaultRegistry</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.Register(name, c)</span>
<span class="term-fg32">+	return c</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CounterFloat64Snapshot is a read-only copy of another CounterFloat64.</span>
<span class="term-fg32">+type CounterFloat64Snapshot float64</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Clear panics.</span>
<span class="term-fg32">+func (CounterFloat64Snapshot) Clear() {</span>
<span class="term-fg32">+	panic(&quot;Clear called on a CounterFloat64Snapshot&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Count returns the value at the time the snapshot was taken.</span>
<span class="term-fg32">+func (c CounterFloat64Snapshot) Count() float64 { return float64(c) }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Dec panics.</span>
<span class="term-fg32">+func (CounterFloat64Snapshot) Dec(float64) {</span>
<span class="term-fg32">+	panic(&quot;Dec called on a CounterFloat64Snapshot&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Inc panics.</span>
<span class="term-fg32">+func (CounterFloat64Snapshot) Inc(float64) {</span>
<span class="term-fg32">+	panic(&quot;Inc called on a CounterFloat64Snapshot&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Snapshot returns the snapshot.</span>
<span class="term-fg32">+func (c CounterFloat64Snapshot) Snapshot() CounterFloat64 { return c }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NilCounterFloat64 is a no-op CounterFloat64.</span>
<span class="term-fg32">+type NilCounterFloat64 struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Clear is a no-op.</span>
<span class="term-fg32">+func (NilCounterFloat64) Clear() {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Count is a no-op.</span>
<span class="term-fg32">+func (NilCounterFloat64) Count() float64 { return 0.0 }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Dec is a no-op.</span>
<span class="term-fg32">+func (NilCounterFloat64) Dec(i float64) {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Inc is a no-op.</span>
<span class="term-fg32">+func (NilCounterFloat64) Inc(i float64) {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Snapshot is a no-op.</span>
<span class="term-fg32">+func (NilCounterFloat64) Snapshot() CounterFloat64 { return NilCounterFloat64{} }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; StandardCounterFloat64 is the standard implementation of a CounterFloat64 and uses the</span>
<span class="term-fg32">+&#47;&#47; atomic to manage a single float64 value.</span>
<span class="term-fg32">+type StandardCounterFloat64 struct {</span>
<span class="term-fg32">+	floatBits atomic.Uint64</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Clear sets the counter to zero.</span>
<span class="term-fg32">+func (c *StandardCounterFloat64) Clear() {</span>
<span class="term-fg32">+	c.floatBits.Store(0)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Count returns the current value.</span>
<span class="term-fg32">+func (c *StandardCounterFloat64) Count() float64 {</span>
<span class="term-fg32">+	return math.Float64frombits(c.floatBits.Load())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Dec decrements the counter by the given amount.</span>
<span class="term-fg32">+func (c *StandardCounterFloat64) Dec(v float64) {</span>
<span class="term-fg32">+	atomicAddFloat(&amp;c.floatBits, -v)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Inc increments the counter by the given amount.</span>
<span class="term-fg32">+func (c *StandardCounterFloat64) Inc(v float64) {</span>
<span class="term-fg32">+	atomicAddFloat(&amp;c.floatBits, v)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Snapshot returns a read-only copy of the counter.</span>
<span class="term-fg32">+func (c *StandardCounterFloat64) Snapshot() CounterFloat64 {</span>
<span class="term-fg32">+	return CounterFloat64Snapshot(c.Count())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func atomicAddFloat(fbits *atomic.Uint64, v float64) {</span>
<span class="term-fg32">+	for {</span>
<span class="term-fg32">+		loadedBits := fbits.Load()</span>
<span class="term-fg32">+		newBits := math.Float64bits(math.Float64frombits(loadedBits) + v)</span>
<span class="term-fg32">+		if fbits.CompareAndSwap(loadedBits, newBits) {</span>
<span class="term-fg32">+			break</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-389a662f5dfc32ac68c033ae" role="button"
                   aria-expanded="false" aria-controls="id-389a662f5dfc32ac68c033ae">
                    <code>metrics/counter_float_64_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/counter_float_64_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+99</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-389a662f5dfc32ac68c033ae"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;counter_float_64_test.go op-geth&#47;metrics&#47;counter_float_64_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f17aca330cbed85f9ce6a11d9baaafbcabc3a9f4</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;counter_float_64_test.go</span>
<span class="term-fg36">@@ -0,0 +1,99 @@</span>
<span class="term-fg32">+package metrics</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;sync&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func BenchmarkCounterFloat64(b *testing.B) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	b.ResetTimer()</span>
<span class="term-fg32">+	for i := 0; i &lt; b.N; i++ {</span>
<span class="term-fg32">+		c.Inc(1.0)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func BenchmarkCounterFloat64Parallel(b *testing.B) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	b.ResetTimer()</span>
<span class="term-fg32">+	var wg sync.WaitGroup</span>
<span class="term-fg32">+	for i := 0; i &lt; 10; i++ {</span>
<span class="term-fg32">+		wg.Add(1)</span>
<span class="term-fg32">+		go func() {</span>
<span class="term-fg32">+			for i := 0; i &lt; b.N; i++ {</span>
<span class="term-fg32">+				c.Inc(1.0)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			wg.Done()</span>
<span class="term-fg32">+		}()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	wg.Wait()</span>
<span class="term-fg32">+	if have, want := c.Count(), 10.0*float64(b.N); have != want {</span>
<span class="term-fg32">+		b.Fatalf(&quot;have %f want %f&quot;, have, want)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Clear(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Inc(1.0)</span>
<span class="term-fg32">+	c.Clear()</span>
<span class="term-fg32">+	if count := c.Count(); count != 0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): 0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Dec1(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Dec(1.0)</span>
<span class="term-fg32">+	if count := c.Count(); count != -1.0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): -1.0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Dec2(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Dec(2.0)</span>
<span class="term-fg32">+	if count := c.Count(); count != -2.0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): -2.0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Inc1(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Inc(1.0)</span>
<span class="term-fg32">+	if count := c.Count(); count != 1.0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): 1.0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Inc2(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Inc(2.0)</span>
<span class="term-fg32">+	if count := c.Count(); count != 2.0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): 2.0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Snapshot(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	c.Inc(1.0)</span>
<span class="term-fg32">+	snapshot := c.Snapshot()</span>
<span class="term-fg32">+	c.Inc(1.0)</span>
<span class="term-fg32">+	if count := snapshot.Count(); count != 1.0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): 1.0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCounterFloat64Zero(t *testing.T) {</span>
<span class="term-fg32">+	c := NewCounterFloat64()</span>
<span class="term-fg32">+	if count := c.Count(); count != 0 {</span>
<span class="term-fg32">+		t.Errorf(&quot;c.Count(): 0 != %v\n&quot;, count)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestGetOrRegisterCounterFloat64(t *testing.T) {</span>
<span class="term-fg32">+	r := NewRegistry()</span>
<span class="term-fg32">+	NewRegisteredCounterFloat64(&quot;foo&quot;, r).Inc(47.0)</span>
<span class="term-fg32">+	if c := GetOrRegisterCounterFloat64(&quot;foo&quot;, r); c.Count() != 47.0 {</span>
<span class="term-fg32">+		t.Fatal(c)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f372591fdc5244b8fd5cf147" role="button"
                   aria-expanded="false" aria-controls="id-f372591fdc5244b8fd5cf147">
                    <code>metrics/ewma.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/ewma.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/ewma.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f372591fdc5244b8fd5cf147"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;ewma.go op-geth&#47;metrics&#47;ewma.go</span>
<span class="term-fg1">index 039286493ebcdb97b06c936d9aa97073fff97e01..ed95cba19b4f81224ee72bad5cbb6180ad76edf9 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;ewma.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;ewma.go</span>
<span class="term-fg36">@@ -75,7 +75,7 @@</span> &#47;&#47; StandardEWMA is the standard implementation of an EWMA and tracks the number
 &#47;&#47; of uncounted events and processes them on each tick.  It uses the
 &#47;&#47; sync&#47;atomic package to manage uncounted events.
 type StandardEWMA struct {
<span class="term-fg31">-	uncounted int64 &#47;&#47; &#47;!\ this should be the first member to ensure 64-bit alignment</span>
<span class="term-fg32">+	uncounted atomic.Int64</span>
 	alpha     float64
 	rate      float64
 	init      bool
<span class="term-fg36">@@ -97,8 +97,8 @@</span>
 &#47;&#47; Tick ticks the clock to update the moving average.  It assumes it is called
 &#47;&#47; every five seconds.
 func (a *StandardEWMA) Tick() {
<span class="term-fg31">-	count := atomic.LoadInt64(&amp;a.uncounted)</span>
<span class="term-fg31">-	atomic.AddInt64(&amp;a.uncounted, -count)</span>
<span class="term-fg32">+	count := a.uncounted.Load()</span>
<span class="term-fg32">+	a.uncounted.Add(-count)</span>
 	instantRate := float64(count) &#47; float64(5*time.Second)
 	a.mutex.Lock()
 	defer a.mutex.Unlock()
<span class="term-fg36">@@ -112,5 +112,5 @@</span> }
&nbsp;
 &#47;&#47; Update adds n uncounted events.
 func (a *StandardEWMA) Update(n int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;a.uncounted, n)</span>
<span class="term-fg32">+	a.uncounted.Add(n)</span>
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ac38b7cf24f052b67aa36ec" role="button"
                   aria-expanded="false" aria-controls="id-8ac38b7cf24f052b67aa36ec">
                    <code>metrics/exp/exp.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/exp/exp.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/exp/exp.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+7</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ac38b7cf24f052b67aa36ec"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;exp&#47;exp.go op-geth&#47;metrics&#47;exp&#47;exp.go</span>
<span class="term-fg1">index 3ebe8cc68aad358d91bde69685cbc8e79a268a65..2b04eeab271f96167b8d95e858e79d54cfed49da 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;exp&#47;exp.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;exp&#47;exp.go</span>
<span class="term-fg36">@@ -100,6 +100,11 @@</span> 	v := exp.getInt(name)
 	v.Set(metric.Count())
 }
&nbsp;
<span class="term-fg32">+func (exp *exp) publishCounterFloat64(name string, metric metrics.CounterFloat64) {</span>
<span class="term-fg32">+	v := exp.getFloat(name)</span>
<span class="term-fg32">+	v.Set(metric.Count())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func (exp *exp) publishGauge(name string, metric metrics.Gauge) {
 	v := exp.getInt(name)
 	v.Set(metric.Value())
<span class="term-fg36">@@ -167,6 +172,8 @@</span> 	exp.registry.Each(func(name string, i interface{}) {
 		switch i := i.(type) {
 		case metrics.Counter:
 			exp.publishCounter(name, i)
<span class="term-fg32">+		case metrics.CounterFloat64:</span>
<span class="term-fg32">+			exp.publishCounterFloat64(name, i)</span>
 		case metrics.Gauge:
 			exp.publishGauge(name, i)
 		case metrics.GaugeFloat64:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-35c5daafc748c36e34e36ec4" role="button"
                   aria-expanded="false" aria-controls="id-35c5daafc748c36e34e36ec4">
                    <code>metrics/gauge.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/gauge.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/gauge.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-35c5daafc748c36e34e36ec4"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;gauge.go op-geth&#47;metrics&#47;gauge.go</span>
<span class="term-fg1">index b6b2758b0d138625db5598f2d63685af75db23fc..81137d7f7c5ea3ba77c1a83f8c64f579a2ea7a4e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;gauge.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;gauge.go</span>
<span class="term-fg36">@@ -25,7 +25,7 @@</span> func NewGauge() Gauge {
 	if !Enabled {
 		return NilGauge{}
 	}
<span class="term-fg31">-	return &amp;StandardGauge{0}</span>
<span class="term-fg32">+	return &amp;StandardGauge{}</span>
 }
&nbsp;
 &#47;&#47; NewRegisteredGauge constructs and registers a new StandardGauge.
<span class="term-fg36">@@ -101,7 +101,7 @@</span>
 &#47;&#47; StandardGauge is the standard implementation of a Gauge and uses the
 &#47;&#47; sync&#47;atomic package to manage a single int64 value.
 type StandardGauge struct {
<span class="term-fg31">-	value int64</span>
<span class="term-fg32">+	value atomic.Int64</span>
 }
&nbsp;
 &#47;&#47; Snapshot returns a read-only copy of the gauge.
<span class="term-fg36">@@ -111,22 +111,22 @@</span> }
&nbsp;
 &#47;&#47; Update updates the gauge&#39;s value.
 func (g *StandardGauge) Update(v int64) {
<span class="term-fg31">-	atomic.StoreInt64(&amp;g.value, v)</span>
<span class="term-fg32">+	g.value.Store(v)</span>
 }
&nbsp;
 &#47;&#47; Value returns the gauge&#39;s current value.
 func (g *StandardGauge) Value() int64 {
<span class="term-fg31">-	return atomic.LoadInt64(&amp;g.value)</span>
<span class="term-fg32">+	return g.value.Load()</span>
 }
&nbsp;
 &#47;&#47; Dec decrements the gauge&#39;s current value by the given amount.
 func (g *StandardGauge) Dec(i int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;g.value, -i)</span>
<span class="term-fg32">+	g.value.Add(-i)</span>
 }
&nbsp;
 &#47;&#47; Inc increments the gauge&#39;s current value by the given amount.
 func (g *StandardGauge) Inc(i int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;g.value, i)</span>
<span class="term-fg32">+	g.value.Add(i)</span>
 }
&nbsp;
 &#47;&#47; FunctionalGauge returns value from given function</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d4ec2ac050a81291b1936e1c" role="button"
                   aria-expanded="false" aria-controls="id-d4ec2ac050a81291b1936e1c">
                    <code>metrics/gauge_float64.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/gauge_float64.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/gauge_float64.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+9</span></div>
                        <div class="text-start"><span class="text-danger">-13</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d4ec2ac050a81291b1936e1c"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;gauge_float64.go op-geth&#47;metrics&#47;gauge_float64.go</span>
<span class="term-fg1">index 66819c957774703e520c43df501939c1625c7e4f..237ff8036e01445b8adfb73c221aba43537e1bb2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;gauge_float64.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;gauge_float64.go</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 package metrics
&nbsp;
<span class="term-fg31">-import &quot;sync&quot;</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&quot;</span>
<span class="term-fg32">+	&quot;sync&#47;atomic&quot;</span>
<span class="term-fg32">+)</span>
&nbsp;
 &#47;&#47; GaugeFloat64s hold a float64 value that can be set arbitrarily.
 type GaugeFloat64 interface {
<span class="term-fg36">@@ -23,9 +26,7 @@</span> func NewGaugeFloat64() GaugeFloat64 {
 	if !Enabled {
 		return NilGaugeFloat64{}
 	}
<span class="term-fg31">-	return &amp;StandardGaugeFloat64{</span>
<span class="term-fg31">-		value: 0.0,</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+	return &amp;StandardGaugeFloat64{}</span>
 }
&nbsp;
 &#47;&#47; NewRegisteredGaugeFloat64 constructs and registers a new StandardGaugeFloat64.
<span class="term-fg36">@@ -83,10 +84,9 @@</span> &#47;&#47; Value is a no-op.
 func (NilGaugeFloat64) Value() float64 { return 0.0 }
&nbsp;
 &#47;&#47; StandardGaugeFloat64 is the standard implementation of a GaugeFloat64 and uses
<span class="term-fg31">-&#47;&#47; sync.Mutex to manage a single float64 value.</span>
<span class="term-fg32">+&#47;&#47; atomic to manage a single float64 value.</span>
 type StandardGaugeFloat64 struct {
<span class="term-fg31">-	mutex sync.Mutex</span>
<span class="term-fg31">-	value float64</span>
<span class="term-fg32">+	floatBits atomic.Uint64</span>
 }
&nbsp;
 &#47;&#47; Snapshot returns a read-only copy of the gauge.
<span class="term-fg36">@@ -96,16 +96,12 @@</span> }
&nbsp;
 &#47;&#47; Update updates the gauge&#39;s value.
 func (g *StandardGaugeFloat64) Update(v float64) {
<span class="term-fg31">-	g.mutex.Lock()</span>
<span class="term-fg31">-	defer g.mutex.Unlock()</span>
<span class="term-fg31">-	g.value = v</span>
<span class="term-fg32">+	g.floatBits.Store(math.Float64bits(v))</span>
 }
&nbsp;
 &#47;&#47; Value returns the gauge&#39;s current value.
 func (g *StandardGaugeFloat64) Value() float64 {
<span class="term-fg31">-	g.mutex.Lock()</span>
<span class="term-fg31">-	defer g.mutex.Unlock()</span>
<span class="term-fg31">-	return g.value</span>
<span class="term-fg32">+	return math.Float64frombits(g.floatBits.Load())</span>
 }
&nbsp;
 &#47;&#47; FunctionalGaugeFloat64 returns value from given function</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d1eb13a10033599057f1a696" role="button"
                   aria-expanded="false" aria-controls="id-d1eb13a10033599057f1a696">
                    <code>metrics/gauge_float64_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/gauge_float64_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/gauge_float64_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+22</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d1eb13a10033599057f1a696"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;gauge_float64_test.go op-geth&#47;metrics&#47;gauge_float64_test.go</span>
<span class="term-fg1">index 7b854d232ba8af76c1d5e7a49a57a808230be294..647d09000935bb47a181095d46b24d0db8ee8d93 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;gauge_float64_test.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;gauge_float64_test.go</span>
<span class="term-fg36">@@ -1,12 +1,33 @@</span>
 package metrics
&nbsp;
<span class="term-fg31">-import &quot;testing&quot;</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;sync&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+)</span>
&nbsp;
 func BenchmarkGaugeFloat64(b *testing.B) {
 	g := NewGaugeFloat64()
 	b.ResetTimer()
 	for i := 0; i &lt; b.N; i++ {
 		g.Update(float64(i))
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func BenchmarkGaugeFloat64Parallel(b *testing.B) {</span>
<span class="term-fg32">+	c := NewGaugeFloat64()</span>
<span class="term-fg32">+	var wg sync.WaitGroup</span>
<span class="term-fg32">+	for i := 0; i &lt; 10; i++ {</span>
<span class="term-fg32">+		wg.Add(1)</span>
<span class="term-fg32">+		go func() {</span>
<span class="term-fg32">+			for i := 0; i &lt; b.N; i++ {</span>
<span class="term-fg32">+				c.Update(float64(i))</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			wg.Done()</span>
<span class="term-fg32">+		}()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	wg.Wait()</span>
<span class="term-fg32">+	if have, want := c.Value(), float64(b.N-1); have != want {</span>
<span class="term-fg32">+		b.Fatalf(&quot;have %f want %f&quot;, have, want)</span>
 	}
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c925f63baa80c84cf387fd19" role="button"
                   aria-expanded="false" aria-controls="id-c925f63baa80c84cf387fd19">
                    <code>metrics/graphite.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/graphite.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/graphite.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c925f63baa80c84cf387fd19"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;graphite.go op-geth&#47;metrics&#47;graphite.go</span>
<span class="term-fg1">index 142eec86beb4a927590fa02326083ab18323d9e7..29f72b0c4181109f4a4c5b98d707b9f3db8986a2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;graphite.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;graphite.go</span>
<span class="term-fg36">@@ -67,6 +67,8 @@</span> 	c.Registry.Each(func(name string, i interface{}) {
 		switch metric := i.(type) {
 		case Counter:
 			fmt.Fprintf(w, &quot;%s.%s.count %d %d\n&quot;, c.Prefix, name, metric.Count(), now)
<span class="term-fg32">+		case CounterFloat64:</span>
<span class="term-fg32">+			fmt.Fprintf(w, &quot;%s.%s.count %f %d\n&quot;, c.Prefix, name, metric.Count(), now)</span>
 		case Gauge:
 			fmt.Fprintf(w, &quot;%s.%s.value %d %d\n&quot;, c.Prefix, name, metric.Value(), now)
 		case GaugeFloat64:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f497c68cb84aca8b2767c8ca" role="button"
                   aria-expanded="false" aria-controls="id-f497c68cb84aca8b2767c8ca">
                    <code>metrics/influxdb/influxdb.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/influxdb/influxdb.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/influxdb/influxdb.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+100</span></div>
                        <div class="text-start"><span class="text-danger">-248</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f497c68cb84aca8b2767c8ca"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;influxdb&#47;influxdb.go op-geth&#47;metrics&#47;influxdb&#47;influxdb.go</span>
<span class="term-fg1">index 748c692e1310dd281323fe7a91ed77077c7a72b4..5dfbbab3edeb6b4ad2271e93c617e8ddbac41ce5 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;influxdb&#47;influxdb.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;influxdb&#47;influxdb.go</span>
<span class="term-fg36">@@ -2,260 +2,112 @@</span> package influxdb
&nbsp;
 import (
 	&quot;fmt&quot;
<span class="term-fg31">-	uurl &quot;net&#47;url&quot;</span>
<span class="term-fg31">-	&quot;time&quot;</span>
&nbsp;
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;metrics&quot;
<span class="term-fg31">-	&quot;github.com&#47;influxdata&#47;influxdb&#47;client&quot;</span>
 )
&nbsp;
<span class="term-fg31">-type reporter struct {</span>
<span class="term-fg31">-	reg      metrics.Registry</span>
<span class="term-fg31">-	interval time.Duration</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	url       uurl.URL</span>
<span class="term-fg31">-	database  string</span>
<span class="term-fg31">-	username  string</span>
<span class="term-fg31">-	password  string</span>
<span class="term-fg31">-	namespace string</span>
<span class="term-fg31">-	tags      map[string]string</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	client *client.Client</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	cache map[string]int64</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-&#47;&#47; InfluxDB starts a InfluxDB reporter which will post the from the given metrics.Registry at each d interval.</span>
<span class="term-fg31">-func InfluxDB(r metrics.Registry, d time.Duration, url, database, username, password, namespace string) {</span>
<span class="term-fg31">-	InfluxDBWithTags(r, d, url, database, username, password, namespace, nil)</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-&#47;&#47; InfluxDBWithTags starts a InfluxDB reporter which will post the from the given metrics.Registry at each d interval with the specified tags</span>
<span class="term-fg31">-func InfluxDBWithTags(r metrics.Registry, d time.Duration, url, database, username, password, namespace string, tags map[string]string) {</span>
<span class="term-fg31">-	u, err := uurl.Parse(url)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		log.Warn(&quot;Unable to parse InfluxDB&quot;, &quot;url&quot;, url, &quot;err&quot;, err)</span>
<span class="term-fg31">-		return</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	rep := &amp;reporter{</span>
<span class="term-fg31">-		reg:       r,</span>
<span class="term-fg31">-		interval:  d,</span>
<span class="term-fg31">-		url:       *u,</span>
<span class="term-fg31">-		database:  database,</span>
<span class="term-fg31">-		username:  username,</span>
<span class="term-fg31">-		password:  password,</span>
<span class="term-fg31">-		namespace: namespace,</span>
<span class="term-fg31">-		tags:      tags,</span>
<span class="term-fg31">-		cache:     make(map[string]int64),</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if err := rep.makeClient(); err != nil {</span>
<span class="term-fg31">-		log.Warn(&quot;Unable to make InfluxDB client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-		return</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	rep.run()</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-&#47;&#47; InfluxDBWithTagsOnce runs once an InfluxDB reporter and post the given metrics.Registry with the specified tags</span>
<span class="term-fg31">-func InfluxDBWithTagsOnce(r metrics.Registry, url, database, username, password, namespace string, tags map[string]string) error {</span>
<span class="term-fg31">-	u, err := uurl.Parse(url)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		return fmt.Errorf(&quot;unable to parse InfluxDB. url: %s, err: %v&quot;, url, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	rep := &amp;reporter{</span>
<span class="term-fg31">-		reg:       r,</span>
<span class="term-fg31">-		url:       *u,</span>
<span class="term-fg31">-		database:  database,</span>
<span class="term-fg31">-		username:  username,</span>
<span class="term-fg31">-		password:  password,</span>
<span class="term-fg31">-		namespace: namespace,</span>
<span class="term-fg31">-		tags:      tags,</span>
<span class="term-fg31">-		cache:     make(map[string]int64),</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if err := rep.makeClient(); err != nil {</span>
<span class="term-fg31">-		return fmt.Errorf(&quot;unable to make InfluxDB client. err: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	if err := rep.send(); err != nil {</span>
<span class="term-fg31">-		return fmt.Errorf(&quot;unable to send to InfluxDB. err: %v&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	return nil</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-func (r *reporter) makeClient() (err error) {</span>
<span class="term-fg31">-	r.client, err = client.NewClient(client.Config{</span>
<span class="term-fg31">-		URL:      r.url,</span>
<span class="term-fg31">-		Username: r.username,</span>
<span class="term-fg31">-		Password: r.password,</span>
<span class="term-fg31">-		Timeout:  10 * time.Second,</span>
<span class="term-fg31">-	})</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	return</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-func (r *reporter) run() {</span>
<span class="term-fg31">-	intervalTicker := time.NewTicker(r.interval)</span>
<span class="term-fg31">-	pingTicker := time.NewTicker(time.Second * 5)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	defer intervalTicker.Stop()</span>
<span class="term-fg31">-	defer pingTicker.Stop()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	for {</span>
<span class="term-fg31">-		select {</span>
<span class="term-fg31">-		case &lt;-intervalTicker.C:</span>
<span class="term-fg31">-			if err := r.send(); err != nil {</span>
<span class="term-fg31">-				log.Warn(&quot;Unable to send to InfluxDB&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-		case &lt;-pingTicker.C:</span>
<span class="term-fg31">-			_, _, err := r.client.Ping()</span>
<span class="term-fg31">-			if err != nil {</span>
<span class="term-fg31">-				log.Warn(&quot;Got error while sending a ping to InfluxDB, trying to recreate client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-				if err = r.makeClient(); err != nil {</span>
<span class="term-fg31">-					log.Warn(&quot;Unable to make InfluxDB client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-			}</span>
<span class="term-fg32">+func readMeter(namespace, name string, i interface{}) (string, map[string]interface{}) {</span>
<span class="term-fg32">+	switch metric := i.(type) {</span>
<span class="term-fg32">+	case metrics.Counter:</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.count&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;value&quot;: metric.Count(),</span>
 		}
<span class="term-fg31">-	}</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-func (r *reporter) send() error {</span>
<span class="term-fg31">-	var pts []client.Point</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	r.reg.Each(func(name string, i interface{}) {</span>
<span class="term-fg31">-		now := time.Now()</span>
<span class="term-fg31">-		namespace := r.namespace</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		switch metric := i.(type) {</span>
<span class="term-fg31">-		case metrics.Counter:</span>
<span class="term-fg31">-			count := metric.Count()</span>
<span class="term-fg31">-			pts = append(pts, client.Point{</span>
<span class="term-fg31">-				Measurement: fmt.Sprintf(&quot;%s%s.count&quot;, namespace, name),</span>
<span class="term-fg31">-				Tags:        r.tags,</span>
<span class="term-fg31">-				Fields: map[string]interface{}{</span>
<span class="term-fg31">-					&quot;value&quot;: count,</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				Time: now,</span>
<span class="term-fg31">-			})</span>
<span class="term-fg31">-		case metrics.Gauge:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			pts = append(pts, client.Point{</span>
<span class="term-fg31">-				Measurement: fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name),</span>
<span class="term-fg31">-				Tags:        r.tags,</span>
<span class="term-fg31">-				Fields: map[string]interface{}{</span>
<span class="term-fg31">-					&quot;value&quot;: ms.Value(),</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				Time: now,</span>
<span class="term-fg31">-			})</span>
<span class="term-fg31">-		case metrics.GaugeFloat64:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			pts = append(pts, client.Point{</span>
<span class="term-fg31">-				Measurement: fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name),</span>
<span class="term-fg31">-				Tags:        r.tags,</span>
<span class="term-fg31">-				Fields: map[string]interface{}{</span>
<span class="term-fg31">-					&quot;value&quot;: ms.Value(),</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				Time: now,</span>
<span class="term-fg31">-			})</span>
<span class="term-fg31">-		case metrics.Histogram:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			if ms.Count() &gt; 0 {</span>
<span class="term-fg31">-				ps := ms.Percentiles([]float64{0.25, 0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
<span class="term-fg31">-				fields := map[string]interface{}{</span>
<span class="term-fg31">-					&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg31">-					&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg31">-					&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg31">-					&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg31">-					&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg31">-					&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg31">-					&quot;p25&quot;:      ps[0],</span>
<span class="term-fg31">-					&quot;p50&quot;:      ps[1],</span>
<span class="term-fg31">-					&quot;p75&quot;:      ps[2],</span>
<span class="term-fg31">-					&quot;p95&quot;:      ps[3],</span>
<span class="term-fg31">-					&quot;p99&quot;:      ps[4],</span>
<span class="term-fg31">-					&quot;p999&quot;:     ps[5],</span>
<span class="term-fg31">-					&quot;p9999&quot;:    ps[6],</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-				pts = append(pts, client.Point{</span>
<span class="term-fg31">-					Measurement: fmt.Sprintf(&quot;%s%s.histogram&quot;, namespace, name),</span>
<span class="term-fg31">-					Tags:        r.tags,</span>
<span class="term-fg31">-					Fields:      fields,</span>
<span class="term-fg31">-					Time:        now,</span>
<span class="term-fg31">-				})</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-		case metrics.Meter:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			pts = append(pts, client.Point{</span>
<span class="term-fg31">-				Measurement: fmt.Sprintf(&quot;%s%s.meter&quot;, namespace, name),</span>
<span class="term-fg31">-				Tags:        r.tags,</span>
<span class="term-fg31">-				Fields: map[string]interface{}{</span>
<span class="term-fg31">-					&quot;count&quot;: ms.Count(),</span>
<span class="term-fg31">-					&quot;m1&quot;:    ms.Rate1(),</span>
<span class="term-fg31">-					&quot;m5&quot;:    ms.Rate5(),</span>
<span class="term-fg31">-					&quot;m15&quot;:   ms.Rate15(),</span>
<span class="term-fg31">-					&quot;mean&quot;:  ms.RateMean(),</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				Time: now,</span>
<span class="term-fg31">-			})</span>
<span class="term-fg31">-		case metrics.Timer:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
<span class="term-fg31">-			pts = append(pts, client.Point{</span>
<span class="term-fg31">-				Measurement: fmt.Sprintf(&quot;%s%s.timer&quot;, namespace, name),</span>
<span class="term-fg31">-				Tags:        r.tags,</span>
<span class="term-fg31">-				Fields: map[string]interface{}{</span>
<span class="term-fg31">-					&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg31">-					&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg31">-					&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg31">-					&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg31">-					&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg31">-					&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg31">-					&quot;p50&quot;:      ps[0],</span>
<span class="term-fg31">-					&quot;p75&quot;:      ps[1],</span>
<span class="term-fg31">-					&quot;p95&quot;:      ps[2],</span>
<span class="term-fg31">-					&quot;p99&quot;:      ps[3],</span>
<span class="term-fg31">-					&quot;p999&quot;:     ps[4],</span>
<span class="term-fg31">-					&quot;p9999&quot;:    ps[5],</span>
<span class="term-fg31">-					&quot;m1&quot;:       ms.Rate1(),</span>
<span class="term-fg31">-					&quot;m5&quot;:       ms.Rate5(),</span>
<span class="term-fg31">-					&quot;m15&quot;:      ms.Rate15(),</span>
<span class="term-fg31">-					&quot;meanrate&quot;: ms.RateMean(),</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				Time: now,</span>
<span class="term-fg31">-			})</span>
<span class="term-fg31">-		case metrics.ResettingTimer:</span>
<span class="term-fg31">-			t := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			if len(t.Values()) &gt; 0 {</span>
<span class="term-fg31">-				ps := t.Percentiles([]float64{50, 95, 99})</span>
<span class="term-fg31">-				val := t.Values()</span>
<span class="term-fg31">-				pts = append(pts, client.Point{</span>
<span class="term-fg31">-					Measurement: fmt.Sprintf(&quot;%s%s.span&quot;, namespace, name),</span>
<span class="term-fg31">-					Tags:        r.tags,</span>
<span class="term-fg31">-					Fields: map[string]interface{}{</span>
<span class="term-fg31">-						&quot;count&quot;: len(val),</span>
<span class="term-fg31">-						&quot;max&quot;:   val[len(val)-1],</span>
<span class="term-fg31">-						&quot;mean&quot;:  t.Mean(),</span>
<span class="term-fg31">-						&quot;min&quot;:   val[0],</span>
<span class="term-fg31">-						&quot;p50&quot;:   ps[0],</span>
<span class="term-fg31">-						&quot;p95&quot;:   ps[1],</span>
<span class="term-fg31">-						&quot;p99&quot;:   ps[2],</span>
<span class="term-fg31">-					},</span>
<span class="term-fg31">-					Time: now,</span>
<span class="term-fg31">-				})</span>
<span class="term-fg31">-			}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.CounterFloat64:</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.count&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;value&quot;: metric.Count(),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.Gauge:</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;value&quot;: metric.Snapshot().Value(),</span>
 		}
<span class="term-fg31">-	})</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.GaugeFloat64:</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;value&quot;: metric.Snapshot().Value(),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.Histogram:</span>
<span class="term-fg32">+		ms := metric.Snapshot()</span>
<span class="term-fg32">+		if ms.Count() &lt;= 0 {</span>
<span class="term-fg32">+			break</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		ps := ms.Percentiles([]float64{0.25, 0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.histogram&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg32">+			&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg32">+			&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg32">+			&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg32">+			&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg32">+			&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg32">+			&quot;p25&quot;:      ps[0],</span>
<span class="term-fg32">+			&quot;p50&quot;:      ps[1],</span>
<span class="term-fg32">+			&quot;p75&quot;:      ps[2],</span>
<span class="term-fg32">+			&quot;p95&quot;:      ps[3],</span>
<span class="term-fg32">+			&quot;p99&quot;:      ps[4],</span>
<span class="term-fg32">+			&quot;p999&quot;:     ps[5],</span>
<span class="term-fg32">+			&quot;p9999&quot;:    ps[6],</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.Meter:</span>
<span class="term-fg32">+		ms := metric.Snapshot()</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.meter&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;count&quot;: ms.Count(),</span>
<span class="term-fg32">+			&quot;m1&quot;:    ms.Rate1(),</span>
<span class="term-fg32">+			&quot;m5&quot;:    ms.Rate5(),</span>
<span class="term-fg32">+			&quot;m15&quot;:   ms.Rate15(),</span>
<span class="term-fg32">+			&quot;mean&quot;:  ms.RateMean(),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.Timer:</span>
<span class="term-fg32">+		ms := metric.Snapshot()</span>
<span class="term-fg32">+		ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
&nbsp;
<span class="term-fg31">-	bps := client.BatchPoints{</span>
<span class="term-fg31">-		Points:   pts,</span>
<span class="term-fg31">-		Database: r.database,</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.timer&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg32">+			&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg32">+			&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg32">+			&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg32">+			&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg32">+			&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg32">+			&quot;p50&quot;:      ps[0],</span>
<span class="term-fg32">+			&quot;p75&quot;:      ps[1],</span>
<span class="term-fg32">+			&quot;p95&quot;:      ps[2],</span>
<span class="term-fg32">+			&quot;p99&quot;:      ps[3],</span>
<span class="term-fg32">+			&quot;p999&quot;:     ps[4],</span>
<span class="term-fg32">+			&quot;p9999&quot;:    ps[5],</span>
<span class="term-fg32">+			&quot;m1&quot;:       ms.Rate1(),</span>
<span class="term-fg32">+			&quot;m5&quot;:       ms.Rate5(),</span>
<span class="term-fg32">+			&quot;m15&quot;:      ms.Rate15(),</span>
<span class="term-fg32">+			&quot;meanrate&quot;: ms.RateMean(),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
<span class="term-fg32">+	case metrics.ResettingTimer:</span>
<span class="term-fg32">+		t := metric.Snapshot()</span>
<span class="term-fg32">+		if len(t.Values()) == 0 {</span>
<span class="term-fg32">+			break</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		ps := t.Percentiles([]float64{50, 95, 99})</span>
<span class="term-fg32">+		val := t.Values()</span>
<span class="term-fg32">+		measurement := fmt.Sprintf(&quot;%s%s.span&quot;, namespace, name)</span>
<span class="term-fg32">+		fields := map[string]interface{}{</span>
<span class="term-fg32">+			&quot;count&quot;: len(val),</span>
<span class="term-fg32">+			&quot;max&quot;:   val[len(val)-1],</span>
<span class="term-fg32">+			&quot;mean&quot;:  t.Mean(),</span>
<span class="term-fg32">+			&quot;min&quot;:   val[0],</span>
<span class="term-fg32">+			&quot;p50&quot;:   ps[0],</span>
<span class="term-fg32">+			&quot;p95&quot;:   ps[1],</span>
<span class="term-fg32">+			&quot;p99&quot;:   ps[2],</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return measurement, fields</span>
 	}
<span class="term-fg31">-</span>
<span class="term-fg31">-	_, err := r.client.Write(bps)</span>
<span class="term-fg31">-	return err</span>
<span class="term-fg32">+	return &quot;&quot;, nil</span>
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-979e901d80cd57c0ed763e01" role="button"
                   aria-expanded="false" aria-controls="id-979e901d80cd57c0ed763e01">
                    <code>metrics/influxdb/influxdbv1.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/influxdb/influxdbv1.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+145</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-979e901d80cd57c0ed763e01"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;influxdb&#47;influxdbv1.go op-geth&#47;metrics&#47;influxdb&#47;influxdbv1.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f65d30ef959097cab6530f46acc5694a0e4e86b0</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;influxdb&#47;influxdbv1.go</span>
<span class="term-fg36">@@ -0,0 +1,145 @@</span>
<span class="term-fg32">+package influxdb</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	uurl &quot;net&#47;url&quot;</span>
<span class="term-fg32">+	&quot;time&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;metrics&quot;</span>
<span class="term-fg32">+	client &quot;github.com&#47;influxdata&#47;influxdb1-client&#47;v2&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type reporter struct {</span>
<span class="term-fg32">+	reg      metrics.Registry</span>
<span class="term-fg32">+	interval time.Duration</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	url       uurl.URL</span>
<span class="term-fg32">+	database  string</span>
<span class="term-fg32">+	username  string</span>
<span class="term-fg32">+	password  string</span>
<span class="term-fg32">+	namespace string</span>
<span class="term-fg32">+	tags      map[string]string</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	client client.Client</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	cache map[string]int64</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; InfluxDB starts a InfluxDB reporter which will post the from the given metrics.Registry at each d interval.</span>
<span class="term-fg32">+func InfluxDB(r metrics.Registry, d time.Duration, url, database, username, password, namespace string) {</span>
<span class="term-fg32">+	InfluxDBWithTags(r, d, url, database, username, password, namespace, nil)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; InfluxDBWithTags starts a InfluxDB reporter which will post the from the given metrics.Registry at each d interval with the specified tags</span>
<span class="term-fg32">+func InfluxDBWithTags(r metrics.Registry, d time.Duration, url, database, username, password, namespace string, tags map[string]string) {</span>
<span class="term-fg32">+	u, err := uurl.Parse(url)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Warn(&quot;Unable to parse InfluxDB&quot;, &quot;url&quot;, url, &quot;err&quot;, err)</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	rep := &amp;reporter{</span>
<span class="term-fg32">+		reg:       r,</span>
<span class="term-fg32">+		interval:  d,</span>
<span class="term-fg32">+		url:       *u,</span>
<span class="term-fg32">+		database:  database,</span>
<span class="term-fg32">+		username:  username,</span>
<span class="term-fg32">+		password:  password,</span>
<span class="term-fg32">+		namespace: namespace,</span>
<span class="term-fg32">+		tags:      tags,</span>
<span class="term-fg32">+		cache:     make(map[string]int64),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err := rep.makeClient(); err != nil {</span>
<span class="term-fg32">+		log.Warn(&quot;Unable to make InfluxDB client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	rep.run()</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; InfluxDBWithTagsOnce runs once an InfluxDB reporter and post the given metrics.Registry with the specified tags</span>
<span class="term-fg32">+func InfluxDBWithTagsOnce(r metrics.Registry, url, database, username, password, namespace string, tags map[string]string) error {</span>
<span class="term-fg32">+	u, err := uurl.Parse(url)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;unable to parse InfluxDB. url: %s, err: %v&quot;, url, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	rep := &amp;reporter{</span>
<span class="term-fg32">+		reg:       r,</span>
<span class="term-fg32">+		url:       *u,</span>
<span class="term-fg32">+		database:  database,</span>
<span class="term-fg32">+		username:  username,</span>
<span class="term-fg32">+		password:  password,</span>
<span class="term-fg32">+		namespace: namespace,</span>
<span class="term-fg32">+		tags:      tags,</span>
<span class="term-fg32">+		cache:     make(map[string]int64),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err := rep.makeClient(); err != nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;unable to make InfluxDB client. err: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err := rep.send(); err != nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;unable to send to InfluxDB. err: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (r *reporter) makeClient() (err error) {</span>
<span class="term-fg32">+	r.client, err = client.NewHTTPClient(client.HTTPConfig{</span>
<span class="term-fg32">+		Addr:     r.url.String(),</span>
<span class="term-fg32">+		Username: r.username,</span>
<span class="term-fg32">+		Password: r.password,</span>
<span class="term-fg32">+		Timeout:  10 * time.Second,</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (r *reporter) run() {</span>
<span class="term-fg32">+	intervalTicker := time.NewTicker(r.interval)</span>
<span class="term-fg32">+	pingTicker := time.NewTicker(time.Second * 5)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	defer intervalTicker.Stop()</span>
<span class="term-fg32">+	defer pingTicker.Stop()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for {</span>
<span class="term-fg32">+		select {</span>
<span class="term-fg32">+		case &lt;-intervalTicker.C:</span>
<span class="term-fg32">+			if err := r.send(); err != nil {</span>
<span class="term-fg32">+				log.Warn(&quot;Unable to send to InfluxDB&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		case &lt;-pingTicker.C:</span>
<span class="term-fg32">+			_, _, err := r.client.Ping(0)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				log.Warn(&quot;Got error while sending a ping to InfluxDB, trying to recreate client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				if err = r.makeClient(); err != nil {</span>
<span class="term-fg32">+					log.Warn(&quot;Unable to make InfluxDB client&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (r *reporter) send() error {</span>
<span class="term-fg32">+	bps, err := client.NewBatchPoints(</span>
<span class="term-fg32">+		client.BatchPointsConfig{</span>
<span class="term-fg32">+			Database: r.database,</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.reg.Each(func(name string, i interface{}) {</span>
<span class="term-fg32">+		now := time.Now()</span>
<span class="term-fg32">+		measurement, fields := readMeter(r.namespace, name, i)</span>
<span class="term-fg32">+		if fields == nil {</span>
<span class="term-fg32">+			return</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if p, err := client.NewPoint(measurement, r.tags, fields, now); err == nil {</span>
<span class="term-fg32">+			bps.AddPoint(p)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	return r.client.Write(bps)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f6800193d114495a10b519b9" role="button"
                   aria-expanded="false" aria-controls="id-f6800193d114495a10b519b9">
                    <code>metrics/influxdb/influxdbv2.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/influxdb/influxdbv2.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/influxdb/influxdbv2.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-132</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f6800193d114495a10b519b9"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;influxdb&#47;influxdbv2.go op-geth&#47;metrics&#47;influxdb&#47;influxdbv2.go</span>
<span class="term-fg1">index bfb762196cb3f01269aa562c1a31bc98ac151216..7984898f32594c5481a69032083aec1c94fabbea 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;influxdb&#47;influxdbv2.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;influxdb&#47;influxdbv2.go</span>
<span class="term-fg36">@@ -2,7 +2,6 @@</span> package influxdb
&nbsp;
 import (
 	&quot;context&quot;
<span class="term-fg31">-	&quot;fmt&quot;</span>
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
<span class="term-fg36">@@ -24,8 +23,6 @@</span> 	tags         map[string]string
&nbsp;
 	client influxdb2.Client
 	write  api.WriteAPI
<span class="term-fg31">-</span>
<span class="term-fg31">-	cache map[string]int64</span>
 }
&nbsp;
 &#47;&#47; InfluxDBWithTags starts a InfluxDB reporter which will post the from the given metrics.Registry at each d interval with the specified tags
<span class="term-fg36">@@ -39,7 +36,6 @@</span> 		bucket:       bucket,
 		organization: organization,
 		namespace:    namespace,
 		tags:         tags,
<span class="term-fg31">-		cache:        make(map[string]int64),</span>
 	}
&nbsp;
 	rep.client = influxdb2.NewClient(rep.endpoint, rep.token)
<span class="term-fg36">@@ -81,136 +77,13 @@</span>
 func (r *v2Reporter) send() {
 	r.reg.Each(func(name string, i interface{}) {
 		now := time.Now()
<span class="term-fg31">-		namespace := r.namespace</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		switch metric := i.(type) {</span>
<span class="term-fg31">-		case metrics.Counter:</span>
<span class="term-fg31">-			v := metric.Count()</span>
<span class="term-fg31">-			l := r.cache[name]</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			measurement := fmt.Sprintf(&quot;%s%s.count&quot;, namespace, name)</span>
<span class="term-fg31">-			fields := map[string]interface{}{</span>
<span class="term-fg31">-				&quot;value&quot;: v - l,</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-			r.write.WritePoint(pt)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			r.cache[name] = v</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.Gauge:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			measurement := fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name)</span>
<span class="term-fg31">-			fields := map[string]interface{}{</span>
<span class="term-fg31">-				&quot;value&quot;: ms.Value(),</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-			r.write.WritePoint(pt)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.GaugeFloat64:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			measurement := fmt.Sprintf(&quot;%s%s.gauge&quot;, namespace, name)</span>
<span class="term-fg31">-			fields := map[string]interface{}{</span>
<span class="term-fg31">-				&quot;value&quot;: ms.Value(),</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-			r.write.WritePoint(pt)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.Histogram:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			if ms.Count() &gt; 0 {</span>
<span class="term-fg31">-				ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
<span class="term-fg31">-				measurement := fmt.Sprintf(&quot;%s%s.histogram&quot;, namespace, name)</span>
<span class="term-fg31">-				fields := map[string]interface{}{</span>
<span class="term-fg31">-					&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg31">-					&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg31">-					&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg31">-					&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg31">-					&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg31">-					&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg31">-					&quot;p50&quot;:      ps[0],</span>
<span class="term-fg31">-					&quot;p75&quot;:      ps[1],</span>
<span class="term-fg31">-					&quot;p95&quot;:      ps[2],</span>
<span class="term-fg31">-					&quot;p99&quot;:      ps[3],</span>
<span class="term-fg31">-					&quot;p999&quot;:     ps[4],</span>
<span class="term-fg31">-					&quot;p9999&quot;:    ps[5],</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-				pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-				r.write.WritePoint(pt)</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.Meter:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			measurement := fmt.Sprintf(&quot;%s%s.meter&quot;, namespace, name)</span>
<span class="term-fg31">-			fields := map[string]interface{}{</span>
<span class="term-fg31">-				&quot;count&quot;: ms.Count(),</span>
<span class="term-fg31">-				&quot;m1&quot;:    ms.Rate1(),</span>
<span class="term-fg31">-				&quot;m5&quot;:    ms.Rate5(),</span>
<span class="term-fg31">-				&quot;m15&quot;:   ms.Rate15(),</span>
<span class="term-fg31">-				&quot;mean&quot;:  ms.RateMean(),</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-			r.write.WritePoint(pt)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.Timer:</span>
<span class="term-fg31">-			ms := metric.Snapshot()</span>
<span class="term-fg31">-			ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			measurement := fmt.Sprintf(&quot;%s%s.timer&quot;, namespace, name)</span>
<span class="term-fg31">-			fields := map[string]interface{}{</span>
<span class="term-fg31">-				&quot;count&quot;:    ms.Count(),</span>
<span class="term-fg31">-				&quot;max&quot;:      ms.Max(),</span>
<span class="term-fg31">-				&quot;mean&quot;:     ms.Mean(),</span>
<span class="term-fg31">-				&quot;min&quot;:      ms.Min(),</span>
<span class="term-fg31">-				&quot;stddev&quot;:   ms.StdDev(),</span>
<span class="term-fg31">-				&quot;variance&quot;: ms.Variance(),</span>
<span class="term-fg31">-				&quot;p50&quot;:      ps[0],</span>
<span class="term-fg31">-				&quot;p75&quot;:      ps[1],</span>
<span class="term-fg31">-				&quot;p95&quot;:      ps[2],</span>
<span class="term-fg31">-				&quot;p99&quot;:      ps[3],</span>
<span class="term-fg31">-				&quot;p999&quot;:     ps[4],</span>
<span class="term-fg31">-				&quot;p9999&quot;:    ps[5],</span>
<span class="term-fg31">-				&quot;m1&quot;:       ms.Rate1(),</span>
<span class="term-fg31">-				&quot;m5&quot;:       ms.Rate5(),</span>
<span class="term-fg31">-				&quot;m15&quot;:      ms.Rate15(),</span>
<span class="term-fg31">-				&quot;meanrate&quot;: ms.RateMean(),</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-			r.write.WritePoint(pt)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-		case metrics.ResettingTimer:</span>
<span class="term-fg31">-			t := metric.Snapshot()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-			if len(t.Values()) &gt; 0 {</span>
<span class="term-fg31">-				ps := t.Percentiles([]float64{50, 95, 99})</span>
<span class="term-fg31">-				val := t.Values()</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-				measurement := fmt.Sprintf(&quot;%s%s.span&quot;, namespace, name)</span>
<span class="term-fg31">-				fields := map[string]interface{}{</span>
<span class="term-fg31">-					&quot;count&quot;: len(val),</span>
<span class="term-fg31">-					&quot;max&quot;:   val[len(val)-1],</span>
<span class="term-fg31">-					&quot;mean&quot;:  t.Mean(),</span>
<span class="term-fg31">-					&quot;min&quot;:   val[0],</span>
<span class="term-fg31">-					&quot;p50&quot;:   ps[0],</span>
<span class="term-fg31">-					&quot;p95&quot;:   ps[1],</span>
<span class="term-fg31">-					&quot;p99&quot;:   ps[2],</span>
<span class="term-fg31">-				}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-				pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg31">-				r.write.WritePoint(pt)</span>
<span class="term-fg31">-			}</span>
<span class="term-fg32">+		measurement, fields := readMeter(r.namespace, name, i)</span>
<span class="term-fg32">+		if fields == nil {</span>
<span class="term-fg32">+			return</span>
 		}
<span class="term-fg32">+		pt := influxdb2.NewPoint(measurement, r.tags, fields, now)</span>
<span class="term-fg32">+		r.write.WritePoint(pt)</span>
 	})
<span class="term-fg31">-</span>
 	&#47;&#47; Force all unwritten data to be sent
 	r.write.Flush()
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c90f9034ce816519a01fec3e" role="button"
                   aria-expanded="false" aria-controls="id-c90f9034ce816519a01fec3e">
                    <code>metrics/librato/client.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/librato/client.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/librato/client.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c90f9034ce816519a01fec3e"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;librato&#47;client.go op-geth&#47;metrics&#47;librato&#47;client.go</span>
<span class="term-fg1">index 729c2da9a9bcea892161a10a500cd96d84fdcdce..f1b9e1e91669b259f3da2acb50765b5fdcdcbf21 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;librato&#47;client.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;librato&#47;client.go</span>
<span class="term-fg36">@@ -87,9 +87,11 @@</span>
 	req.Header.Set(&quot;Content-Type&quot;, &quot;application&#47;json&quot;)
 	req.SetBasicAuth(c.Email, c.Token)
&nbsp;
<span class="term-fg31">-	if resp, err = http.DefaultClient.Do(req); err != nil {</span>
<span class="term-fg32">+	resp, err = http.DefaultClient.Do(req)</span>
<span class="term-fg32">+	if err != nil {</span>
 		return
 	}
<span class="term-fg32">+	defer resp.Body.Close()</span>
&nbsp;
 	if resp.StatusCode != http.StatusOK {
 		var body []byte</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4b8c5145a6c886b35c262130" role="button"
                   aria-expanded="false" aria-controls="id-4b8c5145a6c886b35c262130">
                    <code>metrics/librato/librato.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/librato/librato.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/librato/librato.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+11</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4b8c5145a6c886b35c262130"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;librato&#47;librato.go op-geth&#47;metrics&#47;librato&#47;librato.go</span>
<span class="term-fg1">index b16493413ee13fe2d14fddd8374480a9b8c731fd..3d45f4c7be1be69cf9e8643590237dde01448a78 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;librato&#47;librato.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;librato&#47;librato.go</span>
<span class="term-fg36">@@ -107,6 +107,17 @@</span> 					DisplayMin:        &quot;0&quot;,
 				}
 				snapshot.Counters = append(snapshot.Counters, measurement)
 			}
<span class="term-fg32">+		case metrics.CounterFloat64:</span>
<span class="term-fg32">+			if m.Count() &gt; 0 {</span>
<span class="term-fg32">+				measurement[Name] = fmt.Sprintf(&quot;%s.%s&quot;, name, &quot;count&quot;)</span>
<span class="term-fg32">+				measurement[Value] = m.Count()</span>
<span class="term-fg32">+				measurement[Attributes] = map[string]interface{}{</span>
<span class="term-fg32">+					DisplayUnitsLong:  Operations,</span>
<span class="term-fg32">+					DisplayUnitsShort: OperationsShort,</span>
<span class="term-fg32">+					DisplayMin:        &quot;0&quot;,</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				snapshot.Counters = append(snapshot.Counters, measurement)</span>
<span class="term-fg32">+			}</span>
 		case metrics.Gauge:
 			measurement[Name] = name
 			measurement[Value] = float64(m.Value())</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dbb2ff0d64bf04e8559dc82c" role="button"
                   aria-expanded="false" aria-controls="id-dbb2ff0d64bf04e8559dc82c">
                    <code>metrics/log.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/log.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/log.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dbb2ff0d64bf04e8559dc82c"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;log.go op-geth&#47;metrics&#47;log.go</span>
<span class="term-fg1">index 0c8ea7c97123f1e885bbd5150ad5594e8c45806b..d1ce627a8378ba164cf592aac40711269645efe0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;log.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;log.go</span>
<span class="term-fg36">@@ -24,6 +24,9 @@</span> 			switch metric := i.(type) {
 			case Counter:
 				l.Printf(&quot;counter %s\n&quot;, name)
 				l.Printf(&quot;  count:       %9d\n&quot;, metric.Count())
<span class="term-fg32">+			case CounterFloat64:</span>
<span class="term-fg32">+				l.Printf(&quot;counter %s\n&quot;, name)</span>
<span class="term-fg32">+				l.Printf(&quot;  count:       %f\n&quot;, metric.Count())</span>
 			case Gauge:
 				l.Printf(&quot;gauge %s\n&quot;, name)
 				l.Printf(&quot;  value:       %9d\n&quot;, metric.Value())</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dc85ab23f651926ee10182b5" role="button"
                   aria-expanded="false" aria-controls="id-dc85ab23f651926ee10182b5">
                    <code>metrics/meter.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/meter.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/meter.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+14</span></div>
                        <div class="text-start"><span class="text-danger">-11</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc85ab23f651926ee10182b5"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;meter.go op-geth&#47;metrics&#47;meter.go</span>
<span class="term-fg1">index 60ae919d04db6ac6516f14759bebc4f5cb14cd71..e8564d6a5e76f1615b8ea0decf65f1aa821efeb6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;meter.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;meter.go</span>
<span class="term-fg36">@@ -101,11 +101,7 @@</span> }
&nbsp;
 &#47;&#47; MeterSnapshot is a read-only copy of another Meter.
 type MeterSnapshot struct {
<span class="term-fg31">-	&#47;&#47; WARNING: The `temp` field is accessed atomically.</span>
<span class="term-fg31">-	&#47;&#47; On 32 bit platforms, only 64-bit aligned fields can be atomic. The struct is</span>
<span class="term-fg31">-	&#47;&#47; guaranteed to be so aligned, so take advantage of that. For more information,</span>
<span class="term-fg31">-	&#47;&#47; see https:&#47;&#47;golang.org&#47;pkg&#47;sync&#47;atomic&#47;#pkg-note-BUG.</span>
<span class="term-fg31">-	temp                           int64</span>
<span class="term-fg32">+	temp                           atomic.Int64</span>
 	count                          int64
 	rate1, rate5, rate15, rateMean float64
 }
<span class="term-fg36">@@ -173,7 +169,7 @@</span> 	lock        sync.RWMutex
 	snapshot    *MeterSnapshot
 	a1, a5, a15 EWMA
 	startTime   time.Time
<span class="term-fg31">-	stopped     uint32</span>
<span class="term-fg32">+	stopped     atomic.Bool</span>
 }
&nbsp;
 func newStandardMeter() *StandardMeter {
<span class="term-fg36">@@ -188,8 +184,8 @@</span> }
&nbsp;
 &#47;&#47; Stop stops the meter, Mark() will be a no-op if you use it after being stopped.
 func (m *StandardMeter) Stop() {
<span class="term-fg31">-	stopped := atomic.SwapUint32(&amp;m.stopped, 1)</span>
<span class="term-fg31">-	if stopped != 1 {</span>
<span class="term-fg32">+	stopped := m.stopped.Swap(true)</span>
<span class="term-fg32">+	if !stopped {</span>
 		arbiter.Lock()
 		delete(arbiter.meters, m)
 		arbiter.Unlock()
<span class="term-fg36">@@ -207,7 +203,7 @@</span> }
&nbsp;
 &#47;&#47; Mark records the occurrence of n events.
 func (m *StandardMeter) Mark(n int64) {
<span class="term-fg31">-	atomic.AddInt64(&amp;m.snapshot.temp, n)</span>
<span class="term-fg32">+	m.snapshot.temp.Add(n)</span>
 }
&nbsp;
 &#47;&#47; Rate1 returns the one-minute moving average rate of events per second.
<span class="term-fg36">@@ -241,7 +237,14 @@</span>
 &#47;&#47; Snapshot returns a read-only copy of the meter.
 func (m *StandardMeter) Snapshot() Meter {
 	m.lock.RLock()
<span class="term-fg31">-	snapshot := *m.snapshot</span>
<span class="term-fg32">+	snapshot := MeterSnapshot{</span>
<span class="term-fg32">+		count:    m.snapshot.count,</span>
<span class="term-fg32">+		rate1:    m.snapshot.rate1,</span>
<span class="term-fg32">+		rate5:    m.snapshot.rate5,</span>
<span class="term-fg32">+		rate15:   m.snapshot.rate15,</span>
<span class="term-fg32">+		rateMean: m.snapshot.rateMean,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	snapshot.temp.Store(m.snapshot.temp.Load())</span>
 	m.lock.RUnlock()
 	return &amp;snapshot
 }
<span class="term-fg36">@@ -257,7 +260,7 @@</span> }
&nbsp;
 func (m *StandardMeter) updateMeter() {
 	&#47;&#47; should only run with write lock held on m.lock
<span class="term-fg31">-	n := atomic.SwapInt64(&amp;m.snapshot.temp, 0)</span>
<span class="term-fg32">+	n := m.snapshot.temp.Swap(0)</span>
 	m.snapshot.count += n
 	m.a1.Update(n)
 	m.a5.Update(n)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5253c9c87ef9f66abb904db" role="button"
                   aria-expanded="false" aria-controls="id-c5253c9c87ef9f66abb904db">
                    <code>metrics/metrics.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/metrics.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/metrics.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-6</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5253c9c87ef9f66abb904db"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;metrics.go op-geth&#47;metrics&#47;metrics.go</span>
<span class="term-fg1">index ff7196b56494a5a2ecd8ebe8f90fb5fc20b6bbdc..c206f1692407db306c75995aa37ffa9a0ba55a95 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;metrics.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;metrics.go</span>
<span class="term-fg36">@@ -144,6 +144,9 @@</span> 	var (
 		cpuSysLoad            = GetOrRegisterGauge(&quot;system&#47;cpu&#47;sysload&quot;, DefaultRegistry)
 		cpuSysWait            = GetOrRegisterGauge(&quot;system&#47;cpu&#47;syswait&quot;, DefaultRegistry)
 		cpuProcLoad           = GetOrRegisterGauge(&quot;system&#47;cpu&#47;procload&quot;, DefaultRegistry)
<span class="term-fg32">+		cpuSysLoadTotal       = GetOrRegisterCounterFloat64(&quot;system&#47;cpu&#47;sysload&#47;total&quot;, DefaultRegistry)</span>
<span class="term-fg32">+		cpuSysWaitTotal       = GetOrRegisterCounterFloat64(&quot;system&#47;cpu&#47;syswait&#47;total&quot;, DefaultRegistry)</span>
<span class="term-fg32">+		cpuProcLoadTotal      = GetOrRegisterCounterFloat64(&quot;system&#47;cpu&#47;procload&#47;total&quot;, DefaultRegistry)</span>
 		cpuThreads            = GetOrRegisterGauge(&quot;system&#47;cpu&#47;threads&quot;, DefaultRegistry)
 		cpuGoroutines         = GetOrRegisterGauge(&quot;system&#47;cpu&#47;goroutines&quot;, DefaultRegistry)
 		cpuSchedLatency       = getOrRegisterRuntimeHistogram(&quot;system&#47;cpu&#47;schedlatency&quot;, secondsToNs, nil)
<span class="term-fg36">@@ -172,13 +175,17 @@</span> 		collectTime := time.Now()
 		secondsSinceLastCollect := collectTime.Sub(lastCollectTime).Seconds()
 		lastCollectTime = collectTime
 		if secondsSinceLastCollect &gt; 0 {
<span class="term-fg31">-			sysLoad := (cpustats[now].GlobalTime - cpustats[prev].GlobalTime) &#47; secondsSinceLastCollect</span>
<span class="term-fg31">-			sysWait := (cpustats[now].GlobalWait - cpustats[prev].GlobalWait) &#47; secondsSinceLastCollect</span>
<span class="term-fg31">-			procLoad := (cpustats[now].LocalTime - cpustats[prev].LocalTime) &#47; secondsSinceLastCollect</span>
<span class="term-fg32">+			sysLoad := cpustats[now].GlobalTime - cpustats[prev].GlobalTime</span>
<span class="term-fg32">+			sysWait := cpustats[now].GlobalWait - cpustats[prev].GlobalWait</span>
<span class="term-fg32">+			procLoad := cpustats[now].LocalTime - cpustats[prev].LocalTime</span>
 			&#47;&#47; Convert to integer percentage.
<span class="term-fg31">-			cpuSysLoad.Update(int64(sysLoad * 100))</span>
<span class="term-fg31">-			cpuSysWait.Update(int64(sysWait * 100))</span>
<span class="term-fg31">-			cpuProcLoad.Update(int64(procLoad * 100))</span>
<span class="term-fg32">+			cpuSysLoad.Update(int64(sysLoad &#47; secondsSinceLastCollect * 100))</span>
<span class="term-fg32">+			cpuSysWait.Update(int64(sysWait &#47; secondsSinceLastCollect * 100))</span>
<span class="term-fg32">+			cpuProcLoad.Update(int64(procLoad &#47; secondsSinceLastCollect * 100))</span>
<span class="term-fg32">+			&#47;&#47; increment counters (ms)</span>
<span class="term-fg32">+			cpuSysLoadTotal.Inc(sysLoad)</span>
<span class="term-fg32">+			cpuSysWaitTotal.Inc(sysWait)</span>
<span class="term-fg32">+			cpuProcLoadTotal.Inc(procLoad)</span>
 		}
&nbsp;
 		&#47;&#47; Threads</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a15ea222e16607ad3852cbc0" role="button"
                   aria-expanded="false" aria-controls="id-a15ea222e16607ad3852cbc0">
                    <code>metrics/metrics_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/metrics_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/metrics_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a15ea222e16607ad3852cbc0"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;metrics_test.go op-geth&#47;metrics&#47;metrics_test.go</span>
<span class="term-fg1">index e3fde1ea62cec51cf729230b9735833c4532bd71..534c44139b360031e1b228b2025cb351f90535db 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;metrics_test.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;metrics_test.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span>
 func BenchmarkMetrics(b *testing.B) {
 	r := NewRegistry()
 	c := NewRegisteredCounter(&quot;counter&quot;, r)
<span class="term-fg32">+	cf := NewRegisteredCounterFloat64(&quot;counterfloat64&quot;, r)</span>
 	g := NewRegisteredGauge(&quot;gauge&quot;, r)
 	gf := NewRegisteredGaugeFloat64(&quot;gaugefloat64&quot;, r)
 	h := NewRegisteredHistogram(&quot;histogram&quot;, r, NewUniformSample(100))
<span class="term-fg36">@@ -71,6 +72,7 @@</span> 			defer wg.Done()
 			&#47;&#47;log.Println(&quot;go&quot;, i)
 			for i := 0; i &lt; b.N; i++ {
 				c.Inc(1)
<span class="term-fg32">+				cf.Inc(1.0)</span>
 				g.Update(int64(i))
 				gf.Update(float64(i))
 				h.Update(int64(i))</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c676dbabd4e489ea35bbc18b" role="button"
                   aria-expanded="false" aria-controls="id-c676dbabd4e489ea35bbc18b">
                    <code>metrics/opentsdb.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/opentsdb.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/opentsdb.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c676dbabd4e489ea35bbc18b"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;opentsdb.go op-geth&#47;metrics&#47;opentsdb.go</span>
<span class="term-fg1">index 3fde55454ba91e1dea70af6cd7b8e920e8698deb..c9fd2e75d5e53600bdc5c4437144a7b5c4381747 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;opentsdb.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;opentsdb.go</span>
<span class="term-fg36">@@ -71,6 +71,8 @@</span> 	c.Registry.Each(func(name string, i interface{}) {
 		switch metric := i.(type) {
 		case Counter:
 			fmt.Fprintf(w, &quot;put %s.%s.count %d %d host=%s\n&quot;, c.Prefix, name, now, metric.Count(), shortHostname)
<span class="term-fg32">+		case CounterFloat64:</span>
<span class="term-fg32">+			fmt.Fprintf(w, &quot;put %s.%s.count %d %f host=%s\n&quot;, c.Prefix, name, now, metric.Count(), shortHostname)</span>
 		case Gauge:
 			fmt.Fprintf(w, &quot;put %s.%s.value %d %d host=%s\n&quot;, c.Prefix, name, now, metric.Value(), shortHostname)
 		case GaugeFloat64:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-aadab98ddbb75e1cd6ba5778" role="button"
                   aria-expanded="false" aria-controls="id-aadab98ddbb75e1cd6ba5778">
                    <code>metrics/prometheus/collector.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/prometheus/collector.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/prometheus/collector.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-aadab98ddbb75e1cd6ba5778"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;prometheus&#47;collector.go op-geth&#47;metrics&#47;prometheus&#47;collector.go</span>
<span class="term-fg1">index e8d5e4f5d1ea7553fd1df8f1c48e1f3dd3f1cec2..2bd9bf22ccae03fdb122401c9d3ffd1ad20419ce 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;prometheus&#47;collector.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;prometheus&#47;collector.go</span>
<span class="term-fg36">@@ -50,6 +50,10 @@</span> func (c *collector) addCounter(name string, m metrics.Counter) {
 	c.writeGaugeCounter(name, m.Count())
 }
&nbsp;
<span class="term-fg32">+func (c *collector) addCounterFloat64(name string, m metrics.CounterFloat64) {</span>
<span class="term-fg32">+	c.writeGaugeCounter(name, m.Count())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func (c *collector) addGauge(name string, m metrics.Gauge) {
 	c.writeGaugeCounter(name, m.Value())
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-35451db0ad7b115fb1a7fb40" role="button"
                   aria-expanded="false" aria-controls="id-35451db0ad7b115fb1a7fb40">
                    <code>metrics/prometheus/collector_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/prometheus/collector_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/prometheus/collector_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+7</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-35451db0ad7b115fb1a7fb40"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;prometheus&#47;collector_test.go op-geth&#47;metrics&#47;prometheus&#47;collector_test.go</span>
<span class="term-fg1">index 43f2f804d32ee3e0560f3c26651a9dd76abbf1df..ff87c8e765e16a6b3e1ce55d98a86215ffa7e570 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;prometheus&#47;collector_test.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;prometheus&#47;collector_test.go</span>
<span class="term-fg36">@@ -20,6 +20,10 @@</span> 	counter := metrics.NewCounter()
 	counter.Inc(12345)
 	c.addCounter(&quot;test&#47;counter&quot;, counter)
&nbsp;
<span class="term-fg32">+	counterfloat64 := metrics.NewCounterFloat64()</span>
<span class="term-fg32">+	counterfloat64.Inc(54321.98)</span>
<span class="term-fg32">+	c.addCounterFloat64(&quot;test&#47;counter_float64&quot;, counterfloat64)</span>
<span class="term-fg32">+</span>
 	gauge := metrics.NewGauge()
 	gauge.Update(23456)
 	c.addGauge(&quot;test&#47;gauge&quot;, gauge)
<span class="term-fg36">@@ -60,6 +64,9 @@</span> 	c.addResettingTimer(&quot;test&#47;empty_resetting_timer&quot;, emptyResettingTimer)
&nbsp;
 	const expectedOutput = `# TYPE test_counter gauge
 test_counter 12345
<span class="term-fg32">+</span>
<span class="term-fg32">+# TYPE test_counter_float64 gauge</span>
<span class="term-fg32">+test_counter_float64 54321.98</span>
&nbsp;
 # TYPE test_gauge gauge
 test_gauge 23456</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e0e383429b5f6f5e296d8b52" role="button"
                   aria-expanded="false" aria-controls="id-e0e383429b5f6f5e296d8b52">
                    <code>metrics/prometheus/prometheus.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/prometheus/prometheus.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/prometheus/prometheus.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e0e383429b5f6f5e296d8b52"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;prometheus&#47;prometheus.go op-geth&#47;metrics&#47;prometheus&#47;prometheus.go</span>
<span class="term-fg1">index c8408d8cab8518d3f6bdb1271203dfb40dc0e599..d966fa9a86662c3c1480fc81a5a015a36d1f7b54 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;prometheus&#47;prometheus.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;prometheus&#47;prometheus.go</span>
<span class="term-fg36">@@ -45,6 +45,8 @@</span>
 			switch m := i.(type) {
 			case metrics.Counter:
 				c.addCounter(name, m.Snapshot())
<span class="term-fg32">+			case metrics.CounterFloat64:</span>
<span class="term-fg32">+				c.addCounterFloat64(name, m.Snapshot())</span>
 			case metrics.Gauge:
 				c.addGauge(name, m.Snapshot())
 			case metrics.GaugeFloat64:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ce8cda57508b3e8ca7ce7431" role="button"
                   aria-expanded="false" aria-controls="id-ce8cda57508b3e8ca7ce7431">
                    <code>metrics/registry.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/registry.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/registry.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ce8cda57508b3e8ca7ce7431"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;registry.go op-geth&#47;metrics&#47;registry.go</span>
<span class="term-fg1">index c5435adf2402d8cdb853b1aaef007cdf49141d29..4c62248351a7216ebdcb9d5370cbe503375fa485 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;registry.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;registry.go</span>
<span class="term-fg36">@@ -120,6 +120,8 @@</span> 		values := make(map[string]interface{})
 		switch metric := i.(type) {
 		case Counter:
 			values[&quot;count&quot;] = metric.Count()
<span class="term-fg32">+		case CounterFloat64:</span>
<span class="term-fg32">+			values[&quot;count&quot;] = metric.Count()</span>
 		case Gauge:
 			values[&quot;value&quot;] = metric.Value()
 		case GaugeFloat64:
<span class="term-fg36">@@ -196,7 +198,7 @@</span> 	if _, ok := r.metrics[name]; ok {
 		return DuplicateMetric(name)
 	}
 	switch i.(type) {
<span class="term-fg31">-	case Counter, Gauge, GaugeFloat64, Healthcheck, Histogram, Meter, Timer, ResettingTimer:</span>
<span class="term-fg32">+	case Counter, CounterFloat64, Gauge, GaugeFloat64, Healthcheck, Histogram, Meter, Timer, ResettingTimer:</span>
 		r.metrics[name] = i
 	}
 	return nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-305851eeb4417d31b5db8692" role="button"
                   aria-expanded="false" aria-controls="id-305851eeb4417d31b5db8692">
                    <code>metrics/syslog.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/syslog.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/syslog.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-305851eeb4417d31b5db8692"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;syslog.go op-geth&#47;metrics&#47;syslog.go</span>
<span class="term-fg1">index 551a2bd0f072c930b7d6cdc328288abf772a9891..f23b07e199f32d6e1c392404603fc30f140cb72c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;syslog.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;syslog.go</span>
<span class="term-fg36">@@ -17,6 +17,8 @@</span> 		r.Each(func(name string, i interface{}) {
 			switch metric := i.(type) {
 			case Counter:
 				w.Info(fmt.Sprintf(&quot;counter %s: count: %d&quot;, name, metric.Count()))
<span class="term-fg32">+			case CounterFloat64:</span>
<span class="term-fg32">+				w.Info(fmt.Sprintf(&quot;counter %s: count: %f&quot;, name, metric.Count()))</span>
 			case Gauge:
 				w.Info(fmt.Sprintf(&quot;gauge %s: value: %d&quot;, name, metric.Value()))
 			case GaugeFloat64:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-722edb15b91955e3abd4de9f" role="button"
                   aria-expanded="false" aria-controls="id-722edb15b91955e3abd4de9f">
                    <code>metrics/writer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/metrics/writer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/metrics/writer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-722edb15b91955e3abd4de9f"><span class="term-fg1">diff --git go-ethereum&#47;metrics&#47;writer.go op-geth&#47;metrics&#47;writer.go</span>
<span class="term-fg1">index 88521a80d9d7a22dc243e346ba86b0cc77a3cd75..256fbd14c9b97aebf2a7647ae0584c36d257fbbd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;metrics&#47;writer.go</span>
<span class="term-fg1">+++ op-geth&#47;metrics&#47;writer.go</span>
<span class="term-fg36">@@ -29,6 +29,9 @@</span> 		switch metric := namedMetric.m.(type) {
 		case Counter:
 			fmt.Fprintf(w, &quot;counter %s\n&quot;, namedMetric.name)
 			fmt.Fprintf(w, &quot;  count:       %9d\n&quot;, metric.Count())
<span class="term-fg32">+		case CounterFloat64:</span>
<span class="term-fg32">+			fmt.Fprintf(w, &quot;counter %s\n&quot;, namedMetric.name)</span>
<span class="term-fg32">+			fmt.Fprintf(w, &quot;  count:       %f\n&quot;, metric.Count())</span>
 		case Gauge:
 			fmt.Fprintf(w, &quot;gauge %s\n&quot;, namedMetric.name)
 			fmt.Fprintf(w, &quot;  value:       %9d\n&quot;, metric.Value())</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-28bc988feb3e93edf1c61cc5" role="button"
                   aria-expanded="false" aria-controls="id-28bc988feb3e93edf1c61cc5">
                    <code>miner/stress/1559/main.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/stress/1559/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/stress/1559/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-28bc988feb3e93edf1c61cc5"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;stress&#47;1559&#47;main.go op-geth&#47;miner&#47;stress&#47;1559&#47;main.go</span>
<span class="term-fg1">index c27875000d8546a60cb24e68cb915a1a0b733468..2e8b78d85e33553e729d3e51041cd0842baa17f0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;stress&#47;1559&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;stress&#47;1559&#47;main.go</span>
<span class="term-fg36">@@ -205,7 +205,6 @@</span> 	&#47;&#47; Small gaslimit for easier basefee moving testing.
 	genesis.GasLimit = 8_000_000
&nbsp;
 	genesis.Config.ChainID = big.NewInt(18)
<span class="term-fg31">-	genesis.Config.EIP150Hash = common.Hash{}</span>
&nbsp;
 	genesis.Alloc = core.GenesisAlloc{}
 	for _, faucet := range faucets {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-999c69ccfd8e68c343ca5cd8" role="button"
                   aria-expanded="false" aria-controls="id-999c69ccfd8e68c343ca5cd8">
                    <code>miner/stress/beacon/main.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/stress/beacon/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/stress/beacon/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-999c69ccfd8e68c343ca5cd8"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;stress&#47;beacon&#47;main.go op-geth&#47;miner&#47;stress&#47;beacon&#47;main.go</span>
<span class="term-fg1">index 516862c9cb5278b4bc6217b96ab3129ee244f9a0..65318f1a0e4ef10ac301a17cd2d87557523f539b 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;stress&#47;beacon&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;stress&#47;beacon&#47;main.go</span>
<span class="term-fg36">@@ -127,7 +127,11 @@</span> 	enode := stack.Server().Self()
&nbsp;
 	&#47;&#47; Inject the signer key and start sealing with it
 	stack.AccountManager().AddBackend(keystore.NewPlaintextKeyStore(&quot;beacon-stress&quot;))
<span class="term-fg31">-	store := stack.AccountManager().Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	ks := stack.AccountManager().Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(ks) == 0 {</span>
<span class="term-fg32">+		panic(&quot;Keystore is not available&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	store := ks[0].(*keystore.KeyStore)</span>
 	if _, err := store.NewAccount(&quot;&quot;); err != nil {
 		panic(err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8a6bd4ae474f4a2ce7ceafa7" role="button"
                   aria-expanded="false" aria-controls="id-8a6bd4ae474f4a2ce7ceafa7">
                    <code>miner/stress/clique/main.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/stress/clique/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/stress/clique/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8a6bd4ae474f4a2ce7ceafa7"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;stress&#47;clique&#47;main.go op-geth&#47;miner&#47;stress&#47;clique&#47;main.go</span>
<span class="term-fg1">index 688c2b698409da64d9503c0944f1f94df833b17d..74962c6d51c1fe7910d0db09231918485c458ee5 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;stress&#47;clique&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;stress&#47;clique&#47;main.go</span>
<span class="term-fg36">@@ -153,7 +153,6 @@</span> 	genesis.GasLimit = 25000000
&nbsp;
 	genesis.Config.ChainID = big.NewInt(18)
 	genesis.Config.Clique.Period = 1
<span class="term-fg31">-	genesis.Config.EIP150Hash = common.Hash{}</span>
&nbsp;
 	genesis.Alloc = core.GenesisAlloc{}
 	for _, faucet := range faucets {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5eda3a1479293c4d36471016" role="button"
                   aria-expanded="false" aria-controls="id-5eda3a1479293c4d36471016">
                    <code>miner/stress/ethash/main.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/miner/stress/ethash/main.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/miner/stress/ethash/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5eda3a1479293c4d36471016"><span class="term-fg1">diff --git go-ethereum&#47;miner&#47;stress&#47;ethash&#47;main.go op-geth&#47;miner&#47;stress&#47;ethash&#47;main.go</span>
<span class="term-fg1">index 6b6e7059d33b8a57f55bc49ecdb71a9b3670d9fd..6905bf01f164725f46f53eb59a3296a0828fd409 100644</span>
<span class="term-fg1">--- go-ethereum&#47;miner&#47;stress&#47;ethash&#47;main.go</span>
<span class="term-fg1">+++ op-geth&#47;miner&#47;stress&#47;ethash&#47;main.go</span>
<span class="term-fg36">@@ -139,7 +139,6 @@</span> 	genesis.Difficulty = params.MinimumDifficulty
 	genesis.GasLimit = 25000000
&nbsp;
 	genesis.Config.ChainID = big.NewInt(18)
<span class="term-fg31">-	genesis.Config.EIP150Hash = common.Hash{}</span>
&nbsp;
 	genesis.Alloc = core.GenesisAlloc{}
 	for _, faucet := range faucets {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-757c7fb3507765ede5a17e41" role="button"
                   aria-expanded="false" aria-controls="id-757c7fb3507765ede5a17e41">
                    <code>node/node_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/node/node_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/node/node_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-757c7fb3507765ede5a17e41"><span class="term-fg1">diff --git go-ethereum&#47;node&#47;node_test.go op-geth&#47;node&#47;node_test.go</span>
<span class="term-fg1">index 560d487fa823f4bc8e9008ced72fd6f3cd6659d6..04810a815bf67d37f6de23de663fd74c18e1bdac 100644</span>
<span class="term-fg1">--- go-ethereum&#47;node&#47;node_test.go</span>
<span class="term-fg1">+++ op-geth&#47;node&#47;node_test.go</span>
<span class="term-fg36">@@ -615,6 +615,7 @@</span> 	resp, err := client.Do(req)
 	if err != nil {
 		t.Fatalf(&quot;could not issue a GET request to the given endpoint: %v&quot;, err)
 	}
<span class="term-fg32">+	t.Cleanup(func() { resp.Body.Close() })</span>
 	return resp
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a949bd57adbf7ccf5b7f4c40" role="button"
                   aria-expanded="false" aria-controls="id-a949bd57adbf7ccf5b7f4c40">
                    <code>node/rpcstack_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/node/rpcstack_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/node/rpcstack_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a949bd57adbf7ccf5b7f4c40"><span class="term-fg1">diff --git go-ethereum&#47;node&#47;rpcstack_test.go op-geth&#47;node&#47;rpcstack_test.go</span>
<span class="term-fg1">index 4d10e61e2dec478ec0682657f7120d5901786e3e..0790dddec4114e3eca053b7b3a0b7a7dbd09e05c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;node&#47;rpcstack_test.go</span>
<span class="term-fg1">+++ op-geth&#47;node&#47;rpcstack_test.go</span>
<span class="term-fg36">@@ -320,6 +320,7 @@</span> 	resp, err := http.DefaultClient.Do(req)
 	if err != nil {
 		t.Fatal(err)
 	}
<span class="term-fg32">+	t.Cleanup(func() { resp.Body.Close() })</span>
 	return resp
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-939388028e4b1eaecf5ce02a" role="button"
                   aria-expanded="false" aria-controls="id-939388028e4b1eaecf5ce02a">
                    <code>p2p/server.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/p2p/server.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/p2p/server.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-939388028e4b1eaecf5ce02a"><span class="term-fg1">diff --git go-ethereum&#47;p2p&#47;server.go op-geth&#47;p2p&#47;server.go</span>
<span class="term-fg1">index 610b82d784f62f9f074f64e189654955e9024aac..f7bf948b6901249e49e06c04e08597e16b6ea260 100644</span>
<span class="term-fg1">--- go-ethereum&#47;p2p&#47;server.go</span>
<span class="term-fg1">+++ op-geth&#47;p2p&#47;server.go</span>
<span class="term-fg36">@@ -94,7 +94,6 @@</span> 	&#47;&#47; protocol should be started or not.
 	DiscoveryV5 bool `toml:&quot;,omitempty&quot;`
&nbsp;
 	&#47;&#47; Name sets the node name of this server.
<span class="term-fg31">-	&#47;&#47; Use common.MakeName to create a name that follows existing conventions.</span>
 	Name string `toml:&quot;-&quot;`
&nbsp;
 	&#47;&#47; BootstrapNodes are used to establish connectivity
<span class="term-fg36">@@ -444,7 +443,7 @@</span> 	if srv.running {
 		return errors.New(&quot;server already running&quot;)
 	}
 	srv.running = true
<span class="term-fg31">-	srv.log = srv.Config.Logger</span>
<span class="term-fg32">+	srv.log = srv.Logger</span>
 	if srv.log == nil {
 		srv.log = log.Root()
 	}
<span class="term-fg36">@@ -502,7 +501,7 @@</span> 	}
 	sort.Sort(capsByNameAndVersion(srv.ourHandshake.Caps))
&nbsp;
 	&#47;&#47; Create the local node.
<span class="term-fg31">-	db, err := enode.OpenDB(srv.Config.NodeDatabase)</span>
<span class="term-fg32">+	db, err := enode.OpenDB(srv.NodeDatabase)</span>
 	if err != nil {
 		return err
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4c63e81884cc12d0644ee49a" role="button"
                   aria-expanded="false" aria-controls="id-4c63e81884cc12d0644ee49a">
                    <code>p2p/simulations/adapters/exec.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/p2p/simulations/adapters/exec.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/p2p/simulations/adapters/exec.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4c63e81884cc12d0644ee49a"><span class="term-fg1">diff --git go-ethereum&#47;p2p&#47;simulations&#47;adapters&#47;exec.go op-geth&#47;p2p&#47;simulations&#47;adapters&#47;exec.go</span>
<span class="term-fg1">index 7bfa8aab6d1030625aeff7c115d1650ea4f6b882..1d812514dee7e09130f0fa9bdd948edaa03f1bc0 100644</span>
<span class="term-fg1">--- go-ethereum&#47;p2p&#47;simulations&#47;adapters&#47;exec.go</span>
<span class="term-fg1">+++ op-geth&#47;p2p&#47;simulations&#47;adapters&#47;exec.go</span>
<span class="term-fg36">@@ -428,9 +428,11 @@</span> 	}
&nbsp;
 	&#47;&#47; Send status to the host.
 	statusJSON, _ := json.Marshal(status)
<span class="term-fg31">-	if _, err := http.Post(statusURL, &quot;application&#47;json&quot;, bytes.NewReader(statusJSON)); err != nil {</span>
<span class="term-fg32">+	resp, err := http.Post(statusURL, &quot;application&#47;json&quot;, bytes.NewReader(statusJSON))</span>
<span class="term-fg32">+	if err != nil {</span>
 		log.Crit(&quot;Can&#39;t post startup info&quot;, &quot;url&quot;, statusURL, &quot;err&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
 	if stackErr != nil {
 		os.Exit(1)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b88f66860f805d972e4188c2" role="button"
                   aria-expanded="false" aria-controls="id-b88f66860f805d972e4188c2">
                    <code>p2p/simulations/mocker_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/p2p/simulations/mocker_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/p2p/simulations/mocker_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b88f66860f805d972e4188c2"><span class="term-fg1">diff --git go-ethereum&#47;p2p&#47;simulations&#47;mocker_test.go op-geth&#47;p2p&#47;simulations&#47;mocker_test.go</span>
<span class="term-fg1">index 56d81942bbd01363cbaa76d1d51db91b43d74401..0112ee5cfd6e55d4cd8e76ca40c5855d62630391 100644</span>
<span class="term-fg1">--- go-ethereum&#47;p2p&#47;simulations&#47;mocker_test.go</span>
<span class="term-fg1">+++ op-geth&#47;p2p&#47;simulations&#47;mocker_test.go</span>
<span class="term-fg36">@@ -124,6 +124,7 @@</span> 	resp, err = http.PostForm(s.URL+&quot;&#47;mocker&#47;start&quot;, url.Values{&quot;mocker-type&quot;: {mockertype}, &quot;node-count&quot;: {strconv.Itoa(nodeCount)}})
 	if err != nil {
 		t.Fatalf(&quot;Could not start mocker: %s&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
 	if resp.StatusCode != 200 {
 		t.Fatalf(&quot;Invalid Status Code received for starting mocker, expected 200, got %d&quot;, resp.StatusCode)
 	}
<span class="term-fg36">@@ -145,15 +146,17 @@</span> 	resp, err = http.Post(s.URL+&quot;&#47;mocker&#47;stop&quot;, &quot;&quot;, nil)
 	if err != nil {
 		t.Fatalf(&quot;Could not stop mocker: %s&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
 	if resp.StatusCode != 200 {
 		t.Fatalf(&quot;Invalid Status Code received for stopping mocker, expected 200, got %d&quot;, resp.StatusCode)
 	}
&nbsp;
 	&#47;&#47;reset the network
<span class="term-fg31">-	_, err = http.Post(s.URL+&quot;&#47;reset&quot;, &quot;&quot;, nil)</span>
<span class="term-fg32">+	resp, err = http.Post(s.URL+&quot;&#47;reset&quot;, &quot;&quot;, nil)</span>
 	if err != nil {
 		t.Fatalf(&quot;Could not reset network: %s&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
&nbsp;
 	&#47;&#47;now the number of nodes in the network should be zero
 	nodesInfo, err = client.GetNodes()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7531203a790e784ef25bb4f9" role="button"
                   aria-expanded="false" aria-controls="id-7531203a790e784ef25bb4f9">
                    <code>params/bootnodes.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/params/bootnodes.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/params/bootnodes.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7531203a790e784ef25bb4f9"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;bootnodes.go op-geth&#47;params&#47;bootnodes.go</span>
<span class="term-fg1">index 45e27c441a785b39058c4469953ab31694f37e66..4ae94cfbd32272ffa1056e10c2aa2bd8519e1878 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;bootnodes.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;bootnodes.go</span>
<span class="term-fg36">@@ -31,10 +31,12 @@</span>
 &#47;&#47; SepoliaBootnodes are the enode URLs of the P2P bootstrap nodes running on the
 &#47;&#47; Sepolia test network.
 var SepoliaBootnodes = []string{
<span class="term-fg31">-	&#47;&#47; geth</span>
<span class="term-fg31">-	&quot;enode:&#47;&#47;9246d00bc8fd1742e5ad2428b80fc4dc45d786283e05ef6edbd9002cbc335d40998444732fbe921cb88e1d2c73d1b1de53bae6a2237996e9bfe14f871baf7066@18.168.182.86:30303&quot;,</span>
<span class="term-fg31">-	&#47;&#47; besu</span>
<span class="term-fg31">-	&quot;enode:&#47;&#47;ec66ddcf1a974950bd4c782789a7e04f8aa7110a72569b6e65fcd51e937e74eed303b1ea734e4d19cfaec9fbff9b6ee65bf31dcb50ba79acce9dd63a6aca61c7@52.14.151.177:30303&quot;,</span>
<span class="term-fg32">+	&#47;&#47; EF DevOps</span>
<span class="term-fg32">+	&quot;enode:&#47;&#47;4e5e92199ee224a01932a377160aa432f31d0b351f84ab413a8e0a42f4f36476f8fb1cbe914af0d9aef0d51665c214cf653c651c4bbd9d5550a934f241f1682b@138.197.51.181:30303&quot;, &#47;&#47; sepolia-bootnode-1-nyc3</span>
<span class="term-fg32">+	&quot;enode:&#47;&#47;143e11fb766781d22d92a2e33f8f104cddae4411a122295ed1fdb6638de96a6ce65f5b7c964ba3763bba27961738fef7d3ecc739268f3e5e771fb4c87b6234ba@146.190.1.103:30303&quot;,  &#47;&#47; sepolia-bootnode-1-sfo3</span>
<span class="term-fg32">+	&quot;enode:&#47;&#47;8b61dc2d06c3f96fddcbebb0efb29d60d3598650275dc469c22229d3e5620369b0d3dedafd929835fe7f489618f19f456fe7c0df572bf2d914a9f4e006f783a9@170.64.250.88:30303&quot;,  &#47;&#47; sepolia-bootnode-1-syd1</span>
<span class="term-fg32">+	&quot;enode:&#47;&#47;10d62eff032205fcef19497f35ca8477bea0eadfff6d769a147e895d8b2b8f8ae6341630c645c30f5df6e67547c03494ced3d9c5764e8622a26587b083b028e8@139.59.49.206:30303&quot;,  &#47;&#47; sepolia-bootnode-1-blr1</span>
<span class="term-fg32">+	&quot;enode:&#47;&#47;9e9492e2e8836114cc75f5b929784f4f46c324ad01daf87d956f98b3b6c5fcba95524d6e5cf9861dc96a2c8a171ea7105bb554a197455058de185fa870970c7c@138.68.123.152:30303&quot;, &#47;&#47; sepolia-bootnode-1-ams3</span>
 }
&nbsp;
 &#47;&#47; RinkebyBootnodes are the enode URLs of the P2P bootstrap nodes running on the</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-90d9a385bc21ae4edc3d6c12" role="button"
                   aria-expanded="false" aria-controls="id-90d9a385bc21ae4edc3d6c12">
                    <code>params/config_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/params/config_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/params/config_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+19</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-90d9a385bc21ae4edc3d6c12"><span class="term-fg1">diff --git go-ethereum&#47;params&#47;config_test.go op-geth&#47;params&#47;config_test.go</span>
<span class="term-fg1">index 5634569e29f09891985c442d87ad51a0d053268f..bf9181d00afa04eb9d1ed8c2ee7b22797260be70 100644</span>
<span class="term-fg1">--- go-ethereum&#47;params&#47;config_test.go</span>
<span class="term-fg1">+++ op-geth&#47;params&#47;config_test.go</span>
<span class="term-fg36">@@ -136,3 +136,22 @@</span> 	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsShanghai {
 		t.Errorf(&quot;expected %v to be shanghai&quot;, stamp)
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestConfigRulesRegolith(t *testing.T) {</span>
<span class="term-fg32">+	c := &amp;ChainConfig{</span>
<span class="term-fg32">+		RegolithTime: newUint64(500),</span>
<span class="term-fg32">+		Optimism:     &amp;OptimismConfig{},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var stamp uint64</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); r.IsOptimismRegolith {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to not be regolith&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	stamp = 500</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsOptimismRegolith {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to be regolith&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	stamp = math.MaxInt64</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsOptimismRegolith {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to be regolith&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-535110b5611a85d8230e35a2" role="button"
                   aria-expanded="false" aria-controls="id-535110b5611a85d8230e35a2">
                    <code>rlp/rlpgen/gen_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/rlp/rlpgen/gen_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/rlp/rlpgen/gen_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-535110b5611a85d8230e35a2"><span class="term-fg1">diff --git go-ethereum&#47;rlp&#47;rlpgen&#47;gen_test.go op-geth&#47;rlp&#47;rlpgen&#47;gen_test.go</span>
<span class="term-fg1">index ff3b8385ae16e33ad889d1810c8b8c9e95db48bb..3b4f5df287651f02963f42eafbf7fab8e7c19298 100644</span>
<span class="term-fg1">--- go-ethereum&#47;rlp&#47;rlpgen&#47;gen_test.go</span>
<span class="term-fg1">+++ op-geth&#47;rlp&#47;rlpgen&#47;gen_test.go</span>
<span class="term-fg36">@@ -75,7 +75,7 @@</span> 			if err != nil {
 				t.Fatal(&quot;error loading expected test output:&quot;, err)
 			}
 			if !bytes.Equal(output, wantOutput) {
<span class="term-fg31">-				t.Fatal(&quot;output mismatch:\n&quot;, string(output))</span>
<span class="term-fg32">+				t.Fatalf(&quot;output mismatch, want: %v got %v&quot;, string(wantOutput), string(output))</span>
 			}
 		})
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f5155a2469bec97fac49f710" role="button"
                   aria-expanded="false" aria-controls="id-f5155a2469bec97fac49f710">
                    <code>rpc/http_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/rpc/http_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/rpc/http_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f5155a2469bec97fac49f710"><span class="term-fg1">diff --git go-ethereum&#47;rpc&#47;http_test.go op-geth&#47;rpc&#47;http_test.go</span>
<span class="term-fg1">index 528e1bcfc5e74f003db9fc5d63718a5cddb6d2a1..584842a9aa8d5cb49902c5aff3acdc6a5330222a 100644</span>
<span class="term-fg1">--- go-ethereum&#47;rpc&#47;http_test.go</span>
<span class="term-fg1">+++ op-geth&#47;rpc&#47;http_test.go</span>
<span class="term-fg36">@@ -94,6 +94,7 @@</span> 	resp, err := http.DefaultClient.Do(request)
 	if err != nil {
 		t.Fatalf(&quot;request failed: %v&quot;, err)
 	}
<span class="term-fg32">+	resp.Body.Close()</span>
 	confirmStatusCode(t, resp.StatusCode, expectedStatusCode)
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-85099692b5d11e24b540740f" role="button"
                   aria-expanded="false" aria-controls="id-85099692b5d11e24b540740f">
                    <code>signer/core/testdata/expfail_extradata.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/signer/core/testdata/expfail_extradata.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-85099692b5d11e24b540740f"><span class="term-fg1">diff --git go-ethereum&#47;signer&#47;core&#47;testdata&#47;expfail_extradata-2.json op-geth&#47;signer&#47;core&#47;testdata&#47;expfail_extradata.json</span>
<span class="term-fg1">rename from signer&#47;core&#47;testdata&#47;expfail_extradata-2.json</span>
<span class="term-fg1">rename to signer&#47;core&#47;testdata&#47;expfail_extradata.json</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8aabe6de4aff4b7b0abe871e" role="button"
                   aria-expanded="false" aria-controls="id-8aabe6de4aff4b7b0abe871e">
                    <code>signer/core/testdata/expfail_nonexistant_type2.json</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/signer/core/testdata/expfail_nonexistant_type2.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8aabe6de4aff4b7b0abe871e"><span class="term-fg1">diff --git go-ethereum&#47;signer&#47;core&#47;testdata&#47;expfail_extradata-1.json op-geth&#47;signer&#47;core&#47;testdata&#47;expfail_nonexistant_type2.json</span>
<span class="term-fg1">rename from signer&#47;core&#47;testdata&#47;expfail_extradata-1.json</span>
<span class="term-fg1">rename to signer&#47;core&#47;testdata&#47;expfail_nonexistant_type2.json</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b19623adfdeb241082dced5c" role="button"
                   aria-expanded="false" aria-controls="id-b19623adfdeb241082dced5c">
                    <code>signer/core/uiapi.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/signer/core/uiapi.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/signer/core/uiapi.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b19623adfdeb241082dced5c"><span class="term-fg1">diff --git go-ethereum&#47;signer&#47;core&#47;uiapi.go op-geth&#47;signer&#47;core&#47;uiapi.go</span>
<span class="term-fg1">index 59466d8fa030c81a55adfb56b52ae4a008a4d382..924203a139a7c8266821c0eb043a8c70782554a2 100644</span>
<span class="term-fg1">--- go-ethereum&#47;signer&#47;core&#47;uiapi.go</span>
<span class="term-fg1">+++ op-geth&#47;signer&#47;core&#47;uiapi.go</span>
<span class="term-fg36">@@ -111,7 +111,11 @@</span> }
&nbsp;
 &#47;&#47; fetchKeystore retrieves the encrypted keystore from the account manager.
 func fetchKeystore(am *accounts.Manager) *keystore.KeyStore {
<span class="term-fg31">-	return am.Backends(keystore.KeyStoreType)[0].(*keystore.KeyStore)</span>
<span class="term-fg32">+	ks := am.Backends(keystore.KeyStoreType)</span>
<span class="term-fg32">+	if len(ks) == 0 {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return ks[0].(*keystore.KeyStore)</span>
 }
&nbsp;
 &#47;&#47; ImportRawKey stores the given hex encoded ECDSA key into the key directory,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9435034c1ae044ce97450d2c" role="button"
                   aria-expanded="false" aria-controls="id-9435034c1ae044ce97450d2c">
                    <code>tests/difficulty_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/difficulty_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/difficulty_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+0</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9435034c1ae044ce97450d2c"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;difficulty_test.go op-geth&#47;tests&#47;difficulty_test.go</span>
<span class="term-fg1">index a8273303e31f58e2578068d01174ca24157ffab2..03e14df7c4df56e645300c46d0990472cc4a7bde 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;difficulty_test.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;difficulty_test.go</span>
<span class="term-fg36">@@ -20,7 +20,6 @@</span> import (
 	&quot;math&#47;big&quot;
 	&quot;testing&quot;
&nbsp;
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 )
&nbsp;
<span class="term-fg36">@@ -31,7 +30,6 @@</span> 		HomesteadBlock: big.NewInt(1150000),
 		DAOForkBlock:   big.NewInt(1920000),
 		DAOForkSupport: true,
 		EIP150Block:    big.NewInt(2463000),
<span class="term-fg31">-		EIP150Hash:     common.HexToHash(&quot;0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0&quot;),</span>
 		EIP155Block:    big.NewInt(2675000),
 		EIP158Block:    big.NewInt(2675000),
 		ByzantiumBlock: big.NewInt(4370000),
<span class="term-fg36">@@ -43,7 +41,6 @@</span> 		HomesteadBlock:                big.NewInt(0),
 		DAOForkBlock:                  nil,
 		DAOForkSupport:                true,
 		EIP150Block:                   big.NewInt(0),
<span class="term-fg31">-		EIP150Hash:                    common.HexToHash(&quot;0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d&quot;),</span>
 		EIP155Block:                   big.NewInt(10),
 		EIP158Block:                   big.NewInt(10),
 		ByzantiumBlock:                big.NewInt(1_700_000),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-077e6fb431e007cb15906625" role="button"
                   aria-expanded="false" aria-controls="id-077e6fb431e007cb15906625">
                    <code>tests/fuzzers/les/les-fuzzer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/fuzzers/les/les-fuzzer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/fuzzers/les/les-fuzzer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-077e6fb431e007cb15906625"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;fuzzers&#47;les&#47;les-fuzzer.go op-geth&#47;tests&#47;fuzzers&#47;les&#47;les-fuzzer.go</span>
<span class="term-fg1">index 924a749e5832fc8c5614f0ee89c04f8987e5051c..926de04585720873c2ed4ccfa7493cedadaa7309 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;fuzzers&#47;les&#47;les-fuzzer.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;fuzzers&#47;les&#47;les-fuzzer.go</span>
<span class="term-fg36">@@ -93,13 +93,13 @@</span> 	for i := 0; i &lt; testChainLen; i++ {
 		&#47;&#47; The element in CHT is &lt;big-endian block number&gt; -&gt; &lt;block hash&gt;
 		key := make([]byte, 8)
 		binary.BigEndian.PutUint64(key, uint64(i+1))
<span class="term-fg31">-		chtTrie.Update(key, []byte{0x1, 0xf})</span>
<span class="term-fg32">+		chtTrie.MustUpdate(key, []byte{0x1, 0xf})</span>
 		chtKeys = append(chtKeys, key)
&nbsp;
 		&#47;&#47; The element in Bloom trie is &lt;2 byte bit index&gt; + &lt;big-endian block number&gt; -&gt; bloom
 		key2 := make([]byte, 10)
 		binary.BigEndian.PutUint64(key2[2:], uint64(i+1))
<span class="term-fg31">-		bloomTrie.Update(key2, []byte{0x2, 0xe})</span>
<span class="term-fg32">+		bloomTrie.MustUpdate(key2, []byte{0x2, 0xe})</span>
 		bloomKeys = append(bloomKeys, key2)
 	}
 	return</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-30146e9d763dc4216592a39b" role="button"
                   aria-expanded="false" aria-controls="id-30146e9d763dc4216592a39b">
                    <code>tests/fuzzers/rangeproof/rangeproof-fuzzer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/fuzzers/rangeproof/rangeproof-fuzzer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/fuzzers/rangeproof/rangeproof-fuzzer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-30146e9d763dc4216592a39b"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;fuzzers&#47;rangeproof&#47;rangeproof-fuzzer.go op-geth&#47;tests&#47;fuzzers&#47;rangeproof&#47;rangeproof-fuzzer.go</span>
<span class="term-fg1">index bca93bbe19c7c6da4d21b8b72acdcf3be7a4f108..2881c7a7c2113f666372c865b74e21419822bb15 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;fuzzers&#47;rangeproof&#47;rangeproof-fuzzer.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;fuzzers&#47;rangeproof&#47;rangeproof-fuzzer.go</span>
<span class="term-fg36">@@ -69,8 +69,8 @@</span> 	&#47;&#47; Fill it with some fluff
 	for i := byte(0); i &lt; byte(size); i++ {
 		value := &amp;kv{common.LeftPadBytes([]byte{i}, 32), []byte{i}, false}
 		value2 := &amp;kv{common.LeftPadBytes([]byte{i + 10}, 32), []byte{i}, false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg31">-		trie.Update(value2.k, value2.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value2.k, value2.v)</span>
 		vals[string(value.k)] = value
 		vals[string(value2.k)] = value2
 	}
<span class="term-fg36">@@ -82,7 +82,7 @@</span> 	for i := 0; i &lt; n; i++ {
 		k := f.randBytes(32)
 		v := f.randBytes(20)
 		value := &amp;kv{k, v, false}
<span class="term-fg31">-		trie.Update(k, v)</span>
<span class="term-fg32">+		trie.MustUpdate(k, v)</span>
 		vals[string(k)] = value
 		if f.exhausted {
 			return nil, nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8a04622c93c048453e4875a8" role="button"
                   aria-expanded="false" aria-controls="id-8a04622c93c048453e4875a8">
                    <code>tests/fuzzers/rlp/rlp_fuzzer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/fuzzers/rlp/rlp_fuzzer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/fuzzers/rlp/rlp_fuzzer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8a04622c93c048453e4875a8"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;fuzzers&#47;rlp&#47;rlp_fuzzer.go op-geth&#47;tests&#47;fuzzers&#47;rlp&#47;rlp_fuzzer.go</span>
<span class="term-fg1">index ac02e1651d446dfa597d29259e73cdcee8d0ebb1..9fcdb57769302d556caae55d1af810a3b155fd42 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;fuzzers&#47;rlp&#47;rlp_fuzzer.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;fuzzers&#47;rlp&#47;rlp_fuzzer.go</span>
<span class="term-fg36">@@ -19,9 +19,11 @@</span>
 import (
 	&quot;bytes&quot;
 	&quot;fmt&quot;
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 func decodeEncode(input []byte, val interface{}, i int) {
<span class="term-fg36">@@ -125,6 +127,17 @@</span> 		decodeEncode(input, &amp;txs, i)
 		i++
 		var rs types.Receipts
 		decodeEncode(input, &amp;rs, i)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	{</span>
<span class="term-fg32">+		i++</span>
<span class="term-fg32">+		var v struct {</span>
<span class="term-fg32">+			AnIntPtr  *big.Int</span>
<span class="term-fg32">+			AnInt     big.Int</span>
<span class="term-fg32">+			AnU256Ptr *uint256.Int</span>
<span class="term-fg32">+			AnU256    uint256.Int</span>
<span class="term-fg32">+			NotAnU256 [4]uint64</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		decodeEncode(input, &amp;v, i)</span>
 	}
 	return 1
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7e91e1a071347b9650394502" role="button"
                   aria-expanded="false" aria-controls="id-7e91e1a071347b9650394502">
                    <code>tests/fuzzers/stacktrie/trie_fuzzer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/fuzzers/stacktrie/trie_fuzzer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/fuzzers/stacktrie/trie_fuzzer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7e91e1a071347b9650394502"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;fuzzers&#47;stacktrie&#47;trie_fuzzer.go op-geth&#47;tests&#47;fuzzers&#47;stacktrie&#47;trie_fuzzer.go</span>
<span class="term-fg1">index 435aa3a47cf895e07eb1d1fdd07bbf17ed0aca45..809dba8ce593fa82e074eb40466b204dcffaa74f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;fuzzers&#47;stacktrie&#47;trie_fuzzer.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;fuzzers&#47;stacktrie&#47;trie_fuzzer.go</span>
<span class="term-fg36">@@ -175,7 +175,7 @@</span> 			continue
 		}
 		keys[string(k)] = struct{}{}
 		vals = append(vals, kv{k: k, v: v})
<span class="term-fg31">-		trieA.Update(k, v)</span>
<span class="term-fg32">+		trieA.MustUpdate(k, v)</span>
 		useful = true
 	}
 	if !useful {
<span class="term-fg36">@@ -195,7 +195,7 @@</span> 	for _, kv := range vals {
 		if f.debugging {
 			fmt.Printf(&quot;{\&quot;%#x\&quot; , \&quot;%#x\&quot;} &#47;&#47; stacktrie.Update\n&quot;, kv.k, kv.v)
 		}
<span class="term-fg31">-		trieB.Update(kv.k, kv.v)</span>
<span class="term-fg32">+		trieB.MustUpdate(kv.k, kv.v)</span>
 	}
 	rootB := trieB.Hash()
 	trieB.Commit()
<span class="term-fg36">@@ -223,7 +223,7 @@</span> 		})
 		checked int
 	)
 	for _, kv := range vals {
<span class="term-fg31">-		trieC.Update(kv.k, kv.v)</span>
<span class="term-fg32">+		trieC.MustUpdate(kv.k, kv.v)</span>
 	}
 	rootC, _ := trieC.Commit()
 	if rootA != rootC {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8c9a2319ea098a91cdd668d7" role="button"
                   aria-expanded="false" aria-controls="id-8c9a2319ea098a91cdd668d7">
                    <code>tests/fuzzers/trie/trie-fuzzer.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/fuzzers/trie/trie-fuzzer.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/fuzzers/trie/trie-fuzzer.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+4</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8c9a2319ea098a91cdd668d7"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;fuzzers&#47;trie&#47;trie-fuzzer.go op-geth&#47;tests&#47;fuzzers&#47;trie&#47;trie-fuzzer.go</span>
<span class="term-fg1">index 40dec76b8f84a5a424d9356a4812361805528be1..c0cbceff31ff689a89300055ecbfb7fbead63d96 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;fuzzers&#47;trie&#47;trie-fuzzer.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;fuzzers&#47;trie&#47;trie-fuzzer.go</span>
<span class="term-fg36">@@ -147,13 +147,13 @@</span>
 	for i, step := range rt {
 		switch step.op {
 		case opUpdate:
<span class="term-fg31">-			tr.Update(step.key, step.value)</span>
<span class="term-fg32">+			tr.MustUpdate(step.key, step.value)</span>
 			values[string(step.key)] = string(step.value)
 		case opDelete:
<span class="term-fg31">-			tr.Delete(step.key)</span>
<span class="term-fg32">+			tr.MustDelete(step.key)</span>
 			delete(values, string(step.key))
 		case opGet:
<span class="term-fg31">-			v := tr.Get(step.key)</span>
<span class="term-fg32">+			v := tr.MustGet(step.key)</span>
 			want := values[string(step.key)]
 			if string(v) != want {
 				rt[i].err = fmt.Errorf(&quot;mismatch for key %#x, got %#x want %#x&quot;, step.key, v, want)
<span class="term-fg36">@@ -176,7 +176,7 @@</span> 		case opItercheckhash:
 			checktr := trie.NewEmpty(triedb)
 			it := trie.NewIterator(tr.NodeIterator(nil))
 			for it.Next() {
<span class="term-fg31">-				checktr.Update(it.Key, it.Value)</span>
<span class="term-fg32">+				checktr.MustUpdate(it.Key, it.Value)</span>
 			}
 			if tr.Hash() != checktr.Hash() {
 				return fmt.Errorf(&quot;hash mismatch in opItercheckhash&quot;)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fad13f108f238ff14177824f" role="button"
                   aria-expanded="false" aria-controls="id-fad13f108f238ff14177824f">
                    <code>tests/state_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/state_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/state_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-3</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fad13f108f238ff14177824f"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;state_test.go op-geth&#47;tests&#47;state_test.go</span>
<span class="term-fg1">index 787427f01e45f7b1a7d8fa29338fde54edf3cfd4..2f54ccdbc74f6d7210ae1a32d777ad469d3604cf 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;state_test.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;state_test.go</span>
<span class="term-fg36">@@ -115,8 +115,7 @@</span> 		return
 	}
 	buf := new(bytes.Buffer)
 	w := bufio.NewWriter(buf)
<span class="term-fg31">-	tracer := logger.NewJSONLogger(&amp;logger.Config{}, w)</span>
<span class="term-fg31">-	config.Debug, config.Tracer = true, tracer</span>
<span class="term-fg32">+	config.Tracer = logger.NewJSONLogger(&amp;logger.Config{}, w)</span>
 	err2 := test(config)
 	if !reflect.DeepEqual(err, err2) {
 		t.Errorf(&quot;different error for second run: %v&quot;, err2)
<span class="term-fg36">@@ -222,7 +221,7 @@</span> 			}
&nbsp;
 			&#47;&#47; Prepare the EVM.
 			txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-			context := core.NewEVMBlockContext(block.Header(), nil, &amp;t.json.Env.Coinbase)</span>
<span class="term-fg32">+			context := core.NewEVMBlockContext(block.Header(), nil, &amp;t.json.Env.Coinbase, config, statedb)</span>
 			context.GetHash = vmTestBlockHash
 			context.BaseFee = baseFee
 			evm := vm.NewEVM(context, txContext, statedb, config, vmconfig)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c73adecccb300d79ce673c2f" role="button"
                   aria-expanded="false" aria-controls="id-c73adecccb300d79ce673c2f">
                    <code>tests/state_test_util.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/tests/state_test_util.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/tests/state_test_util.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+3</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c73adecccb300d79ce673c2f"><span class="term-fg1">diff --git go-ethereum&#47;tests&#47;state_test_util.go op-geth&#47;tests&#47;state_test_util.go</span>
<span class="term-fg1">index 98acc468a1d8308f16c4c5a99a02870aa959a812..b34dbe753530ba2a9f84324131e7a989a9c147fd 100644</span>
<span class="term-fg1">--- go-ethereum&#47;tests&#47;state_test_util.go</span>
<span class="term-fg1">+++ op-geth&#47;tests&#47;state_test_util.go</span>
<span class="term-fg36">@@ -37,6 +37,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;trie&quot;</span>
 	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;
 )
&nbsp;
<span class="term-fg36">@@ -245,7 +246,7 @@</span> 	}
&nbsp;
 	&#47;&#47; Prepare the EVM.
 	txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-	context := core.NewEVMBlockContext(block.Header(), nil, &amp;t.json.Env.Coinbase)</span>
<span class="term-fg32">+	context := core.NewEVMBlockContext(block.Header(), nil, &amp;t.json.Env.Coinbase, config, statedb)</span>
 	context.GetHash = vmTestBlockHash
 	context.BaseFee = baseFee
 	context.Random = nil
<span class="term-fg36">@@ -284,7 +285,7 @@</span> 	return t.json.Tx.GasLimit[t.json.Post[subtest.Fork][subtest.Index].Indexes.Gas]
 }
&nbsp;
 func MakePreState(db ethdb.Database, accounts core.GenesisAlloc, snapshotter bool) (*snapshot.Tree, *state.StateDB) {
<span class="term-fg31">-	sdb := state.NewDatabase(db)</span>
<span class="term-fg32">+	sdb := state.NewDatabaseWithConfig(db, &amp;trie.Config{Preimages: true})</span>
 	statedb, _ := state.New(common.Hash{}, sdb, nil)
 	for addr, a := range accounts {
 		statedb.SetCode(addr, a.Code)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a983bc7da4f16e20a87d1f67" role="button"
                   aria-expanded="false" aria-controls="id-a983bc7da4f16e20a87d1f67">
                    <code>trie/errors.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/errors.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/errors.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+1</span></div>
                        <div class="text-start"><span class="text-danger">-1</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a983bc7da4f16e20a87d1f67"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;errors.go op-geth&#47;trie&#47;errors.go</span>
<span class="term-fg1">index afe344bed26927727e159bf289726e87df1c0e40..bd82b950aad29173f79c0443f19c06c463daec4c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;errors.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;errors.go</span>
<span class="term-fg36">@@ -22,7 +22,7 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 )
&nbsp;
<span class="term-fg31">-&#47;&#47; MissingNodeError is returned by the trie functions (TryGet, TryUpdate, TryDelete)</span>
<span class="term-fg32">+&#47;&#47; MissingNodeError is returned by the trie functions (Get, Update, Delete)</span>
 &#47;&#47; in the case where a trie node is not present in the local database. It contains
 &#47;&#47; information necessary for retrieving the missing node.
 type MissingNodeError struct {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-69289ee623cd99799386bafe" role="button"
                   aria-expanded="false" aria-controls="id-69289ee623cd99799386bafe">
                    <code>trie/iterator_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/iterator_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/iterator_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+13</span></div>
                        <div class="text-start"><span class="text-danger">-13</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-69289ee623cd99799386bafe"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;iterator_test.go op-geth&#47;trie&#47;iterator_test.go</span>
<span class="term-fg1">index ac2a3d2a4c40c6680094d1ac9c1d2b8c6891a438..6dc38db6f1aced28ade1009a4b36f4c70aa1907e 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;iterator_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;iterator_test.go</span>
<span class="term-fg36">@@ -58,7 +58,7 @@</span> 	}
 	all := make(map[string]string)
 	for _, val := range vals {
 		all[val.k] = val.v
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	root, nodes := trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -89,8 +89,8 @@</span>
 	for i := byte(0); i &lt; 255; i++ {
 		value := &amp;kv{common.LeftPadBytes([]byte{i}, 32), []byte{i}, false}
 		value2 := &amp;kv{common.LeftPadBytes([]byte{10, i}, 32), []byte{i}, false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg31">-		trie.Update(value2.k, value2.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value2.k, value2.v)</span>
 		vals[string(value.k)] = value
 		vals[string(value2.k)] = value2
 	}
<span class="term-fg36">@@ -178,7 +178,7 @@</span>
 func TestIteratorSeek(t *testing.T) {
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for _, val := range testdata1 {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
&nbsp;
 	&#47;&#47; Seek to the middle.
<span class="term-fg36">@@ -220,7 +220,7 @@</span> func TestDifferenceIterator(t *testing.T) {
 	dba := NewDatabase(rawdb.NewMemoryDatabase())
 	triea := NewEmpty(dba)
 	for _, val := range testdata1 {
<span class="term-fg31">-		triea.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		triea.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	rootA, nodesA := triea.Commit(false)
 	dba.Update(NewWithNodeSet(nodesA))
<span class="term-fg36">@@ -229,7 +229,7 @@</span>
 	dbb := NewDatabase(rawdb.NewMemoryDatabase())
 	trieb := NewEmpty(dbb)
 	for _, val := range testdata2 {
<span class="term-fg31">-		trieb.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trieb.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	rootB, nodesB := trieb.Commit(false)
 	dbb.Update(NewWithNodeSet(nodesB))
<span class="term-fg36">@@ -262,7 +262,7 @@</span> func TestUnionIterator(t *testing.T) {
 	dba := NewDatabase(rawdb.NewMemoryDatabase())
 	triea := NewEmpty(dba)
 	for _, val := range testdata1 {
<span class="term-fg31">-		triea.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		triea.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	rootA, nodesA := triea.Commit(false)
 	dba.Update(NewWithNodeSet(nodesA))
<span class="term-fg36">@@ -271,7 +271,7 @@</span>
 	dbb := NewDatabase(rawdb.NewMemoryDatabase())
 	trieb := NewEmpty(dbb)
 	for _, val := range testdata2 {
<span class="term-fg31">-		trieb.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trieb.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	rootB, nodesB := trieb.Commit(false)
 	dbb.Update(NewWithNodeSet(nodesB))
<span class="term-fg36">@@ -314,7 +314,7 @@</span>
 func TestIteratorNoDups(t *testing.T) {
 	tr := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for _, val := range testdata1 {
<span class="term-fg31">-		tr.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		tr.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	checkIteratorNoDups(t, tr.NodeIterator(nil), nil)
 }
<span class="term-fg36">@@ -329,7 +329,7 @@</span> 	triedb := NewDatabase(diskdb)
&nbsp;
 	tr := NewEmpty(triedb)
 	for _, val := range testdata1 {
<span class="term-fg31">-		tr.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		tr.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	_, nodes := tr.Commit(false)
 	triedb.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -421,7 +421,7 @@</span> 	triedb := NewDatabase(diskdb)
&nbsp;
 	ctr := NewEmpty(triedb)
 	for _, val := range testdata1 {
<span class="term-fg31">-		ctr.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		ctr.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	root, nodes := ctr.Commit(false)
 	triedb.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -540,7 +540,7 @@</span> 		binary.BigEndian.PutUint64(key, uint64(i))
 		binary.BigEndian.PutUint64(val, uint64(i))
 		key = crypto.Keccak256(key)
 		val = crypto.Keccak256(val)
<span class="term-fg31">-		trie.Update(key, val)</span>
<span class="term-fg32">+		trie.MustUpdate(key, val)</span>
 	}
 	_, nodes := trie.Commit(false)
 	triedb.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -580,7 +580,7 @@</span> 	}
 	all := make(map[string]string)
 	for _, val := range vals {
 		all[val.k] = val.v
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	_, nodes := trie.Commit(false)
 	triedb.Update(NewWithNodeSet(nodes))</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-754345fc8d583263c68bf754" role="button"
                   aria-expanded="false" aria-controls="id-754345fc8d583263c68bf754">
                    <code>trie/proof.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/proof.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/proof.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+2</span></div>
                        <div class="text-start"><span class="text-danger">-2</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-754345fc8d583263c68bf754"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;proof.go op-geth&#47;trie&#47;proof.go</span>
<span class="term-fg1">index f11dfc47afabd9c53dd0033aa6f5d0f5a75d6c1a..65df7577b9b69a9be55862f8c719a17dfc3c99bb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;proof.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;proof.go</span>
<span class="term-fg36">@@ -498,7 +498,7 @@</span> 	&#47;&#47; to be the whole leaf-set in the trie.
 	if proof == nil {
 		tr := NewStackTrie(nil)
 		for index, key := range keys {
<span class="term-fg31">-			tr.TryUpdate(key, values[index])</span>
<span class="term-fg32">+			tr.Update(key, values[index])</span>
 		}
 		if have, want := tr.Hash(), rootHash; have != want {
 			return false, fmt.Errorf(&quot;invalid proof, want hash %x, got %x&quot;, want, have)
<span class="term-fg36">@@ -568,7 +568,7 @@</span> 	if empty {
 		tr.root = nil
 	}
 	for index, key := range keys {
<span class="term-fg31">-		tr.TryUpdate(key, values[index])</span>
<span class="term-fg32">+		tr.Update(key, values[index])</span>
 	}
 	if tr.Hash() != rootHash {
 		return false, fmt.Errorf(&quot;invalid proof, want hash %x, got %x&quot;, rootHash, tr.Hash())</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dddff50efc1bd598eab9ade8" role="button"
                   aria-expanded="false" aria-controls="id-dddff50efc1bd598eab9ade8">
                    <code>trie/proof_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/proof_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/proof_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-10</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dddff50efc1bd598eab9ade8"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;proof_test.go op-geth&#47;trie&#47;proof_test.go</span>
<span class="term-fg1">index 6b23bcdb27d8bca62dd56e0b821b234a85f6352b..69e3f8e9ceeae7ab16be8f3bfeaaf98ebe9dbbb6 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;proof_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;proof_test.go</span>
<span class="term-fg36">@@ -403,7 +403,7 @@</span>
 	&#47;&#47; Test the mini trie with only a single element.
 	tinyTrie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	entry := &amp;kv{randBytes(32), randBytes(20), false}
<span class="term-fg31">-	tinyTrie.Update(entry.k, entry.v)</span>
<span class="term-fg32">+	tinyTrie.MustUpdate(entry.k, entry.v)</span>
&nbsp;
 	first = common.HexToHash(&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;).Bytes()
 	last = entry.k
<span class="term-fg36">@@ -477,7 +477,7 @@</span> 		trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 		var entries entrySlice
 		for i := 0; i &lt; 4096; i++ {
 			value := &amp;kv{randBytes(32), randBytes(20), false}
<span class="term-fg31">-			trie.Update(value.k, value.v)</span>
<span class="term-fg32">+			trie.MustUpdate(value.k, value.v)</span>
 			entries = append(entries, value)
 		}
 		sort.Sort(entries)
<span class="term-fg36">@@ -512,7 +512,7 @@</span> 		trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 		var entries entrySlice
 		for i := 0; i &lt; 4096; i++ {
 			value := &amp;kv{randBytes(32), randBytes(20), false}
<span class="term-fg31">-			trie.Update(value.k, value.v)</span>
<span class="term-fg32">+			trie.MustUpdate(value.k, value.v)</span>
 			entries = append(entries, value)
 		}
 		sort.Sort(entries)
<span class="term-fg36">@@ -619,7 +619,7 @@</span> 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	var entries []*kv &#47;&#47; Sorted entries
 	for i := byte(0); i &lt; 10; i++ {
 		value := &amp;kv{common.LeftPadBytes([]byte{i}, 32), []byte{i}, false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
 		entries = append(entries, value)
 	}
 	first, last := 2, 8
<span class="term-fg36">@@ -693,7 +693,7 @@</span> 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	var entries entrySlice
 	for i := 0; i &lt; 4096; i++ {
 		value := &amp;kv{randBytes(32), randBytes(20), false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
 		entries = append(entries, value)
 	}
 	sort.Sort(entries)
<span class="term-fg36">@@ -1047,14 +1047,14 @@</span> 	vals := make(map[string]*kv)
 	for i := byte(0); i &lt; 100; i++ {
 		value := &amp;kv{common.LeftPadBytes([]byte{i}, 32), []byte{i}, false}
 		value2 := &amp;kv{common.LeftPadBytes([]byte{i + 10}, 32), []byte{i}, false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg31">-		trie.Update(value2.k, value2.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value2.k, value2.v)</span>
 		vals[string(value.k)] = value
 		vals[string(value2.k)] = value2
 	}
 	for i := 0; i &lt; n; i++ {
 		value := &amp;kv{randBytes(32), randBytes(20), false}
<span class="term-fg31">-		trie.Update(value.k, value.v)</span>
<span class="term-fg32">+		trie.MustUpdate(value.k, value.v)</span>
 		vals[string(value.k)] = value
 	}
 	return trie, vals
<span class="term-fg36">@@ -1071,7 +1071,7 @@</span> 		binary.LittleEndian.PutUint64(key, i)
 		binary.LittleEndian.PutUint64(value, i-max)
 		&#47;&#47;value := &amp;kv{common.LeftPadBytes([]byte{i}, 32), []byte{i}, false}
 		elem := &amp;kv{key, value, false}
<span class="term-fg31">-		trie.Update(elem.k, elem.v)</span>
<span class="term-fg32">+		trie.MustUpdate(elem.k, elem.v)</span>
 		vals[string(elem.k)] = elem
 	}
 	return trie, vals
<span class="term-fg36">@@ -1088,7 +1088,7 @@</span> 		common.Hex2Bytes(&quot;03&quot;),
 	}
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for i, key := range keys {
<span class="term-fg31">-		trie.Update(key, vals[i])</span>
<span class="term-fg32">+		trie.MustUpdate(key, vals[i])</span>
 	}
 	root := trie.Hash()
 	proof := memorydb.New()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4b10969f035ff6e8f21a43a0" role="button"
                   aria-expanded="false" aria-controls="id-4b10969f035ff6e8f21a43a0">
                    <code>trie/secure_trie.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/secure_trie.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/secure_trie.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+48</span></div>
                        <div class="text-start"><span class="text-danger">-47</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4b10969f035ff6e8f21a43a0"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;secure_trie.go op-geth&#47;trie&#47;secure_trie.go</span>
<span class="term-fg1">index 83b92cebd24502dfa5c7279f8920bca263ee24b3..5bfd246501cc7f6d2c934fb7a1449349ca948e67 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;secure_trie.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;secure_trie.go</span>
<span class="term-fg36">@@ -19,7 +19,6 @@</span>
 import (
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
<span class="term-fg31">-	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;
 )
&nbsp;
<span class="term-fg36">@@ -72,29 +71,28 @@</span> 	}
 	return &amp;StateTrie{trie: *trie, preimages: db.preimages}, nil
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Get returns the value for key stored in the trie.</span>
<span class="term-fg32">+&#47;&#47; MustGet returns the value for key stored in the trie.</span>
 &#47;&#47; The value bytes must not be modified by the caller.
<span class="term-fg31">-func (t *StateTrie) Get(key []byte) []byte {</span>
<span class="term-fg31">-	res, err := t.TryGet(key)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		log.Error(&quot;Unhandled trie error in StateTrie.Get&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	return res</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; This function will omit any encountered error but just</span>
<span class="term-fg32">+&#47;&#47; print out an error message.</span>
<span class="term-fg32">+func (t *StateTrie) MustGet(key []byte) []byte {</span>
<span class="term-fg32">+	return t.trie.MustGet(t.hashKey(key))</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGet returns the value for key stored in the trie.</span>
<span class="term-fg31">-&#47;&#47; The value bytes must not be modified by the caller.</span>
<span class="term-fg31">-&#47;&#47; If the specified node is not in the trie, nil will be returned.</span>
<span class="term-fg32">+&#47;&#47; GetStorage attempts to retrieve a storage slot with provided account address</span>
<span class="term-fg32">+&#47;&#47; and slot key. The value bytes must not be modified by the caller.</span>
<span class="term-fg32">+&#47;&#47; If the specified storage slot is not in the trie, nil will be returned.</span>
 &#47;&#47; If a trie node is not found in the database, a MissingNodeError is returned.
<span class="term-fg31">-func (t *StateTrie) TryGet(key []byte) ([]byte, error) {</span>
<span class="term-fg31">-	return t.trie.TryGet(t.hashKey(key))</span>
<span class="term-fg32">+func (t *StateTrie) GetStorage(_ common.Address, key []byte) ([]byte, error) {</span>
<span class="term-fg32">+	return t.trie.Get(t.hashKey(key))</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGetAccount attempts to retrieve an account with provided account address.</span>
<span class="term-fg32">+&#47;&#47; GetAccount attempts to retrieve an account with provided account address.</span>
 &#47;&#47; If the specified account is not in the trie, nil will be returned.
 &#47;&#47; If a trie node is not found in the database, a MissingNodeError is returned.
<span class="term-fg31">-func (t *StateTrie) TryGetAccount(address common.Address) (*types.StateAccount, error) {</span>
<span class="term-fg31">-	res, err := t.trie.TryGet(t.hashKey(address.Bytes()))</span>
<span class="term-fg32">+func (t *StateTrie) GetAccount(address common.Address) (*types.StateAccount, error) {</span>
<span class="term-fg32">+	res, err := t.trie.Get(t.hashKey(address.Bytes()))</span>
 	if res == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -103,11 +101,11 @@</span> 	err = rlp.DecodeBytes(res, ret)
 	return ret, err
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGetAccountByHash does the same thing as TryGetAccount, however</span>
<span class="term-fg31">-&#47;&#47; it expects an account hash that is the hash of address. This constitutes an</span>
<span class="term-fg31">-&#47;&#47; abstraction leak, since the client code needs to know the key format.</span>
<span class="term-fg31">-func (t *StateTrie) TryGetAccountByHash(addrHash common.Hash) (*types.StateAccount, error) {</span>
<span class="term-fg31">-	res, err := t.trie.TryGet(addrHash.Bytes())</span>
<span class="term-fg32">+&#47;&#47; GetAccountByHash does the same thing as GetAccount, however it expects an</span>
<span class="term-fg32">+&#47;&#47; account hash that is the hash of address. This constitutes an abstraction</span>
<span class="term-fg32">+&#47;&#47; leak, since the client code needs to know the key format.</span>
<span class="term-fg32">+func (t *StateTrie) GetAccountByHash(addrHash common.Hash) (*types.StateAccount, error) {</span>
<span class="term-fg32">+	res, err := t.trie.Get(addrHash.Bytes())</span>
 	if res == nil || err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -116,27 +114,30 @@</span> 	err = rlp.DecodeBytes(res, ret)
 	return ret, err
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGetNode attempts to retrieve a trie node by compact-encoded path. It is not</span>
<span class="term-fg32">+&#47;&#47; GetNode attempts to retrieve a trie node by compact-encoded path. It is not</span>
 &#47;&#47; possible to use keybyte-encoding as the path might contain odd nibbles.
 &#47;&#47; If the specified trie node is not in the trie, nil will be returned.
 &#47;&#47; If a trie node is not found in the database, a MissingNodeError is returned.
<span class="term-fg31">-func (t *StateTrie) TryGetNode(path []byte) ([]byte, int, error) {</span>
<span class="term-fg31">-	return t.trie.TryGetNode(path)</span>
<span class="term-fg32">+func (t *StateTrie) GetNode(path []byte) ([]byte, int, error) {</span>
<span class="term-fg32">+	return t.trie.GetNode(path)</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Update associates key with value in the trie. Subsequent calls to</span>
<span class="term-fg32">+&#47;&#47; MustUpdate associates key with value in the trie. Subsequent calls to</span>
 &#47;&#47; Get will return value. If value has length zero, any existing value
 &#47;&#47; is deleted from the trie and calls to Get will return nil.
 &#47;&#47;
 &#47;&#47; The value bytes must not be modified by the caller while they are
 &#47;&#47; stored in the trie.
<span class="term-fg31">-func (t *StateTrie) Update(key, value []byte) {</span>
<span class="term-fg31">-	if err := t.TryUpdate(key, value); err != nil {</span>
<span class="term-fg31">-		log.Error(&quot;Unhandled trie error in StateTrie.Update&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; This function will omit any encountered error but just print out an</span>
<span class="term-fg32">+&#47;&#47; error message.</span>
<span class="term-fg32">+func (t *StateTrie) MustUpdate(key, value []byte) {</span>
<span class="term-fg32">+	hk := t.hashKey(key)</span>
<span class="term-fg32">+	t.trie.MustUpdate(hk, value)</span>
<span class="term-fg32">+	t.getSecKeyCache()[string(hk)] = common.CopyBytes(key)</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryUpdate associates key with value in the trie. Subsequent calls to</span>
<span class="term-fg32">+&#47;&#47; UpdateStorage associates key with value in the trie. Subsequent calls to</span>
 &#47;&#47; Get will return value. If value has length zero, any existing value
 &#47;&#47; is deleted from the trie and calls to Get will return nil.
 &#47;&#47;
<span class="term-fg36">@@ -144,9 +145,9 @@</span> &#47;&#47; The value bytes must not be modified by the caller while they are
 &#47;&#47; stored in the trie.
 &#47;&#47;
 &#47;&#47; If a node is not found in the database, a MissingNodeError is returned.
<span class="term-fg31">-func (t *StateTrie) TryUpdate(key, value []byte) error {</span>
<span class="term-fg32">+func (t *StateTrie) UpdateStorage(_ common.Address, key, value []byte) error {</span>
 	hk := t.hashKey(key)
<span class="term-fg31">-	err := t.trie.TryUpdate(hk, value)</span>
<span class="term-fg32">+	err := t.trie.Update(hk, value)</span>
 	if err != nil {
 		return err
 	}
<span class="term-fg36">@@ -154,42 +155,42 @@</span> 	t.getSecKeyCache()[string(hk)] = common.CopyBytes(key)
 	return nil
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryUpdateAccount account will abstract the write of an account to the</span>
<span class="term-fg31">-&#47;&#47; secure trie.</span>
<span class="term-fg31">-func (t *StateTrie) TryUpdateAccount(address common.Address, acc *types.StateAccount) error {</span>
<span class="term-fg32">+&#47;&#47; UpdateAccount will abstract the write of an account to the secure trie.</span>
<span class="term-fg32">+func (t *StateTrie) UpdateAccount(address common.Address, acc *types.StateAccount) error {</span>
 	hk := t.hashKey(address.Bytes())
 	data, err := rlp.EncodeToBytes(acc)
 	if err != nil {
 		return err
 	}
<span class="term-fg31">-	if err := t.trie.TryUpdate(hk, data); err != nil {</span>
<span class="term-fg32">+	if err := t.trie.Update(hk, data); err != nil {</span>
 		return err
 	}
 	t.getSecKeyCache()[string(hk)] = address.Bytes()
 	return nil
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Delete removes any existing value for key from the trie.</span>
<span class="term-fg31">-func (t *StateTrie) Delete(key []byte) {</span>
<span class="term-fg31">-	if err := t.TryDelete(key); err != nil {</span>
<span class="term-fg31">-		log.Error(&quot;Unhandled trie error in StateTrie.Delete&quot;, &quot;err&quot;, err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+&#47;&#47; MustDelete removes any existing value for key from the trie. This function</span>
<span class="term-fg32">+&#47;&#47; will omit any encountered error but just print out an error message.</span>
<span class="term-fg32">+func (t *StateTrie) MustDelete(key []byte) {</span>
<span class="term-fg32">+	hk := t.hashKey(key)</span>
<span class="term-fg32">+	delete(t.getSecKeyCache(), string(hk))</span>
<span class="term-fg32">+	t.trie.MustDelete(hk)</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryDelete removes any existing value for key from the trie.</span>
<span class="term-fg32">+&#47;&#47; DeleteStorage removes any existing storage slot from the trie.</span>
 &#47;&#47; If the specified trie node is not in the trie, nothing will be changed.
 &#47;&#47; If a node is not found in the database, a MissingNodeError is returned.
<span class="term-fg31">-func (t *StateTrie) TryDelete(key []byte) error {</span>
<span class="term-fg32">+func (t *StateTrie) DeleteStorage(_ common.Address, key []byte) error {</span>
 	hk := t.hashKey(key)
 	delete(t.getSecKeyCache(), string(hk))
<span class="term-fg31">-	return t.trie.TryDelete(hk)</span>
<span class="term-fg32">+	return t.trie.Delete(hk)</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryDeleteAccount abstracts an account deletion from the trie.</span>
<span class="term-fg31">-func (t *StateTrie) TryDeleteAccount(address common.Address) error {</span>
<span class="term-fg32">+&#47;&#47; DeleteAccount abstracts an account deletion from the trie.</span>
<span class="term-fg32">+func (t *StateTrie) DeleteAccount(address common.Address) error {</span>
 	hk := t.hashKey(address.Bytes())
 	delete(t.getSecKeyCache(), string(hk))
<span class="term-fg31">-	return t.trie.TryDelete(hk)</span>
<span class="term-fg32">+	return t.trie.Delete(hk)</span>
 }
&nbsp;
 &#47;&#47; GetKey returns the sha3 preimage of a hashed key that was</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d01221a3375e678377fd03c5" role="button"
                   aria-expanded="false" aria-controls="id-d01221a3375e678377fd03c5">
                    <code>trie/secure_trie_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/secure_trie_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/secure_trie_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+10</span></div>
                        <div class="text-start"><span class="text-danger">-10</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d01221a3375e678377fd03c5"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;secure_trie_test.go op-geth&#47;trie&#47;secure_trie_test.go</span>
<span class="term-fg1">index d3e6c670690e4cb4aa815a73a8e0fbdbe6c9ddac..a55c10a60b6e315b3c8f3d4b3f7fe1cf0a67c14f 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;secure_trie_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;secure_trie_test.go</span>
<span class="term-fg36">@@ -45,17 +45,17 @@</span> 	for i := byte(0); i &lt; 255; i++ {
 		&#47;&#47; Map the same data under multiple keys
 		key, val := common.LeftPadBytes([]byte{1, i}, 32), []byte{i}
 		content[string(key)] = val
<span class="term-fg31">-		trie.Update(key, val)</span>
<span class="term-fg32">+		trie.MustUpdate(key, val)</span>
&nbsp;
 		key, val = common.LeftPadBytes([]byte{2, i}, 32), []byte{i}
 		content[string(key)] = val
<span class="term-fg31">-		trie.Update(key, val)</span>
<span class="term-fg32">+		trie.MustUpdate(key, val)</span>
&nbsp;
 		&#47;&#47; Add some other data to inflate the trie
 		for j := byte(3); j &lt; 13; j++ {
 			key, val = common.LeftPadBytes([]byte{j, i}, 32), []byte{j, i}
 			content[string(key)] = val
<span class="term-fg31">-			trie.Update(key, val)</span>
<span class="term-fg32">+			trie.MustUpdate(key, val)</span>
 		}
 	}
 	root, nodes := trie.Commit(false)
<span class="term-fg36">@@ -81,9 +81,9 @@</span> 		{&quot;shaman&quot;, &quot;&quot;},
 	}
 	for _, val := range vals {
 		if val.v != &quot;&quot; {
<span class="term-fg31">-			trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+			trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 		} else {
<span class="term-fg31">-			trie.Delete([]byte(val.k))</span>
<span class="term-fg32">+			trie.MustDelete([]byte(val.k))</span>
 		}
 	}
 	hash := trie.Hash()
<span class="term-fg36">@@ -95,13 +95,13 @@</span> }
&nbsp;
 func TestSecureGetKey(t *testing.T) {
 	trie := newEmptySecure()
<span class="term-fg31">-	trie.Update([]byte(&quot;foo&quot;), []byte(&quot;bar&quot;))</span>
<span class="term-fg32">+	trie.MustUpdate([]byte(&quot;foo&quot;), []byte(&quot;bar&quot;))</span>
&nbsp;
 	key := []byte(&quot;foo&quot;)
 	value := []byte(&quot;bar&quot;)
 	seckey := crypto.Keccak256(key)
&nbsp;
<span class="term-fg31">-	if !bytes.Equal(trie.Get(key), value) {</span>
<span class="term-fg32">+	if !bytes.Equal(trie.MustGet(key), value) {</span>
 		t.Errorf(&quot;Get did not return bar&quot;)
 	}
 	if k := trie.GetKey(seckey); !bytes.Equal(k, key) {
<span class="term-fg36">@@ -128,15 +128,15 @@</span>
 			for j := byte(0); j &lt; 255; j++ {
 				&#47;&#47; Map the same data under multiple keys
 				key, val := common.LeftPadBytes([]byte{byte(index), 1, j}, 32), []byte{j}
<span class="term-fg31">-				tries[index].Update(key, val)</span>
<span class="term-fg32">+				tries[index].MustUpdate(key, val)</span>
&nbsp;
 				key, val = common.LeftPadBytes([]byte{byte(index), 2, j}, 32), []byte{j}
<span class="term-fg31">-				tries[index].Update(key, val)</span>
<span class="term-fg32">+				tries[index].MustUpdate(key, val)</span>
&nbsp;
 				&#47;&#47; Add some other data to inflate the trie
 				for k := byte(3); k &lt; 13; k++ {
 					key, val = common.LeftPadBytes([]byte{byte(index), k, j}, 32), []byte{k, j}
<span class="term-fg31">-					tries[index].Update(key, val)</span>
<span class="term-fg32">+					tries[index].MustUpdate(key, val)</span>
 				}
 			}
 			tries[index].Commit(false)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-353ee60b1ab40e2a2d4bee7d" role="button"
                   aria-expanded="false" aria-controls="id-353ee60b1ab40e2a2d4bee7d">
                    <code>trie/stacktrie.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/stacktrie.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/stacktrie.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+6</span></div>
                        <div class="text-start"><span class="text-danger">-4</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-353ee60b1ab40e2a2d4bee7d"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;stacktrie.go op-geth&#47;trie&#47;stacktrie.go</span>
<span class="term-fg1">index 83034e29a530c66fa60b3ff8c1b8b5b0b75baa6e..030d2a596c8881d0bfd4ac8c6bbef22a6c9bbce1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;stacktrie.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;stacktrie.go</span>
<span class="term-fg36">@@ -202,8 +202,8 @@</span> 	leafNode
 	hashedNode
 )
&nbsp;
<span class="term-fg31">-&#47;&#47; TryUpdate inserts a (key, value) pair into the stack trie</span>
<span class="term-fg31">-func (st *StackTrie) TryUpdate(key, value []byte) error {</span>
<span class="term-fg32">+&#47;&#47; Update inserts a (key, value) pair into the stack trie.</span>
<span class="term-fg32">+func (st *StackTrie) Update(key, value []byte) error {</span>
 	k := keybytesToHex(key)
 	if len(value) == 0 {
 		panic(&quot;deletion not supported&quot;)
<span class="term-fg36">@@ -212,8 +212,10 @@</span> 	st.insert(k[:len(k)-1], value, nil)
 	return nil
 }
&nbsp;
<span class="term-fg31">-func (st *StackTrie) Update(key, value []byte) {</span>
<span class="term-fg31">-	if err := st.TryUpdate(key, value); err != nil {</span>
<span class="term-fg32">+&#47;&#47; MustUpdate is a wrapper of Update and will omit any encountered error but</span>
<span class="term-fg32">+&#47;&#47; just print out an error message.</span>
<span class="term-fg32">+func (st *StackTrie) MustUpdate(key, value []byte) {</span>
<span class="term-fg32">+	if err := st.Update(key, value); err != nil {</span>
 		log.Error(&quot;Unhandled trie error in StackTrie.Update&quot;, &quot;err&quot;, err)
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dda1e0e30746ac27451a14f3" role="button"
                   aria-expanded="false" aria-controls="id-dda1e0e30746ac27451a14f3">
                    <code>trie/stacktrie_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/stacktrie_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/stacktrie_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+15</span></div>
                        <div class="text-start"><span class="text-danger">-15</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dda1e0e30746ac27451a14f3"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;stacktrie_test.go op-geth&#47;trie&#47;stacktrie_test.go</span>
<span class="term-fg1">index 3e6cc8cd57850f3df29f3eb6620b5a078d140ccb..ea3eef78820dd83c0ac39660e7214eda45d61799 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;stacktrie_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;stacktrie_test.go</span>
<span class="term-fg36">@@ -174,7 +174,7 @@</span> 		for l := 1; l &lt;= len(test); l++ {
 			st.Reset()
 			for j := 0; j &lt; l; j++ {
 				kv := &amp;test[j]
<span class="term-fg31">-				if err := st.TryUpdate(common.FromHex(kv.K), []byte(kv.V)); err != nil {</span>
<span class="term-fg32">+				if err := st.Update(common.FromHex(kv.K), []byte(kv.V)); err != nil {</span>
 					t.Fatal(err)
 				}
 			}
<span class="term-fg36">@@ -193,8 +193,8 @@</span>
 	leaf := common.FromHex(&quot;290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563&quot;)
 	value := common.FromHex(&quot;94cf40d0d2b44f2b66e07cace1372ca42b73cf21a3&quot;)
&nbsp;
<span class="term-fg31">-	nt.TryUpdate(leaf, value)</span>
<span class="term-fg31">-	st.TryUpdate(leaf, value)</span>
<span class="term-fg32">+	nt.Update(leaf, value)</span>
<span class="term-fg32">+	st.Update(leaf, value)</span>
&nbsp;
 	if nt.Hash() != st.Hash() {
 		t.Fatalf(&quot;error %x != %x&quot;, st.Hash(), nt.Hash())
<span class="term-fg36">@@ -218,8 +218,8 @@</span> 		{K: &quot;c2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b&quot;, V: &quot;02&quot;},
 	}
&nbsp;
 	for _, kv := range kvs {
<span class="term-fg31">-		nt.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg31">-		st.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		nt.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		st.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
 	}
&nbsp;
 	if nt.Hash() != st.Hash() {
<span class="term-fg36">@@ -241,8 +241,8 @@</span> 		{K: &quot;405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace&quot;, V: &quot;1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot;},
 	}
&nbsp;
 	for _, kv := range kvs {
<span class="term-fg31">-		nt.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg31">-		st.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		nt.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		st.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
 	}
&nbsp;
 	if nt.Hash() != st.Hash() {
<span class="term-fg36">@@ -263,8 +263,8 @@</span> 		{&quot;63303030&quot;, &quot;3041&quot;}, &#47;&#47; stacktrie.Update
 		{&quot;65&quot;, &quot;3000&quot;},       &#47;&#47; stacktrie.Update
 	}
 	for _, kv := range kvs {
<span class="term-fg31">-		nt.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg31">-		st.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		nt.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		st.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
 	}
 	if nt.Hash() != st.Hash() {
 		t.Fatalf(&quot;error %x != %x&quot;, st.Hash(), nt.Hash())
<span class="term-fg36">@@ -291,8 +291,8 @@</span> 		{&quot;0x33303534636532393561313031676174&quot;, &quot;303030&quot;},
 		{&quot;0x3330353463653239356131303167617430&quot;, &quot;313131&quot;},
 	}
 	for _, kv := range kvs {
<span class="term-fg31">-		nt.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg31">-		st.TryUpdate(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		nt.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
<span class="term-fg32">+		st.Update(common.FromHex(kv.K), common.FromHex(kv.V))</span>
 	}
 	if nt.Hash() != st.Hash() {
 		t.Fatalf(&quot;error %x != %x&quot;, st.Hash(), nt.Hash())
<span class="term-fg36">@@ -309,7 +309,7 @@</span> 		&#47;&#47; so if the stacktrie tries to append, it won&#39;t have to realloc
 		value := make([]byte, 1, 100)
 		value[0] = 0x2
 		want := common.CopyBytes(value)
<span class="term-fg31">-		st.TryUpdate([]byte{0x01}, value)</span>
<span class="term-fg32">+		st.Update([]byte{0x01}, value)</span>
 		st.Hash()
 		if have := value; !bytes.Equal(have, want) {
 			t.Fatalf(&quot;tiny trie: have %#x want %#x&quot;, have, want)
<span class="term-fg36">@@ -330,7 +330,7 @@</span> 	}
 	for i := 0; i &lt; 1000; i++ {
 		key := common.BigToHash(keyB)
 		value := getValue(i)
<span class="term-fg31">-		st.TryUpdate(key.Bytes(), value)</span>
<span class="term-fg32">+		st.Update(key.Bytes(), value)</span>
 		vals = append(vals, value)
 		keyB = keyB.Add(keyB, keyDelta)
 		keyDelta.Add(keyDelta, common.Big1)
<span class="term-fg36">@@ -371,7 +371,7 @@</span> 		keyB = keyB.Add(keyB, keyDelta)
 		keyDelta.Add(keyDelta, common.Big1)
 	}
 	for i, k := range keys {
<span class="term-fg31">-		nt.TryUpdate(k, common.CopyBytes(vals[i]))</span>
<span class="term-fg32">+		nt.Update(k, common.CopyBytes(vals[i]))</span>
 	}
&nbsp;
 	for i, k := range keys {
<span class="term-fg36">@@ -384,7 +384,7 @@</span> 		if err != nil {
 			t.Fatal(err)
 		}
 		st = newSt
<span class="term-fg31">-		st.TryUpdate(k, common.CopyBytes(vals[i]))</span>
<span class="term-fg32">+		st.Update(k, common.CopyBytes(vals[i]))</span>
 	}
 	if have, want := st.Hash(), nt.Hash(); have != want {
 		t.Fatalf(&quot;have %#x want %#x&quot;, have, want)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-039b0e20fb6091a7e194f5f5" role="button"
                   aria-expanded="false" aria-controls="id-039b0e20fb6091a7e194f5f5">
                    <code>trie/sync_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/sync_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/sync_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+5</span></div>
                        <div class="text-start"><span class="text-danger">-5</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-039b0e20fb6091a7e194f5f5"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;sync_test.go op-geth&#47;trie&#47;sync_test.go</span>
<span class="term-fg1">index 8fec378333da80ae9d7083632ccbbd30e9833b52..70898604f84518d661c4b1bac2cdf897dedc37f1 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;sync_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;sync_test.go</span>
<span class="term-fg36">@@ -40,17 +40,17 @@</span> 	for i := byte(0); i &lt; 255; i++ {
 		&#47;&#47; Map the same data under multiple keys
 		key, val := common.LeftPadBytes([]byte{1, i}, 32), []byte{i}
 		content[string(key)] = val
<span class="term-fg31">-		trie.Update(key, val)</span>
<span class="term-fg32">+		trie.MustUpdate(key, val)</span>
&nbsp;
 		key, val = common.LeftPadBytes([]byte{2, i}, 32), []byte{i}
 		content[string(key)] = val
<span class="term-fg31">-		trie.Update(key, val)</span>
<span class="term-fg32">+		trie.MustUpdate(key, val)</span>
&nbsp;
 		&#47;&#47; Add some other data to inflate the trie
 		for j := byte(3); j &lt; 13; j++ {
 			key, val = common.LeftPadBytes([]byte{j, i}, 32), []byte{j, i}
 			content[string(key)] = val
<span class="term-fg31">-			trie.Update(key, val)</span>
<span class="term-fg32">+			trie.MustUpdate(key, val)</span>
 		}
 	}
 	root, nodes := trie.Commit(false)
<span class="term-fg36">@@ -74,7 +74,7 @@</span> 	if err := checkTrieConsistency(db, common.BytesToHash(root)); err != nil {
 		t.Fatalf(&quot;inconsistent trie at %x: %v&quot;, root, err)
 	}
 	for key, val := range content {
<span class="term-fg31">-		if have := trie.Get([]byte(key)); !bytes.Equal(have, val) {</span>
<span class="term-fg32">+		if have := trie.MustGet([]byte(key)); !bytes.Equal(have, val) {</span>
 			t.Errorf(&quot;entry %x: content mismatch: have %x, want %x&quot;, key, have, val)
 		}
 	}
<span class="term-fg36">@@ -154,7 +154,7 @@</span> 				results[i] = NodeSyncResult{element.path, data}
 			}
 		} else {
 			for i, element := range elements {
<span class="term-fg31">-				data, _, err := srcTrie.TryGetNode(element.syncPath[len(element.syncPath)-1])</span>
<span class="term-fg32">+				data, _, err := srcTrie.GetNode(element.syncPath[len(element.syncPath)-1])</span>
 				if err != nil {
 					t.Fatalf(&quot;failed to retrieve node data for path %x: %v&quot;, element.path, err)
 				}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19d10d55bc42143eaf799fcb" role="button"
                   aria-expanded="false" aria-controls="id-19d10d55bc42143eaf799fcb">
                    <code>trie/tracer_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/tracer_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/tracer_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+12</span></div>
                        <div class="text-start"><span class="text-danger">-12</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19d10d55bc42143eaf799fcb"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;tracer_test.go op-geth&#47;trie&#47;tracer_test.go</span>
<span class="term-fg1">index 5e627c89c9be432c21292476ca83bb5e15c05f76..1b9f441084f2b1b69a7d78843d0e886de1e16f82 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;tracer_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;tracer_test.go</span>
<span class="term-fg36">@@ -64,7 +64,7 @@</span> 	trie := NewEmpty(db)
&nbsp;
 	&#47;&#47; Determine all new nodes are tracked
 	for _, val := range vals {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	insertSet := copySet(trie.tracer.inserts) &#47;&#47; copy before commit
 	deleteSet := copySet(trie.tracer.deletes) &#47;&#47; copy before commit
<span class="term-fg36">@@ -82,7 +82,7 @@</span>
 	&#47;&#47; Determine all deletions are tracked
 	trie, _ = New(TrieID(root), db)
 	for _, val := range vals {
<span class="term-fg31">-		trie.Delete([]byte(val.k))</span>
<span class="term-fg32">+		trie.MustDelete([]byte(val.k))</span>
 	}
 	insertSet, deleteSet = copySet(trie.tracer.inserts), copySet(trie.tracer.deletes)
 	if !compareSet(insertSet, nil) {
<span class="term-fg36">@@ -104,10 +104,10 @@</span>
 func testTrieTracerNoop(t *testing.T, vals []struct{ k, v string }) {
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for _, val := range vals {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	for _, val := range vals {
<span class="term-fg31">-		trie.Delete([]byte(val.k))</span>
<span class="term-fg32">+		trie.MustDelete([]byte(val.k))</span>
 	}
 	if len(trie.tracer.inserts) != 0 {
 		t.Fatal(&quot;Unexpected insertion set&quot;)
<span class="term-fg36">@@ -132,7 +132,7 @@</span> 		orig = trie.Copy()
 	)
 	&#47;&#47; Create trie from scratch
 	for _, val := range vals {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	root, nodes := trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -146,7 +146,7 @@</span> 	&#47;&#47; Update trie
 	trie, _ = New(TrieID(root), db)
 	orig = trie.Copy()
 	for _, val := range vals {
<span class="term-fg31">-		trie.Update([]byte(val.k), randBytes(32))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), randBytes(32))</span>
 	}
 	root, nodes = trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -163,7 +163,7 @@</span> 	var keys []string
 	for i := 0; i &lt; 30; i++ {
 		key := randBytes(32)
 		keys = append(keys, string(key))
<span class="term-fg31">-		trie.Update(key, randBytes(32))</span>
<span class="term-fg32">+		trie.MustUpdate(key, randBytes(32))</span>
 	}
 	root, nodes = trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -177,7 +177,7 @@</span> 	&#47;&#47; Partial deletions
 	trie, _ = New(TrieID(root), db)
 	orig = trie.Copy()
 	for _, key := range keys {
<span class="term-fg31">-		trie.Update([]byte(key), nil)</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(key), nil)</span>
 	}
 	root, nodes = trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -191,7 +191,7 @@</span> 	&#47;&#47; Delete all
 	trie, _ = New(TrieID(root), db)
 	orig = trie.Copy()
 	for _, val := range vals {
<span class="term-fg31">-		trie.Update([]byte(val.k), nil)</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), nil)</span>
 	}
 	root, nodes = trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -210,7 +210,7 @@</span> 		trie = NewEmpty(db)
 	)
 	&#47;&#47; Create trie from scratch
 	for _, val := range standard {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	root, nodes := trie.Commit(false)
 	db.Update(NewWithNodeSet(nodes))
<span class="term-fg36">@@ -260,7 +260,7 @@</span> 		db   = NewDatabase(rawdb.NewMemoryDatabase())
 		trie = NewEmpty(db)
 	)
 	for _, val := range tiny {
<span class="term-fg31">-		trie.Update([]byte(val.k), randBytes(32))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), randBytes(32))</span>
 	}
 	root, set := trie.Commit(false)
 	db.Update(NewWithNodeSet(set))
<span class="term-fg36">@@ -268,7 +268,7 @@</span>
 	trie, _ = New(TrieID(root), db)
 	orig := trie.Copy()
 	for _, val := range tiny {
<span class="term-fg31">-		trie.Update([]byte(val.k), []byte(val.v))</span>
<span class="term-fg32">+		trie.MustUpdate([]byte(val.k), []byte(val.v))</span>
 	}
 	root, set = trie.Commit(false)
 	db.Update(NewWithNodeSet(set))</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6f69aee29d1c350c7ac40d8b" role="button"
                   aria-expanded="false" aria-controls="id-6f69aee29d1c350c7ac40d8b">
                    <code>trie/trie.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/trie.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/trie.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+55</span></div>
                        <div class="text-start"><span class="text-danger">-42</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6f69aee29d1c350c7ac40d8b"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;trie.go op-geth&#47;trie&#47;trie.go</span>
<span class="term-fg1">index 17bacba00fdc02d4e003221c1042b04d53c2b4b4..4b6f6a55bbc46177181cfe183d8c28a2714a9890 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;trie.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;trie.go</span>
<span class="term-fg36">@@ -105,28 +105,30 @@</span> func (t *Trie) NodeIterator(start []byte) NodeIterator {
 	return newNodeIterator(t, start)
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Get returns the value for key stored in the trie.</span>
<span class="term-fg31">-&#47;&#47; The value bytes must not be modified by the caller.</span>
<span class="term-fg31">-func (t *Trie) Get(key []byte) []byte {</span>
<span class="term-fg31">-	res, err := t.TryGet(key)</span>
<span class="term-fg32">+&#47;&#47; MustGet is a wrapper of Get and will omit any encountered error but just</span>
<span class="term-fg32">+&#47;&#47; print out an error message.</span>
<span class="term-fg32">+func (t *Trie) MustGet(key []byte) []byte {</span>
<span class="term-fg32">+	res, err := t.Get(key)</span>
 	if err != nil {
 		log.Error(&quot;Unhandled trie error in Trie.Get&quot;, &quot;err&quot;, err)
 	}
 	return res
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGet returns the value for key stored in the trie.</span>
<span class="term-fg32">+&#47;&#47; Get returns the value for key stored in the trie.</span>
 &#47;&#47; The value bytes must not be modified by the caller.
<span class="term-fg31">-&#47;&#47; If a node was not found in the database, a MissingNodeError is returned.</span>
<span class="term-fg31">-func (t *Trie) TryGet(key []byte) ([]byte, error) {</span>
<span class="term-fg31">-	value, newroot, didResolve, err := t.tryGet(t.root, keybytesToHex(key), 0)</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; If the requested node is not present in trie, no error will be returned.</span>
<span class="term-fg32">+&#47;&#47; If the trie is corrupted, a MissingNodeError is returned.</span>
<span class="term-fg32">+func (t *Trie) Get(key []byte) ([]byte, error) {</span>
<span class="term-fg32">+	value, newroot, didResolve, err := t.get(t.root, keybytesToHex(key), 0)</span>
 	if err == nil &amp;&amp; didResolve {
 		t.root = newroot
 	}
 	return value, err
 }
&nbsp;
<span class="term-fg31">-func (t *Trie) tryGet(origNode node, key []byte, pos int) (value []byte, newnode node, didResolve bool, err error) {</span>
<span class="term-fg32">+func (t *Trie) get(origNode node, key []byte, pos int) (value []byte, newnode node, didResolve bool, err error) {</span>
 	switch n := (origNode).(type) {
 	case nil:
 		return nil, nil, false, nil
<span class="term-fg36">@@ -137,14 +139,14 @@</span> 		if len(key)-pos &lt; len(n.Key) || !bytes.Equal(n.Key, key[pos:pos+len(n.Key)]) {
 			&#47;&#47; key not found in trie
 			return nil, n, false, nil
 		}
<span class="term-fg31">-		value, newnode, didResolve, err = t.tryGet(n.Val, key, pos+len(n.Key))</span>
<span class="term-fg32">+		value, newnode, didResolve, err = t.get(n.Val, key, pos+len(n.Key))</span>
 		if err == nil &amp;&amp; didResolve {
 			n = n.copy()
 			n.Val = newnode
 		}
 		return value, n, didResolve, err
 	case *fullNode:
<span class="term-fg31">-		value, newnode, didResolve, err = t.tryGet(n.Children[key[pos]], key, pos+1)</span>
<span class="term-fg32">+		value, newnode, didResolve, err = t.get(n.Children[key[pos]], key, pos+1)</span>
 		if err == nil &amp;&amp; didResolve {
 			n = n.copy()
 			n.Children[key[pos]] = newnode
<span class="term-fg36">@@ -155,17 +157,30 @@</span> 		child, err := t.resolveAndTrack(n, key[:pos])
 		if err != nil {
 			return nil, n, true, err
 		}
<span class="term-fg31">-		value, newnode, _, err := t.tryGet(child, key, pos)</span>
<span class="term-fg32">+		value, newnode, _, err := t.get(child, key, pos)</span>
 		return value, newnode, true, err
 	default:
 		panic(fmt.Sprintf(&quot;%T: invalid node: %v&quot;, origNode, origNode))
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryGetNode attempts to retrieve a trie node by compact-encoded path. It is not</span>
<span class="term-fg31">-&#47;&#47; possible to use keybyte-encoding as the path might contain odd nibbles.</span>
<span class="term-fg31">-func (t *Trie) TryGetNode(path []byte) ([]byte, int, error) {</span>
<span class="term-fg31">-	item, newroot, resolved, err := t.tryGetNode(t.root, compactToHex(path), 0)</span>
<span class="term-fg32">+&#47;&#47; MustGetNode is a wrapper of GetNode and will omit any encountered error but</span>
<span class="term-fg32">+&#47;&#47; just print out an error message.</span>
<span class="term-fg32">+func (t *Trie) MustGetNode(path []byte) ([]byte, int) {</span>
<span class="term-fg32">+	item, resolved, err := t.GetNode(path)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Unhandled trie error in Trie.GetNode&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return item, resolved</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetNode retrieves a trie node by compact-encoded path. It is not possible</span>
<span class="term-fg32">+&#47;&#47; to use keybyte-encoding as the path might contain odd nibbles.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; If the requested node is not present in trie, no error will be returned.</span>
<span class="term-fg32">+&#47;&#47; If the trie is corrupted, a MissingNodeError is returned.</span>
<span class="term-fg32">+func (t *Trie) GetNode(path []byte) ([]byte, int, error) {</span>
<span class="term-fg32">+	item, newroot, resolved, err := t.getNode(t.root, compactToHex(path), 0)</span>
 	if err != nil {
 		return nil, resolved, err
 	}
<span class="term-fg36">@@ -175,10 +190,10 @@</span> 	}
 	if item == nil {
 		return nil, resolved, nil
 	}
<span class="term-fg31">-	return item, resolved, err</span>
<span class="term-fg32">+	return item, resolved, nil</span>
 }
&nbsp;
<span class="term-fg31">-func (t *Trie) tryGetNode(origNode node, path []byte, pos int) (item []byte, newnode node, resolved int, err error) {</span>
<span class="term-fg32">+func (t *Trie) getNode(origNode node, path []byte, pos int) (item []byte, newnode node, resolved int, err error) {</span>
 	&#47;&#47; If non-existent path requested, abort
 	if origNode == nil {
 		return nil, nil, 0, nil
<span class="term-fg36">@@ -211,7 +226,7 @@</span> 		if len(path)-pos &lt; len(n.Key) || !bytes.Equal(n.Key, path[pos:pos+len(n.Key)]) {
 			&#47;&#47; Path branches off from short node
 			return nil, n, 0, nil
 		}
<span class="term-fg31">-		item, newnode, resolved, err = t.tryGetNode(n.Val, path, pos+len(n.Key))</span>
<span class="term-fg32">+		item, newnode, resolved, err = t.getNode(n.Val, path, pos+len(n.Key))</span>
 		if err == nil &amp;&amp; resolved &gt; 0 {
 			n = n.copy()
 			n.Val = newnode
<span class="term-fg36">@@ -219,7 +234,7 @@</span> 		}
 		return item, n, resolved, err
&nbsp;
 	case *fullNode:
<span class="term-fg31">-		item, newnode, resolved, err = t.tryGetNode(n.Children[path[pos]], path, pos+1)</span>
<span class="term-fg32">+		item, newnode, resolved, err = t.getNode(n.Children[path[pos]], path, pos+1)</span>
 		if err == nil &amp;&amp; resolved &gt; 0 {
 			n = n.copy()
 			n.Children[path[pos]] = newnode
<span class="term-fg36">@@ -231,7 +246,7 @@</span> 		child, err := t.resolveAndTrack(n, path[:pos])
 		if err != nil {
 			return nil, n, 1, err
 		}
<span class="term-fg31">-		item, newnode, resolved, err := t.tryGetNode(child, path, pos)</span>
<span class="term-fg32">+		item, newnode, resolved, err := t.getNode(child, path, pos)</span>
 		return item, newnode, resolved + 1, err
&nbsp;
 	default:
<span class="term-fg36">@@ -239,33 +254,28 @@</span> 		panic(fmt.Sprintf(&quot;%T: invalid node: %v&quot;, origNode, origNode))
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Update associates key with value in the trie. Subsequent calls to</span>
<span class="term-fg31">-&#47;&#47; Get will return value. If value has length zero, any existing value</span>
<span class="term-fg31">-&#47;&#47; is deleted from the trie and calls to Get will return nil.</span>
<span class="term-fg31">-&#47;&#47;</span>
<span class="term-fg31">-&#47;&#47; The value bytes must not be modified by the caller while they are</span>
<span class="term-fg31">-&#47;&#47; stored in the trie.</span>
<span class="term-fg31">-func (t *Trie) Update(key, value []byte) {</span>
<span class="term-fg31">-	if err := t.TryUpdate(key, value); err != nil {</span>
<span class="term-fg32">+&#47;&#47; MustUpdate is a wrapper of Update and will omit any encountered error but</span>
<span class="term-fg32">+&#47;&#47; just print out an error message.</span>
<span class="term-fg32">+func (t *Trie) MustUpdate(key, value []byte) {</span>
<span class="term-fg32">+	if err := t.Update(key, value); err != nil {</span>
 		log.Error(&quot;Unhandled trie error in Trie.Update&quot;, &quot;err&quot;, err)
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryUpdate associates key with value in the trie. Subsequent calls to</span>
<span class="term-fg32">+&#47;&#47; Update associates key with value in the trie. Subsequent calls to</span>
 &#47;&#47; Get will return value. If value has length zero, any existing value
 &#47;&#47; is deleted from the trie and calls to Get will return nil.
 &#47;&#47;
 &#47;&#47; The value bytes must not be modified by the caller while they are
 &#47;&#47; stored in the trie.
 &#47;&#47;
<span class="term-fg31">-&#47;&#47; If a node was not found in the database, a MissingNodeError is returned.</span>
<span class="term-fg31">-func (t *Trie) TryUpdate(key, value []byte) error {</span>
<span class="term-fg31">-	return t.tryUpdate(key, value)</span>
<span class="term-fg32">+&#47;&#47; If the requested node is not present in trie, no error will be returned.</span>
<span class="term-fg32">+&#47;&#47; If the trie is corrupted, a MissingNodeError is returned.</span>
<span class="term-fg32">+func (t *Trie) Update(key, value []byte) error {</span>
<span class="term-fg32">+	return t.update(key, value)</span>
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; tryUpdate expects an RLP-encoded value and performs the core function</span>
<span class="term-fg31">-&#47;&#47; for TryUpdate and TryUpdateAccount.</span>
<span class="term-fg31">-func (t *Trie) tryUpdate(key, value []byte) error {</span>
<span class="term-fg32">+func (t *Trie) update(key, value []byte) error {</span>
 	t.unhashed++
 	k := keybytesToHex(key)
 	if len(value) != 0 {
<span class="term-fg36">@@ -363,16 +373,19 @@</span> 		panic(fmt.Sprintf(&quot;%T: invalid node: %v&quot;, n, n))
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Delete removes any existing value for key from the trie.</span>
<span class="term-fg31">-func (t *Trie) Delete(key []byte) {</span>
<span class="term-fg31">-	if err := t.TryDelete(key); err != nil {</span>
<span class="term-fg32">+&#47;&#47; MustDelete is a wrapper of Delete and will omit any encountered error but</span>
<span class="term-fg32">+&#47;&#47; just print out an error message.</span>
<span class="term-fg32">+func (t *Trie) MustDelete(key []byte) {</span>
<span class="term-fg32">+	if err := t.Delete(key); err != nil {</span>
 		log.Error(&quot;Unhandled trie error in Trie.Delete&quot;, &quot;err&quot;, err)
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; TryDelete removes any existing value for key from the trie.</span>
<span class="term-fg31">-&#47;&#47; If a node was not found in the database, a MissingNodeError is returned.</span>
<span class="term-fg31">-func (t *Trie) TryDelete(key []byte) error {</span>
<span class="term-fg32">+&#47;&#47; Delete removes any existing value for key from the trie.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; If the requested node is not present in trie, no error will be returned.</span>
<span class="term-fg32">+&#47;&#47; If the trie is corrupted, a MissingNodeError is returned.</span>
<span class="term-fg32">+func (t *Trie) Delete(key []byte) error {</span>
 	t.unhashed++
 	k := keybytesToHex(key)
 	_, n, err := t.delete(t.root, nil, k)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c1049d844fbfd651e9386eca" role="button"
                   aria-expanded="false" aria-controls="id-c1049d844fbfd651e9386eca">
                    <code>trie/trie_test.go</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/trie/trie_test.go" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/trie/trie_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+41</span></div>
                        <div class="text-start"><span class="text-danger">-41</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c1049d844fbfd651e9386eca"><span class="term-fg1">diff --git go-ethereum&#47;trie&#47;trie_test.go op-geth&#47;trie&#47;trie_test.go</span>
<span class="term-fg1">index 089bb44a974190a77ec374895c478be474ee71aa..82ead8b441271ad5c3e69f38322daa1c276cc29c 100644</span>
<span class="term-fg1">--- go-ethereum&#47;trie&#47;trie_test.go</span>
<span class="term-fg1">+++ op-geth&#47;trie&#47;trie_test.go</span>
<span class="term-fg36">@@ -56,8 +56,8 @@</span> func TestNull(t *testing.T) {
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	key := make([]byte, 32)
 	value := []byte(&quot;test&quot;)
<span class="term-fg31">-	trie.Update(key, value)</span>
<span class="term-fg31">-	if !bytes.Equal(trie.Get(key), value) {</span>
<span class="term-fg32">+	trie.MustUpdate(key, value)</span>
<span class="term-fg32">+	if !bytes.Equal(trie.MustGet(key), value) {</span>
 		t.Fatal(&quot;wrong value&quot;)
 	}
 }
<span class="term-fg36">@@ -90,27 +90,27 @@</span> 		triedb.Commit(root, false)
 	}
&nbsp;
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err := trie.TryGet([]byte(&quot;120000&quot;))</span>
<span class="term-fg32">+	_, err := trie.Get([]byte(&quot;120000&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err = trie.TryGet([]byte(&quot;120099&quot;))</span>
<span class="term-fg32">+	_, err = trie.Get([]byte(&quot;120099&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err = trie.TryGet([]byte(&quot;123456&quot;))</span>
<span class="term-fg32">+	_, err = trie.Get([]byte(&quot;123456&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	err = trie.TryUpdate([]byte(&quot;120099&quot;), []byte(&quot;zxcvzxcvzxcvzxcvzxcvzxcvzxcvzxcv&quot;))</span>
<span class="term-fg32">+	err = trie.Update([]byte(&quot;120099&quot;), []byte(&quot;zxcvzxcvzxcvzxcvzxcvzxcvzxcvzxcv&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	err = trie.TryDelete([]byte(&quot;123456&quot;))</span>
<span class="term-fg32">+	err = trie.Delete([]byte(&quot;123456&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
<span class="term-fg36">@@ -123,27 +123,27 @@</span> 		diskdb.Delete(hash[:])
 	}
&nbsp;
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err = trie.TryGet([]byte(&quot;120000&quot;))</span>
<span class="term-fg32">+	_, err = trie.Get([]byte(&quot;120000&quot;))</span>
 	if _, ok := err.(*MissingNodeError); !ok {
 		t.Errorf(&quot;Wrong error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err = trie.TryGet([]byte(&quot;120099&quot;))</span>
<span class="term-fg32">+	_, err = trie.Get([]byte(&quot;120099&quot;))</span>
 	if _, ok := err.(*MissingNodeError); !ok {
 		t.Errorf(&quot;Wrong error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	_, err = trie.TryGet([]byte(&quot;123456&quot;))</span>
<span class="term-fg32">+	_, err = trie.Get([]byte(&quot;123456&quot;))</span>
 	if err != nil {
 		t.Errorf(&quot;Unexpected error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	err = trie.TryUpdate([]byte(&quot;120099&quot;), []byte(&quot;zxcv&quot;))</span>
<span class="term-fg32">+	err = trie.Update([]byte(&quot;120099&quot;), []byte(&quot;zxcv&quot;))</span>
 	if _, ok := err.(*MissingNodeError); !ok {
 		t.Errorf(&quot;Wrong error: %v&quot;, err)
 	}
 	trie, _ = New(TrieID(root), triedb)
<span class="term-fg31">-	err = trie.TryDelete([]byte(&quot;123456&quot;))</span>
<span class="term-fg32">+	err = trie.Delete([]byte(&quot;123456&quot;))</span>
 	if _, ok := err.(*MissingNodeError); !ok {
 		t.Errorf(&quot;Wrong error: %v&quot;, err)
 	}
<span class="term-fg36">@@ -311,8 +311,8 @@</span> }
&nbsp;
 func TestLargeValue(t *testing.T) {
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
<span class="term-fg31">-	trie.Update([]byte(&quot;key1&quot;), []byte{99, 99, 99, 99})</span>
<span class="term-fg31">-	trie.Update([]byte(&quot;key2&quot;), bytes.Repeat([]byte{1}, 32))</span>
<span class="term-fg32">+	trie.MustUpdate([]byte(&quot;key1&quot;), []byte{99, 99, 99, 99})</span>
<span class="term-fg32">+	trie.MustUpdate([]byte(&quot;key2&quot;), bytes.Repeat([]byte{1}, 32))</span>
 	trie.Hash()
 }
&nbsp;
<span class="term-fg36">@@ -460,13 +460,13 @@</span> 		&#47;&#47; 	step.op, step.key, step.value, i)
&nbsp;
 		switch step.op {
 		case opUpdate:
<span class="term-fg31">-			tr.Update(step.key, step.value)</span>
<span class="term-fg32">+			tr.MustUpdate(step.key, step.value)</span>
 			values[string(step.key)] = string(step.value)
 		case opDelete:
<span class="term-fg31">-			tr.Delete(step.key)</span>
<span class="term-fg32">+			tr.MustDelete(step.key)</span>
 			delete(values, string(step.key))
 		case opGet:
<span class="term-fg31">-			v := tr.Get(step.key)</span>
<span class="term-fg32">+			v := tr.MustGet(step.key)</span>
 			want := values[string(step.key)]
 			if string(v) != want {
 				rt[i].err = fmt.Errorf(&quot;mismatch for key %#x, got %#x want %#x&quot;, step.key, v, want)
<span class="term-fg36">@@ -509,7 +509,7 @@</span> 		case opItercheckhash:
 			checktr := NewEmpty(triedb)
 			it := NewIterator(tr.NodeIterator(nil))
 			for it.Next() {
<span class="term-fg31">-				checktr.Update(it.Key, it.Value)</span>
<span class="term-fg32">+				checktr.MustUpdate(it.Key, it.Value)</span>
 			}
 			if tr.Hash() != checktr.Hash() {
 				rt[i].err = fmt.Errorf(&quot;hash mismatch in opItercheckhash&quot;)
<span class="term-fg36">@@ -595,13 +595,13 @@</span> 	trie := NewEmpty(triedb)
 	k := make([]byte, 32)
 	for i := 0; i &lt; benchElemCount; i++ {
 		binary.LittleEndian.PutUint64(k, uint64(i))
<span class="term-fg31">-		trie.Update(k, k)</span>
<span class="term-fg32">+		trie.MustUpdate(k, k)</span>
 	}
 	binary.LittleEndian.PutUint64(k, benchElemCount&#47;2)
&nbsp;
 	b.ResetTimer()
 	for i := 0; i &lt; b.N; i++ {
<span class="term-fg31">-		trie.Get(k)</span>
<span class="term-fg32">+		trie.MustGet(k)</span>
 	}
 	b.StopTimer()
 }
<span class="term-fg36">@@ -612,7 +612,7 @@</span> 	k := make([]byte, 32)
 	b.ReportAllocs()
 	for i := 0; i &lt; b.N; i++ {
 		e.PutUint64(k, uint64(i))
<span class="term-fg31">-		trie.Update(k, k)</span>
<span class="term-fg32">+		trie.MustUpdate(k, k)</span>
 	}
 	return trie
 }
<span class="term-fg36">@@ -640,11 +640,11 @@</span> 	&#47;&#47; Insert the accounts into the trie and hash it
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	i := 0
 	for ; i &lt; len(addresses)&#47;2; i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	trie.Hash()
 	for ; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	b.ResetTimer()
 	b.ReportAllocs()
<span class="term-fg36">@@ -670,7 +670,7 @@</span> 	&#47;&#47; Make the random benchmark deterministic
 	addresses, accounts := makeAccounts(b.N)
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for i := 0; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	&#47;&#47; Insert the accounts into the trie and hash it
 	trie.Hash()
<span class="term-fg36">@@ -683,22 +683,22 @@</span> func TestTinyTrie(t *testing.T) {
 	&#47;&#47; Create a realistic account trie to hash
 	_, accounts := makeAccounts(5)
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
<span class="term-fg31">-	trie.Update(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001337&quot;), accounts[3])</span>
<span class="term-fg32">+	trie.MustUpdate(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001337&quot;), accounts[3])</span>
 	if exp, root := common.HexToHash(&quot;8c6a85a4d9fda98feff88450299e574e5378e32391f75a055d470ac0653f1005&quot;), trie.Hash(); exp != root {
 		t.Errorf(&quot;1: got %x, exp %x&quot;, root, exp)
 	}
<span class="term-fg31">-	trie.Update(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001338&quot;), accounts[4])</span>
<span class="term-fg32">+	trie.MustUpdate(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001338&quot;), accounts[4])</span>
 	if exp, root := common.HexToHash(&quot;ec63b967e98a5720e7f720482151963982890d82c9093c0d486b7eb8883a66b1&quot;), trie.Hash(); exp != root {
 		t.Errorf(&quot;2: got %x, exp %x&quot;, root, exp)
 	}
<span class="term-fg31">-	trie.Update(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001339&quot;), accounts[4])</span>
<span class="term-fg32">+	trie.MustUpdate(common.Hex2Bytes(&quot;0000000000000000000000000000000000000000000000000000000000001339&quot;), accounts[4])</span>
 	if exp, root := common.HexToHash(&quot;0608c1d1dc3905fa22204c7a0e43644831c3b6d3def0f274be623a948197e64a&quot;), trie.Hash(); exp != root {
 		t.Errorf(&quot;3: got %x, exp %x&quot;, root, exp)
 	}
 	checktr := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	it := NewIterator(trie.NodeIterator(nil))
 	for it.Next() {
<span class="term-fg31">-		checktr.Update(it.Key, it.Value)</span>
<span class="term-fg32">+		checktr.MustUpdate(it.Key, it.Value)</span>
 	}
 	if troot, itroot := trie.Hash(), checktr.Hash(); troot != itroot {
 		t.Fatalf(&quot;hash mismatch in opItercheckhash, trie: %x, check: %x&quot;, troot, itroot)
<span class="term-fg36">@@ -710,7 +710,7 @@</span> 	&#47;&#47; Create a realistic account trie to hash
 	addresses, accounts := makeAccounts(1000)
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for i := 0; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	&#47;&#47; Insert the accounts into the trie and hash it
 	trie.Hash()
<span class="term-fg36">@@ -820,7 +820,7 @@</span> 		db := NewDatabase(rawdb.NewDatabase(s))
 		trie := NewEmpty(db)
 		&#47;&#47; Fill the trie with elements
 		for i := 0; i &lt; tc.count; i++ {
<span class="term-fg31">-			trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+			trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 		}
 		&#47;&#47; Flush trie -&gt; database
 		root, nodes := trie.Commit(false)
<span class="term-fg36">@@ -861,7 +861,7 @@</span> 				val = make([]byte, 1+prng.Intn(4096))
 			}
 			prng.Read(key)
 			prng.Read(val)
<span class="term-fg31">-			trie.Update(key, val)</span>
<span class="term-fg32">+			trie.MustUpdate(key, val)</span>
 		}
 		&#47;&#47; Flush trie -&gt; database
 		root, nodes := trie.Commit(false)
<span class="term-fg36">@@ -899,8 +899,8 @@</span> 			} else {
 				val = make([]byte, 1+prng.Intn(1024))
 			}
 			prng.Read(val)
<span class="term-fg31">-			trie.TryUpdate(key, val)</span>
<span class="term-fg31">-			stTrie.TryUpdate(key, val)</span>
<span class="term-fg32">+			trie.Update(key, val)</span>
<span class="term-fg32">+			stTrie.Update(key, val)</span>
 		}
 		&#47;&#47; Flush trie -&gt; database
 		root, nodes := trie.Commit(false)
<span class="term-fg36">@@ -948,8 +948,8 @@</span> 	})
 	&#47;&#47; Add a single small-element to the trie(s)
 	key := make([]byte, 5)
 	key[0] = 1
<span class="term-fg31">-	trie.TryUpdate(key, []byte{0x1})</span>
<span class="term-fg31">-	stTrie.TryUpdate(key, []byte{0x1})</span>
<span class="term-fg32">+	trie.Update(key, []byte{0x1})</span>
<span class="term-fg32">+	stTrie.Update(key, []byte{0x1})</span>
 	&#47;&#47; Flush trie -&gt; database
 	root, nodes := trie.Commit(false)
 	&#47;&#47; Flush memdb -&gt; disk (sponge)
<span class="term-fg36">@@ -1017,7 +1017,7 @@</span> func benchmarkHashFixedSize(b *testing.B, addresses [][20]byte, accounts [][]byte) {
 	b.ReportAllocs()
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for i := 0; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	&#47;&#47; Insert the accounts into the trie and hash it
 	b.StartTimer()
<span class="term-fg36">@@ -1068,7 +1068,7 @@</span> func benchmarkCommitAfterHashFixedSize(b *testing.B, addresses [][20]byte, accounts [][]byte) {
 	b.ReportAllocs()
 	trie := NewEmpty(NewDatabase(rawdb.NewMemoryDatabase()))
 	for i := 0; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	&#47;&#47; Insert the accounts into the trie and hash it
 	trie.Hash()
<span class="term-fg36">@@ -1121,7 +1121,7 @@</span> 	b.ReportAllocs()
 	triedb := NewDatabase(rawdb.NewMemoryDatabase())
 	trie := NewEmpty(triedb)
 	for i := 0; i &lt; len(addresses); i++ {
<span class="term-fg31">-		trie.Update(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
<span class="term-fg32">+		trie.MustUpdate(crypto.Keccak256(addresses[i][:]), accounts[i])</span>
 	}
 	h := trie.Hash()
 	_, nodes := trie.Commit(false)
<span class="term-fg36">@@ -1132,15 +1132,15 @@</span> 	b.StopTimer()
 }
&nbsp;
 func getString(trie *Trie, k string) []byte {
<span class="term-fg31">-	return trie.Get([]byte(k))</span>
<span class="term-fg32">+	return trie.MustGet([]byte(k))</span>
 }
&nbsp;
 func updateString(trie *Trie, k, v string) {
<span class="term-fg31">-	trie.Update([]byte(k), []byte(v))</span>
<span class="term-fg32">+	trie.MustUpdate([]byte(k), []byte(v))</span>
 }
&nbsp;
 func deleteString(trie *Trie, k string) {
<span class="term-fg31">-	trie.Delete([]byte(k))</span>
<span class="term-fg32">+	trie.MustDelete([]byte(k))</span>
 }
&nbsp;
 func TestDecodeNode(t *testing.T) {</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
                    <div class="text-muted">
                        <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-25ec0831419fa251e655c0aa"role="button" aria-expanded="false" aria-controls="id-25ec0831419fa251e655c0aa">
        
            <div class="col-12 col-sm-9 text-start"><h4>Ignored changes</h4></div>
        
        <div class="col-12 col-sm-3 ms-auto mt-2">
            <div class="row line-stat">
                <div class="text-end"><span class="text-success">+530</span></div>
                <div class="text-start"><span class="text-danger">-262</span></div>
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-25ec0831419fa251e655c0aa">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cf0e2bc88189611811e7cb8b" role="button"
                   aria-expanded="false" aria-controls="id-cf0e2bc88189611811e7cb8b">
                    <code>.circleci/check-releases.sh</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.circleci/check-releases.sh" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+21</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cf0e2bc88189611811e7cb8b"><span class="term-fg1">diff --git go-ethereum&#47;.circleci&#47;check-releases.sh op-geth&#47;.circleci&#47;check-releases.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f3595e1320377bea4b17c13326d87342083071c0</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;.circleci&#47;check-releases.sh</span>
<span class="term-fg36">@@ -0,0 +1,21 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+set -euo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+LATEST_RELEASE=$(curl -s --fail -L \</span>
<span class="term-fg32">+  -H &quot;Accept: application&#47;vnd.github+json&quot; \</span>
<span class="term-fg32">+  -H &quot;X-GitHub-Api-Version: 2022-11-28&quot; \</span>
<span class="term-fg32">+  https:&#47;&#47;api.github.com&#47;repos&#47;ethereum&#47;go-ethereum&#47;releases \</span>
<span class="term-fg32">+  | jq -r &#39;(.[] | select(.draft==false) | select(.prerelease==false)).tag_name&#39; | head -n 1)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+echo &quot;Detected latest go-ethereum release as ${LATEST_RELEASE}&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+git remote add upstream https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum</span>
<span class="term-fg32">+git fetch upstream &gt; &#47;dev&#47;null</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+if git branch --contains &quot;${LATEST_RELEASE}&quot; 2&gt;&amp;1 | grep -e &#39;^[ *]*optimism$&#39; &gt; &#47;dev&#47;null</span>
<span class="term-fg32">+then</span>
<span class="term-fg32">+  echo &quot;Up to date with latest release.  Great job! 🎉&quot;</span>
<span class="term-fg32">+else</span>
<span class="term-fg32">+  echo &quot;Release has not been merged&quot;</span>
<span class="term-fg32">+  exit 1</span>
<span class="term-fg32">+fi</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81015888fd06158d01696f26" role="button"
                   aria-expanded="false" aria-controls="id-81015888fd06158d01696f26">
                    <code>.circleci/ci-docker-tag-op-geth-release.sh</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.circleci/ci-docker-tag-op-geth-release.sh" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+38</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81015888fd06158d01696f26"><span class="term-fg1">diff --git go-ethereum&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh op-geth&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7b66e789a4d7e50699f2d22ff037117c0d7a3a35</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh</span>
<span class="term-fg36">@@ -0,0 +1,38 @@</span>
<span class="term-fg32">+#!&#47;usr&#47;bin&#47;env bash</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+set -euo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+DOCKER_REPO=$1</span>
<span class="term-fg32">+GIT_TAG=$2</span>
<span class="term-fg32">+GIT_SHA=$3</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+IMAGE_NAME=&quot;op-geth&quot;</span>
<span class="term-fg32">+IMAGE_TAG=$GIT_TAG</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+SOURCE_IMAGE_TAG=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:$GIT_SHA&quot;</span>
<span class="term-fg32">+TARGET_IMAGE_TAG=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:$IMAGE_TAG&quot;</span>
<span class="term-fg32">+TARGET_IMAGE_TAG_LATEST=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:latest&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+echo &quot;Checking if docker images exist for &#39;$IMAGE_NAME&#39;&quot;</span>
<span class="term-fg32">+echo &quot;&quot;</span>
<span class="term-fg32">+tags=$(gcloud container images list-tags &quot;$DOCKER_REPO&#47;$IMAGE_NAME&quot; --limit 1 --format json)</span>
<span class="term-fg32">+if [ &quot;$tags&quot; = &quot;[]&quot; ]; then</span>
<span class="term-fg32">+  echo &quot;No existing docker images were found for &#39;$IMAGE_NAME&#39;. The code tagged with &#39;$GIT_TAG&#39; may not have an associated dockerfile or docker build job.&quot;</span>
<span class="term-fg32">+  echo &quot;If this service has a dockerfile, add a docker-publish job for it in the circleci config.&quot;</span>
<span class="term-fg32">+  echo &quot;&quot;</span>
<span class="term-fg32">+  echo &quot;Exiting&quot;</span>
<span class="term-fg32">+  exit 0</span>
<span class="term-fg32">+fi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+echo &quot;Tagging $SOURCE_IMAGE_TAG with &#39;$IMAGE_TAG&#39;&quot;</span>
<span class="term-fg32">+gcloud container images add-tag -q &quot;$SOURCE_IMAGE_TAG&quot; &quot;$TARGET_IMAGE_TAG&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Do not tag with latest if the release is a release candidate.</span>
<span class="term-fg32">+if [[ &quot;$IMAGE_TAG&quot; == *&quot;rc&quot;* ]]; then</span>
<span class="term-fg32">+  echo &quot;Not tagging with &#39;latest&#39; because the release is a release candidate.&quot;</span>
<span class="term-fg32">+  exit 0</span>
<span class="term-fg32">+fi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+echo &quot;Tagging $SOURCE_IMAGE_TAG with &#39;latest&#39;&quot;</span>
<span class="term-fg32">+gcloud container images add-tag -q &quot;$SOURCE_IMAGE_TAG&quot; &quot;$TARGET_IMAGE_TAG_LATEST&quot;</span>
<span class="term-fg32">+</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77bb04eca1be1dd47fa8fa91" role="button"
                   aria-expanded="false" aria-controls="id-77bb04eca1be1dd47fa8fa91">
                    <code>.circleci/config.yml</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.circleci/config.yml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+198</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77bb04eca1be1dd47fa8fa91"><span class="term-fg1">diff --git go-ethereum&#47;.circleci&#47;config.yml op-geth&#47;.circleci&#47;config.yml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0c9b7cda88004459f3635bc7e86704fc3df4f898</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;.circleci&#47;config.yml</span>
<span class="term-fg36">@@ -0,0 +1,198 @@</span>
<span class="term-fg32">+version: 2.1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+orbs:</span>
<span class="term-fg32">+  gcp-cli: circleci&#47;gcp-cli@3.0.1</span>
<span class="term-fg32">+  slack: circleci&#47;slack@4.10.1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+commands:</span>
<span class="term-fg32">+  gcp-oidc-authenticate:</span>
<span class="term-fg32">+    description: &quot;Authenticate with GCP using a CircleCI OIDC token.&quot;</span>
<span class="term-fg32">+    parameters:</span>
<span class="term-fg32">+      project_id:</span>
<span class="term-fg32">+        type: env_var_name</span>
<span class="term-fg32">+        default: GCP_PROJECT_ID</span>
<span class="term-fg32">+      workload_identity_pool_id:</span>
<span class="term-fg32">+        type: env_var_name</span>
<span class="term-fg32">+        default: GCP_WIP_ID</span>
<span class="term-fg32">+      workload_identity_pool_provider_id:</span>
<span class="term-fg32">+        type: env_var_name</span>
<span class="term-fg32">+        default: GCP_WIP_PROVIDER_ID</span>
<span class="term-fg32">+      service_account_email:</span>
<span class="term-fg32">+        type: env_var_name</span>
<span class="term-fg32">+        default: GCP_SERVICE_ACCOUNT_EMAIL</span>
<span class="term-fg32">+      gcp_cred_config_file_path:</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+        default: &#47;home&#47;circleci&#47;gcp_cred_config.json</span>
<span class="term-fg32">+      oidc_token_file_path:</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+        default: &#47;home&#47;circleci&#47;oidc_token.json</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          name: &quot;Create OIDC credential configuration&quot;</span>
<span class="term-fg32">+          command: |</span>
<span class="term-fg32">+            # Store OIDC token in temp file</span>
<span class="term-fg32">+            echo $CIRCLE_OIDC_TOKEN &gt; &lt;&lt; parameters.oidc_token_file_path &gt;&gt;</span>
<span class="term-fg32">+            # Create a credential configuration for the generated OIDC ID Token</span>
<span class="term-fg32">+            gcloud iam workload-identity-pools create-cred-config \</span>
<span class="term-fg32">+                &quot;projects&#47;${&lt;&lt; parameters.project_id &gt;&gt;}&#47;locations&#47;global&#47;workloadIdentityPools&#47;${&lt;&lt; parameters.workload_identity_pool_id &gt;&gt;}&#47;providers&#47;${&lt;&lt; parameters.workload_identity_pool_provider_id &gt;&gt;}&quot;\</span>
<span class="term-fg32">+                --output-file=&quot;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&quot; \</span>
<span class="term-fg32">+                --service-account=&quot;${&lt;&lt; parameters.service_account_email &gt;&gt;}&quot; \</span>
<span class="term-fg32">+                --credential-source-file=&lt;&lt; parameters.oidc_token_file_path &gt;&gt;</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          name: &quot;Authenticate with GCP using OIDC&quot;</span>
<span class="term-fg32">+          command: |</span>
<span class="term-fg32">+            # Configure gcloud to leverage the generated credential configuration</span>
<span class="term-fg32">+            gcloud auth login --brief --cred-file &quot;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&quot;</span>
<span class="term-fg32">+            # Configure ADC</span>
<span class="term-fg32">+            echo &quot;export GOOGLE_APPLICATION_CREDENTIALS=&#39;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&#39;&quot; | tee -a &quot;$BASH_ENV&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  docker-release:</span>
<span class="term-fg32">+    environment:</span>
<span class="term-fg32">+      DOCKER_BUILDKIT: 1</span>
<span class="term-fg32">+    parameters:</span>
<span class="term-fg32">+      docker_name:</span>
<span class="term-fg32">+        description: Docker image name</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+        default: &quot;op-geth&quot;</span>
<span class="term-fg32">+      docker_tags:</span>
<span class="term-fg32">+        description: Docker image tags as csv</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+      registry:</span>
<span class="term-fg32">+        description: Docker registry</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+        default: &quot;us-docker.pkg.dev&quot;</span>
<span class="term-fg32">+      repo:</span>
<span class="term-fg32">+        description: Docker repo</span>
<span class="term-fg32">+        type: string</span>
<span class="term-fg32">+        default: &quot;oplabs-tools-artifacts&#47;images&quot;</span>
<span class="term-fg32">+      push_tags:</span>
<span class="term-fg32">+        description: Push release push tags</span>
<span class="term-fg32">+        type: boolean</span>
<span class="term-fg32">+        default: false</span>
<span class="term-fg32">+    machine:</span>
<span class="term-fg32">+      image: ubuntu-2204:2022.07.1</span>
<span class="term-fg32">+      resource_class: xlarge</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - gcp-cli&#47;install</span>
<span class="term-fg32">+      - gcp-oidc-authenticate</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          name: Configure Docker</span>
<span class="term-fg32">+          command: |</span>
<span class="term-fg32">+            gcloud auth configure-docker &lt;&lt;parameters.registry&gt;&gt;</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          name: Build and push</span>
<span class="term-fg32">+          command: |</span>
<span class="term-fg32">+            RAW_TAGS=&quot;&lt;&lt;parameters.docker_tags&gt;&gt;&quot;</span>
<span class="term-fg32">+            if [ &quot;$CIRCLE_BRANCH&quot; = &quot;optimism&quot; ]; then</span>
<span class="term-fg32">+              RAW_TAGS=&quot;$RAW_TAGS,optimism&quot;</span>
<span class="term-fg32">+            fi</span>
<span class="term-fg32">+            IMAGE_BASE=&quot;&lt;&lt;parameters.registry&gt;&gt;&#47;&lt;&lt;parameters.repo&gt;&gt;&#47;&lt;&lt;parameters.docker_name&gt;&gt;&quot;</span>
<span class="term-fg32">+            DOCKER_TAGS=$(echo -ne &quot;$RAW_TAGS&quot; | sed &quot;s&#47;,&#47;\n&#47;g&quot; | sed &quot;s&#47;[^a-zA-Z0-9\n.]&#47;-&#47;g&quot; | sed -e &quot;s|^|-t ${IMAGE_BASE}:|&quot;)</span>
<span class="term-fg32">+            docker context create buildx-build</span>
<span class="term-fg32">+            docker buildx create --use buildx-build</span>
<span class="term-fg32">+            docker buildx build --push \</span>
<span class="term-fg32">+              $(echo -ne $DOCKER_TAGS | tr &#39;\n&#39; &#39; &#39;) \</span>
<span class="term-fg32">+              --platform=linux&#47;arm64,linux&#47;amd64 \</span>
<span class="term-fg32">+              --build-arg VERSION=$CIRCLE_TAG \</span>
<span class="term-fg32">+              --build-arg COMMIT=$CIRCLE_SHA \</span>
<span class="term-fg32">+              --build-arg BUILDNUM=$CIRCLE_BUILD_NUM \</span>
<span class="term-fg32">+              --progress plain \</span>
<span class="term-fg32">+              -f Dockerfile .</span>
<span class="term-fg32">+      - when:</span>
<span class="term-fg32">+          condition:</span>
<span class="term-fg32">+            equal: [ true, &lt;&lt;parameters.push_tags&gt;&gt; ]</span>
<span class="term-fg32">+          steps:</span>
<span class="term-fg32">+            - run:</span>
<span class="term-fg32">+                name: Tag</span>
<span class="term-fg32">+                command: |</span>
<span class="term-fg32">+                  .&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh &lt;&lt;parameters.registry&gt;&gt;&#47;&lt;&lt;parameters.repo&gt;&gt; $CIRCLE_TAG $CIRCLE_SHA1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+  build-geth:</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.19</span>
<span class="term-fg32">+    resource_class: xlarge</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go install</span>
<span class="term-fg32">+  unit-test:</span>
<span class="term-fg32">+    resource_class: xlarge</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.19</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go test</span>
<span class="term-fg32">+  lint-geth:</span>
<span class="term-fg32">+    resource_class: medium</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.19</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: go run build&#47;ci.go lint</span>
<span class="term-fg32">+  check-releases:</span>
<span class="term-fg32">+    docker:</span>
<span class="term-fg32">+      - image: cimg&#47;go:1.19</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - checkout</span>
<span class="term-fg32">+      - run:</span>
<span class="term-fg32">+          command: .circleci&#47;check-releases.sh</span>
<span class="term-fg32">+      - slack&#47;notify:</span>
<span class="term-fg32">+          channel: C03N11M0BBN</span>
<span class="term-fg32">+          branch_pattern: optimism</span>
<span class="term-fg32">+          event: fail</span>
<span class="term-fg32">+          template: basic_fail_1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+workflows:</span>
<span class="term-fg32">+  main:</span>
<span class="term-fg32">+    jobs:</span>
<span class="term-fg32">+      - build-geth:</span>
<span class="term-fg32">+          name: Build geth</span>
<span class="term-fg32">+      - unit-test:</span>
<span class="term-fg32">+          name: Run unit tests for geth</span>
<span class="term-fg32">+      - lint-geth:</span>
<span class="term-fg32">+          name: Run linter over geth</span>
<span class="term-fg32">+      - docker-release:</span>
<span class="term-fg32">+          name: Push to Docker</span>
<span class="term-fg32">+          docker_tags: &lt;&lt;pipeline.git.revision&gt;&gt;</span>
<span class="term-fg32">+          context:</span>
<span class="term-fg32">+            - oplabs-gcr</span>
<span class="term-fg32">+  release:</span>
<span class="term-fg32">+    jobs:</span>
<span class="term-fg32">+      - hold:</span>
<span class="term-fg32">+          type: approval</span>
<span class="term-fg32">+          filters:</span>
<span class="term-fg32">+            tags:</span>
<span class="term-fg32">+              only: &#47;^v.*&#47;</span>
<span class="term-fg32">+            branches:</span>
<span class="term-fg32">+              ignore: &#47;.*&#47;</span>
<span class="term-fg32">+      - docker-release:</span>
<span class="term-fg32">+          name: Push to Docker (release)</span>
<span class="term-fg32">+          filters:</span>
<span class="term-fg32">+            tags:</span>
<span class="term-fg32">+              only: &#47;^v.*&#47;</span>
<span class="term-fg32">+            branches:</span>
<span class="term-fg32">+              ignore: &#47;.*&#47;</span>
<span class="term-fg32">+          docker_tags: &lt;&lt;pipeline.git.revision&gt;&gt;,&lt;&lt;pipeline.git.tag&gt;&gt;</span>
<span class="term-fg32">+          push_tags: true</span>
<span class="term-fg32">+          context:</span>
<span class="term-fg32">+            - oplabs-gcr-release</span>
<span class="term-fg32">+          requires:</span>
<span class="term-fg32">+            - hold</span>
<span class="term-fg32">+  scheduled:</span>
<span class="term-fg32">+    triggers:</span>
<span class="term-fg32">+      - schedule:</span>
<span class="term-fg32">+          # run daily</span>
<span class="term-fg32">+          cron: &quot;0 0 * * *&quot;</span>
<span class="term-fg32">+          filters:</span>
<span class="term-fg32">+            branches:</span>
<span class="term-fg32">+              only: [ &quot;optimism&quot; ]</span>
<span class="term-fg32">+    jobs:</span>
<span class="term-fg32">+      - check-releases:</span>
<span class="term-fg32">+          name: Check for new upstream releases</span>
<span class="term-fg32">+          context: slack</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-aabcdd44047d7ad3311326c5" role="button"
                   aria-expanded="false" aria-controls="id-aabcdd44047d7ad3311326c5">
                    <code>.github/workflows/pages.yaml</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/.github/workflows/pages.yaml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+36</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-aabcdd44047d7ad3311326c5"><span class="term-fg1">diff --git go-ethereum&#47;.github&#47;workflows&#47;pages.yaml op-geth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6973b227ce779be6138ee2084e71bb5a5cdd57de</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -0,0 +1,36 @@</span>
<span class="term-fg32">+name: Build and publish forkdiff github-pages</span>
<span class="term-fg32">+permissions:</span>
<span class="term-fg32">+  contents: write</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - optimism</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  deploy:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: Checkout</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v3</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build forkdiff</span>
<span class="term-fg32">+        uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:latest&quot;</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          args: -repo=&#47;github&#47;workspace -fork=&#47;github&#47;workspace&#47;fork.yaml -out=&#47;github&#47;workspace&#47;index.html</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build pages</span>
<span class="term-fg32">+        run: |</span>
<span class="term-fg32">+          mkdir -p tmp&#47;pages</span>
<span class="term-fg32">+          mv index.html tmp&#47;pages&#47;index.html</span>
<span class="term-fg32">+          touch tmp&#47;pages&#47;.nojekyll</span>
<span class="term-fg32">+          if [ &quot;$GITHUB_REPOSITORY&quot; == &quot;ethereum-optimism&#47;op-geth&quot; ]; then</span>
<span class="term-fg32">+              echo &quot;op-geth.optimism.io&quot; &gt; tmp&#47;pages&#47;CNAME</span>
<span class="term-fg32">+          fi;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Deploy</span>
<span class="term-fg32">+        uses: JamesIves&#47;github-pages-deploy-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          folder: tmp&#47;pages</span>
<span class="term-fg32">+          clean: true</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-815e66f7724257ffcba49a1b" role="button"
                   aria-expanded="false" aria-controls="id-815e66f7724257ffcba49a1b">
                    <code>fork.yaml</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/fork.yaml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+203</span></div>
                        <div class="text-start"><span class="text-danger">-0</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-815e66f7724257ffcba49a1b"><span class="term-fg1">diff --git go-ethereum&#47;fork.yaml op-geth&#47;fork.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0e3aa6b9cf5cb6a7645a3847f42034815a87b42c</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ op-geth&#47;fork.yaml</span>
<span class="term-fg36">@@ -0,0 +1,203 @@</span>
<span class="term-fg32">+title: &quot;op-geth - go-ethereum fork diff overview&quot;</span>
<span class="term-fg32">+footer: |</span>
<span class="term-fg32">+  Fork-diff overview of [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth), a fork of [`go-ethereum`](https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum).</span>
<span class="term-fg32">+  and execution-engine of the [OP-stack](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism).</span>
<span class="term-fg32">+base:</span>
<span class="term-fg32">+  name: go-ethereum</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum</span>
<span class="term-fg32">+  hash: a38f4108571d1a144dc3cf3faf8990430d109bc4</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: op-geth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth</span>
<span class="term-fg32">+  ref: refs&#47;heads&#47;optimism</span>
<span class="term-fg32">+def:</span>
<span class="term-fg32">+  title: &quot;op-geth&quot;</span>
<span class="term-fg32">+  description: |</span>
<span class="term-fg32">+    This is an overview of the changes in [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth),</span>
<span class="term-fg32">+    a fork of [`go-ethereum`](https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum), part of the OP-stack.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    The OP-stack architecture is modular, following the Consensus&#47;Execution split of post-Merge Ethereum L1:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - [`op-node`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;tree&#47;develop&#47;op-node) implements most rollup-specific functionality as Consensus-Layer, similar to a L1 beacon-node. </span>
<span class="term-fg32">+      - [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth) implements the Execution-Layer, with **minimal changes** for a secure Ethereum-equivalent application environment.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    Related [op-stack specifications](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;tree&#47;develop&#47;specs):</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    - [L2 Execution Engine spec](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;exec-engine.md)</span>
<span class="term-fg32">+    - [Deposit Transaction spec](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;deposits.md)</span>
<span class="term-fg32">+  sub:</span>
<span class="term-fg32">+    - title: &quot;Core modifications&quot;</span>
<span class="term-fg32">+      sub:</span>
<span class="term-fg32">+        - title: &quot;State-transition modifications&quot;</span>
<span class="term-fg32">+          description: &quot;&quot;</span>
<span class="term-fg32">+          sub:</span>
<span class="term-fg32">+            - title: &quot;Deposit Transaction type&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                The Bedrock upgrade introduces a `Deposit` transaction-type (`0x7E`) to enable both users and the</span>
<span class="term-fg32">+                rollup system itself to change the L2 state based on L1 events and system rules as</span>
<span class="term-fg32">+                [specified](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;deposits.md).</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;deposit_tx.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;transaction_marshalling.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;transaction_signing.go&quot;</span>
<span class="term-fg32">+            - title: &quot;Transaction properties&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                The `Transaction` type now exposes the deposit-transaction and L1-cost properties required for the rollup.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;transaction.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;tx_access_list.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;tx_dynamic_fee.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;tx_legacy.go&quot;</span>
<span class="term-fg32">+            - title: &quot;L1 cost computation&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                Transactions must pay an additional L1 cost based on the amount of rollup-data-gas they consume,</span>
<span class="term-fg32">+                estimated based on gas-price-oracle information and encoded tx size.&quot;</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;core&#47;vm&#47;evm.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;types&#47;rollup_l1_cost.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;state_processor.go&quot;</span>
<span class="term-fg32">+                - &quot;core&#47;state_prefetcher.go&quot;</span>
<span class="term-fg32">+            - title: Transaction processing</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                Deposit transactions have special processing rules: gas is pre-paid on L1,</span>
<span class="term-fg32">+                and deposits with EVM-failure are included with rolled back changes (except mint).</span>
<span class="term-fg32">+                For regular transactions, at the end of the transition, the 1559 burn and L1 cost are routed to vaults.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;core&#47;state_transition.go&quot;</span>
<span class="term-fg32">+            - title: &quot;Gaslimit&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                The gaslimit is free to be set by the Engine API caller, instead of enforcing adjustments of the</span>
<span class="term-fg32">+                gaslimit in increments of 1&#47;1024 of the previous gaslimit.</span>
<span class="term-fg32">+                The gaslimit is changed (and limited) through the `SystemConfig` contract.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;consensus&#47;misc&#47;eip1559.go&quot;</span>
<span class="term-fg32">+            - title: &quot;Consensus tweaks&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                The Engine API is activated at the Merge transition, with a Total Terminal Difficulty (TTD).</span>
<span class="term-fg32">+                The rollup starts post-merge, and thus sets the TTD to 0.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;consensus&#47;beacon&#47;consensus.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Chain config&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            The rollup functionality is enabled with the `optimism` field in the chain config.</span>
<span class="term-fg32">+            The EIP-1559 parameters are configurable to adjust for faster more frequent and smaller blocks.</span>
<span class="term-fg32">+            The parameters can be overriden for testing.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;params&#47;config.go&quot;</span>
<span class="term-fg32">+            - &quot;params&#47;protocol_params.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;genesis.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Chain config cleanup&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            The optimism Goerli testnet used clique-config data to make geth internals accept blocks.</span>
<span class="term-fg32">+            Post-bedrock the beacon-consensus (i.e. follow Engine API) is now used, and the clique config is removed.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;core&#47;rawdb&#47;accessors_metadata.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Engine API modifications&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            The Engine API is extended to insert transactions into the block and optionally exclude the tx-pool,</span>
<span class="term-fg32">+            to reproduce the exact block of the sequencer from just the inputs, as derived from L1 by the rollup-node.</span>
<span class="term-fg32">+            See [L2 execution engine specs](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;exec-engine.md).</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;beacon&#47;engine&#47;types.go&quot;</span>
<span class="term-fg32">+            - &quot;beacon&#47;engine&#47;gen_blockparams.go&quot;</span>
<span class="term-fg32">+            - &quot;eth&#47;catalyst&#47;api.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Block-building modifications&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            The block-building code (in the &quot;miner&quot; package because of Proof-Of-Work legacy of ethereum) implements the</span>
<span class="term-fg32">+            changes to support the transaction-inclusion, tx-pool toggle and gaslimit parameters of the Engine API.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;miner&#47;*&quot;</span>
<span class="term-fg32">+        - title: &quot;Tx-pool tx cost updates&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            Transaction queueing and inclusion needs to account for the L1 cost component.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;core&#47;txpool&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;Node modifications&quot;</span>
<span class="term-fg32">+      description: Changes to the node configuration and services.</span>
<span class="term-fg32">+      sub:</span>
<span class="term-fg32">+        - title: &quot;CLI&quot;</span>
<span class="term-fg32">+          sub:</span>
<span class="term-fg32">+            - title: &quot;Flags&quot;</span>
<span class="term-fg32">+              description: |</span>
<span class="term-fg32">+                Flag changes:</span>
<span class="term-fg32">+                  - Transactions can be forwarded to an RPC for sequencing.</span>
<span class="term-fg32">+                  - Historical calls can be forwarded to a legacy node.</span>
<span class="term-fg32">+                  - The tx pool propagation can be enabled&#47;disabled.</span>
<span class="term-fg32">+                  - The Optimism bedrock fork activation can be changed for testing.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;cmd&#47;utils&#47;flags.go&quot;</span>
<span class="term-fg32">+                - &quot;cmd&#47;geth&#47;main.go&quot;</span>
<span class="term-fg32">+                - &quot;internal&#47;flags&#47;categories.go&quot;</span>
<span class="term-fg32">+                - &quot;cmd&#47;geth&#47;config.go&quot;</span>
<span class="term-fg32">+            - title: &quot;Versioning&quot;</span>
<span class="term-fg32">+              description: List the op-geth and upstream go-ethereum versions.</span>
<span class="term-fg32">+              globs:</span>
<span class="term-fg32">+                - &quot;cmd&#47;geth&#47;misccmd.go&quot;</span>
<span class="term-fg32">+                - &quot;params&#47;version.go&quot;</span>
<span class="term-fg32">+                - &quot;build&#47;ci.go&quot;</span>
<span class="term-fg32">+        - title: Node config</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;eth&#47;ethconfig&#47;config.go&quot;</span>
<span class="term-fg32">+        - title: Tx gossip disable option</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;eth&#47;handler.go&quot;</span>
<span class="term-fg32">+            - &quot;eth&#47;handler_eth.go&quot;</span>
<span class="term-fg32">+    - title: &quot;User API enhancements&quot;</span>
<span class="term-fg32">+      description: &quot;Encode the Deposit Tx properties, the L1 costs, and daisy-chain RPC-calls for pre-Bedrock historical data&quot;</span>
<span class="term-fg32">+      sub:</span>
<span class="term-fg32">+        - title: &quot;Receipts metadata&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            Pre-Bedrock L1-cost receipt data is loaded from the database if available, and post-Bedrock the L1-cost </span>
<span class="term-fg32">+            metadata is hydrated on-the-fly based on the L1 fee information in the corresponding block.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;receipt.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;gen_receipt_json.go&quot;</span>
<span class="term-fg32">+        - title: &quot;API Backend&quot;</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            Forward transactions to the sequencer if configured.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;eth&#47;api_backend.go&quot;</span>
<span class="term-fg32">+            - &quot;eth&#47;backend.go&quot;</span>
<span class="term-fg32">+            - &quot;internal&#47;ethapi&#47;backend.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Apply L1 cost in API responses&quot;</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;eth&#47;state_accessor.go&quot;</span>
<span class="term-fg32">+        - title: API frontend</span>
<span class="term-fg32">+          description: Format deposit and L1-cost data in transaction responses.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;internal&#47;ethapi&#47;api.go&quot;</span>
<span class="term-fg32">+            - &quot;rpc&#47;errors.go&quot;</span>
<span class="term-fg32">+        - title: Tracer RPC daisy-chain</span>
<span class="term-fg32">+          description: Forward pre-bedrock tracing calls to legacy node.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;eth&#47;tracers&#47;api.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Light Ethereum Subprotocol (LES) RPC&quot;</span>
<span class="term-fg32">+          description: Match the RPC changes in the LES RPC</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;les&#47;*&quot;</span>
<span class="term-fg32">+        - title: &quot;Daisy Chain tests&quot;</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;internal&#47;ethapi&#47;transaction_args_test.go&quot;</span>
<span class="term-fg32">+            - &quot;ethclient&#47;ethclient_test.go&quot;</span>
<span class="term-fg32">+            - &quot;eth&#47;tracers&#47;api_test.go&quot;</span>
<span class="term-fg32">+    - title: &quot;Geth extras&quot;</span>
<span class="term-fg32">+      description: Extend the tools available in geth to improve external testing and tooling.</span>
<span class="term-fg32">+      sub:</span>
<span class="term-fg32">+        - title: Simulated Backend</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go&quot;</span>
<span class="term-fg32">+        - title: diff-included testing testing</span>
<span class="term-fg32">+          description: |</span>
<span class="term-fg32">+            Most of the op-geth changes are tested in the Optimism Monorepo and not part of the geth diff,</span>
<span class="term-fg32">+            but some testing like the Deposit TX encoding and API interactions are embedded in the op-geth diff instead.</span>
<span class="term-fg32">+          globs:</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;transaction_marshalling_test.go&quot;</span>
<span class="term-fg32">+            - &quot;internal&#47;ethapi&#47;api_test.go&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# ignored globally, does not count towards line count</span>
<span class="term-fg32">+ignore:</span>
<span class="term-fg32">+  - &quot;.circleci&#47;*&quot;</span>
<span class="term-fg32">+  - &quot;*.sum&quot;</span>
<span class="term-fg32">+  - &quot;go.mod&quot;</span>
<span class="term-fg32">+  - &quot;fork.yaml&quot;</span>
<span class="term-fg32">+  - &quot;.github&#47;workflows&#47;*&quot;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9e7286cc2b8ecf84338e6cbb" role="button"
                   aria-expanded="false" aria-controls="id-9e7286cc2b8ecf84338e6cbb">
                    <code>go.mod</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/go.mod" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/go.mod" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+11</span></div>
                        <div class="text-start"><span class="text-danger">-9</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9e7286cc2b8ecf84338e6cbb"><span class="term-fg1">diff --git go-ethereum&#47;go.mod op-geth&#47;go.mod</span>
<span class="term-fg1">index 21325d5669e1c70a835e1387672f8f083bfa701b..0bcd3a6c6a95b5cb18452426a07aa6cbb1fb25bb 100644</span>
<span class="term-fg1">--- go-ethereum&#47;go.mod</span>
<span class="term-fg1">+++ op-geth&#47;go.mod</span>
<span class="term-fg36">@@ -29,17 +29,17 @@</span> 	github.com&#47;go-stack&#47;stack v1.8.1
 	github.com&#47;gofrs&#47;flock v0.8.1
 	github.com&#47;golang-jwt&#47;jwt&#47;v4 v4.3.0
 	github.com&#47;golang&#47;protobuf v1.5.2
<span class="term-fg31">-	github.com&#47;golang&#47;snappy v0.0.4</span>
<span class="term-fg32">+	github.com&#47;golang&#47;snappy v0.0.5-0.20220116011046-fa5810519dcb</span>
 	github.com&#47;google&#47;gofuzz v1.1.1-0.20200604201612-c04b05f3adfa
 	github.com&#47;google&#47;uuid v1.3.0
 	github.com&#47;gorilla&#47;websocket v1.4.2
 	github.com&#47;graph-gophers&#47;graphql-go v1.3.0
 	github.com&#47;hashicorp&#47;go-bexpr v0.1.10
 	github.com&#47;holiman&#47;bloomfilter&#47;v2 v2.0.3
<span class="term-fg31">-	github.com&#47;holiman&#47;uint256 v1.2.0</span>
<span class="term-fg32">+	github.com&#47;holiman&#47;uint256 v1.2.2-0.20230321075855-87b91420868c</span>
 	github.com&#47;huin&#47;goupnp v1.0.3
<span class="term-fg31">-	github.com&#47;influxdata&#47;influxdb v1.8.3</span>
 	github.com&#47;influxdata&#47;influxdb-client-go&#47;v2 v2.4.0
<span class="term-fg32">+	github.com&#47;influxdata&#47;influxdb1-client v0.0.0-20220302092344-a9ab5670611c</span>
 	github.com&#47;jackpal&#47;go-nat-pmp v1.0.2
 	github.com&#47;jedisct1&#47;go-minisign v0.0.0-20190909160543-45766022959e
 	github.com&#47;julienschmidt&#47;httprouter v1.3.0
<span class="term-fg36">@@ -53,7 +53,7 @@</span> 	github.com&#47;peterh&#47;liner v1.1.1-0.20190123174540-a2c9a5303de7
 	github.com&#47;rs&#47;cors v1.7.0
 	github.com&#47;shirou&#47;gopsutil v3.21.4-0.20210419000835-c7a38de76ee5+incompatible
 	github.com&#47;status-im&#47;keycard-go v0.2.0
<span class="term-fg31">-	github.com&#47;stretchr&#47;testify v1.8.0</span>
<span class="term-fg32">+	github.com&#47;stretchr&#47;testify v1.8.1</span>
 	github.com&#47;supranational&#47;blst v0.3.8-0.20220526154634-513d2456b344
 	github.com&#47;syndtr&#47;goleveldb v1.0.1-0.20210819022825-2ae1ddf74ef7
 	github.com&#47;tyler-smith&#47;go-bip39 v1.1.0
<span class="term-fg36">@@ -61,10 +61,11 @@</span> 	github.com&#47;urfave&#47;cli&#47;v2 v2.17.2-0.20221006022127-8f469abc00aa
 	golang.org&#47;x&#47;crypto v0.1.0
 	golang.org&#47;x&#47;exp v0.0.0-20230206171751-46f607a40771
 	golang.org&#47;x&#47;sync v0.1.0
<span class="term-fg31">-	golang.org&#47;x&#47;sys v0.5.0</span>
<span class="term-fg31">-	golang.org&#47;x&#47;text v0.7.0</span>
<span class="term-fg32">+	golang.org&#47;x&#47;sys v0.6.0</span>
<span class="term-fg32">+	golang.org&#47;x&#47;text v0.8.0</span>
 	golang.org&#47;x&#47;time v0.0.0-20220922220347-f3bd1da661af
<span class="term-fg31">-	golang.org&#47;x&#47;tools v0.2.0</span>
<span class="term-fg32">+	golang.org&#47;x&#47;tools v0.7.0</span>
<span class="term-fg32">+	gopkg.in&#47;natefinch&#47;lumberjack.v2 v2.0.0</span>
 	gopkg.in&#47;natefinch&#47;npipe.v2 v2.0.0-20160621034901-c1b8fa8bdcce
 )
&nbsp;
<span class="term-fg36">@@ -113,11 +114,12 @@</span> 	github.com&#47;prometheus&#47;common v0.39.0 &#47;&#47; indirect
 	github.com&#47;prometheus&#47;procfs v0.9.0 &#47;&#47; indirect
 	github.com&#47;rogpeppe&#47;go-internal v1.9.0 &#47;&#47; indirect
 	github.com&#47;russross&#47;blackfriday&#47;v2 v2.1.0 &#47;&#47; indirect
<span class="term-fg32">+	github.com&#47;stretchr&#47;objx v0.5.0 &#47;&#47; indirect</span>
 	github.com&#47;tklauser&#47;go-sysconf v0.3.5 &#47;&#47; indirect
 	github.com&#47;tklauser&#47;numcpus v0.2.2 &#47;&#47; indirect
 	github.com&#47;xrash&#47;smetrics v0.0.0-20201216005158-039620a65673 &#47;&#47; indirect
<span class="term-fg31">-	golang.org&#47;x&#47;mod v0.6.0 &#47;&#47; indirect</span>
<span class="term-fg31">-	golang.org&#47;x&#47;net v0.4.0 &#47;&#47; indirect</span>
<span class="term-fg32">+	golang.org&#47;x&#47;mod v0.9.0 &#47;&#47; indirect</span>
<span class="term-fg32">+	golang.org&#47;x&#47;net v0.8.0 &#47;&#47; indirect</span>
 	golang.org&#47;x&#47;xerrors v0.0.0-20220517211312-f3a8303e98df &#47;&#47; indirect
 	google.golang.org&#47;protobuf v1.28.1 &#47;&#47; indirect
 	gopkg.in&#47;yaml.v2 v2.4.0 &#47;&#47; indirect</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-35012846bb59b91e76fc3334" role="button"
                   aria-expanded="false" aria-controls="id-35012846bb59b91e76fc3334">
                    <code>go.sum</code>
                </a>
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum/go-ethereum/blob/a38f4108571d1a144dc3cf3faf8990430d109bc4/go.sum" target="_blank">go-ethereum <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/9cc072e922f66d35b32a11e3751ecfd033b768f7/go.sum" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        <div class="text-end"><span class="text-success">+23</span></div>
                        <div class="text-start"><span class="text-danger">-253</span></div>
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-35012846bb59b91e76fc3334"><span class="term-fg1">diff --git go-ethereum&#47;go.sum op-geth&#47;go.sum</span>
<span class="term-fg1">index 51beb15cd24ae8e159cc692b01e3ab3847c19b88..dc40a5705da99acc13aedccc9b94a6c1ecb58f1d 100644</span>
<span class="term-fg1">--- go-ethereum&#47;go.sum</span>
<span class="term-fg1">+++ op-geth&#47;go.sum</span>
<span class="term-fg36">@@ -1,23 +1,4 @@</span>
 cloud.google.com&#47;go v0.26.0&#47;go.mod h1:aQUYkXzVsufM+DwF1aE+0xfcU+56JwCaLick0ClmMTw=
<span class="term-fg31">-cloud.google.com&#47;go v0.34.0&#47;go.mod h1:aQUYkXzVsufM+DwF1aE+0xfcU+56JwCaLick0ClmMTw=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.38.0&#47;go.mod h1:990N+gfupTy94rShfmMCWGDn0LpTmnzTp2qbd1dvSRU=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.43.0&#47;go.mod h1:BOSR3VbTLkk6FDC&#47;TcffxP4NF&#47;FFBGA5ku+jvKOP7pg=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.44.1&#47;go.mod h1:iSa0KzasP4Uvy3f1mN&#47;7PiObzGgflwredwwASm&#47;v6AU=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.44.2&#47;go.mod h1:60680Gw3Yr4ikxnPRS&#47;oxxkBccT6SA1yMk63TGekxKY=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.45.1&#47;go.mod h1:RpBamKRgapWJb87xiFSdk4g1CME7QZg3uwTez+TSTjc=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.46.3&#47;go.mod h1:a6bKKbmY7er1mI7TEI4lsAkts&#47;mkhTSZK8w33B4RAg0=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.50.0&#47;go.mod h1:r9sluTvynVuxRIOHXQEHMFffphuXHOMZMycpNR5e6To=</span>
<span class="term-fg31">-cloud.google.com&#47;go v0.51.0&#47;go.mod h1:hWtGJ6gnXH+KgDv+V0zFGDvpi07n3z8ZNj3T1RW0Gcw=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;bigquery v1.0.1&#47;go.mod h1:i&#47;xbL2UlR5RvWAURpBYZTtm&#47;cXjCha9lbfbpx4poX+o=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;bigquery v1.3.0&#47;go.mod h1:PjpwJnslEMmckchkHFfq+HTD2DmtT67aNFKH1&#47;VBDHE=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;bigtable v1.2.0&#47;go.mod h1:JcVAOl45lrTmQfLj7T6TxyMzIN&#47;3FGGcFm+2xVAli2o=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;datastore v1.0.0&#47;go.mod h1:LXYbyblFSglQ5pkeyhO+Qmw7ukd3C+pD7TKLgZqpHYE=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;pubsub v1.0.1&#47;go.mod h1:R0Gpsv3s54REJCy4fxDixWD93lHJMoZTyQ2kNxGRt3I=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;pubsub v1.1.0&#47;go.mod h1:EwwdRX2sKPjnvnqCa270oGRyludottCI76h+R3AArQw=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;storage v1.0.0&#47;go.mod h1:IhtSnM&#47;ZTZV8YYJWCY8RULGVqBDmpoyjwiyrjsg+URw=</span>
<span class="term-fg31">-cloud.google.com&#47;go&#47;storage v1.5.0&#47;go.mod h1:tpKbwo567HUNpVclU5sGELwQWBDZ8gh0ZeosJ0Rtdos=</span>
<span class="term-fg31">-collectd.org v0.3.0&#47;go.mod h1:A&#47;8DzQBkF6abtvrT2j&#47;AU&#47;4tiBgJWYyh0y&#47;oB&#47;4MlWE=</span>
<span class="term-fg31">-dmitri.shuralyov.com&#47;gpu&#47;mtl v0.0.0-20190408044501-666a987793e9&#47;go.mod h1:H6x&#47;&#47;7gZCb22OMCxBHrMx7a5I7Hp++hsVxbQ4BYO7hU=</span>
 github.com&#47;AndreasBriese&#47;bbloom v0.0.0-20190306092124-e2d15f34fcf9&#47;go.mod h1:bOvUY6CB00SOBii9&#47;FifXqc0awNKxLFCL&#47;+pkDPuyl8=
 github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;azcore v0.21.1 h1:qoVeMsc9&#47;fh&#47;yhxVaA0obYjVH&#47;oI&#47;ihrOoMwsLS9KSA=
 github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;azcore v0.21.1&#47;go.mod h1:fBF9PQNqB8scdgpZ3ufzaLntG0AG7C1WjPMsiFOmfHM=
<span class="term-fg36">@@ -26,27 +7,20 @@</span> github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;internal v0.8.3&#47;go.mod h1:KLF4gFr6DcKFZwSuH8w8yEK6DpFl3LP5rhdvAb7Yz5I=
 github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;storage&#47;azblob v0.3.0 h1:Px2UA+2RvSSvv+RvJNuUB6n7rs5Wsel4dXLe90Um2n4=
 github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;storage&#47;azblob v0.3.0&#47;go.mod h1:tPaiy8S5bQ+S5sOiDlINkp7+Ef339+Nz5L5XO+cnOHo=
 github.com&#47;BurntSushi&#47;toml v0.3.1&#47;go.mod h1:xHWCNGjB5oqiDr8zfno3MHue2Ht5sIBksp03qcyfWMU=
<span class="term-fg31">-github.com&#47;BurntSushi&#47;xgb v0.0.0-20160522181843-27f122750802&#47;go.mod h1:IVnqGOEym&#47;WlBOVXweHU+Q+&#47;VP0lqqI8lqeDx9IjBqo=</span>
<span class="term-fg32">+github.com&#47;BurntSushi&#47;toml v1.2.0 h1:Rt8g24XnyGTyglgET&#47;PRUNlrUeu9F5L+7FilkXfZgs0=</span>
 github.com&#47;CloudyKit&#47;fastprinter v0.0.0-20200109182630-33d98a066a53&#47;go.mod h1:+3IMCy2vIlbG1XG&#47;0ggNQv0SvxCAIpPM5b1nCz56Xno=
 github.com&#47;CloudyKit&#47;jet&#47;v3 v3.0.0&#47;go.mod h1:HKQPgSJmdK8hdoAbKUUWajkHyHo4RaU5rMdUywE7VMo=
<span class="term-fg31">-github.com&#47;DATA-DOG&#47;go-sqlmock v1.3.3&#47;go.mod h1:f&#47;Ixk793poVmq4qj&#47;V1dPUg2JEAKC73Q5eFN3EC&#47;SaM=</span>
 github.com&#47;DataDog&#47;zstd v1.5.2 h1:vUG4lAyuPCXO0TLbXvPv7EB7cNK1QV&#47;luu55UHLrrn8=
 github.com&#47;DataDog&#47;zstd v1.5.2&#47;go.mod h1:g4AWEaM3yOg3HYfnJ3YIawPnVdXJh9QME85blwSAmyw=
 github.com&#47;Joker&#47;hpp v1.0.0&#47;go.mod h1:8x5n+M1Hp5hC0g8okX3sR3vFQwynaX&#47;UgSOM9MeBKzY=
<span class="term-fg31">-github.com&#47;OneOfOne&#47;xxhash v1.2.2&#47;go.mod h1:HSdplMjZKSmBqAxg5vPj2TmRDmfkzw+cTzAElWljhcU=</span>
 github.com&#47;Shopify&#47;goreferrer v0.0.0-20181106222321-ec9c9a553398&#47;go.mod h1:a1uqRtAwp2Xwc6WNPJEufxJ7fx3npB4UV&#47;JOLmbu5I0=
 github.com&#47;StackExchange&#47;wmi v0.0.0-20180116203802-5d049714c4a6 h1:fLjPD&#47;aNc3UIOA6tDi6QXUemppXK3P9BI7mr2hd6gx8=
 github.com&#47;StackExchange&#47;wmi v0.0.0-20180116203802-5d049714c4a6&#47;go.mod h1:3eOhrUMpNV+6aFIbp5&#47;iudMxNCF27Vw2OZgy4xEx0Fg=
 github.com&#47;VictoriaMetrics&#47;fastcache v1.6.0 h1:C&#47;3Oi3EiBCqufydp1neRZkqcwmEiuRT9c3fqvvgKm5o=
 github.com&#47;VictoriaMetrics&#47;fastcache v1.6.0&#47;go.mod h1:0qHz5QP0GMX4pfmMA&#47;zt5RgfNuXJrTP0zS7DqpHGGTw=
 github.com&#47;ajg&#47;form v1.5.1&#47;go.mod h1:uL1WgH+h2mgNtvBq0339dVnzXdBETtL2LeUXaIv25UY=
<span class="term-fg31">-github.com&#47;ajstarks&#47;svgo v0.0.0-20180226025133-644b8db467af&#47;go.mod h1:K08gAheRH3&#47;J6wwsYMMT4xOr94bZjxIelGM0+d&#47;wbFw=</span>
<span class="term-fg31">-github.com&#47;alecthomas&#47;template v0.0.0-20160405071501-a0175ee3bccc&#47;go.mod h1:LOuyumcjzFXgccqObfd&#47;Ljyb9UuFJ6TxHnclSeseNhc=</span>
<span class="term-fg31">-github.com&#47;alecthomas&#47;units v0.0.0-20151022065526-2efee857e7cf&#47;go.mod h1:ybxpYRFXyAe+OPACYpWeL0wqObRcbAqCMya13uyzqw0=</span>
 github.com&#47;allegro&#47;bigcache v1.2.1-0.20190218064605-e24eb225f156 h1:eMwmnE&#47;GDgah4HI848JfFxHt+iPb26b4zyfspmqY0&#47;8=
 github.com&#47;allegro&#47;bigcache v1.2.1-0.20190218064605-e24eb225f156&#47;go.mod h1:Cb&#47;ax3seSYIx7SuZdm2G2xzfwmv3TPSk2ucNfQESPXM=
<span class="term-fg31">-github.com&#47;andreyvit&#47;diff v0.0.0-20170406064948-c7f18ee00883&#47;go.mod h1:rCTlJbsFo29Kk6CurOXKm700vrz8f0KW0JNfpkRJY&#47;8=</span>
<span class="term-fg31">-github.com&#47;apache&#47;arrow&#47;go&#47;arrow v0.0.0-20191024131854-af6fa24be0db&#47;go.mod h1:VTxUBvSJ3s3eHAg65PNgrsn5BtqCRPdmyXh6rAfdxN0=</span>
 github.com&#47;armon&#47;consul-api v0.0.0-20180202201655-eb2c6b5be1b6&#47;go.mod h1:grANhF5doyWs3UAsr3K4I6qtAmlQcZDesFNEHPZAzj8=
 github.com&#47;aws&#47;aws-sdk-go-v2 v1.2.0 h1:BS+UYpbsElC82gB+2E2jiCBg36i8HlubTB&#47;dO&#47;moQ9c=
 github.com&#47;aws&#47;aws-sdk-go-v2 v1.2.0&#47;go.mod h1:zEQs02YRBw1DjK0PoJv3ygDYOFTre1ejlJWl8FwAuQo=
<span class="term-fg36">@@ -67,26 +41,17 @@</span> github.com&#47;aws&#47;aws-sdk-go-v2&#47;service&#47;sts v1.1.1&#47;go.mod h1:Wi0EBZwiz&#47;K44YliU0EKxqTCJGUfYTWXrrBwkq736bM=
 github.com&#47;aws&#47;smithy-go v1.1.0 h1:D6CSsM3gdxaGaqXnPgOBCeL6Mophqzu7KJOu7zW78sU=
 github.com&#47;aws&#47;smithy-go v1.1.0&#47;go.mod h1:EzMw8dbp&#47;YJL4A5&#47;sbhGddag+NPT7q084agLbB9LgIw=
 github.com&#47;aymerick&#47;raymond v2.0.3-0.20180322193309-b565731e1464+incompatible&#47;go.mod h1:osfaiScAUVup+UC9Nfq76eWqDhXlp+4UYaA8uhTBO6g=
<span class="term-fg31">-github.com&#47;beorn7&#47;perks v0.0.0-20180321164747-3a771d992973&#47;go.mod h1:Dwedo&#47;Wpr24TaqPxmxbtue+5NUziq4I4S80YR8gNf3Q=</span>
<span class="term-fg31">-github.com&#47;beorn7&#47;perks v1.0.0&#47;go.mod h1:KWe93zE9D1o94FZ5RNwFwVgaQK1VOXiVxmqh+CedLV8=</span>
 github.com&#47;beorn7&#47;perks v1.0.1 h1:VlbKKnNfV8bJzeqoa4cOKqO6bYr3WgKZxO8Z16+hsOM=
 github.com&#47;beorn7&#47;perks v1.0.1&#47;go.mod h1:G2ZrVWU2WbWT9wwq4&#47;hrbKbnv&#47;1ERSJQ0ibhJ6rlkpw=
<span class="term-fg31">-github.com&#47;bmizerany&#47;pat v0.0.0-20170815010413-6226ea591a40&#47;go.mod h1:8rLXio+WjiTceGBHIoTvn60HIbs7Hm7bcHjyrSqYB9c=</span>
<span class="term-fg31">-github.com&#47;boltdb&#47;bolt v1.3.1&#47;go.mod h1:clJnj&#47;oiGkjum5o1McbSZDSLxVThjynRyGBgiAx27Ps=</span>
 github.com&#47;btcsuite&#47;btcd&#47;btcec&#47;v2 v2.2.0 h1:fzn1qaOt32TuLjFlkzYSsBC35Q3KUjT1SwPxiMSCF5k=
 github.com&#47;btcsuite&#47;btcd&#47;btcec&#47;v2 v2.2.0&#47;go.mod h1:U7MHm051Al6XmscBQ0BoNydpOTsFAn707034b5nY8zU=
 github.com&#47;btcsuite&#47;btcd&#47;chaincfg&#47;chainhash v1.0.1 h1:q0rUy8C&#47;TYNBQS1+CGKw68tLOFYSNEs0TFnxxnS9+4U=
<span class="term-fg31">-github.com&#47;c-bata&#47;go-prompt v0.2.2&#47;go.mod h1:VzqtzE2ksDBcdln8G7mk2RX9QyGjH+OVqOCSiVIqS34=</span>
 github.com&#47;census-instrumentation&#47;opencensus-proto v0.2.1&#47;go.mod h1:f6KPmirojxKA12rnyqOA5BBL4O983OfeGPqjHWSTneU=
 github.com&#47;cespare&#47;cp v0.1.0 h1:SE+dxFebS7Iik5LK0tsi1k9ZCxEaFX4AjQmoyA+1dJk=
 github.com&#47;cespare&#47;cp v0.1.0&#47;go.mod h1:SOGHArjBr4JWaSDEVpWpo&#47;hNg6RoKrls6Oh40hiwW+s=
<span class="term-fg31">-github.com&#47;cespare&#47;xxhash v1.1.0&#47;go.mod h1:XrSqR1VqqWfGrhpAt58auRo0WTKS1nRRg3ghfAqPWnc=</span>
 github.com&#47;cespare&#47;xxhash&#47;v2 v2.1.1&#47;go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3&#47;j3BFtOZR5XLFGgcrjCOs=
 github.com&#47;cespare&#47;xxhash&#47;v2 v2.2.0 h1:DC2CZ1Ep5Y4k3ZQ899DldepgrayRUGE6BBZ&#47;cd9Cj44=
 github.com&#47;cespare&#47;xxhash&#47;v2 v2.2.0&#47;go.mod h1:VGX0DQ3Q6kWi7AoAeZDth3&#47;j3BFtOZR5XLFGgcrjCOs=
<span class="term-fg31">-github.com&#47;chzyer&#47;logex v1.1.10&#47;go.mod h1:+Ywpsq7O8HXn0nuIou7OrIPyXbp3wmkHB+jjWRnGsAI=</span>
<span class="term-fg31">-github.com&#47;chzyer&#47;readline v0.0.0-20180603132655-2972be24d48e&#47;go.mod h1:nSuG5e5PlCu98SY8svDHJxuZscDgtXS6KTTbou5AhLI=</span>
<span class="term-fg31">-github.com&#47;chzyer&#47;test v0.0.0-20180213035817-a1ea475d72b1&#47;go.mod h1:Q3SI9o4m&#47;ZMnBNeIyt5eFwwo7qiLfzFZmjNmxjkiQlU=</span>
 github.com&#47;client9&#47;misspell v0.3.4&#47;go.mod h1:qj6jICC3Q7zFZvVWo7KLAzC3yx5G7kyvSDkc90ppPyw=
 github.com&#47;cloudflare&#47;cloudflare-go v0.14.0 h1:gFqGlGl&#47;5f9UGXAaKapCGUfaTCgRKKnzu2VvzMZlOFA=
 github.com&#47;cloudflare&#47;cloudflare-go v0.14.0&#47;go.mod h1:EnwdgGMaFOruiPZRFSgn+TsQ3hQ7C&#47;YWzIGLeu5c304=
<span class="term-fg36">@@ -118,7 +83,6 @@</span> github.com&#47;crate-crypto&#47;go-ipa v0.0.0-20220523130400-f11357ae11c7 h1:6IrxszG5G+O7zhtkWxq6+unVvnrm1fqV2Pe+T95DUzw=
 github.com&#47;crate-crypto&#47;go-ipa v0.0.0-20220523130400-f11357ae11c7&#47;go.mod h1:gFnFS95y8HstDP6P9pPwzrxOOC5TRDkwbM+ao15ChAI=
 github.com&#47;creack&#47;pty v1.1.9&#47;go.mod h1:oKZEueFk5CKHvIhNR5MUki03XCEU+Q6VDXinZuGJ33E=
 github.com&#47;cyberdelia&#47;templates v0.0.0-20141128023046-ca7fffd4298c&#47;go.mod h1:GyV+0YP4qX0UQ7r2MoYZ+AvYDp12OF5yg4q8rGnyNh4=
<span class="term-fg31">-github.com&#47;dave&#47;jennifer v1.2.0&#47;go.mod h1:fIb+770HOpJ2fmN9EPPKOqm1vMGhB+TwXKMZhrIygKg=</span>
 github.com&#47;davecgh&#47;go-spew v1.1.0&#47;go.mod h1:J7Y8YcW2NihsgmVo&#47;mv3lAwl&#47;skON4iLHjSsI+c5H38=
 github.com&#47;davecgh&#47;go-spew v1.1.1 h1:vj9j&#47;u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=
 github.com&#47;davecgh&#47;go-spew v1.1.1&#47;go.mod h1:J7Y8YcW2NihsgmVo&#47;mv3lAwl&#47;skON4iLHjSsI+c5H38=
<span class="term-fg36">@@ -133,7 +97,6 @@</span> github.com&#47;deepmap&#47;oapi-codegen v1.8.2 h1:SegyeYGcdi0jLLrpbCMoJxnUUn8GBXHsvr4rbzjuhfU=
 github.com&#47;deepmap&#47;oapi-codegen v1.8.2&#47;go.mod h1:YLgSKSDv&#47;bZQB7N4ws6luhozi3cEdRktEqrX88CvjIw=
 github.com&#47;dgraph-io&#47;badger v1.6.0&#47;go.mod h1:zwt7syl517jmP8s94KqSxTlM6IMsdhYy6psNgSztDR4=
 github.com&#47;dgrijalva&#47;jwt-go v3.2.0+incompatible&#47;go.mod h1:E3ru+11k8xSBh+hMPgOLZmtrrCbhqsmaPHjLKYnJCaQ=
<span class="term-fg31">-github.com&#47;dgryski&#47;go-bitstream v0.0.0-20180413035011-3522498ce2c8&#47;go.mod h1:VMaSuZ+SZcx&#47;wljOQKvp5srsbCiKDEb6K2wC4+PiBmQ=</span>
 github.com&#47;dgryski&#47;go-farm v0.0.0-20190423205320-6a90982ecee2&#47;go.mod h1:SqUrOPUnsFjfmXRMNPybcSiG0BgUW2AuFH8PAnS2iTw=
 github.com&#47;dlclark&#47;regexp2 v1.4.1-0.20201116162257-a2a8dda75c91&#47;go.mod h1:2pZnwuY&#47;m+8K6iRw6wQdMtk+rH5tNGR1i55kozfMjCc=
 github.com&#47;dlclark&#47;regexp2 v1.7.0 h1:7lJfhqlPssTb1WQx4yvTHN0uElPEv52sbaECrAQxjAo=
<span class="term-fg36">@@ -149,7 +112,6 @@</span> github.com&#47;dop251&#47;goja v0.0.0-20230122112309-96b1610dd4f7&#47;go.mod h1:yRkwfj0CBpOGre+TwBsqPV0IH0Pk73e4PXJOeNDboGs=
 github.com&#47;dop251&#47;goja_nodejs v0.0.0-20210225215109-d91c329300e7&#47;go.mod h1:hn7BA7c8pLvoGndExHudxTDKZ84Pyvv+90pbBjbTz0Y=
 github.com&#47;dop251&#47;goja_nodejs v0.0.0-20211022123610-8dd9abb0616d&#47;go.mod h1:DngW8aVqWbuLRMHItjPUyqdj+HWPvnQe8V8y1nDpIbM=
 github.com&#47;dustin&#47;go-humanize v1.0.0&#47;go.mod h1:HtrtbFcZ19U5GC7JDqmcUSB87Iq5E25KnS6fMYU6eOk=
<span class="term-fg31">-github.com&#47;eclipse&#47;paho.mqtt.golang v1.2.0&#47;go.mod h1:H9keYFcgq3Qr5OUJm&#47;JZI&#47;i6U7joQ8SYLhZwfeOo6Ts=</span>
 github.com&#47;edsrzf&#47;mmap-go v1.0.0 h1:CEBF7HpRnUCSJgGUb5h1Gm7e3VkmVDrR8lvWVLtrOFw=
 github.com&#47;edsrzf&#47;mmap-go v1.0.0&#47;go.mod h1:YO35OhQPt3KJa3ryjFM5Bs14WD66h8eGKpfaBNrHW5M=
 github.com&#47;eknkc&#47;amber v0.0.0-20171010120322-cdade1c07385&#47;go.mod h1:0vRUJqYpeSZifjYj7uP3BG&#47;gKcuzL9xWVV&#47;Y+cK33KM=
<span class="term-fg36">@@ -166,7 +128,6 @@</span> github.com&#47;fjl&#47;gencodec v0.0.0-20220412091415-8bb9e558978c h1:CndMRAH4JIwxbW8KYq6Q+cGWcGHz0FjGR3QqcInWcW0=
 github.com&#47;fjl&#47;gencodec v0.0.0-20220412091415-8bb9e558978c&#47;go.mod h1:AzA8Lj6YtixmJWL+wkKoBGsLWy9gFrAzi4g+5bCKwpY=
 github.com&#47;fjl&#47;memsize v0.0.0-20190710130421-bcb5799ab5e5 h1:FtmdgXiUlNeRsoNMFlKLDt+S+6hbjVMEW6RGQ7aUf7c=
 github.com&#47;fjl&#47;memsize v0.0.0-20190710130421-bcb5799ab5e5&#47;go.mod h1:VvhXpOYNQvB+uIk2RvXzuaQtkQJzzIx6lSBe1xv7hi0=
<span class="term-fg31">-github.com&#47;fogleman&#47;gg v1.2.1-0.20190220221249-0403632d5b90&#47;go.mod h1:R&#47;bRT+9gY&#47;C5z7JzPU0zXsXHKM4&#47;ayA+zqcVNZzPa1k=</span>
 github.com&#47;fsnotify&#47;fsnotify v1.4.7&#47;go.mod h1:jwhsz4b93w&#47;PPRr&#47;qN1Yymfu8t87LnFCMoQvtojpjFo=
 github.com&#47;fsnotify&#47;fsnotify v1.4.9&#47;go.mod h1:znqG4EE+3YCdAaPaxE2ZRY&#47;06pZUdp0tY4IgpuI1SZQ=
 github.com&#47;fsnotify&#47;fsnotify v1.6.0 h1:n+5WquG0fcWoWp6xPWfHdbskMCQaFnG6PfBrh1Ky4HY=
<span class="term-fg36">@@ -186,17 +147,10 @@</span> github.com&#47;getsentry&#47;sentry-go v0.18.0&#47;go.mod h1:Kgon4Mby+FJ7ZWHFUAZgVaIa8sxHtnRJRLTXZr51aKQ=
 github.com&#47;ghodss&#47;yaml v1.0.0&#47;go.mod h1:4dBDuWmgqj2HViK6kFavaiC9ZROes6MMH2rRYeMEF04=
 github.com&#47;gin-contrib&#47;sse v0.0.0-20190301062529-5545eab6dad3&#47;go.mod h1:VJ0WA2NBN22VlZ2dKZQPAPnyWw5XTlK1KymzLKsr59s=
 github.com&#47;gin-gonic&#47;gin v1.4.0&#47;go.mod h1:OW2EZn3DO8Ln9oIKOvM++LBO+5UPHJJDH72&#47;q&#47;3rZdM=
<span class="term-fg31">-github.com&#47;glycerine&#47;go-unsnap-stream v0.0.0-20180323001048-9f0cb55181dd&#47;go.mod h1:&#47;20jfyN9Y5QPEAprSgKAUr+glWDY39ZiUEAYOEv5dsE=</span>
<span class="term-fg31">-github.com&#47;glycerine&#47;goconvey v0.0.0-20190410193231-58a59202ab31&#47;go.mod h1:Ogl1Tioa0aV7gstGFO7KhffUsb9M4ydbEbbxpcEDc24=</span>
 github.com&#47;go-check&#47;check v0.0.0-20180628173108-788fd7840127&#47;go.mod h1:9ES+weclKsC9YodN5RgxqK&#47;VD9HM9JsCSh7rNhMZE98=
 github.com&#47;go-chi&#47;chi&#47;v5 v5.0.0&#47;go.mod h1:BBug9lr0cqtdAhsu6R4AAdvufI0&#47;XBzAQSsUqJpoZOs=
 github.com&#47;go-errors&#47;errors v1.0.1&#47;go.mod h1:f4zRHt4oKfwPJE5k8C9vpYG+aDHdBFUsgrm6&#47;TyX73Q=
 github.com&#47;go-errors&#47;errors v1.4.2 h1:J6MZopCL4uSllY1OfXM374weqZFFItUbrImctkmUxIA=
<span class="term-fg31">-github.com&#47;go-gl&#47;glfw v0.0.0-20190409004039-e6da0acd62b1&#47;go.mod h1:vR7hzQXu2zJy9AVAgeJqvqgH9Q5CA+iKCZ2gyEVpxRU=</span>
<span class="term-fg31">-github.com&#47;go-gl&#47;glfw&#47;v3.3&#47;glfw v0.0.0-20191125211704-12ad95a8df72&#47;go.mod h1:tQ2UAYgL5IevRw8kRxooKSPJfGvJ9fJQFa0TUsXzTg8=</span>
<span class="term-fg31">-github.com&#47;go-kit&#47;kit v0.8.0&#47;go.mod h1:xBxKIO96dXMWWy0MnWVtmwkA9&#47;13aqxPnvrjFYMA2as=</span>
<span class="term-fg31">-github.com&#47;go-logfmt&#47;logfmt v0.3.0&#47;go.mod h1:Qt1PoO58o5twSAckw1HlFXLmHsOX5&#47;0LbT9GBnD5lWE=</span>
<span class="term-fg31">-github.com&#47;go-logfmt&#47;logfmt v0.4.0&#47;go.mod h1:3RMwSq7FuexP4Kalkev3ejPJsZTpXXBr9+V4qmtdjCk=</span>
 github.com&#47;go-martini&#47;martini v0.0.0-20170121215854-22fa46961aab&#47;go.mod h1:&#47;P9AEU963A2AYjv4d1V5eVL1CQbEJq6aCNHDDjibzu8=
 github.com&#47;go-ole&#47;go-ole v1.2.1 h1:2lOsA72HgjxAuMlKpFiCbHTvu44PIVkZ5hqm3RSdI&#47;E=
 github.com&#47;go-ole&#47;go-ole v1.2.1&#47;go.mod h1:7FAglXiTm7HKlQRDeOQ6ZNUHidzCWXuZWq&#47;1dTyBNF8=
<span class="term-fg36">@@ -204,8 +158,6 @@</span> github.com&#47;go-openapi&#47;jsonpointer v0.19.5&#47;go.mod h1:Pl9vOtqEWErmShwVjC8pYs9cog34VGT37dQOVbmoatg=
 github.com&#47;go-openapi&#47;swag v0.19.5&#47;go.mod h1:POnQmlKehdgb5mhVOsnJFsivZCEZ&#47;vjK9gh66Z9tfKk=
 github.com&#47;go-sourcemap&#47;sourcemap v2.1.3+incompatible h1:W1iEw64niKVGogNgBN3ePyLFfuisuzeidWPMPWmECqU=
 github.com&#47;go-sourcemap&#47;sourcemap v2.1.3+incompatible&#47;go.mod h1:F8jJfvm2KbVjc5NqelyYJmf&#47;v5J0dwNLS2mL4sNA1Jg=
<span class="term-fg31">-github.com&#47;go-sql-driver&#47;mysql v1.4.1&#47;go.mod h1:zAC&#47;RDZ24gD3HViQzih4MyKcchzm+sOG5ZlKdlhCg5w=</span>
<span class="term-fg31">-github.com&#47;go-stack&#47;stack v1.8.0&#47;go.mod h1:v0f6uXyyMGvRgIKkXu+yp6POWl0qKG85gN&#47;melR3HDY=</span>
 github.com&#47;go-stack&#47;stack v1.8.1 h1:ntEHSVwIt7PNXNpgPmVfMrNhLtgjlmnZha2kOpuRiDw=
 github.com&#47;go-stack&#47;stack v1.8.1&#47;go.mod h1:dcoOX6HbPZSZptuspn9bctJ+N&#47;CnF5gGygcUP3XYfe4=
 github.com&#47;gobwas&#47;httphead v0.0.0-20180130184737-2c6c146eadee&#47;go.mod h1:L0fX3K22YWvt&#47;FAX9NnzrNzcI4wNYi9Yku4O0LKYflo=
<span class="term-fg36">@@ -213,26 +165,17 @@</span> github.com&#47;gobwas&#47;pool v0.2.0&#47;go.mod h1:q8bcK0KcYlCgd9e7WYLm9LpyS+YeLd8JVDW6WezmKEw=
 github.com&#47;gobwas&#47;ws v1.0.2&#47;go.mod h1:szmBTxLgaFppYjEmNtny&#47;v3w89xOydFnnZMcgRRu&#47;EM=
 github.com&#47;gofrs&#47;flock v0.8.1 h1:+gYjHKf32LDeiEEFhQaotPbLuUXjY5ZqxKgXy7n59aw=
 github.com&#47;gofrs&#47;flock v0.8.1&#47;go.mod h1:F1TvTiK9OcQqauNUHlbJvyl9Qa1QvF&#47;gOUDKA14jxHU=
<span class="term-fg31">-github.com&#47;gofrs&#47;uuid v3.3.0+incompatible&#47;go.mod h1:b2aQJv3Z4Fp6yNu3cdSllBxTCLRxnplIgP&#47;c0N&#47;04lM=</span>
 github.com&#47;gogo&#47;googleapis v0.0.0-20180223154316-0cd9801be74a&#47;go.mod h1:gf4bu3Q80BeJ6H1S1vYPm8&#47;ELATdvryBaNFGgqEef3s=
 github.com&#47;gogo&#47;googleapis v1.4.1&#47;go.mod h1:2lpHqI5OcWCtVElxXnPt+s8oJvMpySlOyM6xDCrzib4=
<span class="term-fg31">-github.com&#47;gogo&#47;protobuf v1.1.1&#47;go.mod h1:r8qH&#47;GZQm5c6nD&#47;R0oafs1akxWv10x8SbQlK7atdtwQ=</span>
 github.com&#47;gogo&#47;protobuf v1.2.0&#47;go.mod h1:r8qH&#47;GZQm5c6nD&#47;R0oafs1akxWv10x8SbQlK7atdtwQ=
<span class="term-fg31">-github.com&#47;gogo&#47;protobuf v1.3.1&#47;go.mod h1:SlYgWuQ5SjCEi6WLHjHCa1yvBfUnHcTbrrZtXPKa29o=</span>
 github.com&#47;gogo&#47;protobuf v1.3.2 h1:Ov1cvc58UF3b5XjBnZv7+opcTcQFZebYjWzi34vdm4Q=
 github.com&#47;gogo&#47;protobuf v1.3.2&#47;go.mod h1:P1XiOD3dCwIKUDQYPy72D8LYyHL2YPYrpS2s69NZV8Q=
 github.com&#47;gogo&#47;status v1.1.0&#47;go.mod h1:BFv9nrluPLmrS0EmGVvLaPNmRosr9KapBYd5&#47;hpY1WM=
 github.com&#47;golang-jwt&#47;jwt v3.2.2+incompatible&#47;go.mod h1:8pz2t5EyA70fFQQSrl6XZXzqecmYZeUEB8OUGHkxJ+I=
 github.com&#47;golang-jwt&#47;jwt&#47;v4 v4.3.0 h1:kHL1vqdqWNfATmA0FNMdmZNMyZI1U6O31X4rlIPoBog=
 github.com&#47;golang-jwt&#47;jwt&#47;v4 v4.3.0&#47;go.mod h1:&#47;xlHOz8bRuivTWchD4jCa+NbatV+wEUSzwAxVc6locg=
<span class="term-fg31">-github.com&#47;golang&#47;freetype v0.0.0-20170609003504-e2365dfdc4a0&#47;go.mod h1:E&#47;TSTwGwJL78qG&#47;PmXZO1EjYhfJinVAhrmmHX6Z8B9k=</span>
<span class="term-fg31">-github.com&#47;golang&#47;geo v0.0.0-20190916061304-5b978397cfec&#47;go.mod h1:QZ0nwyI2jOfgRAoBvP+ab5aRr7c9x7lhGEJrKvBwjWI=</span>
 github.com&#47;golang&#47;glog v0.0.0-20160126235308-23def4e6c14b&#47;go.mod h1:SBH7ygxi8pfUlaOkMMuAQtPIUF8ecWP5IEl&#47;CR7VP2Q=
<span class="term-fg31">-github.com&#47;golang&#47;groupcache v0.0.0-20190702054246-869f871628b6&#47;go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=</span>
<span class="term-fg31">-github.com&#47;golang&#47;groupcache v0.0.0-20191227052852-215e87163ea7&#47;go.mod h1:cIg4eruTrX1D+g88fzRXU5OdNfaM+9IcxsU14FzY7Hc=</span>
 github.com&#47;golang&#47;mock v1.1.1&#47;go.mod h1:oTYuIxOrZwtPieC+H1uAHpcLFnEyAGVDL&#47;k47Jfbm0A=
<span class="term-fg31">-github.com&#47;golang&#47;mock v1.2.0&#47;go.mod h1:oTYuIxOrZwtPieC+H1uAHpcLFnEyAGVDL&#47;k47Jfbm0A=</span>
<span class="term-fg31">-github.com&#47;golang&#47;mock v1.3.1&#47;go.mod h1:sBzyDLLjw3U8JLTeZvSv8jJB+tU5PVekmnlKIyFUx0Y=</span>
 github.com&#47;golang&#47;protobuf v1.2.0&#47;go.mod h1:6lQm79b+lXiMfvg&#47;cZm0SGofjICqVBUtrP5yJMmIC1U=
 github.com&#47;golang&#47;protobuf v1.3.1&#47;go.mod h1:6lQm79b+lXiMfvg&#47;cZm0SGofjICqVBUtrP5yJMmIC1U=
 github.com&#47;golang&#47;protobuf v1.3.2&#47;go.mod h1:6lQm79b+lXiMfvg&#47;cZm0SGofjICqVBUtrP5yJMmIC1U=
<span class="term-fg36">@@ -247,15 +190,12 @@</span> github.com&#47;golang&#47;protobuf v1.4.2&#47;go.mod h1:oDoupMAO8OvCJWAcko0GGGIgR6R6ocIYbsSw735rRwI=
 github.com&#47;golang&#47;protobuf v1.5.0&#47;go.mod h1:FsONVRAS9T7sI+LIUmWTfcYkHO4aIWwzhcaSAoJOfIk=
 github.com&#47;golang&#47;protobuf v1.5.2 h1:ROPKBNFfQgOUMifHyP+KYbvpjbdoFNs+aK7DXlji0Tw=
 github.com&#47;golang&#47;protobuf v1.5.2&#47;go.mod h1:XVQd3VNwM+JqD3oG2Ue2ip4fOMUkwXdXDdiuN0vRsmY=
<span class="term-fg31">-github.com&#47;golang&#47;snappy v0.0.0-20180518054509-2e65f85255db&#47;go.mod h1:&#47;XxbfmMg8lxefKM7IXC3fBNl&#47;7bRcc72aCRzEWrmP2Q=</span>
 github.com&#47;golang&#47;snappy v0.0.3&#47;go.mod h1:&#47;XxbfmMg8lxefKM7IXC3fBNl&#47;7bRcc72aCRzEWrmP2Q=
<span class="term-fg31">-github.com&#47;golang&#47;snappy v0.0.4 h1:yAGX7huGHXlcLOEtBnF4w7FQwA26wojNCwOYAEhLjQM=</span>
 github.com&#47;golang&#47;snappy v0.0.4&#47;go.mod h1:&#47;XxbfmMg8lxefKM7IXC3fBNl&#47;7bRcc72aCRzEWrmP2Q=
<span class="term-fg32">+github.com&#47;golang&#47;snappy v0.0.5-0.20220116011046-fa5810519dcb h1:PBC98N2aIaM3XXiurYmW7fx4GZkL8feAMVq7nEjURHk=</span>
<span class="term-fg32">+github.com&#47;golang&#47;snappy v0.0.5-0.20220116011046-fa5810519dcb&#47;go.mod h1:&#47;XxbfmMg8lxefKM7IXC3fBNl&#47;7bRcc72aCRzEWrmP2Q=</span>
 github.com&#47;golangci&#47;lint-1 v0.0.0-20181222135242-d2cdd8c08219&#47;go.mod h1:&#47;X8TswGSh1pIozq4ZwCfxS0WA5JGXguxk94ar&#47;4c87Y=
 github.com&#47;gomodule&#47;redigo v1.7.1-0.20190724094224-574c33c3df38&#47;go.mod h1:B4C85qUVwatsJoIUNIfCRsp7qO0iAmpGFZ4EELWSbC4=
<span class="term-fg31">-github.com&#47;google&#47;btree v0.0.0-20180813153112-4030bb1f1f0c&#47;go.mod h1:lNA+9X1NB3Zf8V7Ke586lFgjr2dZNuvo3lPJSGZ5JPQ=</span>
<span class="term-fg31">-github.com&#47;google&#47;btree v1.0.0&#47;go.mod h1:lNA+9X1NB3Zf8V7Ke586lFgjr2dZNuvo3lPJSGZ5JPQ=</span>
<span class="term-fg31">-github.com&#47;google&#47;flatbuffers v1.11.0&#47;go.mod h1:1AeVuKshWv4vARoZatz6mlQ0JxURH0Kv5+zNeJKJCa8=</span>
 github.com&#47;google&#47;go-cmp v0.2.0&#47;go.mod h1:oXzfMopK8JAjlY9xF4vHSVASa0yLyX7SntLO5aqRK0M=
 github.com&#47;google&#47;go-cmp v0.3.0&#47;go.mod h1:8QqcDgzrUqlUb&#47;G2PQTWiueGozuR1884gddMywk6iLU=
 github.com&#47;google&#47;go-cmp v0.3.1&#47;go.mod h1:8QqcDgzrUqlUb&#47;G2PQTWiueGozuR1884gddMywk6iLU=
<span class="term-fg36">@@ -269,17 +209,10 @@</span> github.com&#47;google&#47;go-querystring v1.0.0&#47;go.mod h1:odCYkC5MyYFN7vkCjXpyrEuKhc&#47;BUO6wN&#47;zVPAxq5ck=
 github.com&#47;google&#47;gofuzz v1.0.0&#47;go.mod h1:dBl0BpW6vV&#47;+mYPU4Po3pmUjxk6FQPldtuIdl&#47;M65Eg=
 github.com&#47;google&#47;gofuzz v1.1.1-0.20200604201612-c04b05f3adfa h1:Q75Upo5UN4JbPFURXZ8nLKYUvF85dyFRop&#47;vQ0Rv+64=
 github.com&#47;google&#47;gofuzz v1.1.1-0.20200604201612-c04b05f3adfa&#47;go.mod h1:dBl0BpW6vV&#47;+mYPU4Po3pmUjxk6FQPldtuIdl&#47;M65Eg=
<span class="term-fg31">-github.com&#47;google&#47;martian v2.1.0+incompatible&#47;go.mod h1:9I4somxYTbIHy5NJKHRl3wXiIaQGbYVAs8BPL6v8lEs=</span>
<span class="term-fg31">-github.com&#47;google&#47;pprof v0.0.0-20181206194817-3ea8567a2e57&#47;go.mod h1:zfwlbNMJ+OItoe0UupaVj+oy1omPYYDuagoSzA8v9mc=</span>
<span class="term-fg31">-github.com&#47;google&#47;pprof v0.0.0-20190515194954-54271f7e092f&#47;go.mod h1:zfwlbNMJ+OItoe0UupaVj+oy1omPYYDuagoSzA8v9mc=</span>
<span class="term-fg31">-github.com&#47;google&#47;pprof v0.0.0-20191218002539-d4f498aebedc&#47;go.mod h1:ZgVRPoUq&#47;hfqzAqh7sHMqb3I9Rq5C59dIz2SbBwJ4eM=</span>
<span class="term-fg31">-github.com&#47;google&#47;renameio v0.1.0&#47;go.mod h1:KWCgfxg9yswjAJkECMjeO8J8rahYeXnNhOm40UhjYkI=</span>
 github.com&#47;google&#47;subcommands v1.2.0&#47;go.mod h1:ZjhPrFU+Olkh9WazFPsl27BQ4UPiG37m3yTrtFlrHVk=
 github.com&#47;google&#47;uuid v1.1.2&#47;go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw&#47;LqOeaOT+nhxU+yHo=
 github.com&#47;google&#47;uuid v1.3.0 h1:t6JiXgmwXMjEs8VusXIJk2BXHsn+wx8BZdTaoZ5fu7I=
 github.com&#47;google&#47;uuid v1.3.0&#47;go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw&#47;LqOeaOT+nhxU+yHo=
<span class="term-fg31">-github.com&#47;googleapis&#47;gax-go&#47;v2 v2.0.4&#47;go.mod h1:0Wqv26UfaUD9n4G6kQubkQ+KchISgw+vpHVxEJEs9eg=</span>
<span class="term-fg31">-github.com&#47;googleapis&#47;gax-go&#47;v2 v2.0.5&#47;go.mod h1:DWXyrwAJ9X0FpwwEdw+IPEYBICEFu5mhpdKc&#47;us6bOk=</span>
 github.com&#47;gopherjs&#47;gopherjs v0.0.0-20181017120253-0766667cb4d1&#47;go.mod h1:wJfORRmW1u3UXTncJ5qlYoELFm8eSnnEO6hX4iZ3EWY=
 github.com&#47;gorilla&#47;mux v1.8.0&#47;go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW&#47;n46BH5rLB71So=
 github.com&#47;gorilla&#47;websocket v1.4.1&#47;go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU&#47;adAjf1fMHhE=
<span class="term-fg36">@@ -290,35 +223,25 @@</span> github.com&#47;graph-gophers&#47;graphql-go v1.3.0&#47;go.mod h1:9CQHMSxwO4MprSdzoIEobiHpoLtHm77vfxsvsIN5Vuc=
 github.com&#47;hashicorp&#47;go-bexpr v0.1.10 h1:9kuI5PFotCboP3dkDYFr&#47;wi0gg0QVbSNz5oFRpxn4uE=
 github.com&#47;hashicorp&#47;go-bexpr v0.1.10&#47;go.mod h1:oxlubA2vC&#47;gFVfX1A6JGp7ls7uCDlfJn732ehYYg+g0=
 github.com&#47;hashicorp&#47;go-version v1.2.0&#47;go.mod h1:fltr4n8CU8Ke44wwGCBoEymUuxUHl09ZGVZPK5anwXA=
<span class="term-fg31">-github.com&#47;hashicorp&#47;golang-lru v0.5.0&#47;go.mod h1:&#47;m3WP610KZHVQ1SGc6re&#47;UDhFvYD7pJ4Ao+sR&#47;qLZy8=</span>
<span class="term-fg31">-github.com&#47;hashicorp&#47;golang-lru v0.5.1&#47;go.mod h1:&#47;m3WP610KZHVQ1SGc6re&#47;UDhFvYD7pJ4Ao+sR&#47;qLZy8=</span>
 github.com&#47;hashicorp&#47;hcl v1.0.0&#47;go.mod h1:E5yfLk+7swimpb2L&#47;Alb&#47;PJmXilQ&#47;rhwaUYs4T20WEQ=
 github.com&#47;holiman&#47;bloomfilter&#47;v2 v2.0.3 h1:73e0e&#47;V0tCydx14a0SCYS&#47;EWCxgwLZ18CZcZKVu0fao=
 github.com&#47;holiman&#47;bloomfilter&#47;v2 v2.0.3&#47;go.mod h1:zpoh+gs7qcpqrHr3dB55AMiJwo0iURXE7ZOP9L9hSkA=
<span class="term-fg31">-github.com&#47;holiman&#47;uint256 v1.2.0 h1:gpSYcPLWGv4sG43I2mVLiDZCNDh&#47;EpGjSk8tmtxitHM=</span>
<span class="term-fg31">-github.com&#47;holiman&#47;uint256 v1.2.0&#47;go.mod h1:y4ga&#47;t+u+Xwd7CpDgZESaRcWy0I7XMlTMA25ApIH5Jw=</span>
<span class="term-fg32">+github.com&#47;holiman&#47;uint256 v1.2.2-0.20230321075855-87b91420868c h1:DZfsyhDK1hnSS5lH8l+JggqzEleHteTYfutAiVlSUM8=</span>
<span class="term-fg32">+github.com&#47;holiman&#47;uint256 v1.2.2-0.20230321075855-87b91420868c&#47;go.mod h1:SC8Ryt4n+UBbPbIBKaG9zbbDlp4jOru9xFZmPzLUTxw=</span>
 github.com&#47;hpcloud&#47;tail v1.0.0&#47;go.mod h1:ab1qPbhIpdTxEkNHXyeSf5vhxWSCs&#47;tWer42PpOxQnU=
 github.com&#47;huin&#47;goupnp v1.0.3 h1:N8No57ls+MnjlB+JPiCVSOyy&#47;ot7MJTqlo7rn+NYSqQ=
 github.com&#47;huin&#47;goupnp v1.0.3&#47;go.mod h1:ZxNlw5WqJj6wSsRK5+YfflQGXYfccj5VgQsMNixHM7Y=
 github.com&#47;huin&#47;goutil v0.0.0-20170803182201-1ca381bf3150&#47;go.mod h1:PpLOETDnJ0o3iZrZfqZzyLl6l7F3c6L1oWn7OICBi6o=
 github.com&#47;hydrogen18&#47;memlistener v0.0.0-20200120041712-dcc25e7acd91&#47;go.mod h1:qEIFzExnS6016fRpRfxrExeVn2gbClQA99gQhnIcdhE=
<span class="term-fg31">-github.com&#47;ianlancetaylor&#47;demangle v0.0.0-20181102032728-5e5cf60278f6&#47;go.mod h1:aSSvb&#47;t6k1mPoxDqO4vJh6VOCGPwU4O0C2&#47;Eqndh1Sc=</span>
 github.com&#47;imkira&#47;go-interpol v1.1.0&#47;go.mod h1:z0h2&#47;2T3XF8kyEPpRgJ3kmNv+C43p+I&#47;CoI+jC3w2iA=
 github.com&#47;inconshreveable&#47;mousetrap v1.0.0&#47;go.mod h1:PxqpIevigyE2G7u3NXJIT2ANytuPF1OarO4DADm73n8=
<span class="term-fg31">-github.com&#47;influxdata&#47;flux v0.65.1&#47;go.mod h1:J754&#47;zds0vvpfwuq7Gc2wRdVwEodfpCFM7mYlOw2LqY=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;influxdb v1.8.3 h1:WEypI1BQFTT4teLM+1qkEcvUi0dAvopAI&#47;ir0vAiBg8=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;influxdb v1.8.3&#47;go.mod h1:JugdFhsvvI8gadxOI6noqNeeBHvWNTbfYGtiAn+2jhI=</span>
 github.com&#47;influxdata&#47;influxdb-client-go&#47;v2 v2.4.0 h1:HGBfZYStlx3Kqvsv1h2pJixbCl&#47;jhnFtxpKFAv9Tu5k=
 github.com&#47;influxdata&#47;influxdb-client-go&#47;v2 v2.4.0&#47;go.mod h1:vLNHdxTJkIf2mSLvGrpj8TCcISApPoXkaxP8g9uRlW8=
<span class="term-fg31">-github.com&#47;influxdata&#47;influxql v1.1.1-0.20200828144457-65d3ef77d385&#47;go.mod h1:gHp9y86a&#47;pxhjJ+zMjNXiQAA197Xk9wLxaz+fGG+kWk=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;line-protocol v0.0.0-20180522152040-32c6aa80de5e&#47;go.mod h1:4kt73NQhadE3daL3WhR5EJ&#47;J2ocX0PZzwxQ0gXJ7oFE=</span>
<span class="term-fg32">+github.com&#47;influxdata&#47;influxdb1-client v0.0.0-20220302092344-a9ab5670611c h1:qSHzRbhzK8RdXOsAdfDgO49TtqC1oZ+acxPrkfTxcCs=</span>
<span class="term-fg32">+github.com&#47;influxdata&#47;influxdb1-client v0.0.0-20220302092344-a9ab5670611c&#47;go.mod h1:qj24IKcXYK6Iy9ceXlo3Tc+vtHo9lIhSX5JddghvEPo=</span>
 github.com&#47;influxdata&#47;line-protocol v0.0.0-20200327222509-2487e7298839&#47;go.mod h1:xaLFMmpvUxqXtVkUJfg9QmT88cDaCJ3ZKgdZ78oO8Qo=
 github.com&#47;influxdata&#47;line-protocol v0.0.0-20210311194329-9aa0e372d097 h1:vilfsDSy7TDxedi9gyBkMvAirat&#47;oRcL0lFdJBf6tdM=
 github.com&#47;influxdata&#47;line-protocol v0.0.0-20210311194329-9aa0e372d097&#47;go.mod h1:xaLFMmpvUxqXtVkUJfg9QmT88cDaCJ3ZKgdZ78oO8Qo=
<span class="term-fg31">-github.com&#47;influxdata&#47;promql&#47;v2 v2.12.0&#47;go.mod h1:fxOPu+DY0bqCTCECchSRtWfc+0X19ybifQhZoQNF5D8=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;roaring v0.4.13-0.20180809181101-fc520f41fab6&#47;go.mod h1:bSgUQ7q5ZLSO+bKBGqJiCBGAl+9DxyW63zLTujjUlOE=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;tdigest v0.0.0-20181121200506-bf2b5ad3c0a9&#47;go.mod h1:Js0mqiSBE6Ffsg94weZZ2c+v&#47;ciT8QRHFOap7EKDrR0=</span>
<span class="term-fg31">-github.com&#47;influxdata&#47;usage-client v0.0.0-20160829180054-6d3895376368&#47;go.mod h1:Wbbw6tYNvwa5dlB6304Sd+82Z3f7PmVZHVKU637d4po=</span>
 github.com&#47;iris-contrib&#47;blackfriday v2.0.0+incompatible&#47;go.mod h1:UzZ2bDEoaSGPbkg6SAB4att1aAwTmVIx&#47;5gCVqeyUdI=
 github.com&#47;iris-contrib&#47;go.uuid v2.0.0+incompatible&#47;go.mod h1:iz2lgM&#47;1UnEf1kP0L&#47;+fafWORmlnuysV2EMP8MW+qe0=
 github.com&#47;iris-contrib&#47;jade v1.1.3&#47;go.mod h1:H&#47;geBymxJhShH5kecoiOCSssPX7QWYH7UaeZTSWddIk=
<span class="term-fg36">@@ -332,15 +255,9 @@</span> github.com&#47;jmespath&#47;go-jmespath v0.4.0&#47;go.mod h1:T8mJZnbsbmF+m6zOOFylbeCJqk5+pHWvzYPziyZiYoo=
 github.com&#47;jmespath&#47;go-jmespath&#47;internal&#47;testify v1.5.1&#47;go.mod h1:L3OGu8Wl2&#47;fWfCI6z80xFu9LTZmf1ZRjMHUOPmWr69U=
 github.com&#47;json-iterator&#47;go v1.1.6&#47;go.mod h1:+SdeFBvtyEkXs7REEP0seUULqWtbJapLOCVDaaPEHmU=
 github.com&#47;json-iterator&#47;go v1.1.9&#47;go.mod h1:KdQUCv79m&#47;52Kvf8AW2vK1V8akMuk1QjK&#47;uOdHXbAo4=
<span class="term-fg31">-github.com&#47;jstemmer&#47;go-junit-report v0.0.0-20190106144839-af01ea7f8024&#47;go.mod h1:6v2b51hI&#47;fHJwM22ozAgKL4VKDeJcHhJFhtBdhmNjmU=</span>
<span class="term-fg31">-github.com&#47;jstemmer&#47;go-junit-report v0.9.1&#47;go.mod h1:Brl9GWCQeLvo8nXZwPNNblvFj&#47;XSXhF0NWZEnDohbsk=</span>
<span class="term-fg31">-github.com&#47;jsternberg&#47;zap-logfmt v1.0.0&#47;go.mod h1:uvPs&#47;4X51zdkcm5jXl5SYoN+4RK21K8mysFmDaM&#47;h+o=</span>
 github.com&#47;jtolds&#47;gls v4.20.0+incompatible&#47;go.mod h1:QJZ7F&#47;aHp+rZTRtaJ1ow&#47;lLfFfVYBRgL+9YlvaHOwJU=
<span class="term-fg31">-github.com&#47;julienschmidt&#47;httprouter v1.2.0&#47;go.mod h1:SYymIcj16QtmaHHD7aYtjjsJG7VTCxuUUipMqKk8s4w=</span>
 github.com&#47;julienschmidt&#47;httprouter v1.3.0 h1:U0609e9tgbseu3rBINet9P48AI&#47;D3oJs4dN7jwJOQ1U=
 github.com&#47;julienschmidt&#47;httprouter v1.3.0&#47;go.mod h1:JR6WtHb+2LUe8TCKY3cZOxFyyO8IZAc4RVcycCCAKdM=
<span class="term-fg31">-github.com&#47;jung-kurt&#47;gofpdf v1.0.3-0.20190309125859-24315acbbda5&#47;go.mod h1:7Id9E&#47;uU8ce6rXgefFLlgrJj&#47;GYY22cpxn+r32jIOes=</span>
<span class="term-fg31">-github.com&#47;jwilder&#47;encoding v0.0.0-20170811194829-b4e1701a28ef&#47;go.mod h1:Ct9fl0F6iIOGgxJ5npU&#47;IUOhOhqlVrGjyIZc8&#47;MagT0=</span>
 github.com&#47;k0kubun&#47;colorstring v0.0.0-20150214042306-9440f1994b88&#47;go.mod h1:3w7q1U84EfirKl04SVQ&#47;s7nPm1ZPhiXd34z40TNz36k=
 github.com&#47;karalabe&#47;usb v0.0.2 h1:M6QQBNxF+CQ8OFvxrT90BA0qBOXymndZnk5q235mFc4=
 github.com&#47;karalabe&#47;usb v0.0.2&#47;go.mod h1:Od972xHfMJowv7NGVDiWVxk2zxnWgjLlJzE+F4F7AGU=
<span class="term-fg36">@@ -349,20 +266,13 @@</span> github.com&#47;kataras&#47;iris&#47;v12 v12.1.8&#47;go.mod h1:LMYy4VlP67TQ3Zgriz8RE2h2kMZV2SgMYbq3UhfoFmE=
 github.com&#47;kataras&#47;neffos v0.0.14&#47;go.mod h1:8lqADm8PnbeFfL7CLXh1WHw53dG27MC3pgi2R1rmoTE=
 github.com&#47;kataras&#47;pio v0.0.2&#47;go.mod h1:hAoW0t9UmXi4R5Oyq5Z4irTbaTsOemSrDGUtaTl7Dro=
 github.com&#47;kataras&#47;sitemap v0.0.5&#47;go.mod h1:KY2eugMKiPwsJgx7+U103YZehfvNGOXURubcGyk0Bz8=
<span class="term-fg31">-github.com&#47;kisielk&#47;errcheck v1.2.0&#47;go.mod h1:&#47;BMXB+zMLi60iA8Vv6Ksmxu&#47;1UDYcXs4uQLJ+jE2L00=</span>
 github.com&#47;kisielk&#47;errcheck v1.5.0&#47;go.mod h1:pFxgyoBC7bSaBwPgfKdkLd5X25qrDl4LWUI2bnpBCr8=
 github.com&#47;kisielk&#47;gotool v1.0.0&#47;go.mod h1:XhKaO+MFFWcvkIS&#47;tQcRk01m1F5IRFswLeQ+oQHNcck=
<span class="term-fg31">-github.com&#47;klauspost&#47;compress v1.4.0&#47;go.mod h1:RyIbtBH6LamlWaDj8nUwkbUhJ87Yi3uG0guNDohfE1A=</span>
 github.com&#47;klauspost&#47;compress v1.8.2&#47;go.mod h1:RyIbtBH6LamlWaDj8nUwkbUhJ87Yi3uG0guNDohfE1A=
 github.com&#47;klauspost&#47;compress v1.9.7&#47;go.mod h1:RyIbtBH6LamlWaDj8nUwkbUhJ87Yi3uG0guNDohfE1A=
 github.com&#47;klauspost&#47;compress v1.15.15 h1:EF27CXIuDsYJ6mmvtBRlEuB2UVOqHG1tAXgZ7yIO+lw=
 github.com&#47;klauspost&#47;compress v1.15.15&#47;go.mod h1:ZcK2JAFqKOpnBlxcLsJzYfrS9X1akm9fHZNnD9+Vo&#47;4=
<span class="term-fg31">-github.com&#47;klauspost&#47;cpuid v0.0.0-20170728055534-ae7887de9fa5&#47;go.mod h1:Pj4uuM528wm8OyEC2QMXAi2YiTZ96dNQPGgoMS4s3ek=</span>
 github.com&#47;klauspost&#47;cpuid v1.2.1&#47;go.mod h1:Pj4uuM528wm8OyEC2QMXAi2YiTZ96dNQPGgoMS4s3ek=
<span class="term-fg31">-github.com&#47;klauspost&#47;crc32 v0.0.0-20161016154125-cb6bfca970f6&#47;go.mod h1:+ZoRqAPRLkC4NPOvfYeR5KNOrY6TD+&#47;sAC3HXPZgDYg=</span>
<span class="term-fg31">-github.com&#47;klauspost&#47;pgzip v1.0.2-0.20170402124221-0bf5dcad4ada&#47;go.mod h1:Ch1tH69qFZu15pkjo5kYi6mth2Zzwzt50oCQKQE9RUs=</span>
<span class="term-fg31">-github.com&#47;konsorten&#47;go-windows-terminal-sequences v1.0.1&#47;go.mod h1:T0+1ngSBFLxvqU3pZ+m&#47;2kptfBszLMUkC4ZK&#47;EgS&#47;cQ=</span>
<span class="term-fg31">-github.com&#47;kr&#47;logfmt v0.0.0-20140226030751-b84e30acd515&#47;go.mod h1:+0opPa2QZZtGFBFZlji&#47;RkVcI2GknAs&#47;DXo4wKdlNEc=</span>
 github.com&#47;kr&#47;pretty v0.1.0&#47;go.mod h1:dAy3ld7l9f0ibDNOQOHHMYYIIbhfbHSm3C4ZsoJORNo=
 github.com&#47;kr&#47;pretty v0.2.1&#47;go.mod h1:ipq&#47;a2n7PKx3OHsz4KJII5eveXtPO4qwEXGdVfWzfnI=
 github.com&#47;kr&#47;pretty v0.3.0&#47;go.mod h1:640gp4NfQd8pI5XOwp5fnNeVWj67G7CFk&#47;SaSQn7NBk=
<span class="term-fg36">@@ -379,19 +289,16 @@</span> github.com&#47;labstack&#47;echo&#47;v4 v4.5.0&#47;go.mod h1:czIriw4a0C1dFun+ObrXp7ok03xON0N1awStJ6ArI7Y=
 github.com&#47;labstack&#47;gommon v0.3.0&#47;go.mod h1:MULnywXg0yavhxWKc+lOruYdAhDwPK9wf0OL7NoOu+k=
 github.com&#47;leanovate&#47;gopter v0.2.9 h1:fQjYxZaynp97ozCzfOyOuAGOU4aU&#47;z37zf&#47;tOujFk7c=
 github.com&#47;leanovate&#47;gopter v0.2.9&#47;go.mod h1:U2L&#47;78B+KVFIx2VmW6onHJQzXtFb+p5y3y2Sh+Jxxv8=
<span class="term-fg31">-github.com&#47;lib&#47;pq v1.0.0&#47;go.mod h1:5WUZQaWbwv1U+lTReE5YruASi9Al49XbQIvNi&#47;34Woo=</span>
 github.com&#47;magiconair&#47;properties v1.8.0&#47;go.mod h1:PppfXfuXeibc&#47;6YijjN8zIbojt8czPbwD3XqdrwzmxQ=
 github.com&#47;mailru&#47;easyjson v0.0.0-20190614124828-94de47d64c63&#47;go.mod h1:C1wdFJiN94OJF2b5HbByQZoLdCWB1Yqtg26g4irojpc=
 github.com&#47;mailru&#47;easyjson v0.0.0-20190626092158-b2ccc519800e&#47;go.mod h1:C1wdFJiN94OJF2b5HbByQZoLdCWB1Yqtg26g4irojpc=
 github.com&#47;matryer&#47;moq v0.0.0-20190312154309-6cfb0558e1bd&#47;go.mod h1:9ELz6aaclSIGnZBoaSLZ3NAl1VTufbOrXBPvtcy6WiQ=
<span class="term-fg31">-github.com&#47;mattn&#47;go-colorable v0.0.9&#47;go.mod h1:9vuHe8Xs5qXnSaW&#47;c&#47;ABM9alt+Vo+STaOChaDxuIBZU=</span>
 github.com&#47;mattn&#47;go-colorable v0.1.2&#47;go.mod h1:U0ppj6V5qS13XJ6of8GYAs25YV2eR4EVcfRqFIhoBtE=
 github.com&#47;mattn&#47;go-colorable v0.1.7&#47;go.mod h1:u6P&#47;XSegPjTcexA+o6vUJrdnUu04hMope9wVRipJSqc=
 github.com&#47;mattn&#47;go-colorable v0.1.8&#47;go.mod h1:u6P&#47;XSegPjTcexA+o6vUJrdnUu04hMope9wVRipJSqc=
 github.com&#47;mattn&#47;go-colorable v0.1.11&#47;go.mod h1:u5H1YNBxpqRaxsYJYSkiCWKzEfiAb1Gb520KVy5xxl4=
 github.com&#47;mattn&#47;go-colorable v0.1.13 h1:fFA4WZxdEF4tXPZVKMLwD8oUnCTTo08duU7wxecdEvA=
 github.com&#47;mattn&#47;go-colorable v0.1.13&#47;go.mod h1:7S9&#47;ev0klgBDR4GtXTXX8a3vIGJpMovkB8vQcUbaXHg=
<span class="term-fg31">-github.com&#47;mattn&#47;go-isatty v0.0.4&#47;go.mod h1:M+lRXTBqGeGNdLjl&#47;ufCoiOlB5xdOkqRJdNxMWT7Zi4=</span>
 github.com&#47;mattn&#47;go-isatty v0.0.7&#47;go.mod h1:Iq45c&#47;XA43vh69&#47;j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
 github.com&#47;mattn&#47;go-isatty v0.0.8&#47;go.mod h1:Iq45c&#47;XA43vh69&#47;j3iqttzPXn0bhXyGjM0Hdxcsrc5s=
 github.com&#47;mattn&#47;go-isatty v0.0.9&#47;go.mod h1:YNRxwqDuOph6SZLI9vUUz6OYw3QyUt7WiY2yME+cCiQ=
<span class="term-fg36">@@ -402,10 +309,7 @@</span> github.com&#47;mattn&#47;go-isatty v0.0.16&#47;go.mod h1:kYGgaQfpe5nmfYZH+SKPsOc2e4SrIfOl2e&#47;yFXSvRLM=
 github.com&#47;mattn&#47;go-runewidth v0.0.3&#47;go.mod h1:LwmH8dsx7+W8Uxz3IHJYH5QSwggIsqBzpuz5H&#47;&#47;U1FU=
 github.com&#47;mattn&#47;go-runewidth v0.0.9 h1:Lm995f3rfxdpd6TSmuVCHVb&#47;QhupuXlYr8sCI&#47;QdE+0=
 github.com&#47;mattn&#47;go-runewidth v0.0.9&#47;go.mod h1:H031xJmbD&#47;WCDINGzjvQ9THkh0rPKHF+m2gUSrubnMI=
<span class="term-fg31">-github.com&#47;mattn&#47;go-sqlite3 v1.11.0&#47;go.mod h1:FPy6KqzDD04eiIsT53CuJW3U88zkxoIYsOqkbpncsNc=</span>
<span class="term-fg31">-github.com&#47;mattn&#47;go-tty v0.0.0-20180907095812-13ff1204f104&#47;go.mod h1:XPvLUNfbS4fJH25nqRHfWLMa1ONC8Amw+mIA639KxkE=</span>
 github.com&#47;mattn&#47;goveralls v0.0.2&#47;go.mod h1:8d1ZMHsd7fW6IRPKQh46F2WRpyib5&#47;X4FOpevwGNQEw=
<span class="term-fg31">-github.com&#47;matttproud&#47;golang_protobuf_extensions v1.0.1&#47;go.mod h1:D8He9yQNgCq6Z5Ld7szi9bcBfOoFv&#47;3dc6xSMkL2PC0=</span>
 github.com&#47;matttproud&#47;golang_protobuf_extensions v1.0.4 h1:mmDVorXM7PCGKw94cs5zkfA9PSy5pEvNWRP0ET0TIVo=
 github.com&#47;matttproud&#47;golang_protobuf_extensions v1.0.4&#47;go.mod h1:BSXmuO+STAnVfrANrmjBb36TMTDstsz7MSK+HVaYKv4=
 github.com&#47;mediocregopher&#47;radix&#47;v3 v3.4.2&#47;go.mod h1:8FL3F6UQRXHXIBSPUs5h0RybMF8i4n7wVopoX3x7Bv8=
<span class="term-fg36">@@ -425,8 +329,6 @@</span> github.com&#47;modern-go&#47;reflect2 v0.0.0-20180701023420-4b7aa43c6742&#47;go.mod h1:bx2lNnkwVCuqBIxFjflWJWanXIb3RllmbCylyMrvgv0=
 github.com&#47;modern-go&#47;reflect2 v1.0.1&#47;go.mod h1:bx2lNnkwVCuqBIxFjflWJWanXIb3RllmbCylyMrvgv0=
 github.com&#47;modocache&#47;gover v0.0.0-20171022184752-b58185e213c5&#47;go.mod h1:caMODM3PzxT8aQXRPkAt8xlV&#47;e7d7w8GM5g0fa5F0D8=
 github.com&#47;moul&#47;http2curl v1.0.0&#47;go.mod h1:8UbvGypXm98wA&#47;IqH45anm5Y2Z6ep6O31QGOAZ3H0fQ=
<span class="term-fg31">-github.com&#47;mschoch&#47;smat v0.0.0-20160514031455-90eadee771ae&#47;go.mod h1:qAyveg+e4CE+eKJXWVjKXM4ck2QobLqTDytGJbLLhJg=</span>
<span class="term-fg31">-github.com&#47;mwitkow&#47;go-conntrack v0.0.0-20161129095857-cc309e4a2223&#47;go.mod h1:qRWi+5nqEBWmkhHvq77mSJWrCKwh8bxhgT7d&#47;eI7P4U=</span>
 github.com&#47;naoina&#47;go-stringutil v0.1.0 h1:rCUeRUHjBjGTSHl0VC00jUPLz8&#47;F9dDzYI70Hzifhks=
 github.com&#47;naoina&#47;go-stringutil v0.1.0&#47;go.mod h1:XJ2SJL9jCtBh+P9q5btrd&#47;Ylo8XwT&#47;h1USek5+NqSA0=
 github.com&#47;naoina&#47;toml v0.1.2-0.20170918210437-9fafd6967416 h1:shk&#47;vn9oCoOTmwcouEdwIeOtOGA&#47;ELRUw&#47;GwvxwfT+0=
<span class="term-fg36">@@ -447,46 +349,28 @@</span> github.com&#47;onsi&#47;ginkgo v1.14.0&#47;go.mod h1:iSB4RoI2tjJc9BBv4NKIKWKya62Rps+oPG&#47;Lv9klQyY=
 github.com&#47;onsi&#47;gomega v1.7.1&#47;go.mod h1:XdKZgCCFLUoM&#47;7CFJVPcG8C1xQ1AJ0vpAezJrB7JYyY=
 github.com&#47;onsi&#47;gomega v1.10.1 h1:o0+MgICZLuZ7xjH7Vx6zS&#47;zcu93&#47;BEp1VwkIW1mEXCE=
 github.com&#47;onsi&#47;gomega v1.10.1&#47;go.mod h1:iN09h71vgCQne3DLsj+A5owkum+a2tYe+TOCB1ybHNo=
<span class="term-fg31">-github.com&#47;opentracing&#47;opentracing-go v1.0.2&#47;go.mod h1:UkNAQd3GIcIGf0SeVgPpRdFStlNbqXla1AfSYxPUl2o=</span>
<span class="term-fg31">-github.com&#47;opentracing&#47;opentracing-go v1.0.3-0.20180606204148-bd9c31933947&#47;go.mod h1:UkNAQd3GIcIGf0SeVgPpRdFStlNbqXla1AfSYxPUl2o=</span>
 github.com&#47;opentracing&#47;opentracing-go v1.1.0 h1:pWlfV3Bxv7k65HYwkikxat0+s3pV4bsqf19k25Ur8rU=
 github.com&#47;opentracing&#47;opentracing-go v1.1.0&#47;go.mod h1:UkNAQd3GIcIGf0SeVgPpRdFStlNbqXla1AfSYxPUl2o=
<span class="term-fg31">-github.com&#47;paulbellamy&#47;ratecounter v0.2.0&#47;go.mod h1:Hfx1hDpSGoqxkVVpBi&#47;IlYD7kChlfo5C6hzIHwPqfFE=</span>
 github.com&#47;pelletier&#47;go-toml v1.2.0&#47;go.mod h1:5z9KED0ma1S8pY6P1sdut58dfprrGBbd&#47;94hg7ilaic=
<span class="term-fg31">-github.com&#47;peterh&#47;liner v1.0.1-0.20180619022028-8c1271fcf47f&#47;go.mod h1:xIteQHvHuaLYG9IFj6mSxM0fCKrs34IrEQUhOYuGPHc=</span>
 github.com&#47;peterh&#47;liner v1.1.1-0.20190123174540-a2c9a5303de7 h1:oYW+YCJ1pachXTQmzR3rNLYGGz4g&#47;UgFcjb28p&#47;viDM=
 github.com&#47;peterh&#47;liner v1.1.1-0.20190123174540-a2c9a5303de7&#47;go.mod h1:CRroGNssyjTd&#47;qIG2FyxByd2S8JEAZXBl4qUrZf8GS0=
<span class="term-fg31">-github.com&#47;philhofer&#47;fwd v1.0.0&#47;go.mod h1:gk3iGcWd9+svBvR0sR+KPcfE+RNWozjowpeBVG3ZVNU=</span>
<span class="term-fg31">-github.com&#47;pierrec&#47;lz4 v2.0.5+incompatible&#47;go.mod h1:pdkljMzZIN41W+lC3N2tnIh5sFi+IEE17M5jbnwPHcY=</span>
 github.com&#47;pingcap&#47;errors v0.11.4 h1:lFuQV&#47;oaUMGcD2tqt+01ROSmJs75VG1ToEOkZIZ4nE4=
 github.com&#47;pingcap&#47;errors v0.11.4&#47;go.mod h1:Oi8TUi2kEtXXLMJk9l1cGmz20kV3TaQ0usTwv5KuLY8=
 github.com&#47;pkg&#47;diff v0.0.0-20210226163009-20ebb0f2a09e&#47;go.mod h1:pJLUxLENpZxwdsKMEsNbx1VGcRFpLqf3715MtcvvzbA=
<span class="term-fg31">-github.com&#47;pkg&#47;errors v0.8.0&#47;go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=</span>
 github.com&#47;pkg&#47;errors v0.8.1&#47;go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=
 github.com&#47;pkg&#47;errors v0.9.1 h1:FEBLx1zS214owpjy7qsBeixbURkuhQAwrK5UwLGTwt4=
 github.com&#47;pkg&#47;errors v0.9.1&#47;go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=
<span class="term-fg31">-github.com&#47;pkg&#47;term v0.0.0-20180730021639-bffc007b7fd5&#47;go.mod h1:eCbImbZ95eXtAUIbLAuAVnBnwf83mjf6QIVH8SHYwqQ=</span>
 github.com&#47;pmezard&#47;go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk&#47;f1lZbAQM=
 github.com&#47;pmezard&#47;go-difflib v1.0.0&#47;go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ&#47;4=
<span class="term-fg31">-github.com&#47;prometheus&#47;client_golang v0.9.1&#47;go.mod h1:7SWBe2y4D6OKWSNQJUaRYU&#47;AaXPKyh&#47;dDVn+NZz0KFw=</span>
<span class="term-fg31">-github.com&#47;prometheus&#47;client_golang v1.0.0&#47;go.mod h1:db9x61etRT2tGnBNRi70OPL5FsnadC4Ky3P0J6CfImo=</span>
 github.com&#47;prometheus&#47;client_golang v1.14.0 h1:nJdhIvne2eSX&#47;XRAFV9PcvFFRbrjbcTUj0VP62TMhnw=
 github.com&#47;prometheus&#47;client_golang v1.14.0&#47;go.mod h1:8vpkKitgIVNcqrRBWh1C4TIUQgYNtG&#47;XQE4E&#47;Zae36Y=
<span class="term-fg31">-github.com&#47;prometheus&#47;client_model v0.0.0-20180712105110-5c3871d89910&#47;go.mod h1:MbSGuTsp3dbXC40dX6PRTWyKYBIrTGTE9sqQNg2J8bo=</span>
<span class="term-fg31">-github.com&#47;prometheus&#47;client_model v0.0.0-20190129233127-fd36f4220a90&#47;go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=</span>
 github.com&#47;prometheus&#47;client_model v0.0.0-20190812154241-14fe0d1b01d4&#47;go.mod h1:xMI15A0UPsDsEKsMN9yxemIoYk6Tm2C1GtYGdfGttqA=
 github.com&#47;prometheus&#47;client_model v0.3.0 h1:UBgGFHqYdG&#47;TPFD1B1ogZywDqEkwp3fBMvqdiQ7Xew4=
 github.com&#47;prometheus&#47;client_model v0.3.0&#47;go.mod h1:LDGWKZIo7rky3hgvBe+caln+Dr3dPggB5dvjtD7w9+w=
<span class="term-fg31">-github.com&#47;prometheus&#47;common v0.4.1&#47;go.mod h1:TNfzLD0ON7rHzMJeJkieUDPYmFC7Snx&#47;y86RQel1bk4=</span>
<span class="term-fg31">-github.com&#47;prometheus&#47;common v0.6.0&#47;go.mod h1:eBmuwkDJBwy6iBfxCBob6t6dR6ENT&#47;y+J+Zk0j9GMYc=</span>
 github.com&#47;prometheus&#47;common v0.39.0 h1:oOyhkDq05hPZKItWVBkJ6g6AtGxi+fy7F4JvUV8uhsI=
 github.com&#47;prometheus&#47;common v0.39.0&#47;go.mod h1:6XBZ7lYdLCbkAVhwRsWTZn+IN5AB9F&#47;NXd5w0BbEX0Y=
<span class="term-fg31">-github.com&#47;prometheus&#47;procfs v0.0.0-20181005140218-185b4288413d&#47;go.mod h1:c3At6R&#47;oaqEKCNdg8wHV1ftS6bRYblBhIjjI8uT2IGk=</span>
<span class="term-fg31">-github.com&#47;prometheus&#47;procfs v0.0.2&#47;go.mod h1:TjEm7ze935MbeOT&#47;UhFTIMYKhuLP4wbCsTZCD3I8kEA=</span>
 github.com&#47;prometheus&#47;procfs v0.9.0 h1:wzCHvIvM5SxWqYvwgVL7yJY8Lz3PKn49KQtpgMYJfhI=
 github.com&#47;prometheus&#47;procfs v0.9.0&#47;go.mod h1:+pB4zwohETzFnmlpe6yd2lSc+0&#47;46IYZRB&#47;chUwxUZY=
<span class="term-fg31">-github.com&#47;retailnext&#47;hllpp v1.0.1-0.20180308014038-101a6d2f8b52&#47;go.mod h1:RDpi1RftBQPUCDRw6SmxeaREsAaRKnOclghuzp&#47;WRzc=</span>
<span class="term-fg31">-github.com&#47;rogpeppe&#47;go-internal v1.3.0&#47;go.mod h1:M8bDsm7K2OlrFYOpmOWEs&#47;qY81heoFRclV5y23lUDJ4=</span>
 github.com&#47;rogpeppe&#47;go-internal v1.6.1&#47;go.mod h1:xXDCJY+GAPziupqXw64V24skbSoqbTEfhy4qGm1nDQc=
 github.com&#47;rogpeppe&#47;go-internal v1.8.1&#47;go.mod h1:JeRgkft04UBgHMgCIwADu4Pn6Mtm5d4nPKWu0nJ5d+o=
 github.com&#47;rogpeppe&#47;go-internal v1.9.0 h1:73kH8U+JUqXU8lRuOHeVHaa&#47;SZPifC7BkcraZVejAe8=
<span class="term-fg36">@@ -499,19 +383,14 @@</span> github.com&#47;russross&#47;blackfriday&#47;v2 v2.1.0 h1:JIOH55&#47;0cWyOuilr9&#47;qlrm0BSXldqnqwMsf35Ld67mk=
 github.com&#47;russross&#47;blackfriday&#47;v2 v2.1.0&#47;go.mod h1:+Rmxgy9KzJVeS9&#47;2gXHxylqXiyQDYRxCVz55jmeOWTM=
 github.com&#47;ryanuber&#47;columnize v2.1.0+incompatible&#47;go.mod h1:sm1tb6uqfes&#47;u+d4ooFouqFdy9&#47;2g9QGwK3SQygK0Ts=
 github.com&#47;schollz&#47;closestmatch v2.1.0+incompatible&#47;go.mod h1:RtP1ddjLong6gTkbtmuhtR2uUrrJOpYzYRvbcPAid+g=
<span class="term-fg31">-github.com&#47;segmentio&#47;kafka-go v0.1.0&#47;go.mod h1:X6itGqS9L4jDletMsxZ7Dz+JFWxM6JHfPOCvTvk+EJo=</span>
<span class="term-fg31">-github.com&#47;segmentio&#47;kafka-go v0.2.0&#47;go.mod h1:X6itGqS9L4jDletMsxZ7Dz+JFWxM6JHfPOCvTvk+EJo=</span>
 github.com&#47;sergi&#47;go-diff v1.0.0&#47;go.mod h1:0CfEIISq7TuYL3j771MWULgwwjU+GofnZX9QAmXWZgo=
 github.com&#47;shirou&#47;gopsutil v3.21.4-0.20210419000835-c7a38de76ee5+incompatible h1:Bn1aCHHRnjv4Bl16T8rcaFjYSrGrIZvpiGO6P3Q4GpU=
 github.com&#47;shirou&#47;gopsutil v3.21.4-0.20210419000835-c7a38de76ee5+incompatible&#47;go.mod h1:5b4v6he4MtMOwMlS0TUMTu2PcXUg8+E1lC7eC3UO&#47;RA=
 github.com&#47;shurcooL&#47;sanitized_anchor_name v1.0.0&#47;go.mod h1:1NzhyTcUVG4SuEtjjoZeVRXNmyL&#47;1OwPU0+IJeTBvfc=
<span class="term-fg31">-github.com&#47;sirupsen&#47;logrus v1.2.0&#47;go.mod h1:LxeOpSwHxABJmUn&#47;MG1IvRgCAasNZTLOkJPxbbu5VWo=</span>
 github.com&#47;smartystreets&#47;assertions v0.0.0-20180927180507-b2de0cb4f26d&#47;go.mod h1:OnSkiWE9lh6wB0YB77sQom3nweQdgAjqCqsofrRNTgc=
 github.com&#47;smartystreets&#47;goconvey v1.6.4&#47;go.mod h1:syvi0&#47;a8iFYH4r&#47;RixwvyeAJjdLS9QV7WQ&#47;tjFTllLA=
<span class="term-fg31">-github.com&#47;spaolacci&#47;murmur3 v0.0.0-20180118202830-f09979ecbc72&#47;go.mod h1:JwIasOWyU6f++ZhiEuf87xNszmSA2myDM2Kzu9HwQUA=</span>
 github.com&#47;spf13&#47;afero v1.1.2&#47;go.mod h1:j4pytiNVoe2o6bmDsKpLACNPDBIoEAkihy7loJ1B0CQ=
 github.com&#47;spf13&#47;cast v1.3.0&#47;go.mod h1:Qx5cxh0v+4UWYiBimWS+eyWzqEqokIECu5etghLkUJE=
<span class="term-fg31">-github.com&#47;spf13&#47;cobra v0.0.3&#47;go.mod h1:1l0Ry5zgKvJasoi3XT1TypsSe7PqH0Sj9dhYf7v3XqQ=</span>
 github.com&#47;spf13&#47;cobra v0.0.5&#47;go.mod h1:3K3wKZymM7VvHMDS9+Akkh4K60UwM26emMESw8tLCHU=
 github.com&#47;spf13&#47;jwalterweatherman v1.0.0&#47;go.mod h1:cQK4TGJAtQXfYWX+Ddv3mKDzgVb68N+wFjFa4jdeBTo=
 github.com&#47;spf13&#47;pflag v1.0.3&#47;go.mod h1:DYY7MBk1bdzusC3SYhjObp+wFpr4gzcvqqNjLnInEg4=
<span class="term-fg36">@@ -519,22 +398,22 @@</span> github.com&#47;spf13&#47;viper v1.3.2&#47;go.mod h1:ZiWeW+zYFKm7srdB9IoDzzZXaJaI5eL9QjNiN&#47;DMA2s=
 github.com&#47;status-im&#47;keycard-go v0.2.0 h1:QDLFswOQu1r5jsycloeQh3bVU8n&#47;NatHHaZobtDnDzA=
 github.com&#47;status-im&#47;keycard-go v0.2.0&#47;go.mod h1:wlp8ZLbsmrF6g6WjugPAx+IzoLrkdf9+mHxBEeo3Hbg=
 github.com&#47;stretchr&#47;objx v0.1.0&#47;go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=
<span class="term-fg31">-github.com&#47;stretchr&#47;objx v0.1.1&#47;go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=</span>
 github.com&#47;stretchr&#47;objx v0.4.0&#47;go.mod h1:YvHI0jy2hoMjB+UWwv71VJQ9isScKT&#47;TqJzVSSt89Yw=
<span class="term-fg31">-github.com&#47;stretchr&#47;testify v1.2.0&#47;go.mod h1:a8OnRcib4nhh0OaRAV+Yts87kKdq0PP7pXfy6kDkUVs=</span>
<span class="term-fg32">+github.com&#47;stretchr&#47;objx v0.5.0 h1:1zr&#47;of2m5FGMsad5YfcqgdqdWrIhu+EBEJRhR1U7z&#47;c=</span>
<span class="term-fg32">+github.com&#47;stretchr&#47;objx v0.5.0&#47;go.mod h1:Yh+to48EsGEfYuaHDzXPcE3xhTkx73EhmCGUpEOglKo=</span>
 github.com&#47;stretchr&#47;testify v1.2.2&#47;go.mod h1:a8OnRcib4nhh0OaRAV+Yts87kKdq0PP7pXfy6kDkUVs=
 github.com&#47;stretchr&#47;testify v1.3.0&#47;go.mod h1:M5WIy9Dh21IEIfnGCwXGc5bZfKNJtfHm1UVUgZn+9EI=
 github.com&#47;stretchr&#47;testify v1.4.0&#47;go.mod h1:j7eGeouHqKxXV5pUuKE4zz7dFj8WfuZ+81PSLYec5m4=
 github.com&#47;stretchr&#47;testify v1.5.1&#47;go.mod h1:5W2xD1RspED5o8YsWQXVCued0rvSQ+mT+I5cxcmMvtA=
 github.com&#47;stretchr&#47;testify v1.7.0&#47;go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962&#47;h&#47;Wwjteg=
 github.com&#47;stretchr&#47;testify v1.7.1&#47;go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962&#47;h&#47;Wwjteg=
<span class="term-fg31">-github.com&#47;stretchr&#47;testify v1.8.0 h1:pSgiaMZlXftHpm5L7V1+rVB+AZJydKsMxsQBIJw4PKk=</span>
 github.com&#47;stretchr&#47;testify v1.8.0&#47;go.mod h1:yNjHg4UonilssWZ8iaSj1OCr&#47;vHnekPRkoO+kdMU+MU=
<span class="term-fg32">+github.com&#47;stretchr&#47;testify v1.8.1 h1:w7B6lhMri9wdJUVmEZPGGhZzrYTPvgJArz7wNPgYKsk=</span>
<span class="term-fg32">+github.com&#47;stretchr&#47;testify v1.8.1&#47;go.mod h1:w2LPCIKwWwSfY2zedu0+kehJoqGctiVI29o6fzry7u4=</span>
 github.com&#47;supranational&#47;blst v0.3.8-0.20220526154634-513d2456b344 h1:m+8fKfQwCAy1QjzINvKe&#47;pYtLjo2dl59x2w9YSEJxuY=
 github.com&#47;supranational&#47;blst v0.3.8-0.20220526154634-513d2456b344&#47;go.mod h1:jZJtfjgudtNl4en1tzwPIV3KjUnQUvG3&#47;j+w+fVonLw=
 github.com&#47;syndtr&#47;goleveldb v1.0.1-0.20210819022825-2ae1ddf74ef7 h1:epCh84lMvA70Z7CTTCmYQn2CKbY8j86K7&#47;FAIr141uY=
 github.com&#47;syndtr&#47;goleveldb v1.0.1-0.20210819022825-2ae1ddf74ef7&#47;go.mod h1:q4W45IWZaF22tdD+VEXcAWRA037jwmWEB5VWYORlTpc=
<span class="term-fg31">-github.com&#47;tinylib&#47;msgp v1.0.2&#47;go.mod h1:+d+yLhGm8mzTaHzB+wgMYrodPfmZrzkirds8fDWklFE=</span>
 github.com&#47;tklauser&#47;go-sysconf v0.3.5 h1:uu3Xl4nkLzQfXNsWn15rPc&#47;HQCJKObbt1dKJeWp3vU4=
 github.com&#47;tklauser&#47;go-sysconf v0.3.5&#47;go.mod h1:MkWzOF4RMCshBAMXuhXJs64Rte09mITnppBXY&#47;rYEFI=
 github.com&#47;tklauser&#47;numcpus v0.2.2 h1:oyhllyrScuYI6g+h&#47;zUvNXNp1wy7x8qQy3t&#47;piefldA=
<span class="term-fg36">@@ -554,11 +433,9 @@</span> github.com&#47;valyala&#47;fasthttp v1.6.0&#47;go.mod h1:FstJa9V+Pj9vQ7OJie2qMHdwemEDaDiSdBnvPM1Su9w=
 github.com&#47;valyala&#47;fasttemplate v1.0.1&#47;go.mod h1:UQGH1tvbgY+Nz5t2n7tXsz52dQxojPUpymEIMZ47gx8=
 github.com&#47;valyala&#47;fasttemplate v1.2.1&#47;go.mod h1:KHLXt3tVN2HBp8eijSv&#47;kGJopbvo7S+qRAEEKiv+SiQ=
 github.com&#47;valyala&#47;tcplisten v0.0.0-20161114210144-ceec8f93295a&#47;go.mod h1:v3UYOV9WzVtRmSR+PDvWpU&#47;qWl4Wa5LApYYX4ZtKbio=
<span class="term-fg31">-github.com&#47;willf&#47;bitset v1.1.3&#47;go.mod h1:RjeCKbqT1RxIR&#47;KWY6phxZiaY1IyutSBfGjNPySAYV4=</span>
 github.com&#47;xeipuuv&#47;gojsonpointer v0.0.0-20180127040702-4e3ac2762d5f&#47;go.mod h1:N2zxlSyiKSe5eX1tZViRH5QA0qijqEDrYZiPEAiq3wU=
 github.com&#47;xeipuuv&#47;gojsonreference v0.0.0-20180127040603-bd5ef7bd5415&#47;go.mod h1:GwrjFmJcFw6At&#47;Gs6z4yjiIwzuJ1&#47;+UwLxMQDVQXShQ=
 github.com&#47;xeipuuv&#47;gojsonschema v1.2.0&#47;go.mod h1:anYRn&#47;JVcOK2ZgGU+IjEV4nwlhoK5sQluxsYJ78Id3Y=
<span class="term-fg31">-github.com&#47;xlab&#47;treeprint v0.0.0-20180616005107-d6fb6747feb6&#47;go.mod h1:ce1O1j6UtZfjr22oyGxGLbauSBp2YVXpARAosm7dHBg=</span>
 github.com&#47;xordataexchange&#47;crypt v0.0.3-0.20170626215501-b2862e3d0a77&#47;go.mod h1:aYKd&#47;&#47;L2LvnjZzWKhF00oedf4jCCReLcmhLdhm1A27Q=
 github.com&#47;xrash&#47;smetrics v0.0.0-20201216005158-039620a65673 h1:bAn7&#47;zixMGCfxrRTfdpNzjtPYqr8smhKouy9mxVdGPU=
 github.com&#47;xrash&#47;smetrics v0.0.0-20201216005158-039620a65673&#47;go.mod h1:N3UwUGtsrSj3ccvlPHLoLsHnpR27oXr4ZE984MbSER8=
<span class="term-fg36">@@ -569,17 +446,8 @@</span> github.com&#47;yudai&#47;pp v2.0.1+incompatible&#47;go.mod h1:PuxR&#47;8QJ7cyCkFp&#47;aUDS+JY727OFEZkTdatxwunjIkc=
 github.com&#47;yuin&#47;goldmark v1.1.27&#47;go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
 github.com&#47;yuin&#47;goldmark v1.2.1&#47;go.mod h1:3hX8gzYuyVAZsxl0MRgGTJEmQBFcNTphYh9decYSb74=
 github.com&#47;yuin&#47;goldmark v1.3.5&#47;go.mod h1:mwnBkeHKe2W&#47;ZEtQ+71ViKU8L12m81fl3OWwC1Zlc8k=
<span class="term-fg31">-go.opencensus.io v0.21.0&#47;go.mod h1:mSImk1erAIZhrmZN+AvHh14ztQfjbGwt4TtuofqLduU=</span>
<span class="term-fg31">-go.opencensus.io v0.22.0&#47;go.mod h1:+kGneAE2xo2IficOXnaByMWTGM9T73dGwxeWcUqIpI8=</span>
<span class="term-fg31">-go.opencensus.io v0.22.2&#47;go.mod h1:yxeiOL68Rb0Xd1ddK5vPZ&#47;oVn4vY4Ynel7k9FzqtOIw=</span>
<span class="term-fg31">-go.uber.org&#47;atomic v1.3.2&#47;go.mod h1:gD2HeocX3+yG+ygLZcrzQJaqmWj9AIm7n08wl&#47;qW&#47;PE=</span>
<span class="term-fg31">-go.uber.org&#47;multierr v1.1.0&#47;go.mod h1:wR5kodmAFQ0UK8QlbwjlSNy0Z68gJhDJUG5sjR94q&#47;0=</span>
<span class="term-fg31">-go.uber.org&#47;zap v1.9.1&#47;go.mod h1:vwi&#47;ZaCAaUcBkycHslxD9B2zi4UTXhF60s6SWpuDF0Q=</span>
<span class="term-fg31">-golang.org&#47;x&#47;crypto v0.0.0-20180904163835-0709b304e793&#47;go.mod h1:6SG95UA2DQfeDnfUPMdvaQW0Q7yPrPDi9nlGo2tz2b4=</span>
 golang.org&#47;x&#47;crypto v0.0.0-20181203042331-505ab145d0a9&#47;go.mod h1:6SG95UA2DQfeDnfUPMdvaQW0Q7yPrPDi9nlGo2tz2b4=
 golang.org&#47;x&#47;crypto v0.0.0-20190308221718-c2843e01d9a2&#47;go.mod h1:djNgcEr1&#47;C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=
<span class="term-fg31">-golang.org&#47;x&#47;crypto v0.0.0-20190510104115-cbcb75029529&#47;go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=</span>
<span class="term-fg31">-golang.org&#47;x&#47;crypto v0.0.0-20190605123033-f99c8df09eb5&#47;go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=</span>
 golang.org&#47;x&#47;crypto v0.0.0-20190701094942-4def268fd1a4&#47;go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
 golang.org&#47;x&#47;crypto v0.0.0-20190909091759-094676da4a83&#47;go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
 golang.org&#47;x&#47;crypto v0.0.0-20191011191535-87dc89f01550&#47;go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=
<span class="term-fg36">@@ -591,56 +459,29 @@</span> golang.org&#47;x&#47;crypto v0.0.0-20210322153248-0c34fe9e7dc2&#47;go.mod h1:T9bdIzuCu7OtxOm1hfPfRQxPLYneinmdGuTeoZ9dtd4=
 golang.org&#47;x&#47;crypto v0.0.0-20210921155107-089bfa567519&#47;go.mod h1:GvvjBRRGRdwPK5ydBHafDWAxML&#47;pGHZbMvKqRZ5+Abc=
 golang.org&#47;x&#47;crypto v0.1.0 h1:MDRAIl0xIo9Io2xV565hzXHw3zVseKrJKodhohM5CjU=
 golang.org&#47;x&#47;crypto v0.1.0&#47;go.mod h1:RecgLatLF4+eUMCP1PoPZQb+cVrJcOPbHkTkbkB9sbw=
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20180321215751-8460e604b9de&#47;go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20180807140117-3d87b88a115f&#47;go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=</span>
 golang.org&#47;x&#47;exp v0.0.0-20190121172915-509febef88a4&#47;go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20190125153040-c74c464bbbf2&#47;go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20190306152737-a1d7652674e8&#47;go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20190510132918-efd6b22b2522&#47;go.mod h1:ZjyILWgesfNpC6sMxTJOJm9Kp84zZh5NQWvqDGG3Qr8=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20190829153037-c13cbed26979&#47;go.mod h1:86+5VVa7VpoJ4kLfm080zCjGlMRFzhUhsZKEZO7MGek=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20191030013958-a1ab85dbe136&#47;go.mod h1:JXzH8nQsPlswgeRAPE3MuO9GYsAcnJvJ4vnMwN&#47;5qkY=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20191129062945-2f5052295587&#47;go.mod h1:2RIsYlXP63K8oxa1u096TMicItID8zy7Y6sNkU49FU4=</span>
<span class="term-fg31">-golang.org&#47;x&#47;exp v0.0.0-20191227195350-da58074b4299&#47;go.mod h1:2RIsYlXP63K8oxa1u096TMicItID8zy7Y6sNkU49FU4=</span>
 golang.org&#47;x&#47;exp v0.0.0-20230206171751-46f607a40771 h1:xP7rWLUr1e1n2xkK5YB4LI0hPEy3LJC6Wk+D4pGlOJg=
 golang.org&#47;x&#47;exp v0.0.0-20230206171751-46f607a40771&#47;go.mod h1:CxIveKay+FTh1D0yPZemJVgC&#47;95VzuuOLq5Qi4xnoYc=
<span class="term-fg31">-golang.org&#47;x&#47;image v0.0.0-20180708004352-c73c2afc3b81&#47;go.mod h1:ux5Hcp&#47;YLpHSI86hEcLt0YII63i6oz57MZXIpbrjZUs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;image v0.0.0-20190227222117-0694c2d4d067&#47;go.mod h1:kZ7UVZpmo3dzQBMxlp+ypCbDeSB+sBbTgSJuh5dn5js=</span>
<span class="term-fg31">-golang.org&#47;x&#47;image v0.0.0-20190802002840-cff245a6509b&#47;go.mod h1:FeLwcggjj3mMvU+oOTbSwawSJRM1uh48EjtB4UJZlP0=</span>
 golang.org&#47;x&#47;lint v0.0.0-20181026193005-c67002cb31c3&#47;go.mod h1:UVdnD1Gm6xHRNCYTkRU2&#47;jEulfH38KcIWyp&#47;GAMgvoE=
 golang.org&#47;x&#47;lint v0.0.0-20190227174305-5b3e6a55c961&#47;go.mod h1:wehouNa3lNwaWXcvxsM5YxQ5yQlVC4a0KAMCusXpPoU=
<span class="term-fg31">-golang.org&#47;x&#47;lint v0.0.0-20190301231843-5614ed5bae6f&#47;go.mod h1:UVdnD1Gm6xHRNCYTkRU2&#47;jEulfH38KcIWyp&#47;GAMgvoE=</span>
 golang.org&#47;x&#47;lint v0.0.0-20190313153728-d0100b6bd8b3&#47;go.mod h1:6SW0HCj&#47;g11FgYtHlgUYUwCkIfeOF89ocIRzGO&#47;8vkc=
<span class="term-fg31">-golang.org&#47;x&#47;lint v0.0.0-20190409202823-959b441ac422&#47;go.mod h1:6SW0HCj&#47;g11FgYtHlgUYUwCkIfeOF89ocIRzGO&#47;8vkc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;lint v0.0.0-20190909230951-414d861bb4ac&#47;go.mod h1:6SW0HCj&#47;g11FgYtHlgUYUwCkIfeOF89ocIRzGO&#47;8vkc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;lint v0.0.0-20190930215403-16217165b5de&#47;go.mod h1:6SW0HCj&#47;g11FgYtHlgUYUwCkIfeOF89ocIRzGO&#47;8vkc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;lint v0.0.0-20191125180803-fdd1cda4f05f&#47;go.mod h1:5qLYkcX4OjUUV8bRuDixDT3tpyyb+LUpUlRWLxfhWrs=</span>
 golang.org&#47;x&#47;lint v0.0.0-20210508222113-6edffad5e616&#47;go.mod h1:3xt1FjdF8hUf6vQPIChWIBhFzV8gjjsPE&#47;fR3IyQdNY=
<span class="term-fg31">-golang.org&#47;x&#47;mobile v0.0.0-20190312151609-d3739f865fa6&#47;go.mod h1:z+o9i4GpDbdi3rU15maQ&#47;Ox0txvL9dWGYEHz965HBQE=</span>
<span class="term-fg31">-golang.org&#47;x&#47;mobile v0.0.0-20190719004257-d2bd2a29d028&#47;go.mod h1:E&#47;iHnbuqvinMTCcRqshq8CkpyQDoeVncDDYHnLhea+o=</span>
<span class="term-fg31">-golang.org&#47;x&#47;mod v0.0.0-20190513183733-4bf6d317e70e&#47;go.mod h1:mXi4GBBbnImb6dmsKGUJ2LatrhH&#47;nqhxcFungHvyanc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;mod v0.1.0&#47;go.mod h1:0QHyrYULN0&#47;3qlju5TqG8bIK38QM8yzMo5ekMj3DlcY=</span>
 golang.org&#47;x&#47;mod v0.1.1-0.20191105210325-c90efee705ee&#47;go.mod h1:QqPTAvyqsEbceGzBzNggFXnrqF1CaUcvgkdR5Ot7KZg=
 golang.org&#47;x&#47;mod v0.2.0&#47;go.mod h1:s0Qsj1ACt9ePp&#47;hMypM3fl4fZqREWJwdYDEqhRiZZUA=
 golang.org&#47;x&#47;mod v0.3.0&#47;go.mod h1:s0Qsj1ACt9ePp&#47;hMypM3fl4fZqREWJwdYDEqhRiZZUA=
 golang.org&#47;x&#47;mod v0.4.2&#47;go.mod h1:s0Qsj1ACt9ePp&#47;hMypM3fl4fZqREWJwdYDEqhRiZZUA=
<span class="term-fg31">-golang.org&#47;x&#47;mod v0.6.0 h1:b9gGHsz9&#47;HhJ3HF5DHQytPpuwocVTChQJK3AvoLRD5I=</span>
<span class="term-fg31">-golang.org&#47;x&#47;mod v0.6.0&#47;go.mod h1:4mET923SAdbXp2ki8ey+zGs1SLqsuM2Y0uvdZR&#47;fUNI=</span>
<span class="term-fg32">+golang.org&#47;x&#47;mod v0.9.0 h1:KENHtAZL2y3NLMYZeHY9DW8HW8V+kQyJsY&#47;V9JlKvCs=</span>
<span class="term-fg32">+golang.org&#47;x&#47;mod v0.9.0&#47;go.mod h1:iBbtSCu2XBx23ZKBPSOrRkjjQPZFPuis4dIYUhu&#47;chs=</span>
 golang.org&#47;x&#47;net v0.0.0-20180724234803-3673e40ba225&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
 golang.org&#47;x&#47;net v0.0.0-20180826012351-8a410e7b638d&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
 golang.org&#47;x&#47;net v0.0.0-20180906233101-161cd47e91fd&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20181114220301-adae6a3d119a&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=</span>
 golang.org&#47;x&#47;net v0.0.0-20181220203305-927f97764cc3&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20190108225652-1e06a53dbb7e&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=</span>
 golang.org&#47;x&#47;net v0.0.0-20190213061140-3a22650c66bd&#47;go.mod h1:mL1N&#47;T3taQHkDXs73rZJwtUhF3w3ftmwwsq0BUmARs4=
 golang.org&#47;x&#47;net v0.0.0-20190311183353-d8887717615a&#47;go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
 golang.org&#47;x&#47;net v0.0.0-20190327091125-710a502c58a2&#47;go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
 golang.org&#47;x&#47;net v0.0.0-20190404232315-eb5bcb51f2a3&#47;go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20190501004415-9ce7a6920f09&#47;go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=</span>
 golang.org&#47;x&#47;net v0.0.0-20190503192946-f4e77d36d62c&#47;go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20190603091049-60506f45cf65&#47;go.mod h1:HSz+uSET+XFnRR8LxR5pz3Of3rY3CfYBVs4xY44aLks=</span>
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20190613194153-d28f0bde5980&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=</span>
 golang.org&#47;x&#47;net v0.0.0-20190620200207-3b0461eec859&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.0.0-20190724013045-ca1201d0de80&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=</span>
 golang.org&#47;x&#47;net v0.0.0-20190827160401-ba9fcec4b297&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=
 golang.org&#47;x&#47;net v0.0.0-20191209160850-c0dbc17a3553&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=
 golang.org&#47;x&#47;net v0.0.0-20200226121028-0de0cce0169b&#47;go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4&#47;5GtJWs&#47;s=
<span class="term-fg36">@@ -656,13 +497,9 @@</span> golang.org&#47;x&#47;net v0.0.0-20210405180319-a5a99cb37ef4&#47;go.mod h1:p54w0d4576C0XHj96bSt6lcn1PtDYWL6XObtHCRCNQM=
 golang.org&#47;x&#47;net v0.0.0-20210610132358-84b48f89b13b&#47;go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=
 golang.org&#47;x&#47;net v0.0.0-20210805182204-aaa1db679c0d&#47;go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=
 golang.org&#47;x&#47;net v0.0.0-20211008194852-3b03d305991f&#47;go.mod h1:9nx3DQGgdP8bBQD5qxJ1jj9UTztislL4KSBs9R2vV5Y=
<span class="term-fg31">-golang.org&#47;x&#47;net v0.4.0 h1:Q5QPcMlvfxFTAPV0+07Xz&#47;MpK9NTXu2VDUuy0FeMfaU=</span>
<span class="term-fg31">-golang.org&#47;x&#47;net v0.4.0&#47;go.mod h1:MBQ8lrhLObU&#47;6UmLb4fmbmk5OcyYmqtbGd&#47;9yIeKjEE=</span>
<span class="term-fg32">+golang.org&#47;x&#47;net v0.8.0 h1:Zrh2ngAOFYneWTAIAPethzeaQLuHwhuBkuV6ZiRnUaQ=</span>
<span class="term-fg32">+golang.org&#47;x&#47;net v0.8.0&#47;go.mod h1:QVkue5JL9kW&#47;&#47;ek3r6jTKnTFis1tRmNAW2P1shuFdJc=</span>
 golang.org&#47;x&#47;oauth2 v0.0.0-20180821212333-d2e6202438be&#47;go.mod h1:N&#47;0e6XlmueqKjAGxoOufVs8QHGRruUQn6yWY3a++T0U=
<span class="term-fg31">-golang.org&#47;x&#47;oauth2 v0.0.0-20190226205417-e64efc72b421&#47;go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=</span>
<span class="term-fg31">-golang.org&#47;x&#47;oauth2 v0.0.0-20190604053449-0f29369cfe45&#47;go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=</span>
<span class="term-fg31">-golang.org&#47;x&#47;oauth2 v0.0.0-20191202225959-858c2ad4c8b6&#47;go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=</span>
<span class="term-fg31">-golang.org&#47;x&#47;oauth2 v0.0.0-20200107190931-bf48bf16ab8d&#47;go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=</span>
 golang.org&#47;x&#47;sync v0.0.0-20180314180146-1d60e4601c6f&#47;go.mod h1:RxMgew5VJxzue5&#47;jJTE5uejpjVlOe&#47;izrB70Jof72aM=
 golang.org&#47;x&#47;sync v0.0.0-20181108010431-42b317875d0f&#47;go.mod h1:RxMgew5VJxzue5&#47;jJTE5uejpjVlOe&#47;izrB70Jof72aM=
 golang.org&#47;x&#47;sync v0.0.0-20181221193216-37e7f081c4d4&#47;go.mod h1:RxMgew5VJxzue5&#47;jJTE5uejpjVlOe&#47;izrB70Jof72aM=
<span class="term-fg36">@@ -674,28 +511,17 @@</span> golang.org&#47;x&#47;sync v0.0.0-20210220032951-036812b2e83c&#47;go.mod h1:RxMgew5VJxzue5&#47;jJTE5uejpjVlOe&#47;izrB70Jof72aM=
 golang.org&#47;x&#47;sync v0.1.0 h1:wsuoTGHzEhffawBOhz5CYhcrV4IdKZbEyZjBMuTp12o=
 golang.org&#47;x&#47;sync v0.1.0&#47;go.mod h1:RxMgew5VJxzue5&#47;jJTE5uejpjVlOe&#47;izrB70Jof72aM=
 golang.org&#47;x&#47;sys v0.0.0-20180830151530-49385e6e1522&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20180905080454-ebe1bf3edb33&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=</span>
 golang.org&#47;x&#47;sys v0.0.0-20180909124046-d0be0721c37e&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20181116152217-5ac8a444bdc5&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=</span>
 golang.org&#47;x&#47;sys v0.0.0-20181205085412-a5c9d58dba9a&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
 golang.org&#47;x&#47;sys v0.0.0-20190215142949-d0b11bdaac8a&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
 golang.org&#47;x&#47;sys v0.0.0-20190222072716-a9d3bda3a223&#47;go.mod h1:STP8DvDyc&#47;dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190312061237-fead79001313&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
 golang.org&#47;x&#47;sys v0.0.0-20190412213103-97732733099d&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190502145724-3ef323f4f1fd&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190507160741-ecd444e8653b&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190606165138-5da285871e9c&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190624142023-c5567b49c5d0&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
 golang.org&#47;x&#47;sys v0.0.0-20190626221950-04f50cda93cb&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20190726091711-fc99dfbffb4e&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
 golang.org&#47;x&#47;sys v0.0.0-20190813064441-fde4db37ae7a&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20190904154756-749cb33beabd&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20191005200804-aed5e4c7ecf9&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20191026070338-33540a1f6037&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20191120155948-bd437916bb0e&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20191204072324-ce4227a45e2e&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20191228213918-04cbcbbfeed8&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.0.0-20200107162124-548cf772de50&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=</span>
 golang.org&#47;x&#47;sys v0.0.0-20200116001909-b77594299b42&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20200223170610-d5e6a3e2c0ae&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
 golang.org&#47;x&#47;sys v0.0.0-20200323222414-85ca7c5b95cd&#47;go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=
<span class="term-fg36">@@ -719,108 +545,56 @@</span> golang.org&#47;x&#47;sys v0.0.0-20211020174200-9d6173849985&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20220209214540-3681064d5158&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20220811171246-fbc7d0a398ab&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
 golang.org&#47;x&#47;sys v0.0.0-20220908164124-27713097b956&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.5.0 h1:MUK&#47;U&#47;4lj1t1oPg0HfuXDN&#47;Z1wv31ZJ&#47;YcPiGccS4DU=</span>
<span class="term-fg31">-golang.org&#47;x&#47;sys v0.5.0&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=</span>
<span class="term-fg32">+golang.org&#47;x&#47;sys v0.6.0 h1:MVltZSvRTcU2ljQOhs94SXPftV6DCNnZViHeQps87pQ=</span>
<span class="term-fg32">+golang.org&#47;x&#47;sys v0.6.0&#47;go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=</span>
 golang.org&#47;x&#47;term v0.0.0-20201117132131-f5c789dd3221&#47;go.mod h1:Nr5EML6q2oocZ2LXRh80K7BxOlk5&#47;8JxuGnuhpl+muw=
 golang.org&#47;x&#47;term v0.0.0-20201126162022-7de9c90e9dd1&#47;go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=
 golang.org&#47;x&#47;text v0.3.0&#47;go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi&#47;IjpwHt7yyuwOQ=
<span class="term-fg31">-golang.org&#47;x&#47;text v0.3.1-0.20180807135948-17ff2d5776d2&#47;go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi&#47;IjpwHt7yyuwOQ=</span>
 golang.org&#47;x&#47;text v0.3.2&#47;go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=
 golang.org&#47;x&#47;text v0.3.3&#47;go.mod h1:5Zoc&#47;QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
 golang.org&#47;x&#47;text v0.3.4&#47;go.mod h1:5Zoc&#47;QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
 golang.org&#47;x&#47;text v0.3.5&#47;go.mod h1:5Zoc&#47;QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
 golang.org&#47;x&#47;text v0.3.6&#47;go.mod h1:5Zoc&#47;QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
 golang.org&#47;x&#47;text v0.3.7&#47;go.mod h1:u+2+&#47;6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=
<span class="term-fg31">-golang.org&#47;x&#47;text v0.7.0 h1:4BRB4x83lYWy72KwLD&#47;qYDuTu7q9PjSagHvijDw7cLo=</span>
<span class="term-fg31">-golang.org&#47;x&#47;text v0.7.0&#47;go.mod h1:mrYo+phRRbMaCq&#47;xk9113O4dZlRixOauAjOtrjsXDZ8=</span>
<span class="term-fg31">-golang.org&#47;x&#47;time v0.0.0-20181108054448-85acf8d2951c&#47;go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW&#47;OXSQhTDSoE431IQ=</span>
<span class="term-fg31">-golang.org&#47;x&#47;time v0.0.0-20190308202827-9d24e82272b4&#47;go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW&#47;OXSQhTDSoE431IQ=</span>
<span class="term-fg32">+golang.org&#47;x&#47;text v0.8.0 h1:57P1ETyNKtuIjB4SRd15iJxuhj8Gc416Y78H3qgMh68=</span>
<span class="term-fg32">+golang.org&#47;x&#47;text v0.8.0&#47;go.mod h1:e1OnstbJyHTd6l&#47;uOt8jFFHp6TRDWZR&#47;bV3emEE&#47;zU8=</span>
 golang.org&#47;x&#47;time v0.0.0-20201208040808-7e3f01d25324&#47;go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW&#47;OXSQhTDSoE431IQ=
 golang.org&#47;x&#47;time v0.0.0-20210220033141-f8bda1e9f3ba&#47;go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW&#47;OXSQhTDSoE431IQ=
 golang.org&#47;x&#47;time v0.0.0-20220922220347-f3bd1da661af h1:Yx9k8YCG3dvF87UAn2tu2HQLf2dt&#47;eR1bXxpLMWeH+Y=
 golang.org&#47;x&#47;time v0.0.0-20220922220347-f3bd1da661af&#47;go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW&#47;OXSQhTDSoE431IQ=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20180525024113-a5b4c53f6e8b&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=</span>
 golang.org&#47;x&#47;tools v0.0.0-20180917221912-90fa682c2a6e&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20181030221726-6c7e314b6563&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=</span>
 golang.org&#47;x&#47;tools v0.0.0-20181221001348-537d06c36207&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
 golang.org&#47;x&#47;tools v0.0.0-20190114222345-bf090417da8b&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190206041539-40960b6deb8e&#47;go.mod h1:n7NCudcB&#47;nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=</span>
 golang.org&#47;x&#47;tools v0.0.0-20190226205152-f727befe758c&#47;go.mod h1:9Yl7xja0Znq3iFh3HoIrodX9oNMXvdceNzlUR8zjMvY=
 golang.org&#47;x&#47;tools v0.0.0-20190311212946-11955173bddd&#47;go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190312151545-0bb0c0a6e846&#47;go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190312170243-e65039ee4138&#47;go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=</span>
 golang.org&#47;x&#47;tools v0.0.0-20190327201419-c70d86f8b7cf&#47;go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
 golang.org&#47;x&#47;tools v0.0.0-20190328211700-ab21143f2384&#47;go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190425150028-36563e24a262&#47;go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190506145303-2d16b83fe98c&#47;go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=</span>
 golang.org&#47;x&#47;tools v0.0.0-20190524140312-2c0ae7006135&#47;go.mod h1:RgjU9mgBXZiqYHBnxXauZ1Gv1EHHAz9KjViQ78xBX0Q=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190606124116-d0a3d012864b&#47;go.mod h1:&#47;rFqwRUd4F7ZHNgwSSTFct+R&#47;Kf4OFW1sUzUTQQTgfc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190621195816-6e04913cbbac&#47;go.mod h1:&#47;rFqwRUd4F7ZHNgwSSTFct+R&#47;Kf4OFW1sUzUTQQTgfc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190628153133-6cdbf07be9d0&#47;go.mod h1:&#47;rFqwRUd4F7ZHNgwSSTFct+R&#47;Kf4OFW1sUzUTQQTgfc=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190816200558-6889da9d5479&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20190911174233-4f2ddba30aff&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20191012152004-8de300cfc20a&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20191113191852-77e3bb0ad9e7&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20191115202509-3a792d9c32b2&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=</span>
 golang.org&#47;x&#47;tools v0.0.0-20191119224855-298f0cb1881e&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=
 golang.org&#47;x&#47;tools v0.0.0-20191125144606-a911d9008d1f&#47;go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20191216173652-a0e659d51361&#47;go.mod h1:TB2adYChydJhpapKDTa4BR&#47;hXlZSLoq2Wpct&#47;0txZ28=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20191227053925-7b8e75db28f4&#47;go.mod h1:TB2adYChydJhpapKDTa4BR&#47;hXlZSLoq2Wpct&#47;0txZ28=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.0.0-20200108203644-89082a384178&#47;go.mod h1:TB2adYChydJhpapKDTa4BR&#47;hXlZSLoq2Wpct&#47;0txZ28=</span>
 golang.org&#47;x&#47;tools v0.0.0-20200130002326-2f3ba24bd6e7&#47;go.mod h1:TB2adYChydJhpapKDTa4BR&#47;hXlZSLoq2Wpct&#47;0txZ28=
 golang.org&#47;x&#47;tools v0.0.0-20200619180055-7c47624df98f&#47;go.mod h1:EkVYQZoAsY45+roYkvgYkIh4xh&#47;qjgUK9TdY2XT94GE=
 golang.org&#47;x&#47;tools v0.0.0-20210106214847-113979e3529a&#47;go.mod h1:emZCQorbCU4vsT4fOWvOPXz4eW1wZW4PmDk9uLelYpA=
 golang.org&#47;x&#47;tools v0.1.3&#47;go.mod h1:o0xws9oXOQQZyjljx8fwUC0k7L1pTE6eaCbjGeHmOkk=
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.2.0 h1:G6AHpWxTMGY1KyEYoAQ5WTtIekUUvDNjan3ugu60JvE=</span>
<span class="term-fg31">-golang.org&#47;x&#47;tools v0.2.0&#47;go.mod h1:y4OqIKeOV&#47;fWJetJ8bXPU1sEVniLMIyDAZWeHdV+NTA=</span>
<span class="term-fg32">+golang.org&#47;x&#47;tools v0.7.0 h1:W4OVu8VVOaIO0yzWMNdepAulS7YfoS3Zabrm8DOXXU4=</span>
<span class="term-fg32">+golang.org&#47;x&#47;tools v0.7.0&#47;go.mod h1:4pg6aUX35JBAogB10C9AtvVL+qowtN4pT3CGSQex14s=</span>
 golang.org&#47;x&#47;xerrors v0.0.0-20190717185122-a985d3407aa7&#47;go.mod h1:I&#47;5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
 golang.org&#47;x&#47;xerrors v0.0.0-20191011141410-1b5146add898&#47;go.mod h1:I&#47;5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
 golang.org&#47;x&#47;xerrors v0.0.0-20191204190536-9bdfabe68543&#47;go.mod h1:I&#47;5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
 golang.org&#47;x&#47;xerrors v0.0.0-20200804184101-5ec99f83aff1&#47;go.mod h1:I&#47;5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=
 golang.org&#47;x&#47;xerrors v0.0.0-20220517211312-f3a8303e98df h1:5Pf6pFKu98ODmgnpvkJ3kFUOQGGLIzLIkbzUHp47618=
 golang.org&#47;x&#47;xerrors v0.0.0-20220517211312-f3a8303e98df&#47;go.mod h1:K8+ghG5WaK9qNqU5K3HdILfMLy1f3aNYFI&#47;wnl100a8=
<span class="term-fg31">-gonum.org&#47;v1&#47;gonum v0.0.0-20180816165407-929014505bf4&#47;go.mod h1:Y+Yx5eoAFn32cQvJDxZx5Dpnq+c3wtXuadVZAcxbbBo=</span>
<span class="term-fg31">-gonum.org&#47;v1&#47;gonum v0.0.0-20181121035319-3f7ecaa7e8ca&#47;go.mod h1:Y+Yx5eoAFn32cQvJDxZx5Dpnq+c3wtXuadVZAcxbbBo=</span>
<span class="term-fg31">-gonum.org&#47;v1&#47;gonum v0.6.0&#47;go.mod h1:9mxDZsDKxgMAuccQkewq682L+0eCu4dCN2yonUJTCLU=</span>
<span class="term-fg31">-gonum.org&#47;v1&#47;netlib v0.0.0-20181029234149-ec6d1f5cefe6&#47;go.mod h1:wa6Ws7BG&#47;ESfp6dHfk7C6KdzKA7wR7u&#47;rKwOGE66zvw=</span>
<span class="term-fg31">-gonum.org&#47;v1&#47;netlib v0.0.0-20190313105609-8cb42192e0e0&#47;go.mod h1:wa6Ws7BG&#47;ESfp6dHfk7C6KdzKA7wR7u&#47;rKwOGE66zvw=</span>
<span class="term-fg31">-gonum.org&#47;v1&#47;plot v0.0.0-20190515093506-e2840ee46a6b&#47;go.mod h1:Wt8AAjI+ypCyYX3nZBvf6cAIx93T+c&#47;OS2HFAYskSZc=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.4.0&#47;go.mod h1:8k5glujaEP+g9n7WNsDg8QP6cUVNI86fCNMcbazEtwE=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.7.0&#47;go.mod h1:WtwebWUNSVBH&#47;HAw79HIFXZNqEvBhG+Ra+ax0hx3E3M=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.8.0&#47;go.mod h1:o4eAsZoiT+ibD93RtjEohWalFOjRDx6CVaqeizhEnKg=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.9.0&#47;go.mod h1:o4eAsZoiT+ibD93RtjEohWalFOjRDx6CVaqeizhEnKg=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.13.0&#47;go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.14.0&#47;go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=</span>
<span class="term-fg31">-google.golang.org&#47;api v0.15.0&#47;go.mod h1:iLdEw5Ide6rF15KTC1Kkl0iskquN2gFfn9o9XIsbkAI=</span>
 google.golang.org&#47;appengine v1.1.0&#47;go.mod h1:EbEs0AVv82hx2wNQdGPgUI5lhzA&#47;G0D9YwlJXL52JkM=
 google.golang.org&#47;appengine v1.4.0&#47;go.mod h1:xpcJRLb0r&#47;rnEns0DIKYYv+WjYCduHsrkT7&#47;EB5XEv4=
<span class="term-fg31">-google.golang.org&#47;appengine v1.5.0&#47;go.mod h1:xpcJRLb0r&#47;rnEns0DIKYYv+WjYCduHsrkT7&#47;EB5XEv4=</span>
<span class="term-fg31">-google.golang.org&#47;appengine v1.6.1&#47;go.mod h1:i06prIuMbXzDqacNJfV5OdTW448YApPu5ww&#47;cMBSeb0=</span>
<span class="term-fg31">-google.golang.org&#47;appengine v1.6.5&#47;go.mod h1:8WjMMxjGQR8xUklV&#47;ARdw2HLXBOI7O7uCIDZVag1xfc=</span>
 google.golang.org&#47;genproto v0.0.0-20180518175338-11a468237815&#47;go.mod h1:JiN7NxoALGmiZfu7CAH4rXhgtRTLTxftemlI0sWmxmc=
 google.golang.org&#47;genproto v0.0.0-20180817151627-c66870c02cf8&#47;go.mod h1:JiN7NxoALGmiZfu7CAH4rXhgtRTLTxftemlI0sWmxmc=
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190307195333-5fe7a883aa19&#47;go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5&#47;KpmUdxsrq26oE=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190418145605-e7d98fc518a7&#47;go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5&#47;KpmUdxsrq26oE=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190425155659-357c62f0e4bb&#47;go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5&#47;KpmUdxsrq26oE=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190502173448-54afdca5d873&#47;go.mod h1:VzzqZJRnGkLBvHegQrXjBqPurQTc5&#47;KpmUdxsrq26oE=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190716160619-c506a9f90610&#47;go.mod h1:DMBHOl98Agz4BDEuKkezgsaosCRResVns1a3J2ZsMNc=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190801165951-fa694d86fc64&#47;go.mod h1:DMBHOl98Agz4BDEuKkezgsaosCRResVns1a3J2ZsMNc=</span>
 google.golang.org&#47;genproto v0.0.0-20190819201941-24fa4b261c55&#47;go.mod h1:DMBHOl98Agz4BDEuKkezgsaosCRResVns1a3J2ZsMNc=
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20190911173649-1774047e7e51&#47;go.mod h1:IbNlFCBrqXvoKpeg0TB2l7cyZUmoaFKYIwrEpbDKLA8=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20191108220845-16a3f7862a1a&#47;go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20191115194625-c23dd37a84c9&#47;go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20191216164720-4f79533eabd1&#47;go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20191230161307-f3c370f40bfb&#47;go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=</span>
<span class="term-fg31">-google.golang.org&#47;genproto v0.0.0-20200108215221-bd8f9a0ef82f&#47;go.mod h1:n3cpQtvxv34hfy77yVDNjmbRyujviMdxYliBSkLhpCc=</span>
 google.golang.org&#47;genproto v0.0.0-20200526211855-cb27e3aa2013&#47;go.mod h1:NbSheEEYHJ7i3ixzK3sjbqSGDJWnxyFXZblF3eUsNvo=
 google.golang.org&#47;genproto v0.0.0-20210624195500-8bfb893ecb84&#47;go.mod h1:SzzZ&#47;N+nwJDaO1kznhnlzqS8ocJICar6hYhVyhi++24=
 google.golang.org&#47;grpc v1.12.0&#47;go.mod h1:yo6s7OP7yaDglbqo1J04qKzAhqBH6lvTonzMVmEdcZw=
 google.golang.org&#47;grpc v1.19.0&#47;go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=
<span class="term-fg31">-google.golang.org&#47;grpc v1.20.1&#47;go.mod h1:10oTOabMzJvdu6&#47;UiuZezV6QK5dSlG84ov&#47;aaiqXj38=</span>
<span class="term-fg31">-google.golang.org&#47;grpc v1.21.1&#47;go.mod h1:oYelfM1adQP15Ek0mdvEgi9Df8B9CZIaU1084ijfRaM=</span>
 google.golang.org&#47;grpc v1.23.0&#47;go.mod h1:Y5yQAOtifL1yxbo5wqy6BxZv8vAUGQwXBOALyacEbxg=
 google.golang.org&#47;grpc v1.25.1&#47;go.mod h1:c3i+UQWmh7LiEpx4sFZnkU36qjEYZ0imhYfXVyQciAY=
<span class="term-fg31">-google.golang.org&#47;grpc v1.26.0&#47;go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=</span>
 google.golang.org&#47;grpc v1.27.0&#47;go.mod h1:qbnxyOmOxrQa7FizSgH+ReBfzJrCY1pSN7KXBS8abTk=
 google.golang.org&#47;grpc v1.38.0&#47;go.mod h1:NREThFqKR1f3iQ6oBuvc5LadQuXVGo9rkm5ZGrQdJfM=
 google.golang.org&#47;protobuf v0.0.0-20200109180630-ec00e32a8dfd&#47;go.mod h1:DFci5gLYBciE7Vtevhsrf46CRTquxDuWsQurQQe4oz8=
<span class="term-fg36">@@ -836,7 +610,6 @@</span> google.golang.org&#47;protobuf v1.26.0-rc.1&#47;go.mod h1:jlhhOSvTdKEhbULTjvd4ARK9grFBp09yW+WbY&#47;TyQbw=
 google.golang.org&#47;protobuf v1.26.0&#47;go.mod h1:9q0QmTI4eRPtz6boOQmLYwt+qCgq0jsYwAQnmE0givc=
 google.golang.org&#47;protobuf v1.28.1 h1:d0NfwRgPtno5B1Wa6L2DAG+KivqkdutMf1UhdNx175w=
 google.golang.org&#47;protobuf v1.28.1&#47;go.mod h1:HV8QOd&#47;L58Z+nl8r43ehVNZIU&#47;HEI6OcFqwMG9pJV4I=
<span class="term-fg31">-gopkg.in&#47;alecthomas&#47;kingpin.v2 v2.2.6&#47;go.mod h1:FMv+mEhP44yOT+4EoQTLFTRgOQ1FBLkstjWtayDeSgw=</span>
 gopkg.in&#47;check.v1 v0.0.0-20161208181325-20d25e280405&#47;go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof&#47;cbN4VW5Yz0=
 gopkg.in&#47;check.v1 v1.0.0-20180628173108-788fd7840127&#47;go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof&#47;cbN4VW5Yz0=
 gopkg.in&#47;check.v1 v1.0.0-20190902080502-41f04d3bba15&#47;go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof&#47;cbN4VW5Yz0=
<span class="term-fg36">@@ -848,6 +621,8 @@</span> gopkg.in&#47;go-playground&#47;assert.v1 v1.2.1&#47;go.mod h1:9RXL0bg&#47;zibRAgZUYszZSwO&#47;z8Y&#47;a8bDuhia5mkpMnE=
 gopkg.in&#47;go-playground&#47;validator.v8 v8.18.2&#47;go.mod h1:RX2a&#47;7Ha8BgOhfk7j780h4&#47;u&#47;RRjR0eouCJSH80&#47;M2Y=
 gopkg.in&#47;ini.v1 v1.51.1&#47;go.mod h1:pNLf8WUiyNEtQjuu5G5vTm06TEv9tsIgeAvK8hOrP4k=
 gopkg.in&#47;mgo.v2 v2.0.0-20180705113604-9856a29383ce&#47;go.mod h1:yeKp02qBN3iKW1OzL3MGk2IdtZzaj7SFntXj72NppTA=
<span class="term-fg32">+gopkg.in&#47;natefinch&#47;lumberjack.v2 v2.0.0 h1:1Lc07Kr7qY4U2YPouBjpCLxpiyxIVoxqXgkXLknAOE8=</span>
<span class="term-fg32">+gopkg.in&#47;natefinch&#47;lumberjack.v2 v2.0.0&#47;go.mod h1:l0ndWWf7gzL7RNwBG7wST&#47;UCcT4T24xpD6X8LsfU&#47;+k=</span>
 gopkg.in&#47;natefinch&#47;npipe.v2 v2.0.0-20160621034901-c1b8fa8bdcce h1:+JknDZhAj8YMt7GC73Ei8pv4MzjDUNPHgQWJdtMAaDU=
 gopkg.in&#47;natefinch&#47;npipe.v2 v2.0.0-20160621034901-c1b8fa8bdcce&#47;go.mod h1:5AcXVHNjg+BDxry382+8OKon8SEWiKktQR07RKPsv1c=
 gopkg.in&#47;tomb.v1 v1.0.0-20141024135613-dd632973f1e7 h1:uRGJdciOHaEIrze2W8Q3AKkepLTh2hOroT7a+7czfdQ=
<span class="term-fg36">@@ -866,11 +641,6 @@</span> gopkg.in&#47;yaml.v3 v3.0.0-20210107192922-496545a6307b&#47;go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
 gopkg.in&#47;yaml.v3 v3.0.1 h1:fxVm&#47;GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=
 gopkg.in&#47;yaml.v3 v3.0.1&#47;go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=
 honnef.co&#47;go&#47;tools v0.0.0-20190102054323-c2f93a96b099&#47;go.mod h1:rf3lG4BRIbNafJWhAfAdb&#47;ePZxsR&#47;4RtNHQocxwk9r4=
<span class="term-fg31">-honnef.co&#47;go&#47;tools v0.0.0-20190106161140-3f1c8253044a&#47;go.mod h1:rf3lG4BRIbNafJWhAfAdb&#47;ePZxsR&#47;4RtNHQocxwk9r4=</span>
<span class="term-fg31">-honnef.co&#47;go&#47;tools v0.0.0-20190418001031-e561f6794a2a&#47;go.mod h1:rf3lG4BRIbNafJWhAfAdb&#47;ePZxsR&#47;4RtNHQocxwk9r4=</span>
 honnef.co&#47;go&#47;tools v0.0.0-20190523083050-ea95bdfd59fc&#47;go.mod h1:rf3lG4BRIbNafJWhAfAdb&#47;ePZxsR&#47;4RtNHQocxwk9r4=
<span class="term-fg31">-honnef.co&#47;go&#47;tools v0.0.1-2019.2.3&#47;go.mod h1:a3bituU0lyd329TUQxRnasdCoJDkEUEAqEt0JzvZhAg=</span>
<span class="term-fg31">-rsc.io&#47;binaryregexp v0.2.0&#47;go.mod h1:qTv7&#47;COck+e2FymRvadv62gMdZztPaShugOCi3I+8D8=</span>
<span class="term-fg31">-rsc.io&#47;pdf v0.1.1&#47;go.mod h1:n8OzWcQ6Sp37PL01nO98y4iUCRdTGarVfzxY20ICaU4=</span>
 rsc.io&#47;tmplfunc v0.0.3 h1:53XFQh69AfOa8Tw0Jm7t+GV7KZhOi6jzsCzTtKbMvzU=
 rsc.io&#47;tmplfunc v0.0.3&#47;go.mod h1:AG3sTPzElb1Io3Yg4voV9AGZJuleGAwaVRxL9M49PhA=</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                    </div>
                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of <a href="https://github.com/ethereum-optimism/op-geth"><code>op-geth</code></a>, a fork of <a href="https://github.com/ethereum/go-ethereum"><code>go-ethereum</code></a>.
and execution-engine of the <a href="https://github.com/ethereum-optimism/optimism">OP-stack</a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
